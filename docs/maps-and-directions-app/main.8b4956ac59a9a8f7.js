(self.webpackChunkMapsAndDirectionsApp=self.webpackChunkMapsAndDirectionsApp||[]).push([[179],{562:(Kd,pc,_l)=>{"use strict";function Rn(t){return"function"==typeof t}function _h(t){const r=t(a=>{Error.call(a),a.stack=(new Error).stack});return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}const Yd=_h(t=>function(r){t(this),this.message=r?`${r.length} errors occurred during unsubscription:\n${r.map((a,h)=>`${h+1}) ${a.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=r});function d(t,n){if(t){const r=t.indexOf(n);0<=r&&t.splice(r,1)}}class Kn{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:r}=this;if(r)if(this._parentage=null,Array.isArray(r))for(const g of r)g.remove(this);else r.remove(this);const{initialTeardown:a}=this;if(Rn(a))try{a()}catch(g){n=g instanceof Yd?g.errors:[g]}const{_teardowns:h}=this;if(h){this._teardowns=null;for(const g of h)try{We(g)}catch(b){n=null!=n?n:[],b instanceof Yd?n=[...n,...b.errors]:n.push(b)}}if(n)throw new Yd(n)}}add(n){var r;if(n&&n!==this)if(this.closed)We(n);else{if(n instanceof Kn){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._teardowns=null!==(r=this._teardowns)&&void 0!==r?r:[]).push(n)}}_hasParent(n){const{_parentage:r}=this;return r===n||Array.isArray(r)&&r.includes(n)}_addParent(n){const{_parentage:r}=this;this._parentage=Array.isArray(r)?(r.push(n),r):r?[r,n]:n}_removeParent(n){const{_parentage:r}=this;r===n?this._parentage=null:Array.isArray(r)&&d(r,n)}remove(n){const{_teardowns:r}=this;r&&d(r,n),n instanceof Kn&&n._removeParent(this)}}Kn.EMPTY=(()=>{const t=new Kn;return t.closed=!0,t})();const Ao=Kn.EMPTY;function Jr(t){return t instanceof Kn||t&&"closed"in t&&Rn(t.remove)&&Rn(t.add)&&Rn(t.unsubscribe)}function We(t){Rn(t)?t():t.unsubscribe()}const _t={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Pe={setTimeout(...t){const{delegate:n}=Pe;return((null==n?void 0:n.setTimeout)||setTimeout)(...t)},clearTimeout(t){const{delegate:n}=Pe;return((null==n?void 0:n.clearTimeout)||clearTimeout)(t)},delegate:void 0};function li(t){Pe.setTimeout(()=>{const{onUnhandledError:n}=_t;if(!n)throw t;n(t)})}function Tn(){}const yl=Bi("C",void 0,void 0);function Bi(t,n,r){return{kind:t,value:n,error:r}}let ur=null;function Po(t){if(_t.useDeprecatedSynchronousErrorHandling){const n=!ur;if(n&&(ur={errorThrown:!1,error:null}),t(),n){const{errorThrown:r,error:a}=ur;if(ur=null,r)throw a}}else t()}class ko extends Kn{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Jr(n)&&n.add(this)):this.destination=bu}static create(n,r,a){return new vi(n,r,a)}next(n){this.isStopped?us(function vl(t){return Bi("N",t,void 0)}(n),this):this._next(n)}error(n){this.isStopped?us(function Qr(t){return Bi("E",void 0,t)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?us(yl,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const xl=Function.prototype.bind;function Lo(t,n){return xl.call(t,n)}class fc{constructor(n){this.partialObserver=n}next(n){const{partialObserver:r}=this;if(r.next)try{r.next(n)}catch(a){cs(a)}}error(n){const{partialObserver:r}=this;if(r.error)try{r.error(n)}catch(a){cs(a)}else cs(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(r){cs(r)}}}class vi extends ko{constructor(n,r,a){let h;if(super(),Rn(n)||!n)h={next:null!=n?n:void 0,error:null!=r?r:void 0,complete:null!=a?a:void 0};else{let g;this&&_t.useDeprecatedNextContext?(g=Object.create(n),g.unsubscribe=()=>this.unsubscribe(),h={next:n.next&&Lo(n.next,g),error:n.error&&Lo(n.error,g),complete:n.complete&&Lo(n.complete,g)}):h=n}this.destination=new fc(h)}}function cs(t){_t.useDeprecatedSynchronousErrorHandling?function ao(t){_t.useDeprecatedSynchronousErrorHandling&&ur&&(ur.errorThrown=!0,ur.error=t)}(t):li(t)}function us(t,n){const{onStoppedNotification:r}=_t;r&&Pe.setTimeout(()=>r(t,n))}const bu={closed:!0,next:Tn,error:function ba(t){throw t},complete:Tn},xi="function"==typeof Symbol&&Symbol.observable||"@@observable";function ci(t){return t}let Yn=(()=>{class t{constructor(r){r&&(this._subscribe=r)}lift(r){const a=new t;return a.source=this,a.operator=r,a}subscribe(r,a,h){const g=function Bs(t){return t&&t instanceof ko||function mc(t){return t&&Rn(t.next)&&Rn(t.error)&&Rn(t.complete)}(t)&&Jr(t)}(r)?r:new vi(r,a,h);return Po(()=>{const{operator:b,source:D}=this;g.add(b?b.call(g,D):D?this._subscribe(g):this._trySubscribe(g))}),g}_trySubscribe(r){try{return this._subscribe(r)}catch(a){r.error(a)}}forEach(r,a){return new(a=$t(a))((h,g)=>{const b=new vi({next:D=>{try{r(D)}catch(I){g(I),b.unsubscribe()}},error:g,complete:h});this.subscribe(b)})}_subscribe(r){var a;return null===(a=this.source)||void 0===a?void 0:a.subscribe(r)}[xi](){return this}pipe(...r){return function Ni(t){return 0===t.length?ci:1===t.length?t[0]:function(r){return t.reduce((a,h)=>h(a),r)}}(r)(this)}toPromise(r){return new(r=$t(r))((a,h)=>{let g;this.subscribe(b=>g=b,b=>h(b),()=>a(g))})}}return t.create=n=>new t(n),t})();function $t(t){var n;return null!==(n=null!=t?t:_t.Promise)&&void 0!==n?n:Promise}const Ns=_h(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let wl=(()=>{class t extends Yn{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(r){const a=new Vs(this,this);return a.operator=r,a}_throwIfClosed(){if(this.closed)throw new Ns}next(r){Po(()=>{if(this._throwIfClosed(),!this.isStopped){const a=this.observers.slice();for(const h of a)h.next(r)}})}error(r){Po(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=r;const{observers:a}=this;for(;a.length;)a.shift().error(r)}})}complete(){Po(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:r}=this;for(;r.length;)r.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var r;return(null===(r=this.observers)||void 0===r?void 0:r.length)>0}_trySubscribe(r){return this._throwIfClosed(),super._trySubscribe(r)}_subscribe(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)}_innerSubscribe(r){const{hasError:a,isStopped:h,observers:g}=this;return a||h?Ao:(g.push(r),new Kn(()=>d(g,r)))}_checkFinalizedStatuses(r){const{hasError:a,thrownError:h,isStopped:g}=this;a?r.error(h):g&&r.complete()}asObservable(){const r=new Yn;return r.source=this,r}}return t.create=(n,r)=>new Vs(n,r),t})();class Vs extends wl{constructor(n,r){super(),this.destination=n,this.source=r}next(n){var r,a;null===(a=null===(r=this.destination)||void 0===r?void 0:r.next)||void 0===a||a.call(r,n)}error(n){var r,a;null===(a=null===(r=this.destination)||void 0===r?void 0:r.error)||void 0===a||a.call(r,n)}complete(){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===r||r.call(n)}_subscribe(n){var r,a;return null!==(a=null===(r=this.source)||void 0===r?void 0:r.subscribe(n))&&void 0!==a?a:Ao}}function Vi(t){return n=>{if(function lo(t){return Rn(null==t?void 0:t.lift)}(n))return n.lift(function(r){try{return t(r,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ro(t,n,r,a,h){return new gc(t,n,r,a,h)}class gc extends ko{constructor(n,r,a,h,g,b){super(n),this.onFinalize=g,this.shouldUnsubscribe=b,this._next=r?function(D){try{r(D)}catch(I){n.error(I)}}:super._next,this._error=h?function(D){try{h(D)}catch(I){n.error(I)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(D){n.error(D)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:r}=this;super.unsubscribe(),!r&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function Fo(t,n){return Vi((r,a)=>{let h=0;r.subscribe(Ro(a,g=>{a.next(t.call(n,g,h++))}))})}function ji(t){return this instanceof ji?(this.v=t,this):new ji(t)}function wi(t,n,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var h,a=r.apply(t,n||[]),g=[];return h={},b("next"),b("throw"),b("return"),h[Symbol.asyncIterator]=function(){return this},h;function b(ee){a[ee]&&(h[ee]=function(ae){return new Promise(function(ye,Fe){g.push([ee,ae,ye,Fe])>1||D(ee,ae)})})}function D(ee,ae){try{!function I(ee){ee.value instanceof ji?Promise.resolve(ee.value.v).then(L,B):$(g[0][2],ee)}(a[ee](ae))}catch(ye){$(g[0][3],ye)}}function L(ee){D("next",ee)}function B(ee){D("throw",ee)}function $(ee,ae){ee(ae),g.shift(),g.length&&D(g[0][0],g[0][1])}}function Da(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,n=t[Symbol.asyncIterator];return n?n.call(t):(t=function ds(t){var n="function"==typeof Symbol&&Symbol.iterator,r=n&&t[n],a=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r);function a(g){r[g]=t[g]&&function(b){return new Promise(function(D,I){!function h(g,b,D,I){Promise.resolve(I).then(function(L){g({value:L,done:D})},b)}(D,I,(b=t[g](b)).done,b.value)})}}}const ui=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function js(t){return Rn(null==t?void 0:t.then)}function $i(t){return Rn(t[xi])}function Us(t){return Symbol.asyncIterator&&Rn(null==t?void 0:t[Symbol.asyncIterator])}function fs(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ei=function Oo(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Bo(t){return Rn(null==t?void 0:t[Ei])}function Gi(t){return wi(this,arguments,function*(){const r=t.getReader();try{for(;;){const{value:a,done:h}=yield ji(r.read());if(h)return yield ji(void 0);yield yield ji(a)}}finally{r.releaseLock()}})}function $s(t){return Rn(null==t?void 0:t.getReader)}function hr(t){if(t instanceof Yn)return t;if(null!=t){if($i(t))return function K(t){return new Yn(n=>{const r=t[xi]();if(Rn(r.subscribe))return r.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(ui(t))return function F(t){return new Yn(n=>{for(let r=0;r<t.length&&!n.closed;r++)n.next(t[r]);n.complete()})}(t);if(js(t))return function V(t){return new Yn(n=>{t.then(r=>{n.closed||(n.next(r),n.complete())},r=>n.error(r)).then(null,li)})}(t);if(Us(t))return J(t);if(Bo(t))return function X(t){return new Yn(n=>{for(const r of t)if(n.next(r),n.closed)return;n.complete()})}(t);if($s(t))return function le(t){return J(Gi(t))}(t)}throw fs(t)}function J(t){return new Yn(n=>{(function ge(t,n){var r,a,h,g;return function Tl(t,n,r,a){return new(r||(r=Promise))(function(g,b){function D(B){try{L(a.next(B))}catch($){b($)}}function I(B){try{L(a.throw(B))}catch($){b($)}}function L(B){B.done?g(B.value):function h(g){return g instanceof r?g:new r(function(b){b(g)})}(B.value).then(D,I)}L((a=a.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){try{for(r=Da(t);!(a=yield r.next()).done;)if(n.next(a.value),n.closed)return}catch(b){h={error:b}}finally{try{a&&!a.done&&(g=r.return)&&(yield g.call(r))}finally{if(h)throw h.error}}n.complete()})})(t,n).catch(r=>n.error(r))})}function pe(t,n,r,a=0,h=!1){const g=n.schedule(function(){r(),h?t.add(this.schedule(null,a)):this.unsubscribe()},a);if(t.add(g),!h)return g}function _e(t,n,r=1/0){return Rn(n)?_e((a,h)=>Fo((g,b)=>n(a,g,h,b))(hr(t(a,h))),r):("number"==typeof n&&(r=n),Vi((a,h)=>function ue(t,n,r,a,h,g,b,D){const I=[];let L=0,B=0,$=!1;const ee=()=>{$&&!I.length&&!L&&n.complete()},ae=Fe=>L<a?ye(Fe):I.push(Fe),ye=Fe=>{g&&n.next(Fe),L++;let qe=!1;hr(r(Fe,B++)).subscribe(Ro(n,He=>{null==h||h(He),g?ae(He):n.next(He)},()=>{qe=!0},void 0,()=>{if(qe)try{for(L--;I.length&&L<a;){const He=I.shift();b?pe(n,b,()=>ye(He)):ye(He)}ee()}catch(He){n.error(He)}}))};return t.subscribe(Ro(n,ae,()=>{$=!0,ee()})),()=>{null==D||D()}}(a,h,t,r)))}const Ae=new Yn(t=>t.complete());function st(t){return t[t.length-1]}function Mt(t){return function ct(t){return t&&Rn(t.schedule)}(st(t))?t.pop():void 0}function yn(t,n=0){return Vi((r,a)=>{r.subscribe(Ro(a,h=>pe(a,t,()=>a.next(h),n),()=>pe(a,t,()=>a.complete(),n),h=>pe(a,t,()=>a.error(h),n)))})}function un(t,n=0){return Vi((r,a)=>{a.add(t.schedule(()=>r.subscribe(a),n))})}function Hi(t,n){if(!t)throw new Error("Iterable cannot be null");return new Yn(r=>{pe(r,n,()=>{const a=t[Symbol.asyncIterator]();pe(r,n,()=>{a.next().then(h=>{h.done?r.complete():r.next(h.value)})},0,!0)})})}function Ml(t,n){return n?function yh(t,n){if(null!=t){if($i(t))return function bn(t,n){return hr(t).pipe(un(n),yn(n))}(t,n);if(ui(t))return function No(t,n){return new Yn(r=>{let a=0;return n.schedule(function(){a===t.length?r.complete():(r.next(t[a++]),r.closed||this.schedule())})})}(t,n);if(js(t))return function ms(t,n){return hr(t).pipe(un(n),yn(n))}(t,n);if(Us(t))return Hi(t,n);if(Bo(t))return function xr(t,n){return new Yn(r=>{let a;return pe(r,n,()=>{a=t[Ei](),pe(r,n,()=>{let h,g;try{({value:h,done:g}=a.next())}catch(b){return void r.error(b)}g?r.complete():r.next(h)},0,!0)}),()=>Rn(null==a?void 0:a.return)&&a.return()})}(t,n);if($s(t))return function bc(t,n){return Hi(Gi(t),n)}(t,n)}throw fs(t)}(t,n):hr(t)}function Ca(t,n,...r){return!0===n?(t(),null):!1===n?null:n(...r).pipe(function Tu(t){return t<=0?()=>Ae:Vi((n,r)=>{let a=0;n.subscribe(Ro(r,h=>{++a<=t&&(r.next(h),t<=a&&r.complete())}))})}(1)).subscribe(()=>t())}function ln(t){for(let n in t)if(t[n]===ln)return n;throw Error("Could not find renamed property on target object.")}function Nt(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(Nt).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const r=n.indexOf("\n");return-1===r?n:n.substring(0,r)}function Gs(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const co=ln({__forward_ref__:ln});function Du(t){return t.__forward_ref__=Du,t.toString=function(){return Nt(this())},t}function It(t){return function Hs(t){return"function"==typeof t&&t.hasOwnProperty(co)&&t.__forward_ref__===Du}(t)?t():t}class Kt extends Error{constructor(n,r){super(function Ec(t,n){return`NG0${Math.abs(t)}${n?": "+n:""}`}(n,r)),this.code=n}}function wt(t){return"string"==typeof t?t:null==t?"":String(t)}function dr(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():wt(t)}function be(t,n){const r=n?` in ${n}`:"";throw new Kt(-201,`No provider for ${dr(t)} found${r}`)}function ft(t,n){null==t&&function dn(t,n,r,a){throw new Error(`ASSERTION ERROR: ${t}`+(null==a?"":` [Expected=> ${r} ${a} ${n} <=Actual]`))}(n,t,null,"!=")}function pt(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function zn(t){return{providers:t.providers||[],imports:t.imports||[]}}function Ma(t){return Xs(t,Ks)||Xs(t,xt)}function Xs(t,n){return t.hasOwnProperty(n)?t[n]:null}function qt(t){return t&&(t.hasOwnProperty(kl)||t.hasOwnProperty(Ti))?t[kl]:null}const Ks=ln({\u0275prov:ln}),kl=ln({\u0275inj:ln}),xt=ln({ngInjectableDef:ln}),Ti=ln({ngInjectorDef:ln});var St=(()=>((St=St||{})[St.Default=0]="Default",St[St.Host=1]="Host",St[St.Self=2]="Self",St[St.SkipSelf=4]="SkipSelf",St[St.Optional=8]="Optional",St))();let Aa;function Di(t){const n=Aa;return Aa=t,n}function jo(t,n,r){const a=Ma(t);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:r&St.Optional?null:void 0!==n?n:void be(Nt(t),"Injector")}function Zi(t){return{toString:t}.toString()}var On=(()=>((On=On||{})[On.OnPush=0]="OnPush",On[On.Default=1]="Default",On))(),ho=(()=>{return(t=ho||(ho={}))[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",ho;var t})();const po="undefined"!=typeof globalThis&&globalThis,vh="undefined"!=typeof window&&window,xh="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,rn=po||"undefined"!=typeof global&&global||vh||xh,fo={},_n=[],Ll=ln({\u0275cmp:ln}),Rl=ln({\u0275dir:ln}),Dc=ln({\u0275pipe:ln}),Cc=ln({\u0275mod:ln}),$o=ln({\u0275fac:ln}),ka=ln({__NG_ELEMENT_ID__:ln});let Qd=0;function Mi(t){return Zi(()=>{const r={},a={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===On.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||_n,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||ho.Emulated,id:"c",styles:t.styles||_n,_:null,setInput:null,schemas:t.schemas||null,tView:null},h=t.directives,g=t.features,b=t.pipes;return a.id+=Qd++,a.inputs=Ra(t.inputs,r),a.outputs=Ra(t.outputs),g&&g.forEach(D=>D(a)),a.directiveDefs=h?()=>("function"==typeof h?h():h).map(Mc):null,a.pipeDefs=b?()=>("function"==typeof b?b():b).map(Su):null,a})}function Mc(t){return tr(t)||function Wi(t){return t[Rl]||null}(t)}function Su(t){return function Xi(t){return t[Dc]||null}(t)}const Au={};function ei(t){return Zi(()=>{const n={type:t.type,bootstrap:t.bootstrap||_n,declarations:t.declarations||_n,imports:t.imports||_n,exports:t.exports||_n,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(Au[t.id]=t.type),n})}function Ra(t,n){if(null==t)return fo;const r={};for(const a in t)if(t.hasOwnProperty(a)){let h=t[a],g=h;Array.isArray(h)&&(g=h[1],h=h[0]),r[h]=a,n&&(n[h]=g)}return r}const Ir=Mi;function tr(t){return t[Ll]||null}function Sr(t,n){const r=t[Cc]||null;if(!r&&!0===n)throw new Error(`Type ${Nt(t)} does not have '\u0275mod' property.`);return r}function hi(t){return Array.isArray(t)&&"object"==typeof t[1]}function pr(t){return Array.isArray(t)&&!0===t[1]}function Ic(t){return 0!=(8&t.flags)}function Oa(t){return 2==(2&t.flags)}function Ba(t){return 1==(1&t.flags)}function Si(t){return null!==t.template}function Pu(t){return 0!=(512&t[2])}function Xo(t,n){return t.hasOwnProperty($o)?t[$o]:null}class Va{constructor(n,r,a){this.previousValue=n,this.currentValue=r,this.firstChange=a}isFirstChange(){return this.firstChange}}function ja(t){return t.type.prototype.ngOnChanges&&(t.setInput=Mh),Ru}function Ru(){const t=Ol(this),n=null==t?void 0:t.current;if(n){const r=t.previous;if(r===fo)t.previous=n;else for(let a in n)r[a]=n[a];t.current=null,this.ngOnChanges(n)}}function Mh(t,n,r,a){const h=Ol(t)||function Ai(t,n){return t[ea]=n}(t,{previous:fo,current:null}),g=h.current||(h.current={}),b=h.previous,D=this.declaredInputs[r],I=b[D];g[D]=new Va(I&&I.currentValue,n,b===fo),t[a]=n}const ea="__ngSimpleChanges__";function Ol(t){return t[ea]||null}let $a;function Bn(t){return!!t.listen}const Fc={createRenderer:(t,n)=>function ws(){return void 0!==$a?$a:"undefined"!=typeof document?document:void 0}()};function Nn(t){for(;Array.isArray(t);)t=t[0];return t}function ta(t,n){return Nn(n[t])}function ni(t,n){return Nn(n[t.index])}function na(t,n){return t.data[n]}function ri(t,n){const r=n[t];return hi(r)?r:r[0]}function Ga(t){return 4==(4&t[2])}function Es(t){return 128==(128&t[2])}function Ko(t,n){return null==n?null:t[n]}function Oc(t){t[18]=0}function Nl(t,n){t[5]+=n;let r=t,a=t[3];for(;null!==a&&(1===n&&1===r[5]||-1===n&&0===r[5]);)a[5]+=n,r=a,a=a[3]}const vt={lFrame:W(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Bu(){return vt.bindingsEnabled}function Ne(){return vt.lFrame.lView}function Jt(){return vt.lFrame.tView}function qa(t){return vt.lFrame.contextLView=t,t[8]}function ir(){let t=Nu();for(;null!==t&&64===t.type;)t=t.parent;return t}function Nu(){return vt.lFrame.currentTNode}function Dn(t,n){const r=vt.lFrame;r.currentTNode=t,r.isParent=n}function ia(){return vt.lFrame.isParent}function Qo(){return vt.isInCheckNoChangesMode}function Vl(t){vt.isInCheckNoChangesMode=t}function o(){return vt.lFrame.bindingIndex++}function x(t,n){const r=vt.lFrame;r.bindingIndex=r.bindingRootIndex=t,C(n)}function C(t){vt.lFrame.currentDirectiveIndex=t}function k(){return vt.lFrame.currentQueryIndex}function R(t){vt.lFrame.currentQueryIndex=t}function O(t){const n=t[1];return 2===n.type?n.declTNode:1===n.type?t[6]:null}function j(t,n,r){if(r&St.SkipSelf){let h=n,g=t;for(;!(h=h.parent,null!==h||r&St.Host||(h=O(g),null===h||(g=g[15],10&h.type))););if(null===h)return!1;n=h,t=g}const a=vt.lFrame=G();return a.currentTNode=n,a.lView=t,!0}function Z(t){const n=G(),r=t[1];vt.lFrame=n,n.currentTNode=r.firstChild,n.lView=t,n.tView=r,n.contextLView=t,n.bindingIndex=r.bindingStartIndex,n.inI18n=!1}function G(){const t=vt.lFrame,n=null===t?null:t.child;return null===n?W(t):n}function W(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function se(){const t=vt.lFrame;return vt.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const H=se;function ne(){const t=se();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Q(){return vt.lFrame.selectedIndex}function oe(t){vt.lFrame.selectedIndex=t}function ke(t,n){for(let r=n.directiveStart,a=n.directiveEnd;r<a;r++){const g=t.data[r].type.prototype,{ngAfterContentInit:b,ngAfterContentChecked:D,ngAfterViewInit:I,ngAfterViewChecked:L,ngOnDestroy:B}=g;b&&(t.contentHooks||(t.contentHooks=[])).push(-r,b),D&&((t.contentHooks||(t.contentHooks=[])).push(r,D),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(r,D)),I&&(t.viewHooks||(t.viewHooks=[])).push(-r,I),L&&((t.viewHooks||(t.viewHooks=[])).push(r,L),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(r,L)),null!=B&&(t.destroyHooks||(t.destroyHooks=[])).push(r,B)}}function De(t,n,r){Tt(t,n,3,r)}function tt(t,n,r,a){(3&t[2])===r&&Tt(t,n,r,a)}function lt(t,n){let r=t[2];(3&r)===n&&(r&=2047,r+=1,t[2]=r)}function Tt(t,n,r,a){const g=null!=a?a:-1,b=n.length-1;let D=0;for(let I=void 0!==a?65535&t[18]:0;I<b;I++)if("number"==typeof n[I+1]){if(D=n[I],null!=a&&D>=a)break}else n[I]<0&&(t[18]+=65536),(D<g||-1==g)&&(je(t,r,n,I),t[18]=(4294901760&t[18])+I+2),I++}function je(t,n,r,a){const h=r[a]<0,g=r[a+1],D=t[h?-r[a]:r[a]];if(h){if(t[2]>>11<t[18]>>16&&(3&t[2])===n){t[2]+=2048;try{g.call(D)}finally{}}}else try{g.call(D)}finally{}}class mt{constructor(n,r,a){this.factory=n,this.resolving=!1,this.canSeeViewProviders=r,this.injectImpl=a}}function ii(t,n,r){const a=Bn(t);let h=0;for(;h<r.length;){const g=r[h];if("number"==typeof g){if(0!==g)break;h++;const b=r[h++],D=r[h++],I=r[h++];a?t.setAttribute(n,D,I,b):n.setAttributeNS(b,D,I)}else{const b=g,D=r[++h];gt(b)?a&&t.setProperty(n,b,D):a?t.setAttribute(n,b,D):n.setAttribute(b,D),h++}}return h}function Gt(t){return 3===t||4===t||6===t}function gt(t){return 64===t.charCodeAt(0)}function Pt(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let r=-1;for(let a=0;a<n.length;a++){const h=n[a];"number"==typeof h?r=h:0===r||Cn(t,r,h,null,-1===r||2===r?n[++a]:null)}}return t}function Cn(t,n,r,a,h){let g=0,b=t.length;if(-1===n)b=-1;else for(;g<t.length;){const D=t[g++];if("number"==typeof D){if(D===n){b=-1;break}if(D>n){b=g-1;break}}}for(;g<t.length;){const D=t[g];if("number"==typeof D)break;if(D===r){if(null===a)return void(null!==h&&(t[g+1]=h));if(a===t[g+1])return void(t[g+2]=h)}g++,null!==a&&g++,null!==h&&g++}-1!==b&&(t.splice(b,0,n),g=b+1),t.splice(g++,0,r),null!==a&&t.splice(g++,0,a),null!==h&&t.splice(g++,0,h)}function oi(t){return-1!==t}function sn(t){return 32767&t}function _o(t,n){let r=function pi(t){return t>>16}(t),a=n;for(;r>0;)a=a[15],r--;return a}let Rr=!0;function yo(t){const n=Rr;return Rr=t,n}let oa=0;function Wn(t,n){const r=op(t,n);if(-1!==r)return r;const a=n[1];a.firstCreatePass&&(t.injectorIndex=n.length,Lh(a.data,t),Lh(n,null),Lh(a.blueprint,null));const h=Za(t,n),g=t.injectorIndex;if(oi(h)){const b=sn(h),D=_o(h,n),I=D[1].data;for(let L=0;L<8;L++)n[g+L]=D[b+L]|I[b+L]}return n[g+8]=h,g}function Lh(t,n){t.push(0,0,0,0,0,0,0,0,n)}function op(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function Za(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let r=0,a=null,h=n;for(;null!==h;){const g=h[1],b=g.type;if(a=2===b?g.declTNode:1===b?h[6]:null,null===a)return-1;if(r++,h=h[15],-1!==a.injectorIndex)return a.injectorIndex|r<<16}return-1}function Mn(t,n,r){!function Ds(t,n,r){let a;"string"==typeof r?a=r.charCodeAt(0)||0:r.hasOwnProperty(ka)&&(a=r[ka]),null==a&&(a=r[ka]=oa++);const h=255&a;n.data[t+(h>>5)]|=1<<h}(t,n,r)}function sp(t,n,r){if(r&St.Optional)return t;be(n,"NodeInjector")}function jl(t,n,r,a){if(r&St.Optional&&void 0===a&&(a=null),0==(r&(St.Self|St.Host))){const h=t[9],g=Di(void 0);try{return h?h.get(n,a,r&St.Optional):jo(n,a,r&St.Optional)}finally{Di(g)}}return sp(a,n,r)}function Ul(t,n,r,a=St.Default,h){if(null!==t){const g=function ap(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(ka)?t[ka]:void 0;return"number"==typeof n?n>=0?255&n:Nc:n}(r);if("function"==typeof g){if(!j(n,t,a))return a&St.Host?sp(h,r,a):jl(n,r,a,h);try{const b=g(a);if(null!=b||a&St.Optional)return b;be(r)}finally{H()}}else if("number"==typeof g){let b=null,D=op(t,n),I=-1,L=a&St.Host?n[16][6]:null;for((-1===D||a&St.SkipSelf)&&(I=-1===D?Za(t,n):n[D+8],-1!==I&&Vu(a,!1)?(b=n[1],D=sn(I),n=_o(I,n)):D=-1);-1!==D;){const B=n[1];if(Fh(g,D,B.data)){const $=Wa(D,n,r,b,a,L);if($!==Rh)return $}I=n[D+8],-1!==I&&Vu(a,n[1].data[D+8]===L)&&Fh(g,D,n)?(b=B,D=sn(I),n=_o(I,n)):D=-1}}}return jl(n,r,a,h)}const Rh={};function Nc(){return new Xa(ir(),Ne())}function Wa(t,n,r,a,h,g){const b=n[1],D=b.data[t+8],B=$l(D,b,r,null==a?Oa(D)&&Rr:a!=b&&0!=(3&D.type),h&St.Host&&g===D);return null!==B?Gl(n,b,B,D):Rh}function $l(t,n,r,a,h){const g=t.providerIndexes,b=n.data,D=1048575&g,I=t.directiveStart,B=g>>20,ee=h?D+B:t.directiveEnd;for(let ae=a?D:D+B;ae<ee;ae++){const ye=b[ae];if(ae<I&&r===ye||ae>=I&&ye.type===r)return ae}if(h){const ae=b[I];if(ae&&Si(ae)&&ae.type===r)return I}return null}function Gl(t,n,r,a){let h=t[r];const g=n.data;if(function on(t){return t instanceof mt}(h)){const b=h;b.resolving&&function gs(t,n){const r=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new Kt(-200,`Circular dependency in DI detected for ${t}${r}`)}(dr(g[r]));const D=yo(b.canSeeViewProviders);b.resolving=!0;const I=b.injectImpl?Di(b.injectImpl):null;j(t,a,St.Default);try{h=t[r]=b.factory(void 0,g,t,a),n.firstCreatePass&&r>=a.directiveStart&&function ve(t,n,r){const{ngOnChanges:a,ngOnInit:h,ngDoCheck:g}=n.type.prototype;if(a){const b=ja(n);(r.preOrderHooks||(r.preOrderHooks=[])).push(t,b),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(t,b)}h&&(r.preOrderHooks||(r.preOrderHooks=[])).push(0-t,h),g&&((r.preOrderHooks||(r.preOrderHooks=[])).push(t,g),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(t,g))}(r,g[r],n)}finally{null!==I&&Di(I),yo(D),b.resolving=!1,H()}}return h}function Fh(t,n,r){return!!(r[n+(t>>5)]&1<<t)}function Vu(t,n){return!(t&St.Self||t&St.Host&&n)}class Xa{constructor(n,r){this._tNode=n,this._lView=r}get(n,r,a){return Ul(this._tNode,this._lView,n,a,r)}}const sa="__parameters__";function eo(t,n,r){return Zi(()=>{const a=function Uu(t){return function(...r){if(t){const a=t(...r);for(const h in a)this[h]=a[h]}}}(n);function h(...g){if(this instanceof h)return a.apply(this,g),this;const b=new h(...g);return D.annotation=b,D;function D(I,L,B){const $=I.hasOwnProperty(sa)?I[sa]:Object.defineProperty(I,sa,{value:[]})[sa];for(;$.length<=B;)$.push(null);return($[B]=$[B]||[]).push(b),I}}return r&&(h.prototype=Object.create(r.prototype)),h.prototype.ngMetadataName=t,h.annotationCls=h,h})}class an{constructor(n,r){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof r?this.__NG_ELEMENT_ID__=r:void 0!==r&&(this.\u0275prov=pt({token:this,providedIn:r.providedIn||"root",factory:r.factory}))}toString(){return`InjectionToken ${this._desc}`}}function to(t,n){void 0===n&&(n=t);for(let r=0;r<t.length;r++){let a=t[r];Array.isArray(a)?(n===t&&(n=t.slice(0,r)),to(a,n)):n!==t&&n.push(a)}return n}function Cs(t,n){t.forEach(r=>Array.isArray(r)?Cs(r,n):n(r))}function $c(t,n,r){n>=t.length?t.push(r):t.splice(n,0,r)}function Bh(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function Pi(t,n,r){let a=Gc(t,n);return a>=0?t[1|a]=r:(a=~a,function Nh(t,n,r,a){let h=t.length;if(h==n)t.push(r,a);else if(1===h)t.push(a,t[0]),t[0]=r;else{for(h--,t.push(t[h-1],t[h]);h>n;)t[h]=t[h-2],h--;t[n]=r,t[n+1]=a}}(t,a,n,r)),a}function fp(t,n){const r=Gc(t,n);if(r>=0)return t[1|r]}function Gc(t,n){return function Vh(t,n,r){let a=0,h=t.length>>r;for(;h!==a;){const g=a+(h-a>>1),b=t[g<<r];if(n===b)return g<<r;b>n?h=g:a=g+1}return~(h<<r)}(t,n,1)}const Gu={},mp="__NG_DI_FLAG__",Hu="ngTempTokenPath",ts=/\n/gm,Qf="__source",Xn=ln({provide:String,useValue:ln});let Dt;function tl(t){const n=Dt;return Dt=t,n}function em(t,n=St.Default){if(void 0===Dt)throw new Kt(203,"");return null===Dt?jo(t,void 0,n):Dt.get(t,n&St.Optional?null:void 0,n)}function rt(t,n=St.Default){return(function qn(){return Aa}()||em)(It(t),n)}function nl(t){const n=[];for(let r=0;r<t.length;r++){const a=It(t[r]);if(Array.isArray(a)){if(0===a.length)throw new Kt(900,"");let h,g=St.Default;for(let b=0;b<a.length;b++){const D=a[b],I=ns(D);"number"==typeof I?-1===I?h=D.token:g|=I:h=D}n.push(rt(h,g))}else n.push(rt(a))}return n}function Is(t,n){return t[mp]=n,t.prototype[mp]=n,t}function ns(t){return t[mp]}const qu=Is(eo("Inject",t=>({token:t})),-1),mi=Is(eo("Optional"),8),Hl=Is(eo("SkipSelf"),4);const Sp="__ngContext__";function Hr(t,n){t[Sp]=n}function Ap(t){const n=function Ju(t){return t[Sp]||null}(t);return n?Array.isArray(n)?n:n.lView:null}function Lp(t){return t.ngOriginalError}function x_(t,...n){t.error(...n)}class Qc{constructor(){this._console=console}handleError(n){const r=this._findOriginalError(n),a=function v_(t){return t&&t.ngErrorLogger||x_}(n);a(this._console,"ERROR",n),r&&a(this._console,"ORIGINAL ERROR",r)}_findOriginalError(n){let r=n&&Lp(n);for(;r&&Lp(r);)r=Lp(r);return r||null}}const Tm=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(rn))();function wo(t){return t instanceof Function?t():t}var qr=(()=>((qr=qr||{})[qr.Important=1]="Important",qr[qr.DashCase=2]="DashCase",qr))();function Op(t,n){return undefined(t,n)}function ha(t){const n=t[3];return pr(n)?n[3]:n}function id(t){return ks(t[13])}function od(t){return ks(t[4])}function ks(t){for(;null!==t&&!pr(t);)t=t[4];return t}function Xl(t,n,r,a,h){if(null!=a){let g,b=!1;pr(a)?g=a:hi(a)&&(b=!0,a=a[0]);const D=Nn(a);0===t&&null!==r?null==h?eu(n,r,D):Dr(n,r,D,h||null,!0):1===t&&null!==r?Dr(n,r,D,h||null,!0):2===t?function Kp(t,n,r){const a=Jl(t,n);a&&function Gp(t,n,r,a){Bn(t)?t.removeChild(n,r,a):n.removeChild(r)}(t,a,n,r)}(n,D,b):3===t&&n.destroyNode(D),null!=g&&function km(t,n,r,a,h){const g=r[7];g!==Nn(r)&&Xl(n,t,a,g,h);for(let D=10;D<r.length;D++){const I=r[D];ru(I[1],I,t,n,a,g)}}(n,t,g,r,h)}}function Vp(t,n,r){if(Bn(t))return t.createElement(n,r);{const a=null!==r?function Rc(t){const n=t.toLowerCase();return"svg"===n?"http://www.w3.org/2000/svg":"math"===n?"http://www.w3.org/1998/MathML/":null}(r):null;return null===a?t.createElement(n):t.createElementNS(a,n)}}function Kl(t,n){const r=t[9],a=r.indexOf(n),h=n[3];1024&n[2]&&(n[2]&=-1025,Nl(h,-1)),r.splice(a,1)}function ad(t,n){if(t.length<=10)return;const r=10+n,a=t[r];if(a){const h=a[17];null!==h&&h!==t&&Kl(h,a),n>0&&(t[r-1][4]=a[4]);const g=Bh(t,10+n);!function S_(t,n){ru(t,n,n[11],2,null,null),n[0]=null,n[6]=null}(a[1],a);const b=g[19];null!==b&&b.detachView(g[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function Sm(t,n){if(!(256&n[2])){const r=n[11];Bn(r)&&r.destroyNode&&ru(t,n,r,3,null,null),function k_(t){let n=t[13];if(!n)return jp(t[1],t);for(;n;){let r=null;if(hi(n))r=n[13];else{const a=n[10];a&&(r=a)}if(!r){for(;n&&!n[4]&&n!==t;)hi(n)&&jp(n[1],n),n=n[3];null===n&&(n=t),hi(n)&&jp(n[1],n),r=n&&n[4]}n=r}}(n)}}function jp(t,n){if(!(256&n[2])){n[2]&=-129,n[2]|=256,function Up(t,n){let r;if(null!=t&&null!=(r=t.destroyHooks))for(let a=0;a<r.length;a+=2){const h=n[r[a]];if(!(h instanceof mt)){const g=r[a+1];if(Array.isArray(g))for(let b=0;b<g.length;b+=2){const D=h[g[b]],I=g[b+1];try{I.call(D)}finally{}}else try{g.call(h)}finally{}}}}(t,n),function R_(t,n){const r=t.cleanup,a=n[7];let h=-1;if(null!==r)for(let g=0;g<r.length-1;g+=2)if("string"==typeof r[g]){const b=r[g+1],D="function"==typeof b?b(n):Nn(n[b]),I=a[h=r[g+2]],L=r[g+3];"boolean"==typeof L?D.removeEventListener(r[g],I,L):L>=0?a[h=L]():a[h=-L].unsubscribe(),g+=2}else{const b=a[h=r[g+1]];r[g].call(b)}if(null!==a){for(let g=h+1;g<a.length;g++)a[g]();n[7]=null}}(t,n),1===n[1].type&&Bn(n[11])&&n[11].destroy();const r=n[17];if(null!==r&&pr(n[3])){r!==n[3]&&Kl(r,n);const a=n[19];null!==a&&a.detachView(t)}}}function ld(t,n,r){return function $p(t,n,r){let a=n;for(;null!==a&&40&a.type;)a=(n=a).parent;if(null===a)return r[0];if(2&a.flags){const h=t.data[a.directiveStart].encapsulation;if(h===ho.None||h===ho.Emulated)return null}return ni(a,r)}(t,n.parent,r)}function Dr(t,n,r,a,h){Bn(t)?t.insertBefore(n,r,a,h):n.insertBefore(r,a,h)}function eu(t,n,r){Bn(t)?t.appendChild(n,r):n.appendChild(r)}function Yl(t,n,r,a,h){null!==a?Dr(t,n,r,a,h):eu(t,n,r)}function Jl(t,n){return Bn(t)?t.parentNode(n):n.parentNode}let Am=function qp(t,n,r){return 40&t.type?ni(t,r):null};function tu(t,n,r,a){const h=ld(t,a,n),g=n[11],D=function Hp(t,n,r){return Am(t,n,r)}(a.parent||n[6],a,n);if(null!=h)if(Array.isArray(r))for(let I=0;I<r.length;I++)Yl(g,h,r[I],D,!1);else Yl(g,h,r,D,!1)}function nu(t,n){if(null!==n){const r=n.type;if(3&r)return ni(n,t);if(4&r)return Xp(-1,t[n.index]);if(8&r){const a=n.child;if(null!==a)return nu(t,a);{const h=t[n.index];return pr(h)?Xp(-1,h):Nn(h)}}if(32&r)return Op(n,t)()||Nn(t[n.index]);{const a=Wp(t,n);return null!==a?Array.isArray(a)?a[0]:nu(ha(t[16]),a):nu(t,n.next)}}return null}function Wp(t,n){return null!==n?t[16][6].projection[n.projection]:null}function Xp(t,n){const r=10+t+1;if(r<n.length){const a=n[r],h=a[1].firstChild;if(null!==h)return nu(a,h)}return n[7]}function rs(t,n,r,a,h,g,b){for(;null!=r;){const D=a[r.index],I=r.type;if(b&&0===n&&(D&&Hr(Nn(D),a),r.flags|=4),64!=(64&r.flags))if(8&I)rs(t,n,r.child,a,h,g,!1),Xl(n,t,h,D,g);else if(32&I){const L=Op(r,a);let B;for(;B=L();)Xl(n,t,h,B,g);Xl(n,t,h,D,g)}else 16&I?Yp(t,n,a,r,h,g):Xl(n,t,h,D,g);r=b?r.projectionNext:r.next}}function ru(t,n,r,a,h,g){rs(r,a,t.firstChild,n,h,g,!1)}function Yp(t,n,r,a,h,g){const b=r[16],I=b[6].projection[a.projection];if(Array.isArray(I))for(let L=0;L<I.length;L++)Xl(n,t,h,I[L],g);else rs(t,n,I,b[3],h,g,!0)}function Lm(t,n,r){Bn(t)?t.setAttribute(n,"style",r):n.style.cssText=r}function ud(t,n,r){Bn(t)?""===r?t.removeAttribute(n,"class"):t.setAttribute(n,"class",r):n.className=r}function Jp(t,n,r){let a=t.length;for(;;){const h=t.indexOf(n,r);if(-1===h)return h;if(0===h||t.charCodeAt(h-1)<=32){const g=n.length;if(h+g===a||t.charCodeAt(h+g)<=32)return h}r=h+1}}const Qp="ng-template";function Rm(t,n,r){let a=0;for(;a<t.length;){let h=t[a++];if(r&&"class"===h){if(h=t[a],-1!==Jp(h.toLowerCase(),n,0))return!0}else if(1===h){for(;a<t.length&&"string"==typeof(h=t[a++]);)if(h.toLowerCase()===n)return!0;return!1}}return!1}function dd(t){return 4===t.type&&t.value!==Qp}function iu(t,n,r){return n===(4!==t.type||r?t.value:Qp)}function Fm(t,n,r){let a=4;const h=t.attrs||[],g=function O_(t){for(let n=0;n<t.length;n++)if(Gt(t[n]))return n;return t.length}(h);let b=!1;for(let D=0;D<n.length;D++){const I=n[D];if("number"!=typeof I){if(!b)if(4&a){if(a=2|1&a,""!==I&&!iu(t,I,r)||""===I&&1===n.length){if(ki(a))return!1;b=!0}}else{const L=8&a?I:n[++D];if(8&a&&null!==t.attrs){if(!Rm(t.attrs,L,r)){if(ki(a))return!1;b=!0}continue}const $=zm(8&a?"class":I,h,dd(t),r);if(-1===$){if(ki(a))return!1;b=!0;continue}if(""!==L){let ee;ee=$>g?"":h[$+1].toLowerCase();const ae=8&a?ee:null;if(ae&&-1!==Jp(ae,L,0)||2&a&&L!==ee){if(ki(a))return!1;b=!0}}}}else{if(!b&&!ki(a)&&!ki(I))return!1;if(b&&ki(I))continue;b=!1,a=I|1&a}}return ki(a)||b}function ki(t){return 0==(1&t)}function zm(t,n,r,a){if(null===n)return-1;let h=0;if(a||!r){let g=!1;for(;h<n.length;){const b=n[h];if(b===t)return h;if(3===b||6===b)g=!0;else{if(1===b||2===b){let D=n[++h];for(;"string"==typeof D;)D=n[++h];continue}if(4===b)break;if(0===b){h+=4;continue}}h+=g?1:2}return-1}return function B_(t,n){let r=t.indexOf(4);if(r>-1)for(r++;r<t.length;){const a=t[r];if("number"==typeof a)return-1;if(a===n)return r;r++}return-1}(n,t)}function rh(t,n,r=!1){for(let a=0;a<n.length;a++)if(Fm(t,n[a],r))return!0;return!1}function Om(t,n){return t?":not("+n.trim()+")":n}function V_(t){let n=t[0],r=1,a=2,h="",g=!1;for(;r<t.length;){let b=t[r];if("string"==typeof b)if(2&a){const D=t[++r];h+="["+b+(D.length>0?'="'+D+'"':"")+"]"}else 8&a?h+="."+b:4&a&&(h+=" "+b);else""!==h&&!ki(b)&&(n+=Om(g,h),h=""),a=b,g=g||!ki(a);r++}return""!==h&&(n+=Om(g,h)),n}const kt={};function Ql(t){Bm(Jt(),Ne(),Q()+t,Qo())}function Bm(t,n,r,a){if(!a)if(3==(3&n[2])){const g=t.preOrderCheckHooks;null!==g&&De(n,g,r)}else{const g=t.preOrderHooks;null!==g&&tt(n,g,0,r)}oe(r)}function md(t,n){return t<<17|n<<2}function zr(t){return t>>17&32767}function su(t){return 2|t}function is(t){return(131068&t)>>2}function nf(t,n){return-131069&t|n<<2}function rf(t){return 1|t}function pf(t,n){const r=t.contentQueries;if(null!==r)for(let a=0;a<r.length;a+=2){const h=r[a],g=r[a+1];if(-1!==g){const b=t.data[g];R(h),b.contentQueries(2,n[g],g)}}}function uu(t,n,r,a,h,g,b,D,I,L){const B=n.blueprint.slice();return B[0]=h,B[2]=140|a,Oc(B),B[3]=B[15]=t,B[8]=r,B[10]=b||t&&t[10],B[11]=D||t&&t[11],B[12]=I||t&&t[12]||null,B[9]=L||t&&t[9]||null,B[6]=g,B[16]=2==n.type?t[16]:B,B}function ec(t,n,r,a,h){let g=t.data[n];if(null===g)g=function Rs(t,n,r,a,h){const g=Nu(),b=ia(),I=t.data[n]=function cl(t,n,r,a,h,g){return{type:r,index:a,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:h,attrs:g,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,b?g:g&&g.parent,r,n,a,h);return null===t.firstChild&&(t.firstChild=I),null!==g&&(b?null==g.child&&null!==I.parent&&(g.child=I):null===g.next&&(g.next=I)),I}(t,n,r,a,h),function m(){return vt.lFrame.inI18n}()&&(g.flags|=64);else if(64&g.type){g.type=r,g.value=a,g.attrs=h;const b=function Jo(){const t=vt.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();g.injectorIndex=null===b?-1:b.injectorIndex}return Dn(g,!0),g}function tc(t,n,r,a){if(0===r)return-1;const h=n.length;for(let g=0;g<r;g++)n.push(a),t.blueprint.push(a),t.data.push(null);return h}function ll(t,n,r){Z(n);try{const a=t.viewQuery;null!==a&&Id(1,a,r);const h=t.template;null!==h&&ff(t,n,h,1,r),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&pf(t,n),t.staticViewQueries&&Id(2,t.viewQuery,r);const g=t.components;null!==g&&function Wm(t,n){for(let r=0;r<n.length;r++)Dd(t,n[r])}(n,g)}catch(a){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),a}finally{n[2]&=-5,ne()}}function hu(t,n,r,a){const h=n[2];if(256==(256&h))return;Z(n);const g=Qo();try{Oc(n),function f(t){return vt.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==r&&ff(t,n,r,2,a);const b=3==(3&h);if(!g)if(b){const L=t.preOrderCheckHooks;null!==L&&De(n,L,null)}else{const L=t.preOrderHooks;null!==L&&tt(n,L,0,null),lt(n,0)}if(function ch(t){for(let n=id(t);null!==n;n=od(n)){if(!n[2])continue;const r=n[9];for(let a=0;a<r.length;a++){const h=r[a],g=h[3];0==(1024&h[2])&&Nl(g,1),h[2]|=1024}}}(n),function lh(t){for(let n=id(t);null!==n;n=od(n))for(let r=10;r<n.length;r++){const a=n[r],h=a[1];Es(a)&&hu(h,a,h.template,a[8])}}(n),null!==t.contentQueries&&pf(t,n),!g)if(b){const L=t.contentCheckHooks;null!==L&&De(n,L)}else{const L=t.contentHooks;null!==L&&tt(n,L,1),lt(n,1)}!function qm(t,n){const r=t.hostBindingOpCodes;if(null!==r)try{for(let a=0;a<r.length;a++){const h=r[a];if(h<0)oe(~h);else{const g=h,b=r[++a],D=r[++a];x(b,g),D(2,n[g])}}}finally{oe(-1)}}(t,n);const D=t.components;null!==D&&function Zm(t,n){for(let r=0;r<n.length;r++)uh(t,n[r])}(n,D);const I=t.viewQuery;if(null!==I&&Id(2,I,a),!g)if(b){const L=t.viewCheckHooks;null!==L&&De(n,L)}else{const L=t.viewHooks;null!==L&&tt(n,L,2),lt(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),g||(n[2]&=-73),1024&n[2]&&(n[2]&=-1025,Nl(n[3],-1))}finally{ne()}}function nc(t,n,r,a){const h=n[10],g=!Qo(),b=Ga(n);try{g&&!b&&h.begin&&h.begin(),b&&ll(t,n,a),hu(t,n,r,a)}finally{g&&!b&&h.end&&h.end()}}function ff(t,n,r,a,h){const g=Q(),b=2&a;try{oe(-1),b&&n.length>20&&Bm(t,n,20,Qo()),r(a,h)}finally{oe(g)}}function du(t,n,r){!Bu()||(function Jm(t,n,r,a){const h=r.directiveStart,g=r.directiveEnd;t.firstCreatePass||Wn(r,n),Hr(a,n);const b=r.initialInputs;for(let D=h;D<g;D++){const I=t.data[D],L=Si(I);L&&Q_(n,r,I);const B=Gl(n,t,D,r);Hr(B,n),null!==b&&tg(0,D-h,B,I,0,b),L&&(ri(r.index,n)[8]=B)}}(t,n,r,ni(r,n)),128==(128&r.flags)&&function vf(t,n,r){const a=r.directiveStart,h=r.directiveEnd,b=r.index,D=function E(){return vt.lFrame.currentDirectiveIndex}();try{oe(b);for(let I=a;I<h;I++){const L=t.data[I],B=n[I];C(I),(null!==L.hostBindings||0!==L.hostVars||null!==L.hostAttrs)&&ah(L,B)}}finally{oe(-1),C(D)}}(t,n,r))}function bd(t,n,r=ni){const a=n.localNames;if(null!==a){let h=n.index+1;for(let g=0;g<a.length;g+=2){const b=a[g+1],D=-1===b?r(n,t):t[b];t[h++]=D}}}function gf(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=wd(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):n}function wd(t,n,r,a,h,g,b,D,I,L){const B=20+a,$=B+h,ee=function K_(t,n){const r=[];for(let a=0;a<n;a++)r.push(a<t?null:kt);return r}(B,$),ae="function"==typeof L?L():L;return ee[1]={type:t,blueprint:ee,template:r,queries:null,viewQuery:D,declTNode:n,data:ee.slice().fill(null,B),bindingStartIndex:B,expandoStartIndex:$,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof g?g():g,pipeRegistry:"function"==typeof b?b():b,firstChild:null,schemas:I,consts:ae,incompleteFirstPass:!1}}function ss(t,n,r,a){const h=s(n);null===r?h.push(a):(h.push(r),t.firstCreatePass&&l(t).push(a,h.length-1))}function sh(t,n,r){for(let a in t)if(t.hasOwnProperty(a)){const h=t[a];(r=null===r?{}:r).hasOwnProperty(a)?r[a].push(n,h):r[a]=[n,h]}return r}function si(t,n,r,a){let h=!1;if(Bu()){const g=function Qm(t,n,r){const a=t.directiveRegistry;let h=null;if(a)for(let g=0;g<a.length;g++){const b=a[g];rh(r,b.selectors,!1)&&(h||(h=[]),Mn(Wn(r,n),t,b.type),Si(b)?(xf(t,r),h.unshift(b)):h.push(b))}return h}(t,n,r),b=null===a?null:{"":-1};if(null!==g){h=!0,rc(r,t.data.length,g.length);for(let B=0;B<g.length;B++){const $=g[B];$.providersResolver&&$.providersResolver($)}let D=!1,I=!1,L=tc(t,n,g.length,null);for(let B=0;B<g.length;B++){const $=g[B];r.mergedAttrs=Pt(r.mergedAttrs,$.hostAttrs),wf(t,r,n,L,$),bf(L,$,b),null!==$.contentQueries&&(r.flags|=8),(null!==$.hostBindings||null!==$.hostAttrs||0!==$.hostVars)&&(r.flags|=128);const ee=$.type.prototype;!D&&(ee.ngOnChanges||ee.ngOnInit||ee.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(r.index),D=!0),!I&&(ee.ngOnChanges||ee.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(r.index),I=!0),L++}!function Xm(t,n){const a=n.directiveEnd,h=t.data,g=n.attrs,b=[];let D=null,I=null;for(let L=n.directiveStart;L<a;L++){const B=h[L],$=B.inputs,ee=null===g||dd(n)?null:ey($,g);b.push(ee),D=sh($,L,D),I=sh(B.outputs,L,I)}null!==D&&(D.hasOwnProperty("class")&&(n.flags|=16),D.hasOwnProperty("style")&&(n.flags|=32)),n.initialInputs=b,n.inputs=D,n.outputs=I}(t,r)}b&&function eg(t,n,r){if(n){const a=t.localNames=[];for(let h=0;h<n.length;h+=2){const g=r[n[h+1]];if(null==g)throw new Kt(-301,!1);a.push(n[h],g)}}}(r,a,b)}return r.mergedAttrs=Pt(r.mergedAttrs,r.attrs),h}function Ym(t,n,r,a,h,g){const b=g.hostBindings;if(b){let D=t.hostBindingOpCodes;null===D&&(D=t.hostBindingOpCodes=[]);const I=~n.index;(function Ed(t){let n=t.length;for(;n>0;){const r=t[--n];if("number"==typeof r&&r<0)return r}return 0})(D)!=I&&D.push(I),D.push(a,h,b)}}function ah(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function xf(t,n){n.flags|=2,(t.components||(t.components=[])).push(n.index)}function bf(t,n,r){if(r){if(n.exportAs)for(let a=0;a<n.exportAs.length;a++)r[n.exportAs[a]]=t;Si(n)&&(r[""]=t)}}function rc(t,n,r){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+r,t.providerIndexes=n}function wf(t,n,r,a,h){t.data[a]=h;const g=h.factory||(h.factory=Xo(h.type)),b=new mt(g,Si(h),null);t.blueprint[a]=b,r[a]=b,Ym(t,n,0,a,tc(t,r,h.hostVars,kt),h)}function Q_(t,n,r){const a=ni(n,t),h=gf(r),g=t[10],b=Cd(t,uu(t,h,null,r.onPush?64:16,a,n,g,g.createRenderer(a,r),null,null));t[n.index]=b}function tg(t,n,r,a,h,g){const b=g[n];if(null!==b){const D=a.setInput;for(let I=0;I<b.length;){const L=b[I++],B=b[I++],$=b[I++];null!==D?a.setInput(r,$,L,B):r[B]=$}}}function ey(t,n){let r=null,a=0;for(;a<n.length;){const h=n[a];if(0!==h)if(5!==h){if("number"==typeof h)break;t.hasOwnProperty(h)&&(null===r&&(r=[]),r.push(h,t[h],n[a+1])),a+=2}else a+=2;else a+=4}return r}function ng(t,n,r,a){return new Array(t,!0,!1,n,null,0,a,r,null,null)}function uh(t,n){const r=ri(n,t);if(Es(r)){const a=r[1];80&r[2]?hu(a,r,a.template,r[8]):r[5]>0&&ic(r)}}function ic(t){for(let a=id(t);null!==a;a=od(a))for(let h=10;h<a.length;h++){const g=a[h];if(1024&g[2]){const b=g[1];hu(b,g,b.template,g[8])}else g[5]>0&&ic(g)}const r=t[1].components;if(null!==r)for(let a=0;a<r.length;a++){const h=ri(r[a],t);Es(h)&&h[5]>0&&ic(h)}}function Dd(t,n){const r=ri(n,t),a=r[1];(function ty(t,n){for(let r=n.length;r<t.blueprint.length;r++)n.push(t.blueprint[r])})(a,r),ll(a,r,r[8])}function Cd(t,n){return t[13]?t[14][4]=n:t[13]=n,t[14]=n,n}function hl(t){for(;t;){t[2]|=64;const n=ha(t);if(Pu(t)&&!n)return t;t=n}return null}function Tf(t,n,r){const a=n[10];a.begin&&a.begin();try{hu(t,n,t.template,r)}catch(h){throw p(n,h),h}finally{a.end&&a.end()}}function Df(t){!function Ef(t){for(let n=0;n<t.components.length;n++){const r=t.components[n],a=Ap(r),h=a[1];nc(h,a,h.template,r)}}(t[8])}function Id(t,n,r){R(0),n(t,r)}const e=(()=>Promise.resolve(null))();function s(t){return t[7]||(t[7]=[])}function l(t){return t.cleanup||(t.cleanup=[])}function p(t,n){const r=t[9],a=r?r.get(Qc,null):null;a&&a.handleError(n)}function _(t,n,r,a,h){for(let g=0;g<r.length;){const b=r[g++],D=r[g++],I=n[b],L=t.data[b];null!==L.setInput?L.setInput(I,h,a,D):I[D]=h}}function v(t,n,r){const a=ta(n,t);!function Im(t,n,r){Bn(t)?t.setValue(n,r):n.textContent=r}(t[11],a,r)}function w(t,n,r){let a=r?t.styles:null,h=r?t.classes:null,g=0;if(null!==n)for(let b=0;b<n.length;b++){const D=n[b];"number"==typeof D?g=D:1==g?h=Gs(h,D):2==g&&(a=Gs(a,D+": "+n[++b]+";"))}r?t.styles=a:t.stylesWithoutHost=a,r?t.classes=h:t.classesWithoutHost=h}const A=new an("INJECTOR",-1);class z{get(n,r=Gu){if(r===Gu){const a=new Error(`NullInjectorError: No provider for ${Nt(n)}!`);throw a.name="NullInjectorError",a}return r}}const N=new an("Set Injector scope."),U={},q={};let Y;function ie(){return void 0===Y&&(Y=new z),Y}function ce(t,n=null,r=null,a){const h=he(t,n,r,a);return h._resolveInjectorDefTypes(),h}function he(t,n=null,r=null,a){return new fe(t,r,n||ie(),a)}class fe{constructor(n,r,a,h=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const g=[];r&&Cs(r,D=>this.processProvider(D,n,r)),Cs([n],D=>this.processInjectorType(D,[],g)),this.records.set(A,Oe(void 0,this));const b=this.records.get(N);this.scope=null!=b?b.value:null,this.source=h||("object"==typeof n?null:Nt(n))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(n=>n.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(n,r=Gu,a=St.Default){this.assertNotDestroyed();const h=tl(this),g=Di(void 0);try{if(!(a&St.SkipSelf)){let D=this.records.get(n);if(void 0===D){const I=function fn(t){return"function"==typeof t||"object"==typeof t&&t instanceof an}(n)&&Ma(n);D=I&&this.injectableDefInScope(I)?Oe(me(n),U):null,this.records.set(n,D)}if(null!=D)return this.hydrate(n,D)}return(a&St.Self?ie():this.parent).get(n,r=a&St.Optional&&r===Gu?null:r)}catch(b){if("NullInjectorError"===b.name){if((b[Hu]=b[Hu]||[]).unshift(Nt(n)),h)throw b;return function ca(t,n,r,a){const h=t[Hu];throw n[Qf]&&h.unshift(n[Qf]),t.message=function vo(t,n,r,a=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let h=Nt(n);if(Array.isArray(n))h=n.map(Nt).join(" -> ");else if("object"==typeof n){let g=[];for(let b in n)if(n.hasOwnProperty(b)){let D=n[b];g.push(b+":"+("string"==typeof D?JSON.stringify(D):Nt(D)))}h=`{${g.join(", ")}}`}return`${r}${a?"("+a+")":""}[${h}]: ${t.replace(ts,"\n  ")}`}("\n"+t.message,h,r,a),t.ngTokenPath=h,t[Hu]=null,t}(b,n,"R3InjectorError",this.source)}throw b}finally{Di(g),tl(h)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(n=>this.get(n))}toString(){const n=[];return this.records.forEach((a,h)=>n.push(Nt(h))),`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Kt(205,!1)}processInjectorType(n,r,a){if(!(n=It(n)))return!1;let h=qt(n);const g=null==h&&n.ngModule||void 0,b=void 0===g?n:g,D=-1!==a.indexOf(b);if(void 0!==g&&(h=qt(g)),null==h)return!1;if(null!=h.imports&&!D){let B;a.push(b);try{Cs(h.imports,$=>{this.processInjectorType($,r,a)&&(void 0===B&&(B=[]),B.push($))})}finally{}if(void 0!==B)for(let $=0;$<B.length;$++){const{ngModule:ee,providers:ae}=B[$];Cs(ae,ye=>this.processProvider(ye,ee,ae||_n))}}this.injectorDefTypes.add(b);const I=Xo(b)||(()=>new b);this.records.set(b,Oe(I,U));const L=h.providers;if(null!=L&&!D){const B=n;Cs(L,$=>this.processProvider($,B,L))}return void 0!==g&&void 0!==n.providers}processProvider(n,r,a){let h=Ie(n=It(n))?n:It(n&&n.provide);const g=function Ee(t,n,r){return Te(t)?Oe(void 0,t.useValue):Oe(function $e(t,n,r){let a;if(Ie(t)){const h=It(t);return Xo(h)||me(h)}if(Te(t))a=()=>It(t.useValue);else if(function Ze(t){return!(!t||!t.useFactory)}(t))a=()=>t.useFactory(...nl(t.deps||[]));else if(function Ve(t){return!(!t||!t.useExisting)}(t))a=()=>rt(It(t.useExisting));else{const h=It(t&&(t.useClass||t.provide));if(!function Je(t){return!!t.deps}(t))return Xo(h)||me(h);a=()=>new h(...nl(t.deps))}return a}(t),U)}(n);if(Ie(n)||!0!==n.multi)this.records.get(h);else{let b=this.records.get(h);b||(b=Oe(void 0,U,!0),b.factory=()=>nl(b.multi),this.records.set(h,b)),h=n,b.multi.push(n)}this.records.set(h,g)}hydrate(n,r){return r.value===U&&(r.value=q,r.value=r.factory()),"object"==typeof r.value&&r.value&&function Ht(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(r.value)&&this.onDestroy.add(r.value),r.value}injectableDefInScope(n){if(!n.providedIn)return!1;const r=It(n.providedIn);return"string"==typeof r?"any"===r||r===this.scope:this.injectorDefTypes.has(r)}}function me(t){const n=Ma(t),r=null!==n?n.factory:Xo(t);if(null!==r)return r;if(t instanceof an)throw new Kt(204,!1);if(t instanceof Function)return function Ce(t){const n=t.length;if(n>0)throw function Ja(t,n){const r=[];for(let a=0;a<t;a++)r.push(n);return r}(n,"?"),new Kt(204,!1);const r=function Ia(t){const n=t&&(t[Ks]||t[xt]);if(n){const r=function Sa(t){if(t.hasOwnProperty("name"))return t.name;const n=(""+t).match(/^function\s*([^\s(]+)/);return null===n?"":n[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${r}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${r}" class.`),n}return null}(t);return null!==r?()=>r.factory(t):()=>new t}(t);throw new Kt(204,!1)}function Oe(t,n,r=!1){return{factory:t,value:n,multi:r?[]:void 0}}function Te(t){return null!==t&&"object"==typeof t&&Xn in t}function Ie(t){return"function"==typeof t}let yt=(()=>{class t{static create(r,a){var h;if(Array.isArray(r))return ce({name:""},a,r,"");{const g=null!==(h=r.name)&&void 0!==h?h:"";return ce({name:g},r.parent,r.providers,g)}}}return t.THROW_IF_NOT_FOUND=Gu,t.NULL=new z,t.\u0275prov=pt({token:t,providedIn:"any",factory:()=>rt(A)}),t.__NG_ELEMENT_ID__=-1,t})();function ai(t,n){ke(Ap(t)[1],ir())}let mu=null;function yi(){if(!mu){const t=rn.Symbol;if(t&&t.iterator)mu=t.iterator;else{const n=Object.getOwnPropertyNames(Map.prototype);for(let r=0;r<n.length;++r){const a=n[r];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(mu=a)}}}return mu}function sc(t){return!!dh(t)&&(Array.isArray(t)||!(t instanceof Map)&&yi()in t)}function dh(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function xn(t,n,r){return!Object.is(t[n],r)&&(t[n]=r,!0)}function Bd(t,n,r,a,h,g,b,D){const I=Ne(),L=Jt(),B=t+20,$=L.firstCreatePass?function jb(t,n,r,a,h,g,b,D,I){const L=n.consts,B=ec(n,t,4,b||null,Ko(L,D));si(n,r,B,Ko(L,I)),ke(n,B);const $=B.tViews=wd(2,B,a,h,g,n.directiveRegistry,n.pipeRegistry,null,n.schemas,L);return null!==n.queries&&(n.queries.template(n,B),$.queries=n.queries.embeddedTView(B)),B}(B,L,I,n,r,a,h,g,b):L.data[B];Dn($,!1);const ee=I[11].createComment("");tu(L,I,ee,$),Hr(ee,I),Cd(I,I[B]=ng(ee,I,ee,$)),Ba($)&&du(L,I,$),null!=b&&bd(I,$,D)}function ry(t){return function ra(t,n){return t[n]}(function Ye(){return vt.lFrame.contextLView}(),20+t)}function zt(t,n=St.Default){const r=Ne();return null===r?rt(t,n):Ul(ir(),r,It(t),n)}function ph(t,n,r){const a=Ne();return xn(a,o(),n)&&function Ri(t,n,r,a,h,g,b,D){const I=ni(n,r);let B,L=n.inputs;!D&&null!=L&&(B=L[a])?(_(t,r,B,a,h),Oa(n)&&function yf(t,n){const r=ri(n,t);16&r[2]||(r[2]|=64)}(r,n.index)):3&n.type&&(a=function _f(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(a),h=null!=b?b(h,n.value||"",a):h,Bn(g)?g.setProperty(I,a,h):gt(a)||(I.setProperty?I.setProperty(a,h):I[a]=h))}(Jt(),function de(){const t=vt.lFrame;return na(t.tView,t.selectedIndex)}(),a,t,n,a[11],r,!1),ph}function ly(t,n,r,a,h){const b=h?"class":"style";_(t,r,n.inputs[b],b,a)}function Mo(t,n,r,a){const h=Ne(),g=Jt(),b=20+t,D=h[11],I=h[b]=Vp(D,n,function we(){return vt.lFrame.currentNamespace}()),L=g.firstCreatePass?function cw(t,n,r,a,h,g,b){const D=n.consts,L=ec(n,t,2,h,Ko(D,g));return si(n,r,L,Ko(D,b)),null!==L.attrs&&w(L,L.attrs,!1),null!==L.mergedAttrs&&w(L,L.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,L),L}(b,g,h,0,n,r,a):g.data[b];Dn(L,!0);const B=L.mergedAttrs;null!==B&&ii(D,I,B);const $=L.classes;null!==$&&ud(D,I,$);const ee=L.styles;return null!==ee&&Lm(D,I,ee),64!=(64&L.flags)&&tu(g,h,I,L),0===function mr(){return vt.lFrame.elementDepthCount}()&&Hr(I,h),function Ou(){vt.lFrame.elementDepthCount++}(),Ba(L)&&(du(g,h,L),function mf(t,n,r){if(Ic(n)){const h=n.directiveEnd;for(let g=n.directiveStart;g<h;g++){const b=t.data[g];b.contentQueries&&b.contentQueries(1,r[g],g)}}}(g,L,h)),null!==a&&bd(h,L),Mo}function Io(){let t=ir();ia()?function Ts(){vt.lFrame.isParent=!1}():(t=t.parent,Dn(t,!1));const n=t;!function Yo(){vt.lFrame.elementDepthCount--}();const r=Jt();return r.firstCreatePass&&(ke(r,t),Ic(t)&&r.queries.elementEnd(t)),null!=n.classesWithoutHost&&function wn(t){return 0!=(16&t.flags)}(n)&&ly(r,n,Ne(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function Jn(t){return 0!=(32&t.flags)}(n)&&ly(r,n,Ne(),n.stylesWithoutHost,!1),Io}function ac(t,n,r,a){return Mo(t,n,r,a),Io(),ac}function hy(){return Ne()}function dy(t){return!!t&&"function"==typeof t.then}const hw=function yx(t){return!!t&&"function"==typeof t.subscribe};function Vd(t,n,r,a){const h=Ne(),g=Jt(),b=ir();return function xx(t,n,r,a,h,g,b,D){const I=Ba(a),B=t.firstCreatePass&&l(t),$=n[8],ee=s(n);let ae=!0;if(3&a.type||D){const qe=ni(a,n),He=D?D(qe):qe,Se=ee.length,ht=D?Ut=>D(Nn(Ut[a.index])):a.index;if(Bn(r)){let Ut=null;if(!D&&I&&(Ut=function dw(t,n,r,a){const h=t.cleanup;if(null!=h)for(let g=0;g<h.length-1;g+=2){const b=h[g];if(b===r&&h[g+1]===a){const D=n[7],I=h[g+2];return D.length>I?D[I]:null}"string"==typeof b&&(g+=2)}return null}(t,n,h,a.index)),null!==Ut)(Ut.__ngLastListenerFn__||Ut).__ngNextListenerFn__=g,Ut.__ngLastListenerFn__=g,ae=!1;else{g=py(a,n,$,g,!1);const mn=r.listen(He,h,g);ee.push(g,mn),B&&B.push(h,ht,Se,Se+1)}}else g=py(a,n,$,g,!0),He.addEventListener(h,g,b),ee.push(g),B&&B.push(h,ht,Se,b)}else g=py(a,n,$,g,!1);const ye=a.outputs;let Fe;if(ae&&null!==ye&&(Fe=ye[h])){const qe=Fe.length;if(qe)for(let He=0;He<qe;He+=2){const ls=n[Fe[He]][Fe[He+1]].subscribe(g),gh=ee.length;ee.push(g,ls),B&&B.push(h,a.index,gh,-(gh+1))}}}(g,h,h[11],b,t,n,!!r,a),Vd}function bx(t,n,r,a){try{return!1!==r(a)}catch(h){return p(t,h),!1}}function py(t,n,r,a,h){return function g(b){if(b===Function)return a;const D=2&t.flags?ri(t.index,n):n;0==(32&n[2])&&hl(D);let I=bx(n,0,a,b),L=g.__ngNextListenerFn__;for(;L;)I=bx(n,0,L,b)&&I,L=L.__ngNextListenerFn__;return h&&!1===I&&(b.preventDefault(),b.returnValue=!1),I}}function If(t=1){return function re(t){return(vt.lFrame.contextLView=function te(t,n){for(;t>0;)n=n[15],t--;return n}(t,vt.lFrame.contextLView))[8]}(t)}function Px(t,n,r,a,h){const g=t[r+1],b=null===n;let D=a?zr(g):is(g),I=!1;for(;0!==D&&(!1===I||b);){const B=t[D+1];yw(t[D],n)&&(I=!0,t[D+1]=a?rf(B):su(B)),D=a?zr(B):is(B)}I&&(t[r+1]=a?su(g):rf(g))}function yw(t,n){return null===t||null==n||(Array.isArray(t)?t[1]:t)===n||!(!Array.isArray(t)||"string"!=typeof n)&&Gc(t,n)>=0}function my(t,n){return function ma(t,n,r,a){const h=Ne(),g=Jt(),b=function c(t){const n=vt.lFrame,r=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,r}(2);g.firstUpdatePass&&function Vx(t,n,r,a){const h=t.data;if(null===h[r+1]){const g=h[Q()],b=function Nx(t,n){return n>=t.expandoStartIndex}(t,r);(function Gx(t,n){return 0!=(t.flags&(n?16:32))})(g,a)&&null===n&&!b&&(n=!1),n=function Mw(t,n,r,a){const h=function P(t){const n=vt.lFrame.currentDirectiveIndex;return-1===n?null:t[n]}(t);let g=a?n.residualClasses:n.residualStyles;if(null===h)0===(a?n.classBindings:n.styleBindings)&&(r=Sf(r=gy(null,t,n,r,a),n.attrs,a),g=null);else{const b=n.directiveStylingLast;if(-1===b||t[b]!==h)if(r=gy(h,t,n,r,a),null===g){let I=function Iw(t,n,r){const a=r?n.classBindings:n.styleBindings;if(0!==is(a))return t[zr(a)]}(t,n,a);void 0!==I&&Array.isArray(I)&&(I=gy(null,t,n,I[1],a),I=Sf(I,n.attrs,a),function Sw(t,n,r,a){t[zr(r?n.classBindings:n.styleBindings)]=a}(t,n,a,I))}else g=function Aw(t,n,r){let a;const h=n.directiveEnd;for(let g=1+n.directiveStylingLast;g<h;g++)a=Sf(a,t[g].hostAttrs,r);return Sf(a,n.attrs,r)}(t,n,a)}return void 0!==g&&(a?n.residualClasses=g:n.residualStyles=g),r}(h,g,n,a),function gw(t,n,r,a,h,g){let b=g?n.classBindings:n.styleBindings,D=zr(b),I=is(b);t[a]=r;let B,L=!1;if(Array.isArray(r)){const $=r;B=$[1],(null===B||Gc($,B)>0)&&(L=!0)}else B=r;if(h)if(0!==I){const ee=zr(t[D+1]);t[a+1]=md(ee,D),0!==ee&&(t[ee+1]=nf(t[ee+1],a)),t[D+1]=function Nm(t,n){return 131071&t|n<<17}(t[D+1],a)}else t[a+1]=md(D,0),0!==D&&(t[D+1]=nf(t[D+1],a)),D=a;else t[a+1]=md(I,0),0===D?D=a:t[I+1]=nf(t[I+1],a),I=a;L&&(t[a+1]=su(t[a+1])),Px(t,B,a,!0),Px(t,B,a,!1),function _w(t,n,r,a,h){const g=h?t.residualClasses:t.residualStyles;null!=g&&"string"==typeof n&&Gc(g,n)>=0&&(r[a+1]=rf(r[a+1]))}(n,B,t,a,g),b=md(D,I),g?n.classBindings=b:n.styleBindings=b}(h,g,n,r,b,a)}}(g,t,b,a),n!==kt&&xn(h,b,n)&&function Ux(t,n,r,a,h,g,b,D){if(!(3&n.type))return;const I=t.data,L=I[D+1];ug(function Vm(t){return 1==(1&t)}(L)?$x(I,n,r,h,is(L),b):void 0)||(ug(g)||function tf(t){return 2==(2&t)}(L)&&(g=$x(I,null,r,h,D,b)),function z_(t,n,r,a,h){const g=Bn(t);if(n)h?g?t.addClass(r,a):r.classList.add(a):g?t.removeClass(r,a):r.classList.remove(a);else{let b=-1===a.indexOf("-")?void 0:qr.DashCase;if(null==h)g?t.removeStyle(r,a,b):r.style.removeProperty(a);else{const D="string"==typeof h&&h.endsWith("!important");D&&(h=h.slice(0,-10),b|=qr.Important),g?t.setStyle(r,a,h,b):r.style.setProperty(a,h,D?"important":"")}}}(a,b,ta(Q(),r),h,g))}(g,g.data[Q()],h,h[11],t,h[b+1]=function Lw(t,n){return null==t||("string"==typeof n?t+=n:"object"==typeof t&&(t=Nt(function As(t){return t instanceof class xp{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?t.changingThisBreaksApplicationSecurity:t}(t)))),t}(n,r),a,b)}(t,n,null,!0),my}function gy(t,n,r,a,h){let g=null;const b=r.directiveEnd;let D=r.directiveStylingLast;for(-1===D?D=r.directiveStart:D++;D<b&&(g=n[D],a=Sf(a,g.hostAttrs,h),g!==t);)D++;return null!==t&&(r.directiveStylingLast=D),a}function Sf(t,n,r){const a=r?1:2;let h=-1;if(null!==n)for(let g=0;g<n.length;g++){const b=n[g];"number"==typeof b?h=b:h===a&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),Pi(t,b,!!r||n[++g]))}return void 0===t?null:t}function $x(t,n,r,a,h,g){const b=null===n;let D;for(;h>0;){const I=t[h],L=Array.isArray(I),B=L?I[1]:I,$=null===B;let ee=r[h+1];ee===kt&&(ee=$?_n:void 0);let ae=$?fp(ee,a):B===a?ee:void 0;if(L&&!ug(ae)&&(ae=fp(I,a)),ug(ae)&&(D=ae,b))return D;const ye=t[h+1];h=b?zr(ye):is(ye)}if(null!==n){let I=g?n.residualClasses:n.residualStyles;null!=I&&(D=fp(I,a))}return D}function ug(t){return void 0!==t}function lc(t,n=""){const r=Ne(),a=Jt(),h=t+20,g=a.firstCreatePass?ec(a,h,1,n,null):a.data[h],b=r[h]=function Np(t,n){return Bn(t)?t.createText(n):t.createTextNode(n)}(r[11],n);tu(a,r,b,g),Dn(g,!1)}function _y(t){return hg("",t,""),_y}function hg(t,n,r){const a=Ne(),h=function Ad(t,n,r,a){return xn(t,o(),r)?n+wt(r)+a:kt}(a,t,n,r);return h!==kt&&v(a,Q(),h),hg}const fh=void 0;var Qw=["en",[["a","p"],["AM","PM"],fh],[["AM","PM"],fh,fh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],fh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],fh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",fh,"{1} 'at' {0}",fh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function Jw(t){const r=Math.floor(Math.abs(t)),a=t.toString().replace(/^[^.]*\.?/,"").length;return 1===r&&0===a?1:5}];let Ud={};function d0(t){return t in Ud||(Ud[t]=rn.ng&&rn.ng.common&&rn.ng.common.locales&&rn.ng.common.locales[t]),Ud[t]}var ot=(()=>((ot=ot||{})[ot.LocaleId=0]="LocaleId",ot[ot.DayPeriodsFormat=1]="DayPeriodsFormat",ot[ot.DayPeriodsStandalone=2]="DayPeriodsStandalone",ot[ot.DaysFormat=3]="DaysFormat",ot[ot.DaysStandalone=4]="DaysStandalone",ot[ot.MonthsFormat=5]="MonthsFormat",ot[ot.MonthsStandalone=6]="MonthsStandalone",ot[ot.Eras=7]="Eras",ot[ot.FirstDayOfWeek=8]="FirstDayOfWeek",ot[ot.WeekendRange=9]="WeekendRange",ot[ot.DateFormat=10]="DateFormat",ot[ot.TimeFormat=11]="TimeFormat",ot[ot.DateTimeFormat=12]="DateTimeFormat",ot[ot.NumberSymbols=13]="NumberSymbols",ot[ot.NumberFormats=14]="NumberFormats",ot[ot.CurrencyCode=15]="CurrencyCode",ot[ot.CurrencySymbol=16]="CurrencySymbol",ot[ot.CurrencyName=17]="CurrencyName",ot[ot.Currencies=18]="Currencies",ot[ot.Directionality=19]="Directionality",ot[ot.PluralCase=20]="PluralCase",ot[ot.ExtraData=21]="ExtraData",ot))();const dg="en-US";let p0=dg;class B0{}class nT{resolveComponentFactory(n){throw function tT(t){const n=Error(`No component factory found for ${Nt(t)}. Did you add it to @NgModule.entryComponents?`);return n.ngComponent=t,n}(n)}}let Rf=(()=>{class t{}return t.NULL=new nT,t})();function rT(){return Gd(ir(),Ne())}function Gd(t,n){return new Hd(ni(t,n))}let Hd=(()=>{class t{constructor(r){this.nativeElement=r}}return t.__NG_ELEMENT_ID__=rT,t})();function iT(t){return t instanceof Hd?t.nativeElement:t}class V0{}let j0=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>function sT(){const t=Ne(),r=ri(ir().index,t);return function oT(t){return t[11]}(hi(r)?r:t)}(),t})(),aT=(()=>{class t{}return t.\u0275prov=pt({token:t,providedIn:"root",factory:()=>null}),t})();class Ty{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const lT=new Ty("13.2.4"),Dy={};function _g(t,n,r,a,h=!1){for(;null!==r;){const g=n[r.index];if(null!==g&&a.push(Nn(g)),pr(g))for(let D=10;D<g.length;D++){const I=g[D],L=I[1].firstChild;null!==L&&_g(I[1],I,L,a)}const b=r.type;if(8&b)_g(t,n,r.child,a);else if(32&b){const D=Op(r,n);let I;for(;I=D();)a.push(I)}else if(16&b){const D=Wp(n,r);if(Array.isArray(D))a.push(...D);else{const I=ha(n[16]);_g(I[1],I,D,a,!0)}}r=h?r.projectionNext:r.next}return a}class Ff{constructor(n,r){this._lView=n,this._cdRefInjectingView=r,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const n=this._lView,r=n[1];return _g(r,n,r.firstChild,[])}get context(){return this._lView[8]}set context(n){this._lView[8]=n}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[3];if(pr(n)){const r=n[8],a=r?r.indexOf(this):-1;a>-1&&(ad(n,a),Bh(r,a))}this._attachedToViewContainer=!1}Sm(this._lView[1],this._lView)}onDestroy(n){ss(this._lView[1],this._lView,null,n)}markForCheck(){hl(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Tf(this._lView[1],this._lView,this.context)}checkNoChanges(){!function ny(t,n,r){Vl(!0);try{Tf(t,n,r)}finally{Vl(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Kt(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function P_(t,n){ru(t,n,n[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Kt(902,"");this._appRef=n}}class cT extends Ff{constructor(n){super(n),this._view=n}detectChanges(){Df(this._view)}checkNoChanges(){!function rg(t){Vl(!0);try{Df(t)}finally{Vl(!1)}}(this._view)}get context(){return null}}class U0 extends Rf{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const r=tr(n);return new Cy(r,this.ngModule)}}function $0(t){const n=[];for(let r in t)t.hasOwnProperty(r)&&n.push({propName:t[r],templateName:r});return n}const hT=new an("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>Tm});class Cy extends B0{constructor(n,r){super(),this.componentDef=n,this.ngModule=r,this.componentType=n.type,this.selector=function ou(t){return t.map(V_).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!r}get inputs(){return $0(this.componentDef.inputs)}get outputs(){return $0(this.componentDef.outputs)}create(n,r,a,h){const g=(h=h||this.ngModule)?function dT(t,n){return{get:(r,a,h)=>{const g=t.get(r,Dy,h);return g!==Dy||a===Dy?g:n.get(r,a,h)}}}(n,h.injector):n,b=g.get(V0,Fc),D=g.get(aT,null),I=b.createRenderer(null,this.componentDef),L=this.componentDef.selectors[0][0]||"div",B=a?function fa(t,n,r){if(Bn(t))return t.selectRootElement(n,r===ho.ShadowDom);let a="string"==typeof n?t.querySelector(n):n;return a.textContent="",a}(I,a,this.componentDef.encapsulation):Vp(b.createRenderer(null,this.componentDef),L,function uT(t){const n=t.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(L)),$=this.componentDef.onPush?576:528,ee=function Nr(t,n){return{components:[],scheduler:t||Tm,clean:e,playerHandler:n||null,flags:0}}(),ae=wd(0,null,null,1,0,null,null,null,null,null),ye=uu(null,ae,ee,$,null,null,b,I,D,g);let Fe,qe;Z(ye);try{const He=function Br(t,n,r,a,h,g){const b=r[1];r[20]=t;const I=ec(b,20,2,"#host",null),L=I.mergedAttrs=n.hostAttrs;null!==L&&(w(I,L,!0),null!==t&&(ii(h,t,L),null!==I.classes&&ud(h,t,I.classes),null!==I.styles&&Lm(h,t,I.styles)));const B=a.createRenderer(t,n),$=uu(r,gf(n),null,n.onPush?64:16,r[20],I,a,B,g||null,null);return b.firstCreatePass&&(Mn(Wn(I,r),b,n.type),xf(b,I),rc(I,r.length,1)),Cd(r,$),r[20]=$}(B,this.componentDef,ye,b,I);if(B)if(a)ii(I,B,["ng-version",lT.full]);else{const{attrs:Se,classes:ht}=function ef(t){const n=[],r=[];let a=1,h=2;for(;a<t.length;){let g=t[a];if("string"==typeof g)2===h?""!==g&&n.push(g,t[++a]):8===h&&r.push(g);else{if(!ki(h))break;h=g}a++}return{attrs:n,classes:r}}(this.componentDef.selectors[0]);Se&&ii(I,B,Se),ht&&ht.length>0&&ud(I,B,ht.join(" "))}if(qe=na(ae,20),void 0!==r){const Se=qe.projection=[];for(let ht=0;ht<this.ngContentSelectors.length;ht++){const Ut=r[ht];Se.push(null!=Ut?Array.from(Ut):null)}}Fe=function er(t,n,r,a,h){const g=r[1],b=function Fi(t,n,r){const a=ir();t.firstCreatePass&&(r.providersResolver&&r.providersResolver(r),wf(t,a,n,tc(t,n,1,null),r));const h=Gl(n,t,a.directiveStart,a);Hr(h,n);const g=ni(a,n);return g&&Hr(g,n),h}(g,r,n);if(a.components.push(b),t[8]=b,h&&h.forEach(I=>I(b,n)),n.contentQueries){const I=ir();n.contentQueries(1,b,I.directiveStart)}const D=ir();return!g.firstCreatePass||null===n.hostBindings&&null===n.hostAttrs||(oe(D.index),Ym(r[1],D,0,D.directiveStart,D.directiveEnd,n),ah(n,b)),b}(He,this.componentDef,ye,ee,[ai]),ll(ae,ye,null)}finally{ne()}return new fT(this.componentType,Fe,Gd(qe,ye),ye,qe)}}class fT extends class eT{}{constructor(n,r,a,h,g){super(),this.location=a,this._rootLView=h,this._tNode=g,this.instance=r,this.hostView=this.changeDetectorRef=new cT(h),this.componentType=n}get injector(){return new Xa(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}class qd{}const Zd=new Map;class q0 extends qd{constructor(n,r){super(),this._parent=r,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new U0(this);const a=Sr(n);this._bootstrapComponents=wo(a.bootstrap),this._r3Injector=he(n,r,[{provide:qd,useValue:this},{provide:Rf,useValue:this.componentFactoryResolver}],Nt(n)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(n)}get(n,r=yt.THROW_IF_NOT_FOUND,a=St.Default){return n===yt||n===qd||n===A?this:this._r3Injector.get(n,r,a)}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(r=>r()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class My extends class gT{}{constructor(n){super(),this.moduleType=n,null!==Sr(n)&&function _T(t){const n=new Set;!function r(a){const h=Sr(a,!0),g=h.id;null!==g&&(function G0(t,n,r){if(n&&n!==r)throw new Error(`Duplicate module registered for ${t} - ${Nt(n)} vs ${Nt(n.name)}`)}(g,Zd.get(g),a),Zd.set(g,a));const b=wo(h.imports);for(const D of b)n.has(D)||(n.add(D),r(D))}(t)}(n)}create(n){return new q0(this.moduleType,n)}}function Iy(t){return n=>{setTimeout(t,void 0,n)}}const cc=class FT extends wl{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,r,a){var h,g,b;let D=n,I=r||(()=>null),L=a;if(n&&"object"==typeof n){const $=n;D=null===(h=$.next)||void 0===h?void 0:h.bind($),I=null===(g=$.error)||void 0===g?void 0:g.bind($),L=null===(b=$.complete)||void 0===b?void 0:b.bind($)}this.__isAsync&&(I=Iy(I),D&&(D=Iy(D)),L&&(L=Iy(L)));const B=super.subscribe({next:D,error:I,complete:L});return n instanceof Kn&&n.add(B),B}};function zT(){return this._results[yi()]()}class Sy{constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const r=yi(),a=Sy.prototype;a[r]||(a[r]=zT)}get changes(){return this._changes||(this._changes=new cc)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,r){return this._results.reduce(n,r)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,r){const a=this;a.dirty=!1;const h=to(n);(this._changesDetected=!function Jg(t,n,r){if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++){let h=t[a],g=n[a];if(r&&(h=r(h),g=r(g)),g!==h)return!1}return!0}(a._results,h,r))&&(a._results=h,a.length=h.length,a.last=h[this.length-1],a.first=h[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let uc=(()=>{class t{}return t.__NG_ELEMENT_ID__=NT,t})();const OT=uc,BT=class extends OT{constructor(n,r,a){super(),this._declarationLView=n,this._declarationTContainer=r,this.elementRef=a}createEmbeddedView(n){const r=this._declarationTContainer.tViews,a=uu(this._declarationLView,r,n,16,null,r.declTNode,null,null,null,null);a[17]=this._declarationLView[this._declarationTContainer.index];const g=this._declarationLView[19];return null!==g&&(a[19]=g.createEmbeddedView(r)),ll(r,a,n),new Ff(a)}};function NT(){return yg(ir(),Ne())}function yg(t,n){return 4&t.type?new BT(n,t,Gd(t,n)):null}let gl=(()=>{class t{}return t.__NG_ELEMENT_ID__=VT,t})();function VT(){return e1(ir(),Ne())}const jT=gl,J0=class extends jT{constructor(n,r,a){super(),this._lContainer=n,this._hostTNode=r,this._hostLView=a}get element(){return Gd(this._hostTNode,this._hostLView)}get injector(){return new Xa(this._hostTNode,this._hostLView)}get parentInjector(){const n=Za(this._hostTNode,this._hostLView);if(oi(n)){const r=_o(n,this._hostLView),a=sn(n);return new Xa(r[1].data[a+8],r)}return new Xa(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const r=Q0(this._lContainer);return null!==r&&r[n]||null}get length(){return this._lContainer.length-10}createEmbeddedView(n,r,a){const h=n.createEmbeddedView(r||{});return this.insert(h,a),h}createComponent(n,r,a,h,g){const b=n&&!function Uc(t){return"function"==typeof t}(n);let D;if(b)D=r;else{const $=r||{};D=$.index,a=$.injector,h=$.projectableNodes,g=$.ngModuleRef}const I=b?n:new Cy(tr(n)),L=a||this.parentInjector;if(!g&&null==I.ngModule){const ee=(b?L:this.parentInjector).get(qd,null);ee&&(g=ee)}const B=I.create(L,h,void 0,g);return this.insert(B.hostView,D),B}insert(n,r){const a=n._lView,h=a[1];if(function zu(t){return pr(t[3])}(a)){const B=this.indexOf(n);if(-1!==B)this.detach(B);else{const $=a[3],ee=new J0($,$[6],$[3]);ee.detach(ee.indexOf(n))}}const g=this._adjustIndex(r),b=this._lContainer;!function L_(t,n,r,a){const h=10+a,g=r.length;a>0&&(r[h-1][4]=n),a<g-10?(n[4]=r[h],$c(r,10+a,n)):(r.push(n),n[4]=null),n[3]=r;const b=n[17];null!==b&&r!==b&&function sd(t,n){const r=t[9];n[16]!==n[3][3][16]&&(t[2]=!0),null===r?t[9]=[n]:r.push(n)}(b,n);const D=n[19];null!==D&&D.insertView(t),n[2]|=128}(h,a,b,g);const D=Xp(g,b),I=a[11],L=Jl(I,b[7]);return null!==L&&function A_(t,n,r,a,h,g){a[0]=h,a[6]=n,ru(t,a,r,1,h,g)}(h,b[6],I,a,L,D),n.attachToViewContainerRef(),$c(Ay(b),g,n),n}move(n,r){return this.insert(n,r)}indexOf(n){const r=Q0(this._lContainer);return null!==r?r.indexOf(n):-1}remove(n){const r=this._adjustIndex(n,-1),a=ad(this._lContainer,r);a&&(Bh(Ay(this._lContainer),r),Sm(a[1],a))}detach(n){const r=this._adjustIndex(n,-1),a=ad(this._lContainer,r);return a&&null!=Bh(Ay(this._lContainer),r)?new Ff(a):null}_adjustIndex(n,r=0){return null==n?this.length+r:n}};function Q0(t){return t[8]}function Ay(t){return t[8]||(t[8]=[])}function e1(t,n){let r;const a=n[t.index];if(pr(a))r=a;else{let h;if(8&t.type)h=Nn(a);else{const g=n[11];h=g.createComment("");const b=ni(t,n);Dr(g,Jl(g,b),h,function F_(t,n){return Bn(t)?t.nextSibling(n):n.nextSibling}(g,b),!1)}n[t.index]=r=ng(a,n,h,t),Cd(n,r)}return new J0(r,t,n)}class Py{constructor(n){this.queryList=n,this.matches=null}clone(){return new Py(this.queryList)}setDirty(){this.queryList.setDirty()}}class ky{constructor(n=[]){this.queries=n}createEmbeddedView(n){const r=n.queries;if(null!==r){const a=null!==n.contentQueries?n.contentQueries[0]:r.length,h=[];for(let g=0;g<a;g++){const b=r.getByIndex(g);h.push(this.queries[b.indexInDeclarationView].clone())}return new ky(h)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let r=0;r<this.queries.length;r++)null!==l1(n,r).matches&&this.queries[r].setDirty()}}class t1{constructor(n,r,a=null){this.predicate=n,this.flags=r,this.read=a}}class Ly{constructor(n=[]){this.queries=n}elementStart(n,r){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(n,r)}elementEnd(n){for(let r=0;r<this.queries.length;r++)this.queries[r].elementEnd(n)}embeddedTView(n){let r=null;for(let a=0;a<this.length;a++){const h=null!==r?r.length:0,g=this.getByIndex(a).embeddedTView(n,h);g&&(g.indexInDeclarationView=a,null!==r?r.push(g):r=[g])}return null!==r?new Ly(r):null}template(n,r){for(let a=0;a<this.queries.length;a++)this.queries[a].template(n,r)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class Ry{constructor(n,r=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=r}elementStart(n,r){this.isApplyingToNode(r)&&this.matchTNode(n,r)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,r){this.elementStart(n,r)}embeddedTView(n,r){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,r),new Ry(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const r=this._declarationNodeIndex;let a=n.parent;for(;null!==a&&8&a.type&&a.index!==r;)a=a.parent;return r===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(n,r){const a=this.metadata.predicate;if(Array.isArray(a))for(let h=0;h<a.length;h++){const g=a[h];this.matchTNodeWithReadOption(n,r,GT(r,g)),this.matchTNodeWithReadOption(n,r,$l(r,n,g,!1,!1))}else a===uc?4&r.type&&this.matchTNodeWithReadOption(n,r,-1):this.matchTNodeWithReadOption(n,r,$l(r,n,a,!1,!1))}matchTNodeWithReadOption(n,r,a){if(null!==a){const h=this.metadata.read;if(null!==h)if(h===Hd||h===gl||h===uc&&4&r.type)this.addMatch(r.index,-2);else{const g=$l(r,n,h,!1,!1);null!==g&&this.addMatch(r.index,g)}else this.addMatch(r.index,a)}}addMatch(n,r){null===this.matches?this.matches=[n,r]:this.matches.push(n,r)}}function GT(t,n){const r=t.localNames;if(null!==r)for(let a=0;a<r.length;a+=2)if(r[a]===n)return r[a+1];return null}function qT(t,n,r,a){return-1===r?function HT(t,n){return 11&t.type?Gd(t,n):4&t.type?yg(t,n):null}(n,t):-2===r?function ZT(t,n,r){return r===Hd?Gd(n,t):r===uc?yg(n,t):r===gl?e1(n,t):void 0}(t,n,a):Gl(t,t[1],r,n)}function n1(t,n,r,a){const h=n[19].queries[a];if(null===h.matches){const g=t.data,b=r.matches,D=[];for(let I=0;I<b.length;I+=2){const L=b[I];D.push(L<0?null:qT(n,g[L],b[I+1],r.metadata.read))}h.matches=D}return h.matches}function Fy(t,n,r,a){const h=t.queries.getByIndex(r),g=h.matches;if(null!==g){const b=n1(t,n,h,r);for(let D=0;D<g.length;D+=2){const I=g[D];if(I>0)a.push(b[D/2]);else{const L=g[D+1],B=n[-I];for(let $=10;$<B.length;$++){const ee=B[$];ee[17]===ee[3]&&Fy(ee[1],ee,L,a)}if(null!==B[9]){const $=B[9];for(let ee=0;ee<$.length;ee++){const ae=$[ee];Fy(ae[1],ae,L,a)}}}}}return a}function r1(t){const n=Ne(),r=Jt(),a=k();R(a+1);const h=l1(r,a);if(t.dirty&&Ga(n)===(2==(2&h.metadata.flags))){if(null===h.matches)t.reset([]);else{const g=h.crossesNgTemplate?Fy(r,n,a,[]):n1(r,n,h,a);t.reset(g,iT),t.notifyOnChanges()}return!0}return!1}function i1(t,n,r){const a=Jt();a.firstCreatePass&&(function a1(t,n,r){null===t.queries&&(t.queries=new Ly),t.queries.track(new Ry(n,r))}(a,new t1(t,n,r),-1),2==(2&n)&&(a.staticViewQueries=!0)),function s1(t,n,r){const a=new Sy(4==(4&r));ss(t,n,a,a.destroy),null===n[19]&&(n[19]=new ky),n[19].queries.push(new Py(a))}(a,Ne(),n)}function l1(t,n){return t.queries.getByIndex(n)}function c1(t,n){return yg(t,n)}function bg(...t){}const jy=new an("Application Initializer");let Xd=(()=>{class t{constructor(r){this.appInits=r,this.resolve=bg,this.reject=bg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,h)=>{this.resolve=a,this.reject=h})}runInitializers(){if(this.initialized)return;const r=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let h=0;h<this.appInits.length;h++){const g=this.appInits[h]();if(dy(g))r.push(g);else if(hw(g)){const b=new Promise((D,I)=>{g.subscribe({complete:D,error:I})});r.push(b)}}Promise.all(r).then(()=>{a()}).catch(h=>{this.reject(h)}),0===r.length&&a(),this.initialized=!0}}return t.\u0275fac=function(r){return new(r||t)(rt(jy,8))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();const Nf=new an("AppId"),fD={provide:Nf,useFactory:function pD(){return`${Uy()}${Uy()}${Uy()}`},deps:[]};function Uy(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const C1=new an("Platform Initializer"),wg=new an("Platform ID"),mD=new an("appBootstrapListener");let gD=(()=>{class t{log(r){console.log(r)}warn(r){console.warn(r)}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();const _u=new an("LocaleId"),M1=new an("DefaultCurrencyCode");class _D{constructor(n,r){this.ngModuleFactory=n,this.componentFactories=r}}let I1=(()=>{class t{compileModuleSync(r){return new My(r)}compileModuleAsync(r){return Promise.resolve(this.compileModuleSync(r))}compileModuleAndAllComponentsSync(r){const a=this.compileModuleSync(r),g=wo(Sr(r).declarations).reduce((b,D)=>{const I=tr(D);return I&&b.push(new Cy(I)),b},[]);return new _D(a,g)}compileModuleAndAllComponentsAsync(r){return Promise.resolve(this.compileModuleAndAllComponentsSync(r))}clearCache(){}clearCacheFor(r){}getModuleId(r){}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();const vD=(()=>Promise.resolve(0))();function $y(t){"undefined"==typeof Zone?vD.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class Oi{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new cc(!1),this.onMicrotaskEmpty=new cc(!1),this.onStable=new cc(!1),this.onError=new cc(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const h=this;h._nesting=0,h._outer=h._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(h._inner=h._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(h._inner=h._inner.fork(Zone.longStackTraceZoneSpec)),h.shouldCoalesceEventChangeDetection=!a&&r,h.shouldCoalesceRunChangeDetection=a,h.lastRequestAnimationFrameId=-1,h.nativeRequestAnimationFrame=function xD(){let t=rn.requestAnimationFrame,n=rn.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&n){const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r);const a=n[Zone.__symbol__("OriginalDelegate")];a&&(n=a)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function ED(t){const n=()=>{!function wD(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(rn,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Hy(t),t.isCheckStableRunning=!0,Gy(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Hy(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(r,a,h,g,b,D)=>{try{return S1(t),r.invokeTask(h,g,b,D)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===g.type||t.shouldCoalesceRunChangeDetection)&&n(),A1(t)}},onInvoke:(r,a,h,g,b,D,I)=>{try{return S1(t),r.invoke(h,g,b,D,I)}finally{t.shouldCoalesceRunChangeDetection&&n(),A1(t)}},onHasTask:(r,a,h,g)=>{r.hasTask(h,g),a===h&&("microTask"==g.change?(t._hasPendingMicrotasks=g.microTask,Hy(t),Gy(t)):"macroTask"==g.change&&(t.hasPendingMacrotasks=g.macroTask))},onHandleError:(r,a,h,g)=>(r.handleError(h,g),t.runOutsideAngular(()=>t.onError.emit(g)),!1)})}(h)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Oi.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Oi.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(n,r,a){return this._inner.run(n,r,a)}runTask(n,r,a,h){const g=this._inner,b=g.scheduleEventTask("NgZoneEvent: "+h,n,bD,bg,bg);try{return g.runTask(b,r,a)}finally{g.cancelTask(b)}}runGuarded(n,r,a){return this._inner.runGuarded(n,r,a)}runOutsideAngular(n){return this._outer.run(n)}}const bD={};function Gy(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Hy(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function S1(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function A1(t){t._nesting--,Gy(t)}class TD{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new cc,this.onMicrotaskEmpty=new cc,this.onStable=new cc,this.onError=new cc}run(n,r,a){return n.apply(r,a)}runGuarded(n,r,a){return n.apply(r,a)}runOutsideAngular(n){return n()}runTask(n,r,a,h){return n.apply(r,a)}}let qy=(()=>{class t{constructor(r){this._ngZone=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),r.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Oi.assertNotInAngularZone(),$y(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())$y(()=>{for(;0!==this._callbacks.length;){let r=this._callbacks.pop();clearTimeout(r.timeoutId),r.doneCb(this._didWork)}this._didWork=!1});else{let r=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(r)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(r=>({source:r.source,creationLocation:r.creationLocation,data:r.data})):[]}addCallback(r,a,h){let g=-1;a&&a>0&&(g=setTimeout(()=>{this._callbacks=this._callbacks.filter(b=>b.timeoutId!==g),r(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:r,timeoutId:g,updateCb:h})}whenStable(r,a,h){if(h&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(r,a,h),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(r,a,h){return[]}}return t.\u0275fac=function(r){return new(r||t)(rt(Oi))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})(),P1=(()=>{class t{constructor(){this._applications=new Map,Zy.addToWindow(this)}registerApplication(r,a){this._applications.set(r,a)}unregisterApplication(r){this._applications.delete(r)}unregisterAllApplications(){this._applications.clear()}getTestability(r){return this._applications.get(r)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(r,a=!0){return Zy.findTestabilityInTree(this,r,a)}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();class DD{addToWindow(n){}findTestabilityInTree(n,r,a){return null}}let _a,Zy=new DD;const k1=new an("AllowMultipleToken");function L1(t,n,r=[]){const a=`Platform: ${n}`,h=new an(a);return(g=[])=>{let b=R1();if(!b||b.injector.get(k1,!1))if(t)t(r.concat(g).concat({provide:h,useValue:!0}));else{const D=r.concat(g).concat({provide:h,useValue:!0},{provide:N,useValue:"platform"});!function SD(t){if(_a&&!_a.destroyed&&!_a.injector.get(k1,!1))throw new Kt(400,"");_a=t.get(F1);const n=t.get(C1,null);n&&n.forEach(r=>r())}(yt.create({providers:D,name:a}))}return function AD(t){const n=R1();if(!n)throw new Kt(401,"");return n}()}}function R1(){return _a&&!_a.destroyed?_a:null}let F1=(()=>{class t{constructor(r){this._injector=r,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(r,a){const D=function PD(t,n){let r;return r="noop"===t?new TD:("zone.js"===t?void 0:t)||new Oi({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==n?void 0:n.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==n?void 0:n.ngZoneRunCoalescing)}),r}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),I=[{provide:Oi,useValue:D}];return D.run(()=>{const L=yt.create({providers:I,parent:this.injector,name:r.moduleType.name}),B=r.create(L),$=B.injector.get(Qc,null);if(!$)throw new Kt(402,"");return D.runOutsideAngular(()=>{const ee=D.onError.subscribe({next:ae=>{$.handleError(ae)}});B.onDestroy(()=>{Wy(this._modules,B),ee.unsubscribe()})}),function kD(t,n,r){try{const a=r();return dy(a)?a.catch(h=>{throw n.runOutsideAngular(()=>t.handleError(h)),h}):a}catch(a){throw n.runOutsideAngular(()=>t.handleError(a)),a}}($,D,()=>{const ee=B.injector.get(Xd);return ee.runInitializers(),ee.donePromise.then(()=>(function iE(t){ft(t,"Expected localeId to be defined"),"string"==typeof t&&(p0=t.toLowerCase().replace(/_/g,"-"))}(B.injector.get(_u,dg)||dg),this._moduleDoBootstrap(B),B))})})}bootstrapModule(r,a=[]){const h=z1({},a);return function MD(t,n,r){const a=new My(r);return Promise.resolve(a)}(0,0,r).then(g=>this.bootstrapModuleFactory(g,h))}_moduleDoBootstrap(r){const a=r.injector.get(Eg);if(r._bootstrapComponents.length>0)r._bootstrapComponents.forEach(h=>a.bootstrap(h));else{if(!r.instance.ngDoBootstrap)throw new Kt(403,"");r.instance.ngDoBootstrap(a)}this._modules.push(r)}onDestroy(r){this._destroyListeners.push(r)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Kt(404,"");this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(r){return new(r||t)(rt(yt))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();function z1(t,n){return Array.isArray(n)?n.reduce(z1,t):Object.assign(Object.assign({},t),n)}let Eg=(()=>{class t{constructor(r,a,h,g,b){this._zone=r,this._injector=a,this._exceptionHandler=h,this._componentFactoryResolver=g,this._initStatus=b,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const D=new Yn(L=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{L.next(this._stable),L.complete()})}),I=new Yn(L=>{let B;this._zone.runOutsideAngular(()=>{B=this._zone.onStable.subscribe(()=>{Oi.assertNotInAngularZone(),$y(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,L.next(!0))})})});const $=this._zone.onUnstable.subscribe(()=>{Oi.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{L.next(!1)}))});return()=>{B.unsubscribe(),$.unsubscribe()}});this.isStable=function Il(...t){const n=Mt(t),r=function gn(t,n){return"number"==typeof st(t)?t.pop():n}(t,1/0),a=t;return a.length?1===a.length?hr(a[0]):function Me(t=1/0){return _e(ci,t)}(r)(Ml(a,n)):Ae}(D,I.pipe(function wc(t={}){const{connector:n=(()=>new wl),resetOnError:r=!0,resetOnComplete:a=!0,resetOnRefCountZero:h=!0}=t;return g=>{let b=null,D=null,I=null,L=0,B=!1,$=!1;const ee=()=>{null==D||D.unsubscribe(),D=null},ae=()=>{ee(),b=I=null,B=$=!1},ye=()=>{const Fe=b;ae(),null==Fe||Fe.unsubscribe()};return Vi((Fe,qe)=>{L++,!$&&!B&&ee();const He=I=null!=I?I:n();qe.add(()=>{L--,0===L&&!$&&!B&&(D=Ca(ye,h))}),He.subscribe(qe),b||(b=new vi({next:Se=>He.next(Se),error:Se=>{$=!0,ee(),D=Ca(ae,r,Se),He.error(Se)},complete:()=>{B=!0,ee(),D=Ca(ae,a),He.complete()}}),Ml(Fe).subscribe(b))})(g)}}()))}bootstrap(r,a){if(!this._initStatus.done)throw new Kt(405,"");let h;h=r instanceof B0?r:this._componentFactoryResolver.resolveComponentFactory(r),this.componentTypes.push(h.componentType);const g=function ID(t){return t.isBoundToModule}(h)?void 0:this._injector.get(qd),D=h.create(yt.NULL,[],a||h.selector,g),I=D.location.nativeElement,L=D.injector.get(qy,null),B=L&&D.injector.get(P1);return L&&B&&B.registerApplication(I,L),D.onDestroy(()=>{this.detachView(D.hostView),Wy(this.components,D),B&&B.unregisterApplication(I)}),this._loadComponent(D),D}tick(){if(this._runningTick)throw new Kt(101,"");try{this._runningTick=!0;for(let r of this._views)r.detectChanges()}catch(r){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(r))}finally{this._runningTick=!1}}attachView(r){const a=r;this._views.push(a),a.attachToAppRef(this)}detachView(r){const a=r;Wy(this._views,a),a.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r),this._injector.get(mD,[]).concat(this._bootstrapListeners).forEach(h=>h(r))}ngOnDestroy(){this._views.slice().forEach(r=>r.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(r){return new(r||t)(rt(Oi),rt(yt),rt(Qc),rt(Rf),rt(Xd))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();function Wy(t,n){const r=t.indexOf(n);r>-1&&t.splice(r,1)}let B1=!0;class $1{constructor(){}supports(n){return sc(n)}create(n){return new $D(n)}}const UD=(t,n)=>n;class $D{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||UD}forEachItem(n){let r;for(r=this._itHead;null!==r;r=r._next)n(r)}forEachOperation(n){let r=this._itHead,a=this._removalsHead,h=0,g=null;for(;r||a;){const b=!a||r&&r.currentIndex<H1(a,h,g)?r:a,D=H1(b,h,g),I=b.currentIndex;if(b===a)h--,a=a._nextRemoved;else if(r=r._next,null==b.previousIndex)h++;else{g||(g=[]);const L=D-h,B=I-h;if(L!=B){for(let ee=0;ee<L;ee++){const ae=ee<g.length?g[ee]:g[ee]=0,ye=ae+ee;B<=ye&&ye<L&&(g[ee]=ae+1)}g[b.previousIndex]=B-L}}D!==I&&n(b,D,I)}}forEachPreviousItem(n){let r;for(r=this._previousItHead;null!==r;r=r._nextPrevious)n(r)}forEachAddedItem(n){let r;for(r=this._additionsHead;null!==r;r=r._nextAdded)n(r)}forEachMovedItem(n){let r;for(r=this._movesHead;null!==r;r=r._nextMoved)n(r)}forEachRemovedItem(n){let r;for(r=this._removalsHead;null!==r;r=r._nextRemoved)n(r)}forEachIdentityChange(n){let r;for(r=this._identityChangesHead;null!==r;r=r._nextIdentityChange)n(r)}diff(n){if(null==n&&(n=[]),!sc(n))throw new Kt(900,"");return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let h,g,b,r=this._itHead,a=!1;if(Array.isArray(n)){this.length=n.length;for(let D=0;D<this.length;D++)g=n[D],b=this._trackByFn(D,g),null!==r&&Object.is(r.trackById,b)?(a&&(r=this._verifyReinsertion(r,g,b,D)),Object.is(r.item,g)||this._addIdentityChange(r,g)):(r=this._mismatch(r,g,b,D),a=!0),r=r._next}else h=0,function dl(t,n){if(Array.isArray(t))for(let r=0;r<t.length;r++)n(t[r]);else{const r=t[yi()]();let a;for(;!(a=r.next()).done;)n(a.value)}}(n,D=>{b=this._trackByFn(h,D),null!==r&&Object.is(r.trackById,b)?(a&&(r=this._verifyReinsertion(r,D,b,h)),Object.is(r.item,D)||this._addIdentityChange(r,D)):(r=this._mismatch(r,D,b,h),a=!0),r=r._next,h++}),this.length=h;return this._truncate(r),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,r,a,h){let g;return null===n?g=this._itTail:(g=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(n.item,r)||this._addIdentityChange(n,r),this._reinsertAfter(n,g,h)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(a,h))?(Object.is(n.item,r)||this._addIdentityChange(n,r),this._moveAfter(n,g,h)):n=this._addAfter(new GD(r,a),g,h),n}_verifyReinsertion(n,r,a,h){let g=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==g?n=this._reinsertAfter(g,n._prev,h):n.currentIndex!=h&&(n.currentIndex=h,this._addToMoves(n,h)),n}_truncate(n){for(;null!==n;){const r=n._next;this._addToRemovals(this._unlink(n)),n=r}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,r,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const h=n._prevRemoved,g=n._nextRemoved;return null===h?this._removalsHead=g:h._nextRemoved=g,null===g?this._removalsTail=h:g._prevRemoved=h,this._insertAfter(n,r,a),this._addToMoves(n,a),n}_moveAfter(n,r,a){return this._unlink(n),this._insertAfter(n,r,a),this._addToMoves(n,a),n}_addAfter(n,r,a){return this._insertAfter(n,r,a),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,r,a){const h=null===r?this._itHead:r._next;return n._next=h,n._prev=r,null===h?this._itTail=n:h._prev=n,null===r?this._itHead=n:r._next=n,null===this._linkedRecords&&(this._linkedRecords=new G1),this._linkedRecords.put(n),n.currentIndex=a,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const r=n._prev,a=n._next;return null===r?this._itHead=a:r._next=a,null===a?this._itTail=r:a._prev=r,n}_addToMoves(n,r){return n.previousIndex===r||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new G1),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,r){return n.item=r,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class GD{constructor(n,r){this.item=n,this.trackById=r,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class HD{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,r){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===r||r<=a.currentIndex)&&Object.is(a.trackById,n))return a;return null}remove(n){const r=n._prevDup,a=n._nextDup;return null===r?this._head=a:r._nextDup=a,null===a?this._tail=r:a._prevDup=r,null===this._head}}class G1{constructor(){this.map=new Map}put(n){const r=n.trackById;let a=this.map.get(r);a||(a=new HD,this.map.set(r,a)),a.add(n)}get(n,r){const h=this.map.get(n);return h?h.get(n,r):null}remove(n){const r=n.trackById;return this.map.get(r).remove(n)&&this.map.delete(r),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function H1(t,n,r){const a=t.previousIndex;if(null===a)return a;let h=0;return r&&a<r.length&&(h=r[a]),a+n+h}class q1{constructor(){}supports(n){return n instanceof Map||dh(n)}create(){return new qD}}class qD{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let r;for(r=this._mapHead;null!==r;r=r._next)n(r)}forEachPreviousItem(n){let r;for(r=this._previousMapHead;null!==r;r=r._nextPrevious)n(r)}forEachChangedItem(n){let r;for(r=this._changesHead;null!==r;r=r._nextChanged)n(r)}forEachAddedItem(n){let r;for(r=this._additionsHead;null!==r;r=r._nextAdded)n(r)}forEachRemovedItem(n){let r;for(r=this._removalsHead;null!==r;r=r._nextRemoved)n(r)}diff(n){if(n){if(!(n instanceof Map||dh(n)))throw new Kt(900,"")}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let r=this._mapHead;if(this._appendAfter=null,this._forEach(n,(a,h)=>{if(r&&r.key===h)this._maybeAddToChanges(r,a),this._appendAfter=r,r=r._next;else{const g=this._getOrCreateRecordForKey(h,a);r=this._insertBeforeOrAppend(r,g)}}),r){r._prev&&(r._prev._next=null),this._removalsHead=r;for(let a=r;null!==a;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,r){if(n){const a=n._prev;return r._next=n,r._prev=a,n._prev=r,a&&(a._next=r),n===this._mapHead&&(this._mapHead=r),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=r,r._prev=this._appendAfter):this._mapHead=r,this._appendAfter=r,null}_getOrCreateRecordForKey(n,r){if(this._records.has(n)){const h=this._records.get(n);this._maybeAddToChanges(h,r);const g=h._prev,b=h._next;return g&&(g._next=b),b&&(b._prev=g),h._next=null,h._prev=null,h}const a=new ZD(n);return this._records.set(n,a),a.currentValue=r,this._addToAdditions(a),a}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,r){Object.is(r,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=r,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,r){n instanceof Map?n.forEach(r):Object.keys(n).forEach(a=>r(n[a],a))}}class ZD{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Z1(){return new Cg([new $1])}let Cg=(()=>{class t{constructor(r){this.factories=r}static create(r,a){if(null!=a){const h=a.factories.slice();r=r.concat(h)}return new t(r)}static extend(r){return{provide:t,useFactory:a=>t.create(r,a||Z1()),deps:[[t,new Hl,new mi]]}}find(r){const a=this.factories.find(h=>h.supports(r));if(null!=a)return a;throw new Kt(901,"")}}return t.\u0275prov=pt({token:t,providedIn:"root",factory:Z1}),t})();function W1(){return new Vf([new q1])}let Vf=(()=>{class t{constructor(r){this.factories=r}static create(r,a){if(a){const h=a.factories.slice();r=r.concat(h)}return new t(r)}static extend(r){return{provide:t,useFactory:a=>t.create(r,a||W1()),deps:[[t,new Hl,new mi]]}}find(r){const a=this.factories.find(g=>g.supports(r));if(a)return a;throw new Kt(901,"")}}return t.\u0275prov=pt({token:t,providedIn:"root",factory:W1}),t})();const KD=L1(null,"core",[{provide:wg,useValue:"unknown"},{provide:F1,deps:[yt]},{provide:P1,deps:[]},{provide:gD,deps:[]}]),QD=[{provide:Eg,useClass:Eg,deps:[Oi,yt,Qc,Rf,Xd]},{provide:hT,deps:[Oi],useFactory:function eC(t){let n=[];return t.onStable.subscribe(()=>{for(;n.length;)n.pop()()}),function(r){n.push(r)}}},{provide:Xd,useClass:Xd,deps:[[new mi,jy]]},{provide:I1,useClass:I1,deps:[]},fD,{provide:_u,useFactory:function YD(t){return t||function JD(){return"undefined"!=typeof $localize&&$localize.locale||dg}()},deps:[[new qu(_u),new mi,new Hl]]},{provide:M1,useValue:"USD"}];let tC=(()=>{class t{constructor(r){}}return t.\u0275fac=function(r){return new(r||t)(rt(Eg))},t.\u0275mod=ei({type:t}),t.\u0275inj=zn({providers:QD}),t})(),Mg=null;function jf(){return Mg}const ya=new an("DocumentToken");var jr=(()=>((jr=jr||{})[jr.Zero=0]="Zero",jr[jr.One=1]="One",jr[jr.Two=2]="Two",jr[jr.Few=3]="Few",jr[jr.Many=4]="Many",jr[jr.Other=5]="Other",jr))();const fC=function h0(t){return function oo(t){const n=function eE(t){return t.toLowerCase().replace(/_/g,"-")}(t);let r=d0(n);if(r)return r;const a=n.split("-")[0];if(r=d0(a),r)return r;if("en"===a)return Qw;throw new Error(`Missing locale data for the locale "${t}".`)}(t)[ot.PluralCase]};class Og{}let $C=(()=>{class t extends Og{constructor(r){super(),this.locale=r}getPluralCategory(r,a){switch(fC(a||this.locale)(r)){case jr.Zero:return"zero";case jr.One:return"one";case jr.Two:return"two";case jr.Few:return"few";case jr.Many:return"many";default:return"other"}}}return t.\u0275fac=function(r){return new(r||t)(rt(_u))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();function ob(t,n){n=encodeURIComponent(n);for(const r of t.split(";")){const a=r.indexOf("="),[h,g]=-1==a?[r,""]:[r.slice(0,a),r.slice(a+1)];if(h.trim()===n)return decodeURIComponent(g)}return null}let sb=(()=>{class t{constructor(r,a,h,g){this._iterableDiffers=r,this._keyValueDiffers=a,this._ngEl=h,this._renderer=g,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(r){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof r?r.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(r){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof r?r.split(/\s+/):r,this._rawClass&&(sc(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const r=this._iterableDiffer.diff(this._rawClass);r&&this._applyIterableChanges(r)}else if(this._keyValueDiffer){const r=this._keyValueDiffer.diff(this._rawClass);r&&this._applyKeyValueChanges(r)}}_applyKeyValueChanges(r){r.forEachAddedItem(a=>this._toggleClass(a.key,a.currentValue)),r.forEachChangedItem(a=>this._toggleClass(a.key,a.currentValue)),r.forEachRemovedItem(a=>{a.previousValue&&this._toggleClass(a.key,!1)})}_applyIterableChanges(r){r.forEachAddedItem(a=>{if("string"!=typeof a.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${Nt(a.item)}`);this._toggleClass(a.item,!0)}),r.forEachRemovedItem(a=>this._toggleClass(a.item,!1))}_applyClasses(r){r&&(Array.isArray(r)||r instanceof Set?r.forEach(a=>this._toggleClass(a,!0)):Object.keys(r).forEach(a=>this._toggleClass(a,!!r[a])))}_removeClasses(r){r&&(Array.isArray(r)||r instanceof Set?r.forEach(a=>this._toggleClass(a,!1)):Object.keys(r).forEach(a=>this._toggleClass(a,!1)))}_toggleClass(r,a){(r=r.trim())&&r.split(/\s+/g).forEach(h=>{a?this._renderer.addClass(this._ngEl.nativeElement,h):this._renderer.removeClass(this._ngEl.nativeElement,h)})}}return t.\u0275fac=function(r){return new(r||t)(zt(Cg),zt(Vf),zt(Hd),zt(j0))},t.\u0275dir=Ir({type:t,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),t})();class HC{constructor(n,r,a,h){this.$implicit=n,this.ngForOf=r,this.index=a,this.count=h}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let ab=(()=>{class t{constructor(r,a,h){this._viewContainer=r,this._template=a,this._differs=h,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(r){this._ngForOf=r,this._ngForOfDirty=!0}set ngForTrackBy(r){this._trackByFn=r}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(r){r&&(this._template=r)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const r=this._ngForOf;!this._differ&&r&&(this._differ=this._differs.find(r).create(this.ngForTrackBy))}if(this._differ){const r=this._differ.diff(this._ngForOf);r&&this._applyChanges(r)}}_applyChanges(r){const a=this._viewContainer;r.forEachOperation((h,g,b)=>{if(null==h.previousIndex)a.createEmbeddedView(this._template,new HC(h.item,this._ngForOf,-1,-1),null===b?void 0:b);else if(null==b)a.remove(null===g?void 0:g);else if(null!==g){const D=a.get(g);a.move(D,b),lb(D,h)}});for(let h=0,g=a.length;h<g;h++){const D=a.get(h).context;D.index=h,D.count=g,D.ngForOf=this._ngForOf}r.forEachIdentityChange(h=>{lb(a.get(h.currentIndex),h)})}static ngTemplateContextGuard(r,a){return!0}}return t.\u0275fac=function(r){return new(r||t)(zt(gl),zt(uc),zt(Cg))},t.\u0275dir=Ir({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),t})();function lb(t,n){t.context.$implicit=n.item}let av=(()=>{class t{constructor(r,a){this._viewContainer=r,this._context=new qC,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=a}set ngIf(r){this._context.$implicit=this._context.ngIf=r,this._updateView()}set ngIfThen(r){cb("ngIfThen",r),this._thenTemplateRef=r,this._thenViewRef=null,this._updateView()}set ngIfElse(r){cb("ngIfElse",r),this._elseTemplateRef=r,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(r,a){return!0}}return t.\u0275fac=function(r){return new(r||t)(zt(gl),zt(uc))},t.\u0275dir=Ir({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),t})();class qC{constructor(){this.$implicit=null,this.ngIf=null}}function cb(t,n){if(n&&!n.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${Nt(n)}'.`)}let db=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=ei({type:t}),t.\u0275inj=zn({providers:[{provide:Og,useClass:$C}]}),t})();class mb{}class dv extends class EM extends class iC{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function rC(t){Mg||(Mg=t)}(new dv)}onAndCancel(n,r,a){return n.addEventListener(r,a,!1),()=>{n.removeEventListener(r,a,!1)}}dispatchEvent(n,r){n.dispatchEvent(r)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,r){return(r=r||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,r){return"window"===r?window:"document"===r?n:"body"===r?n.body:null}getBaseHref(n){const r=function TM(){return Gf=Gf||document.querySelector("base"),Gf?Gf.getAttribute("href"):null}();return null==r?null:function DM(t){Bg=Bg||document.createElement("a"),Bg.setAttribute("href",t);const n=Bg.pathname;return"/"===n.charAt(0)?n:`/${n}`}(r)}resetBaseElement(){Gf=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return ob(document.cookie,n)}}let Bg,Gf=null;const gb=new an("TRANSITION_ID"),MM=[{provide:jy,useFactory:function CM(t,n,r){return()=>{r.get(Xd).donePromise.then(()=>{const a=jf(),h=n.querySelectorAll(`style[ng-transition="${t}"]`);for(let g=0;g<h.length;g++)a.remove(h[g])})}},deps:[gb,ya,yt],multi:!0}];class pv{static init(){!function CD(t){Zy=t}(new pv)}addToWindow(n){rn.getAngularTestability=(a,h=!0)=>{const g=n.findTestabilityInTree(a,h);if(null==g)throw new Error("Could not find testability for element.");return g},rn.getAllAngularTestabilities=()=>n.getAllTestabilities(),rn.getAllAngularRootElements=()=>n.getAllRootElements(),rn.frameworkStabilizers||(rn.frameworkStabilizers=[]),rn.frameworkStabilizers.push(a=>{const h=rn.getAllAngularTestabilities();let g=h.length,b=!1;const D=function(I){b=b||I,g--,0==g&&a(b)};h.forEach(function(I){I.whenStable(D)})})}findTestabilityInTree(n,r,a){if(null==r)return null;const h=n.getTestability(r);return null!=h?h:a?jf().isShadowRoot(r)?this.findTestabilityInTree(n,r.host,!0):this.findTestabilityInTree(n,r.parentElement,!0):null}}let IM=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();const Ng=new an("EventManagerPlugins");let Vg=(()=>{class t{constructor(r,a){this._zone=a,this._eventNameToPlugin=new Map,r.forEach(h=>h.manager=this),this._plugins=r.slice().reverse()}addEventListener(r,a,h){return this._findPluginFor(a).addEventListener(r,a,h)}addGlobalEventListener(r,a,h){return this._findPluginFor(a).addGlobalEventListener(r,a,h)}getZone(){return this._zone}_findPluginFor(r){const a=this._eventNameToPlugin.get(r);if(a)return a;const h=this._plugins;for(let g=0;g<h.length;g++){const b=h[g];if(b.supports(r))return this._eventNameToPlugin.set(r,b),b}throw new Error(`No event manager plugin found for event ${r}`)}}return t.\u0275fac=function(r){return new(r||t)(rt(Ng),rt(Oi))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();class _b{constructor(n){this._doc=n}addGlobalEventListener(n,r,a){const h=jf().getGlobalEventTarget(this._doc,n);if(!h)throw new Error(`Unsupported event target ${h} for event ${r}`);return this.addEventListener(h,r,a)}}let yb=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(r){const a=new Set;r.forEach(h=>{this._stylesSet.has(h)||(this._stylesSet.add(h),a.add(h))}),this.onStylesAdded(a)}onStylesAdded(r){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})(),Hf=(()=>{class t extends yb{constructor(r){super(),this._doc=r,this._hostNodes=new Map,this._hostNodes.set(r.head,[])}_addStylesToHost(r,a,h){r.forEach(g=>{const b=this._doc.createElement("style");b.textContent=g,h.push(a.appendChild(b))})}addHost(r){const a=[];this._addStylesToHost(this._stylesSet,r,a),this._hostNodes.set(r,a)}removeHost(r){const a=this._hostNodes.get(r);a&&a.forEach(vb),this._hostNodes.delete(r)}onStylesAdded(r){this._hostNodes.forEach((a,h)=>{this._addStylesToHost(r,h,a)})}ngOnDestroy(){this._hostNodes.forEach(r=>r.forEach(vb))}}return t.\u0275fac=function(r){return new(r||t)(rt(ya))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();function vb(t){jf().remove(t)}const fv={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},mv=/%COMP%/g;function jg(t,n,r){for(let a=0;a<n.length;a++){let h=n[a];Array.isArray(h)?jg(t,h,r):(h=h.replace(mv,t),r.push(h))}return r}function wb(t){return n=>{if("__ngUnwrap__"===n)return t;!1===t(n)&&(n.preventDefault(),n.returnValue=!1)}}let gv=(()=>{class t{constructor(r,a,h){this.eventManager=r,this.sharedStylesHost=a,this.appId=h,this.rendererByCompId=new Map,this.defaultRenderer=new _v(r)}createRenderer(r,a){if(!r||!a)return this.defaultRenderer;switch(a.encapsulation){case ho.Emulated:{let h=this.rendererByCompId.get(a.id);return h||(h=new RM(this.eventManager,this.sharedStylesHost,a,this.appId),this.rendererByCompId.set(a.id,h)),h.applyToHost(r),h}case 1:case ho.ShadowDom:return new FM(this.eventManager,this.sharedStylesHost,r,a);default:if(!this.rendererByCompId.has(a.id)){const h=jg(a.id,a.styles,[]);this.sharedStylesHost.addStyles(h),this.rendererByCompId.set(a.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(r){return new(r||t)(rt(Vg),rt(Hf),rt(Nf))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();class _v{constructor(n){this.eventManager=n,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,r){return r?document.createElementNS(fv[r]||r,n):document.createElement(n)}createComment(n){return document.createComment(n)}createText(n){return document.createTextNode(n)}appendChild(n,r){n.appendChild(r)}insertBefore(n,r,a){n&&n.insertBefore(r,a)}removeChild(n,r){n&&n.removeChild(r)}selectRootElement(n,r){let a="string"==typeof n?document.querySelector(n):n;if(!a)throw new Error(`The selector "${n}" did not match any elements`);return r||(a.textContent=""),a}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,r,a,h){if(h){r=h+":"+r;const g=fv[h];g?n.setAttributeNS(g,r,a):n.setAttribute(r,a)}else n.setAttribute(r,a)}removeAttribute(n,r,a){if(a){const h=fv[a];h?n.removeAttributeNS(h,r):n.removeAttribute(`${a}:${r}`)}else n.removeAttribute(r)}addClass(n,r){n.classList.add(r)}removeClass(n,r){n.classList.remove(r)}setStyle(n,r,a,h){h&(qr.DashCase|qr.Important)?n.style.setProperty(r,a,h&qr.Important?"important":""):n.style[r]=a}removeStyle(n,r,a){a&qr.DashCase?n.style.removeProperty(r):n.style[r]=""}setProperty(n,r,a){n[r]=a}setValue(n,r){n.nodeValue=r}listen(n,r,a){return"string"==typeof n?this.eventManager.addGlobalEventListener(n,r,wb(a)):this.eventManager.addEventListener(n,r,wb(a))}}class RM extends _v{constructor(n,r,a,h){super(n),this.component=a;const g=jg(h+"-"+a.id,a.styles,[]);r.addStyles(g),this.contentAttr=function PM(t){return"_ngcontent-%COMP%".replace(mv,t)}(h+"-"+a.id),this.hostAttr=function kM(t){return"_nghost-%COMP%".replace(mv,t)}(h+"-"+a.id)}applyToHost(n){super.setAttribute(n,this.hostAttr,"")}createElement(n,r){const a=super.createElement(n,r);return super.setAttribute(a,this.contentAttr,""),a}}class FM extends _v{constructor(n,r,a,h){super(n),this.sharedStylesHost=r,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const g=jg(h.id,h.styles,[]);for(let b=0;b<g.length;b++){const D=document.createElement("style");D.textContent=g[b],this.shadowRoot.appendChild(D)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(n,r){return super.appendChild(this.nodeOrShadowRoot(n),r)}insertBefore(n,r,a){return super.insertBefore(this.nodeOrShadowRoot(n),r,a)}removeChild(n,r){return super.removeChild(this.nodeOrShadowRoot(n),r)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}}let zM=(()=>{class t extends _b{constructor(r){super(r)}supports(r){return!0}addEventListener(r,a,h){return r.addEventListener(a,h,!1),()=>this.removeEventListener(r,a,h)}removeEventListener(r,a,h){return r.removeEventListener(a,h)}}return t.\u0275fac=function(r){return new(r||t)(rt(ya))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();const Tb=["alt","control","meta","shift"],BM={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Db={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},NM={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let VM=(()=>{class t extends _b{constructor(r){super(r)}supports(r){return null!=t.parseEventName(r)}addEventListener(r,a,h){const g=t.parseEventName(a),b=t.eventCallback(g.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>jf().onAndCancel(r,g.domEventName,b))}static parseEventName(r){const a=r.toLowerCase().split("."),h=a.shift();if(0===a.length||"keydown"!==h&&"keyup"!==h)return null;const g=t._normalizeKey(a.pop());let b="";if(Tb.forEach(I=>{const L=a.indexOf(I);L>-1&&(a.splice(L,1),b+=I+".")}),b+=g,0!=a.length||0===g.length)return null;const D={};return D.domEventName=h,D.fullKey=b,D}static getEventFullKey(r){let a="",h=function jM(t){let n=t.key;if(null==n){if(n=t.keyIdentifier,null==n)return"Unidentified";n.startsWith("U+")&&(n=String.fromCharCode(parseInt(n.substring(2),16)),3===t.location&&Db.hasOwnProperty(n)&&(n=Db[n]))}return BM[n]||n}(r);return h=h.toLowerCase()," "===h?h="space":"."===h&&(h="dot"),Tb.forEach(g=>{g!=h&&NM[g](r)&&(a+=g+".")}),a+=h,a}static eventCallback(r,a,h){return g=>{t.getEventFullKey(g)===r&&h.runGuarded(()=>a(g))}}static _normalizeKey(r){return"esc"===r?"escape":r}}return t.\u0275fac=function(r){return new(r||t)(rt(ya))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();const HM=L1(KD,"browser",[{provide:wg,useValue:"browser"},{provide:C1,useValue:function UM(){dv.makeCurrent(),pv.init()},multi:!0},{provide:ya,useFactory:function GM(){return function Sh(t){$a=t}(document),document},deps:[]}]),qM=[{provide:N,useValue:"root"},{provide:Qc,useFactory:function $M(){return new Qc},deps:[]},{provide:Ng,useClass:zM,multi:!0,deps:[ya,Oi,wg]},{provide:Ng,useClass:VM,multi:!0,deps:[ya]},{provide:gv,useClass:gv,deps:[Vg,Hf,Nf]},{provide:V0,useExisting:gv},{provide:yb,useExisting:Hf},{provide:Hf,useClass:Hf,deps:[ya]},{provide:qy,useClass:qy,deps:[Oi]},{provide:Vg,useClass:Vg,deps:[Ng,Oi]},{provide:mb,useClass:IM,deps:[]}];let ZM=(()=>{class t{constructor(r){if(r)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(r){return{ngModule:t,providers:[{provide:Nf,useValue:r.appId},{provide:gb,useExisting:Nf},MM]}}}return t.\u0275fac=function(r){return new(r||t)(rt(t,12))},t.\u0275mod=ei({type:t}),t.\u0275inj=zn({providers:qM,imports:[db,tC]}),t})();"undefined"!=typeof window&&window;class Ug{}class Ib{}class dc{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?this.lazyInit="string"==typeof n?()=>{this.headers=new Map,n.split("\n").forEach(r=>{const a=r.indexOf(":");if(a>0){const h=r.slice(0,a),g=h.toLowerCase(),b=r.slice(a+1).trim();this.maybeSetNormalizedName(h,g),this.headers.has(g)?this.headers.get(g).push(b):this.headers.set(g,[b])}})}:()=>{this.headers=new Map,Object.keys(n).forEach(r=>{let a=n[r];const h=r.toLowerCase();"string"==typeof a&&(a=[a]),a.length>0&&(this.headers.set(h,a),this.maybeSetNormalizedName(r,h))})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const r=this.headers.get(n.toLowerCase());return r&&r.length>0?r[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,r){return this.clone({name:n,value:r,op:"a"})}set(n,r){return this.clone({name:n,value:r,op:"s"})}delete(n,r){return this.clone({name:n,value:r,op:"d"})}maybeSetNormalizedName(n,r){this.normalizedNames.has(r)||this.normalizedNames.set(r,n)}init(){this.lazyInit&&(this.lazyInit instanceof dc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(r=>{this.headers.set(r,n.headers.get(r)),this.normalizedNames.set(r,n.normalizedNames.get(r))})}clone(n){const r=new dc;return r.lazyInit=this.lazyInit&&this.lazyInit instanceof dc?this.lazyInit:this,r.lazyUpdate=(this.lazyUpdate||[]).concat([n]),r}applyUpdate(n){const r=n.name.toLowerCase();switch(n.op){case"a":case"s":let a=n.value;if("string"==typeof a&&(a=[a]),0===a.length)return;this.maybeSetNormalizedName(n.name,r);const h=("a"===n.op?this.headers.get(r):void 0)||[];h.push(...a),this.headers.set(r,h);break;case"d":const g=n.value;if(g){let b=this.headers.get(r);if(!b)return;b=b.filter(D=>-1===g.indexOf(D)),0===b.length?(this.headers.delete(r),this.normalizedNames.delete(r)):this.headers.set(r,b)}else this.headers.delete(r),this.normalizedNames.delete(r)}}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(r=>n(this.normalizedNames.get(r),this.headers.get(r)))}}class aI{encodeKey(n){return Sb(n)}encodeValue(n){return Sb(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const cI=/%(\d[a-f0-9])/gi,uI={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function Sb(t){return encodeURIComponent(t).replace(cI,(n,r)=>{var a;return null!==(a=uI[r])&&void 0!==a?a:n})}function Ab(t){return`${t}`}class vu{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new aI,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function lI(t,n){const r=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(h=>{const g=h.indexOf("="),[b,D]=-1==g?[n.decodeKey(h),""]:[n.decodeKey(h.slice(0,g)),n.decodeValue(h.slice(g+1))],I=r.get(b)||[];I.push(D),r.set(b,I)}),r}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(r=>{const a=n.fromObject[r];this.map.set(r,Array.isArray(a)?a:[a])})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const r=this.map.get(n);return r?r[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,r){return this.clone({param:n,value:r,op:"a"})}appendAll(n){const r=[];return Object.keys(n).forEach(a=>{const h=n[a];Array.isArray(h)?h.forEach(g=>{r.push({param:a,value:g,op:"a"})}):r.push({param:a,value:h,op:"a"})}),this.clone(r)}set(n,r){return this.clone({param:n,value:r,op:"s"})}delete(n,r){return this.clone({param:n,value:r,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const r=this.encoder.encodeKey(n);return this.map.get(n).map(a=>r+"="+this.encoder.encodeValue(a)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const r=new vu({encoder:this.encoder});return r.cloneFrom=this.cloneFrom||this,r.updates=(this.updates||[]).concat(n),r}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const r=("a"===n.op?this.map.get(n.param):void 0)||[];r.push(Ab(n.value)),this.map.set(n.param,r);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let a=this.map.get(n.param)||[];const h=a.indexOf(Ab(n.value));-1!==h&&a.splice(h,1),a.length>0?this.map.set(n.param,a):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class hI{constructor(){this.map=new Map}set(n,r){return this.map.set(n,r),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function Pb(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function kb(t){return"undefined"!=typeof Blob&&t instanceof Blob}function Lb(t){return"undefined"!=typeof FormData&&t instanceof FormData}class qf{constructor(n,r,a,h){let g;if(this.url=r,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function dI(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||h?(this.body=void 0!==a?a:null,g=h):g=a,g&&(this.reportProgress=!!g.reportProgress,this.withCredentials=!!g.withCredentials,g.responseType&&(this.responseType=g.responseType),g.headers&&(this.headers=g.headers),g.context&&(this.context=g.context),g.params&&(this.params=g.params)),this.headers||(this.headers=new dc),this.context||(this.context=new hI),this.params){const b=this.params.toString();if(0===b.length)this.urlWithParams=r;else{const D=r.indexOf("?");this.urlWithParams=r+(-1===D?"?":D<r.length-1?"&":"")+b}}else this.params=new vu,this.urlWithParams=r}serializeBody(){return null===this.body?null:Pb(this.body)||kb(this.body)||Lb(this.body)||function pI(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof vu?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Lb(this.body)?null:kb(this.body)?this.body.type||null:Pb(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof vu?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){var r;const a=n.method||this.method,h=n.url||this.url,g=n.responseType||this.responseType,b=void 0!==n.body?n.body:this.body,D=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,I=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let L=n.headers||this.headers,B=n.params||this.params;const $=null!==(r=n.context)&&void 0!==r?r:this.context;return void 0!==n.setHeaders&&(L=Object.keys(n.setHeaders).reduce((ee,ae)=>ee.set(ae,n.setHeaders[ae]),L)),n.setParams&&(B=Object.keys(n.setParams).reduce((ee,ae)=>ee.set(ae,n.setParams[ae]),B)),new qf(a,h,b,{params:B,headers:L,context:$,reportProgress:I,responseType:g,withCredentials:D})}}var $r=(()=>(($r=$r||{})[$r.Sent=0]="Sent",$r[$r.UploadProgress=1]="UploadProgress",$r[$r.ResponseHeader=2]="ResponseHeader",$r[$r.DownloadProgress=3]="DownloadProgress",$r[$r.Response=4]="Response",$r[$r.User=5]="User",$r))();class vv{constructor(n,r=200,a="OK"){this.headers=n.headers||new dc,this.status=void 0!==n.status?n.status:r,this.statusText=n.statusText||a,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class xv extends vv{constructor(n={}){super(n),this.type=$r.ResponseHeader}clone(n={}){return new xv({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class $g extends vv{constructor(n={}){super(n),this.type=$r.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new $g({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class Rb extends vv{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function bv(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let wv=(()=>{class t{constructor(r){this.handler=r}request(r,a,h={}){let g;if(r instanceof qf)g=r;else{let I,L;I=h.headers instanceof dc?h.headers:new dc(h.headers),h.params&&(L=h.params instanceof vu?h.params:new vu({fromObject:h.params})),g=new qf(r,a,void 0!==h.body?h.body:null,{headers:I,context:h.context,params:L,reportProgress:h.reportProgress,responseType:h.responseType||"json",withCredentials:h.withCredentials})}const b=function iI(...t){return Ml(t,Mt(t))}(g).pipe(function oI(t,n){return Rn(n)?_e(t,n,1):_e(t,1)}(I=>this.handler.handle(I)));if(r instanceof qf||"events"===h.observe)return b;const D=b.pipe(function sI(t,n){return Vi((r,a)=>{let h=0;r.subscribe(Ro(a,g=>t.call(n,g,h++)&&a.next(g)))})}(I=>I instanceof $g));switch(h.observe||"body"){case"body":switch(g.responseType){case"arraybuffer":return D.pipe(Fo(I=>{if(null!==I.body&&!(I.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return I.body}));case"blob":return D.pipe(Fo(I=>{if(null!==I.body&&!(I.body instanceof Blob))throw new Error("Response is not a Blob.");return I.body}));case"text":return D.pipe(Fo(I=>{if(null!==I.body&&"string"!=typeof I.body)throw new Error("Response is not a string.");return I.body}));default:return D.pipe(Fo(I=>I.body))}case"response":return D;default:throw new Error(`Unreachable: unhandled observe type ${h.observe}}`)}}delete(r,a={}){return this.request("DELETE",r,a)}get(r,a={}){return this.request("GET",r,a)}head(r,a={}){return this.request("HEAD",r,a)}jsonp(r,a){return this.request("JSONP",r,{params:(new vu).append(a,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,a={}){return this.request("OPTIONS",r,a)}patch(r,a,h={}){return this.request("PATCH",r,bv(h,a))}post(r,a,h={}){return this.request("POST",r,bv(h,a))}put(r,a,h={}){return this.request("PUT",r,bv(h,a))}}return t.\u0275fac=function(r){return new(r||t)(rt(Ug))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();class Fb{constructor(n,r){this.next=n,this.interceptor=r}handle(n){return this.interceptor.intercept(n,this.next)}}const zb=new an("HTTP_INTERCEPTORS");let fI=(()=>{class t{intercept(r,a){return a.handle(r)}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();const mI=/^\)\]\}',?\n/;let Ob=(()=>{class t{constructor(r){this.xhrFactory=r}handle(r){if("JSONP"===r.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Yn(a=>{const h=this.xhrFactory.build();if(h.open(r.method,r.urlWithParams),r.withCredentials&&(h.withCredentials=!0),r.headers.forEach((ae,ye)=>h.setRequestHeader(ae,ye.join(","))),r.headers.has("Accept")||h.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){const ae=r.detectContentTypeHeader();null!==ae&&h.setRequestHeader("Content-Type",ae)}if(r.responseType){const ae=r.responseType.toLowerCase();h.responseType="json"!==ae?ae:"text"}const g=r.serializeBody();let b=null;const D=()=>{if(null!==b)return b;const ae=h.statusText||"OK",ye=new dc(h.getAllResponseHeaders()),Fe=function gI(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(h)||r.url;return b=new xv({headers:ye,status:h.status,statusText:ae,url:Fe}),b},I=()=>{let{headers:ae,status:ye,statusText:Fe,url:qe}=D(),He=null;204!==ye&&(He=void 0===h.response?h.responseText:h.response),0===ye&&(ye=He?200:0);let Se=ye>=200&&ye<300;if("json"===r.responseType&&"string"==typeof He){const ht=He;He=He.replace(mI,"");try{He=""!==He?JSON.parse(He):null}catch(Ut){He=ht,Se&&(Se=!1,He={error:Ut,text:He})}}Se?(a.next(new $g({body:He,headers:ae,status:ye,statusText:Fe,url:qe||void 0})),a.complete()):a.error(new Rb({error:He,headers:ae,status:ye,statusText:Fe,url:qe||void 0}))},L=ae=>{const{url:ye}=D(),Fe=new Rb({error:ae,status:h.status||0,statusText:h.statusText||"Unknown Error",url:ye||void 0});a.error(Fe)};let B=!1;const $=ae=>{B||(a.next(D()),B=!0);let ye={type:$r.DownloadProgress,loaded:ae.loaded};ae.lengthComputable&&(ye.total=ae.total),"text"===r.responseType&&!!h.responseText&&(ye.partialText=h.responseText),a.next(ye)},ee=ae=>{let ye={type:$r.UploadProgress,loaded:ae.loaded};ae.lengthComputable&&(ye.total=ae.total),a.next(ye)};return h.addEventListener("load",I),h.addEventListener("error",L),h.addEventListener("timeout",L),h.addEventListener("abort",L),r.reportProgress&&(h.addEventListener("progress",$),null!==g&&h.upload&&h.upload.addEventListener("progress",ee)),h.send(g),a.next({type:$r.Sent}),()=>{h.removeEventListener("error",L),h.removeEventListener("abort",L),h.removeEventListener("load",I),h.removeEventListener("timeout",L),r.reportProgress&&(h.removeEventListener("progress",$),null!==g&&h.upload&&h.upload.removeEventListener("progress",ee)),h.readyState!==h.DONE&&h.abort()}})}}return t.\u0275fac=function(r){return new(r||t)(rt(mb))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})();const Ev=new an("XSRF_COOKIE_NAME"),Tv=new an("XSRF_HEADER_NAME");class Bb{}let _I=(()=>{class t{constructor(r,a,h){this.doc=r,this.platform=a,this.cookieName=h,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=ob(r,this.cookieName),this.lastCookieString=r),this.lastToken}}return t.\u0275fac=function(r){return new(r||t)(rt(ya),rt(wg),rt(Ev))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})(),Dv=(()=>{class t{constructor(r,a){this.tokenService=r,this.headerName=a}intercept(r,a){const h=r.url.toLowerCase();if("GET"===r.method||"HEAD"===r.method||h.startsWith("http://")||h.startsWith("https://"))return a.handle(r);const g=this.tokenService.getToken();return null!==g&&!r.headers.has(this.headerName)&&(r=r.clone({headers:r.headers.set(this.headerName,g)})),a.handle(r)}}return t.\u0275fac=function(r){return new(r||t)(rt(Bb),rt(Tv))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})(),yI=(()=>{class t{constructor(r,a){this.backend=r,this.injector=a,this.chain=null}handle(r){if(null===this.chain){const a=this.injector.get(zb,[]);this.chain=a.reduceRight((h,g)=>new Fb(h,g),this.backend)}return this.chain.handle(r)}}return t.\u0275fac=function(r){return new(r||t)(rt(Ib),rt(yt))},t.\u0275prov=pt({token:t,factory:t.\u0275fac}),t})(),vI=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:Dv,useClass:fI}]}}static withOptions(r={}){return{ngModule:t,providers:[r.cookieName?{provide:Ev,useValue:r.cookieName}:[],r.headerName?{provide:Tv,useValue:r.headerName}:[]]}}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=ei({type:t}),t.\u0275inj=zn({providers:[Dv,{provide:zb,useExisting:Dv,multi:!0},{provide:Bb,useClass:_I},{provide:Ev,useValue:"XSRF-TOKEN"},{provide:Tv,useValue:"X-XSRF-TOKEN"}]}),t})(),xI=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=ei({type:t}),t.\u0275inj=zn({providers:[wv,{provide:Ug,useClass:yI},Ob,{provide:Ib,useExisting:Ob}],imports:[[vI.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),t})();var xu=_l(898),bI=_l.n(xu);const Cv_apiKey="pk.eyJ1IjoicmljYXJkb25veWEiLCJhIjoiY2tybnkyODFkMXN3bzJvcXI1MWppaHVyNSJ9.YoBoFemsH3iRu8AuCYAtnQ";let wI=(()=>{class t extends wv{constructor(r){super(r),this.baseUrl="https://api.mapbox.com/directions/v5/mapbox/driving"}get(r){return super.get(r=this.baseUrl+r,{params:{alternatives:!1,geometries:"geojson",language:"es",overview:"simplified",steps:!1,access_token:Cv_apiKey}})}}return t.\u0275fac=function(r){return new(r||t)(rt(Ug))},t.\u0275prov=pt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),EI=(()=>{class t extends wv{constructor(r){super(r),this.baseUrl="https://api.mapbox.com/geocoding/v5/mapbox.places"}get(r,a){return super.get(r=this.baseUrl+r,{params:Object.assign({limit:5,language:"es",access_token:Cv_apiKey},a.params)})}}return t.\u0275fac=function(r){return new(r||t)(rt(Ug))},t.\u0275prov=pt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Gg=(()=>{class t{constructor(r){this.directoionsApi=r,this.markers=[]}get isMapReady(){return!!this.map}setMap(r){this.map=r}flyTo(r){var a;if(!this.isMapReady)throw new Error("El mapa no esta inicializado");null===(a=this.map)||void 0===a||a.flyTo({zoom:14,center:r})}createMarkersFormPlaces(r,a){if(!this.map)throw Error("Mapa no inicializado");this.markers.forEach(b=>b.remove());const h=[];for(const b of r){const[D,I]=b.center,L=(new xu.Popup).setHTML(`\n      <h6>${b.text}</h6>\n      <span>${b.place_name}</span>\n      `),B=(new xu.Marker).setLngLat([D,I]).setPopup(L).addTo(this.map);h.push(B)}if(this.markers=h,0===r.length)return;const g=new xu.LngLatBounds;h.forEach(b=>g.extend(b.getLngLat())),g.extend(a),this.map.fitBounds(g,{padding:200})}getRouteBetweenPoints(r,a){this.directoionsApi.get(`/${r.join(",")};${a.join(",")}`).subscribe(h=>this.drawPolyline(h.routes[0]))}drawPolyline(r){var a;if(console.log({km:r.distance/1e3,duration:r.duration/60}),!this.map)throw new Error("Mapa no inicializado");const h=r.geometry.coordinates,g=new xu.LngLatBounds;h.forEach(([D,I])=>{g.extend([D,I])}),null===(a=this.map)||void 0===a||a.fitBounds(g,{padding:200});const b={type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:h}}]}};this.map.getLayer("RouteString")&&(this.map.removeLayer("RouteString"),this.map.removeSource("RouteString")),this.map.addSource("RouteString",b),this.map.addLayer({id:"RouteString",type:"line",source:"RouteString",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"black","line-width":3}})}}return t.\u0275fac=function(r){return new(r||t)(rt(wI))},t.\u0275prov=pt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function Nb(t,n,r,a,h,g,b){try{var D=t[g](b),I=D.value}catch(L){return void r(L)}D.done?n(I):Promise.resolve(I).then(a,h)}let Zf=(()=>{class t{constructor(r,a){this.placesApi=r,this.mapService=a,this.isLoadingPlaces=!1,this.places=[],this.getUSerLocation()}get isUserLocationReady(){return!!this.userLocation}getUSerLocation(){var r=this;return function TI(t){return function(){var n=this,r=arguments;return new Promise(function(a,h){var g=t.apply(n,r);function b(I){Nb(g,a,h,b,D,"next",I)}function D(I){Nb(g,a,h,b,D,"throw",I)}b(void 0)})}}(function*(){return new Promise((a,h)=>{navigator.geolocation.getCurrentPosition(({coords:g})=>{r.userLocation=[g.longitude,g.latitude],a(r.userLocation)},g=>{alert("No se pudo obtener la geolocalizaci\xf3n"),console.log(g),h()})})})()}getPlacesByQuery(r=""){if(0===r.length)return this.isLoadingPlaces=!1,void(this.places=[]);if(!this.userLocation)throw Error("No hay userLocation");this.isLoadingPlaces=!0,this.placesApi.get(`/${r}.json`,{params:{proximity:this.userLocation.join(",")}}).subscribe(a=>{this.isLoadingPlaces=!1,this.places=a.features,this.mapService.createMarkersFormPlaces(this.places,this.userLocation)})}deletePlaces(){this.places=[]}}return t.\u0275fac=function(r){return new(r||t)(rt(EI),rt(Gg))},t.\u0275prov=pt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),DI=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=Mi({type:t,selectors:[["app-loading"]],decls:6,vars:0,consts:[[1,"loading-map","d-flex","justify-content-center","align-items-center"],[1,"text-center"]],template:function(r,a){1&r&&(Mo(0,"div",0)(1,"div",1)(2,"h3"),lc(3,"Espere por favor"),Io(),Mo(4,"span"),lc(5,"Localizando..."),Io()()())},styles:[".loading-map[_ngcontent-%COMP%]{background-color:#000c;color:#fff;height:100vh;position:fixed;right:0px;top:0px;width:100vw}"]}),t})();const CI=["mapDiv"];let MI=(()=>{class t{constructor(r,a){this.placesServices=r,this.mapService=a}ngAfterViewInit(){if(!this.placesServices.userLocation)throw new Error("No hay placesService.userLocation");const r=new xu.Map({container:this.mapDivElement.nativeElement,style:"mapbox://styles/mapbox/streets-v11",center:this.placesServices.userLocation,zoom:14}),a=(new xu.Popup).setHTML("\n    <h6>Aqu\xed estoy</h6>\n    <span>Estoy en este lugar del mundo</span>\n    ");new xu.Marker({color:"red"}).setLngLat(this.placesServices.userLocation).setPopup(a).addTo(r),this.mapService.setMap(r)}}return t.\u0275fac=function(r){return new(r||t)(zt(Zf),zt(Gg))},t.\u0275cmp=Mi({type:t,selectors:[["app-map-view"]],viewQuery:function(r,a){if(1&r&&i1(CI,5),2&r){let h;r1(h=function o1(){return function XT(t,n){return t[19].queries[n].queryList}(Ne(),k())}())&&(a.mapDivElement=h.first)}},decls:2,vars:0,consts:[[1,"map-container"],["mapDiv",""]],template:function(r,a){1&r&&ac(0,"div",0,1)},styles:[".map-container[_ngcontent-%COMP%]{height:100vh;position:fixed;right:0px;top:0px;width:100vw}"]}),t})(),II=(()=>{class t{constructor(r,a){this.mapService=r,this.placesService=a}goToMyLocation(){if(!this.placesService.isUserLocationReady)throw Error("No hay ubicaci\xf3n de usuario");if(!this.mapService.isMapReady)throw Error("No hay mapa disponible");this.mapService.flyTo(this.placesService.userLocation)}}return t.\u0275fac=function(r){return new(r||t)(zt(Gg),zt(Zf))},t.\u0275cmp=Mi({type:t,selectors:[["app-btn-my-location"]],decls:2,vars:0,consts:[[1,"btn","btn-primary",3,"click"]],template:function(r,a){1&r&&(Mo(0,"button",0),Vd("click",function(){return a.goToMyLocation()}),lc(1," Mi ubicaci\xf3n\n"),Io())},styles:["button[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;z-index:9}"]}),t})();function SI(t,n){1&t&&(Mo(0,"div",2)(1,"h6"),lc(2,"Cargando"),Io(),Mo(3,"span"),lc(4,"Espere por favor..."),Io()())}function AI(t,n){if(1&t){const r=hy();Mo(0,"li",5),Vd("click",function(){const g=qa(r).$implicit;return If(2).flyTo(g)}),Mo(1,"h6"),lc(2),Io(),Mo(3,"p"),lc(4),Io(),Mo(5,"button",6),Vd("click",function(){const g=qa(r).$implicit;return If(2).getDirections(g)}),lc(6," Direcciones "),Io()()}if(2&t){const r=n.$implicit,a=If(2);my("active",r.id===a.selectedId),Ql(2),_y(r.text_es),Ql(2),hg(" ",r.place_name," "),Ql(1),ph("ngClass",r.id===a.selectedId?"btn-outline-light":"btn-outline-primary")}}function PI(t,n){if(1&t&&(Mo(0,"ul",3),Bd(1,AI,7,5,"li",4),Io()),2&t){const r=If();Ql(1),ph("ngForOf",r.places)}}let kI=(()=>{class t{constructor(r,a){this.placesService=r,this.mapService=a,this.selectedId=""}get isLoadingPlaces(){return this.placesService.isLoadingPlaces}get places(){return this.placesService.places}flyTo(r){this.selectedId=r.id;const[a,h]=r.center;this.mapService.flyTo([a,h])}getDirections(r){if(!this.placesService.userLocation)throw Error("No hay userLocation");this.placesService.deletePlaces(),this.mapService.getRouteBetweenPoints(this.placesService.userLocation,r.center)}}return t.\u0275fac=function(r){return new(r||t)(zt(Zf),zt(Gg))},t.\u0275cmp=Mi({type:t,selectors:[["app-search-results"]],decls:2,vars:2,consts:[["class","alert alert-primary mt-2 text-center",4,"ngIf"],["class","list-group mt-2",4,"ngIf"],[1,"alert","alert-primary","mt-2","text-center"],[1,"list-group","mt-2"],["class","list-group-item list-group-item-action pointer",3,"active","click",4,"ngFor","ngForOf"],[1,"list-group-item","list-group-item-action","pointer",3,"click"],[1,"btn","btn-sm",3,"ngClass","click"]],template:function(r,a){1&r&&(Bd(0,SI,5,0,"div",0),Bd(1,PI,2,1,"ul",1)),2&r&&(ph("ngIf",a.isLoadingPlaces),Ql(1),ph("ngIf",a.places.length>0))},directives:[av,ab,sb],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}p[_ngcontent-%COMP%]{font-size:12px}"]}),t})(),LI=(()=>{class t{constructor(r){this.placesService=r}onQueryChange(r=""){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.placesService.getPlacesByQuery(r)},1e3)}}return t.\u0275fac=function(r){return new(r||t)(zt(Zf))},t.\u0275cmp=Mi({type:t,selectors:[["app-search-bar"]],decls:4,vars:0,consts:[[1,"search-container"],["type","text","placeholder","Buscar lugar...",1,"form-control",3,"keyup"],["txtQuery",""]],template:function(r,a){if(1&r){const h=hy();Mo(0,"div",0)(1,"input",1,2),Vd("keyup",function(){qa(h);const b=ry(2);return a.onQueryChange(b.value)}),Io(),ac(3,"app-search-results"),Io()}},directives:[kI],styles:[".search-container[_ngcontent-%COMP%]{left:20px;position:fixed;top:20px;background-color:#fff;border-radius:5px;border:1px solid rgba(0,0,0,.1);box-shadow:0 10px 10px #0000001a;padding:5px;width:270px}"]}),t})(),RI=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=Mi({type:t,selectors:[["app-angular-logo"]],decls:1,vars:0,consts:[["width","100","alt","Angular Logo","src","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg=="]],template:function(r,a){1&r&&ac(0,"img",0)},styles:["img[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;z-index:9}"]}),t})();function FI(t,n){1&t&&ac(0,"app-loading")}function zI(t,n){1&t&&ac(0,"app-map-view")(1,"app-btn-my-location")(2,"app-search-bar")}let OI=(()=>{class t{constructor(r){this.placesService=r}get isUserLocationReady(){return this.placesService.isUserLocationReady}}return t.\u0275fac=function(r){return new(r||t)(zt(Zf))},t.\u0275cmp=Mi({type:t,selectors:[["app-map-screen"]],decls:4,vars:2,consts:[[4,"ngIf","ngIfElse"],["mapReady",""]],template:function(r,a){if(1&r&&(Bd(0,FI,1,0,"app-loading",0),Bd(1,zI,3,0,"ng-template",null,1,c1),ac(3,"app-angular-logo")),2&r){const h=ry(2);ph("ngIf",!a.isUserLocationReady)("ngIfElse",h)}},directives:[av,DI,MI,II,LI,RI],styles:[""]}),t})(),BI=(()=>{class t{constructor(){this.title="MapsAndDirectionsApp"}}return t.\u0275fac=function(r){return new(r||t)},t.\u0275cmp=Mi({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(r,a){1&r&&ac(0,"app-map-screen")},directives:[OI],styles:[""]}),t})(),NI=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=ei({type:t}),t.\u0275inj=zn({imports:[[db]]}),t})(),VI=(()=>{class t{}return t.\u0275fac=function(r){return new(r||t)},t.\u0275mod=ei({type:t,bootstrap:[BI]}),t.\u0275inj=zn({providers:[],imports:[[ZM,NI,xI]]}),t})();if(bI().accessToken="pk.eyJ1IjoicmljYXJkb25veWEiLCJhIjoiY2tybnkyODFkMXN3bzJvcXI1MWppaHVyNSJ9.YoBoFemsH3iRu8AuCYAtnQ",!navigator.geolocation)throw alert("Navegador no soporta la Geolocalizaci\xf3n"),new Error("Navegador no soporta la Geolocalizaci\xf3n");(function RD(){B1=!1})(),HM().bootstrapModule(VI).catch(t=>console.error(t))},898:function(Kd){Kd.exports=function(){"use strict";var pc,_l,Rn;function _h(d,Kn){if(pc)if(_l){var Ao="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+pc+")(sharedChunk); ("+_l+")(sharedChunk); self.onerror = null;",Jr={};pc(Jr),Rn=Kn(Jr),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Rn.workerUrl=window.URL.createObjectURL(new Blob([Ao],{type:"text/javascript"})))}else _l=Kn;else pc=Kn}return _h(0,function(d){var Ao=Jr;function Jr(i,e,s,l){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=s,this.p2y=l}Jr.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},Jr.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},Jr.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},Jr.prototype.solveCurveX=function(i,e){var s,l,u,p,_;for(void 0===e&&(e=1e-6),u=i,_=0;_<8;_++){if(p=this.sampleCurveX(u)-i,Math.abs(p)<e)return u;var v=this.sampleCurveDerivativeX(u);if(Math.abs(v)<1e-6)break;u-=p/v}if((u=i)<(s=0))return s;if(u>(l=1))return l;for(;s<l;){if(p=this.sampleCurveX(u),Math.abs(p-i)<e)return u;i>p?s=u:l=u,u=.5*(l-s)+s}return u},Jr.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var We=_t;function _t(i,e){this.x=i,this.y=e}_t.prototype={clone:function(){return new _t(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,s=i.y-this.y;return e*e+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),s=Math.sin(i),l=s*this.x+e*this.y;return this.x=e*this.x-s*this.y,this.y=l,this},_rotateAround:function(i,e){var s=Math.cos(i),l=Math.sin(i),u=e.y+l*(this.x-e.x)+s*(this.y-e.y);return this.x=e.x+s*(this.x-e.x)-l*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_t.convert=function(i){return i instanceof _t?i:Array.isArray(i)?new _t(i[0],i[1]):i};var Pe="undefined"!=typeof self?self:{},li=1e-6,Tn="undefined"!=typeof Float32Array?Float32Array:Array;function yl(){var i=new Tn(9);return Tn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Qr(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function vl(i,e,s){var l=e[0],u=e[1],p=e[2],_=e[3],v=e[4],w=e[5],T=e[6],M=e[7],S=e[8],A=e[9],z=e[10],N=e[11],U=e[12],q=e[13],Y=e[14],ie=e[15],ce=s[0],he=s[1],fe=s[2],me=s[3];return i[0]=ce*l+he*v+fe*S+me*U,i[1]=ce*u+he*w+fe*A+me*q,i[2]=ce*p+he*T+fe*z+me*Y,i[3]=ce*_+he*M+fe*N+me*ie,i[4]=(ce=s[4])*l+(he=s[5])*v+(fe=s[6])*S+(me=s[7])*U,i[5]=ce*u+he*w+fe*A+me*q,i[6]=ce*p+he*T+fe*z+me*Y,i[7]=ce*_+he*M+fe*N+me*ie,i[8]=(ce=s[8])*l+(he=s[9])*v+(fe=s[10])*S+(me=s[11])*U,i[9]=ce*u+he*w+fe*A+me*q,i[10]=ce*p+he*T+fe*z+me*Y,i[11]=ce*_+he*M+fe*N+me*ie,i[12]=(ce=s[12])*l+(he=s[13])*v+(fe=s[14])*S+(me=s[15])*U,i[13]=ce*u+he*w+fe*A+me*q,i[14]=ce*p+he*T+fe*z+me*Y,i[15]=ce*_+he*M+fe*N+me*ie,i}function Bi(i,e,s){var l,u,p,_,v,w,T,M,S,A,z,N,U=s[0],q=s[1],Y=s[2];return e===i?(i[12]=e[0]*U+e[4]*q+e[8]*Y+e[12],i[13]=e[1]*U+e[5]*q+e[9]*Y+e[13],i[14]=e[2]*U+e[6]*q+e[10]*Y+e[14],i[15]=e[3]*U+e[7]*q+e[11]*Y+e[15]):(u=e[1],p=e[2],_=e[3],v=e[4],w=e[5],T=e[6],M=e[7],S=e[8],A=e[9],z=e[10],N=e[11],i[0]=l=e[0],i[1]=u,i[2]=p,i[3]=_,i[4]=v,i[5]=w,i[6]=T,i[7]=M,i[8]=S,i[9]=A,i[10]=z,i[11]=N,i[12]=l*U+v*q+S*Y+e[12],i[13]=u*U+w*q+A*Y+e[13],i[14]=p*U+T*q+z*Y+e[14],i[15]=_*U+M*q+N*Y+e[15]),i}function ur(i,e,s){var l=s[0],u=s[1],p=s[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*u,i[5]=e[5]*u,i[6]=e[6]*u,i[7]=e[7]*u,i[8]=e[8]*p,i[9]=e[9]*p,i[10]=e[10]*p,i[11]=e[11]*p,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Po(i,e,s){var l=Math.sin(s),u=Math.cos(s),p=e[4],_=e[5],v=e[6],w=e[7],T=e[8],M=e[9],S=e[10],A=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=p*u+T*l,i[5]=_*u+M*l,i[6]=v*u+S*l,i[7]=w*u+A*l,i[8]=T*u-p*l,i[9]=M*u-_*l,i[10]=S*u-v*l,i[11]=A*u-w*l,i}function ao(i,e,s){var l=Math.sin(s),u=Math.cos(s),p=e[0],_=e[1],v=e[2],w=e[3],T=e[8],M=e[9],S=e[10],A=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*u-T*l,i[1]=_*u-M*l,i[2]=v*u-S*l,i[3]=w*u-A*l,i[8]=p*l+T*u,i[9]=_*l+M*u,i[10]=v*l+S*u,i[11]=w*l+A*u,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var ko=vl;function xl(){var i=new Tn(3);return Tn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Lo(i){var e=new Tn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function fc(i){return Math.hypot(i[0],i[1],i[2])}function vi(i,e,s){var l=new Tn(3);return l[0]=i,l[1]=e,l[2]=s,l}function cs(i,e,s){return i[0]=e[0]+s[0],i[1]=e[1]+s[1],i[2]=e[2]+s[2],i}function ba(i,e,s){return i[0]=e[0]-s[0],i[1]=e[1]-s[1],i[2]=e[2]-s[2],i}function us(i,e,s){return i[0]=e[0]*s[0],i[1]=e[1]*s[1],i[2]=e[2]*s[2],i}function bu(i,e,s){return i[0]=Math.max(e[0],s[0]),i[1]=Math.max(e[1],s[1]),i[2]=Math.max(e[2],s[2]),i}function xi(i,e,s){return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i}function ci(i,e,s,l){return i[0]=e[0]+s[0]*l,i[1]=e[1]+s[1]*l,i[2]=e[2]+s[2]*l,i}function bl(i,e){var s=e[0],l=e[1],u=e[2],p=s*s+l*l+u*u;return p>0&&(p=1/Math.sqrt(p)),i[0]=e[0]*p,i[1]=e[1]*p,i[2]=e[2]*p,i}function Ni(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function Yn(i,e,s){var l=e[0],u=e[1],p=e[2],_=s[0],v=s[1],w=s[2];return i[0]=u*w-p*v,i[1]=p*_-l*w,i[2]=l*v-u*_,i}function $t(i,e,s){var l=e[0],u=e[1],p=e[2],_=s[3]*l+s[7]*u+s[11]*p+s[15];return i[0]=(s[0]*l+s[4]*u+s[8]*p+s[12])/(_=_||1),i[1]=(s[1]*l+s[5]*u+s[9]*p+s[13])/_,i[2]=(s[2]*l+s[6]*u+s[10]*p+s[14])/_,i}function mc(i,e,s){var l=s[0],u=s[1],p=s[2],_=e[0],v=e[1],w=e[2],T=u*w-p*v,M=p*_-l*w,S=l*v-u*_,A=u*S-p*M,z=p*T-l*S,N=l*M-u*T,U=2*s[3];return M*=U,S*=U,z*=2,N*=2,i[0]=_+(T*=U)+(A*=2),i[1]=v+M+z,i[2]=w+S+N,i}var Bs,i,Ns=ba,wl=us,Vs=fc;function lo(i,e,s){var l=e[0],u=e[1],p=e[2],_=e[3];return i[0]=s[0]*l+s[4]*u+s[8]*p+s[12]*_,i[1]=s[1]*l+s[5]*u+s[9]*p+s[13]*_,i[2]=s[2]*l+s[6]*u+s[10]*p+s[14]*_,i[3]=s[3]*l+s[7]*u+s[11]*p+s[15]*_,i}function Vi(){var i=new Tn(4);return Tn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Ro(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function gc(i,e,s){s*=.5;var l=e[0],u=e[1],p=e[2],_=e[3],v=Math.sin(s),w=Math.cos(s);return i[0]=l*w+_*v,i[1]=u*w+p*v,i[2]=p*w-u*v,i[3]=_*w-l*v,i}function Fo(i,e){return i[0]===e[0]&&i[1]===e[1]}xl(),Bs=new Tn(4),Tn!=Float32Array&&(Bs[0]=0,Bs[1]=0,Bs[2]=0,Bs[3]=0),xl(),vi(1,0,0),vi(0,1,0),Vi(),Vi(),yl(),i=new Tn(2),Tn!=Float32Array&&(i[0]=0,i[1]=0);const wa=Math.PI/180,El=180/Math.PI;function Lt(i){return i*wa}function bi(i){return i*El}const Ea=[[0,0],[1,0],[1,1],[0,1]];function _c(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,s=e*i;return 4*(i<.5?s:3*(i-e)+s-.75)}function yc(i,e,s,l){const u=new Ao(i,e,s,l);return function(p){return u.solve(p)}}const Tl=yc(.25,.1,.25,1);function cn(i,e,s){return Math.min(s,Math.max(e,i))}function zo(i,e,s){return(s=cn((s-i)/(e-i),0,1))*s*(3-2*s)}function hs(i,e,s){const l=s-e,u=((i-e)%l+l)%l+e;return u===e?s:u}function ds(i,e,s){if(!i.length)return s(null,[]);let l=i.length;const u=new Array(i.length);let p=null;i.forEach((_,v)=>{e(_,(w,T)=>{w&&(p=w),u[v]=T,0==--l&&s(p,u)})})}function Ta(i){const e=[];for(const s in i)e.push(i[s]);return e}function Fn(i,...e){for(const s of e)for(const l in s)i[l]=s[l];return i}let vc=1;function xc(){return vc++}function ji(){return function i(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function wi(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function wu(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Da(i,e){i.forEach(s=>{e[s]&&(e[s]=e[s].bind(e))})}function Dl(i,e){return-1!==i.indexOf(e,i.length-e.length)}function ps(i,e,s){const l={};for(const u in i)l[u]=e.call(s||this,i[u],u,i);return l}function Cl(i,e,s){const l={};for(const u in i)e.call(s||this,i[u],u,i)&&(l[u]=i[u]);return l}function Ui(i){return Array.isArray(i)?i.map(Ui):"object"==typeof i&&i?ps(i,Ui):i}const Eu={};function Pn(i){Eu[i]||("undefined"!=typeof console&&console.warn(i),Eu[i]=!0)}function ui(i,e,s){return(s.y-i.y)*(e.x-i.x)>(e.y-i.y)*(s.x-i.x)}function js(i){let e=0;for(let s,l,u=0,p=i.length,_=p-1;u<p;_=u++)s=i[u],l=i[_],e+=(l.x-s.x)*(s.y+l.y);return e}function $i(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Us(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,u,p)=>{const _=u||p;return e[l]=!_||_.toLowerCase(),""}),e["max-age"]){const s=parseInt(e["max-age"],10);isNaN(s)?delete e["max-age"]:e["max-age"]=s}return e}let fs,Oo,Ei,Bo=null;function Gi(i){if(null==Bo){const e=i.navigator?i.navigator.userAgent:null;Bo=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Bo}function $s(i){try{const e=Pe[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const hr={now:()=>void 0!==Ei?Ei:Pe.performance.now(),setNow(i){Ei=i},restoreNow(){Ei=void 0},frame(i){const e=Pe.requestAnimationFrame(i);return{cancel:()=>Pe.cancelAnimationFrame(e)}},getImageData(i,e=0){const s=Pe.document.createElement("canvas"),l=s.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return s.width=i.width,s.height=i.height,l.drawImage(i,0,0,i.width,i.height),l.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(fs||(fs=Pe.document.createElement("a")),fs.href=i,fs.href),get devicePixelRatio(){return Pe.devicePixelRatio},get prefersReducedMotion(){return!!Pe.matchMedia&&(null==Oo&&(Oo=Pe.matchMedia("(prefers-reduced-motion: reduce)")),Oo.matches)}};let K;const F={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==K){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{K=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):i}catch(e){K=i}}return K},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},V={supported:!1,testSupport:function(i){!le&&J&&(ge?pe(i):X=i)}};let X,J,le=!1,ge=!1;function pe(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,J),i.isContextLost())return;V.supported=!0}catch(s){}i.deleteTexture(e),le=!0}Pe.document&&(J=Pe.document.createElement("img"),J.onload=function(){X&&pe(X),X=null,ge=!0},J.onerror=function(){le=!0,X=null},J.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ue="01",_e="NO_ACCESS_TOKEN";function Me(i){return 0===i.indexOf("mapbox:")}function Ae(i){return F.API_URL_REGEX.test(i)}const ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(i){const e=i.match(ze);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ct(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function st(i){if(!i)return null;const e=i.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Pe.atob(e[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class dt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const s=st(F.ACCESS_TOKEN);let l="";return l=s&&s.u?Pe.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(u,p)=>String.fromCharCode(Number("0x"+p)))):F.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const e=$s("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{const u=Pe.localStorage.getItem(s);u&&(this.eventData=JSON.parse(u));const p=Pe.localStorage.getItem(l);p&&(this.anonId=p)}catch(u){Pn("Unable to read from LocalStorage")}}saveEventData(){const e=$s("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{Pe.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&Pe.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(u){Pn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,s,l,u){if(!F.EVENTS_URL)return;const p=it(F.EVENTS_URL);p.params.push(`access_token=${u||F.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.7.0",skuId:ue,userId:this.anonId},v=s?Fn(_,s):_,w={url:ct(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=co(w,T=>{this.pendingRequest=null,l(T),this.saveEventData(),this.processRequests(u)})}queueRequest(e,s){this.queue.push(e),this.processRequests(s)}}const Mt=new class extends dt{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){F.EVENTS_URL&&F.ACCESS_TOKEN&&Array.isArray(i)&&i.some(s=>Me(s)||Ae(s))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=st(F.ACCESS_TOKEN),s=e?e.u:F.ACCESS_TOKEN;let l=s!==this.eventData.tokenU;wu(this.anonId)||(this.anonId=ji(),l=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),_=new Date(u),v=(u-this.eventData.lastSuccess)/864e5;l=l||v>=1||v<-1||p.getDate()!==_.getDate()}else l=!0;if(!l)return this.processRequests();this.postEvent(u,{"enabled.telemetry":!1},p=>{p||(this.eventData.lastSuccess=u,this.eventData.tokenU=s)},i)}},gn=Mt.postTurnstileEvent.bind(Mt),yn=new class extends dt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,s,l){this.skuToken=e,this.errorCb=l,F.EVENTS_URL&&(s||F.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(_e)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),wu(this.anonId)||(this.anonId=ji()),this.postEvent(s,{skuToken:this.skuToken},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},i))}},un=yn.postMapLoadEvent.bind(yn),bn=new class extends dt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,s,l){if(!F.API_URL||!F.SESSION_PATH)return;const u=it(F.API_URL+F.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${l||F.ACCESS_TOKEN||""}`);const p={url:ct(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Du(p,_=>{this.pendingRequest=null,s(_),this.saveEventData(),this.processRequests(l)})}getSessionAPI(i,e,s,l){this.skuToken=e,this.errorCb=l,F.SESSION_PATH&&F.API_URL&&(s||F.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},s):this.errorCb(new Error(_e)))}processRequests(i){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:s}=this.queue.shift();e&&this.success[e]||this.getSession(s,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},i)}},ms=bn.getSessionAPI.bind(bn),No=new Set,xr="mapbox-tiles";let Hi,bc,yh=500,Ml=50;function Il(){Pe.caches&&!Hi&&(Hi=Pe.caches.open(xr))}function Tu(i){const e=i.indexOf("?");return e<0?i:i.slice(0,e)}let wc=1/0;const Ca={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ca);class ln extends Error{constructor(e,s,l){401===s&&Ae(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=s,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Sl=$i()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Pe.location.protocol?Pe.parent:Pe).location.href,Nt=function(i,e){if(!(/^file:/.test(s=i.url)||/^file:/.test(Sl())&&!/^\w+:/.test(s))){if(Pe.fetch&&Pe.Request&&Pe.AbortController&&Pe.Request.prototype.hasOwnProperty("signal"))return function(l,u){const p=new Pe.AbortController,_=new Pe.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Sl(),signal:p.signal});let v=!1,w=!1;const T=(M=_.url).indexOf("sku=")>0&&Ae(M);var M;"json"===l.type&&_.headers.set("Accept","application/json");const S=(z,N,U)=>{if(w)return;if(z&&"SecurityError"!==z.message&&Pn(z),N&&U)return A(N);const q=Date.now();Pe.fetch(_).then(Y=>{if(Y.ok){const ie=T?Y.clone():null;return A(Y,ie,q)}return u(new ln(Y.statusText,Y.status,l.url))}).catch(Y=>{20!==Y.code&&u(new Error(Y.message))})},A=(z,N,U)=>{("arrayBuffer"===l.type?z.arrayBuffer():"json"===l.type?z.json():z.text()).then(q=>{w||(N&&U&&function(Y,ie,ce){if(Il(),!Hi)return;const he={status:ie.status,statusText:ie.statusText,headers:new Pe.Headers};ie.headers.forEach((me,Ce)=>he.headers.set(Ce,me));const fe=Us(ie.headers.get("Cache-Control")||"");fe["no-store"]||(fe["max-age"]&&he.headers.set("Expires",new Date(ce+1e3*fe["max-age"]).toUTCString()),new Date(he.headers.get("Expires")).getTime()-ce<42e4||function(me,Ce){if(void 0===bc)try{new Response(new ReadableStream),bc=!0}catch(Ee){bc=!1}bc?Ce(me.body):me.blob().then(Ce)}(ie,me=>{const Ce=new Pe.Response(me,he);Il(),Hi&&Hi.then(Ee=>Ee.put(Tu(Y.url),Ce)).catch(Ee=>Pn(Ee.message))}))}(_,N,U),v=!0,u(null,q,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(q=>{w||u(new Error(q.message))})};return T?function(z,N){if(Il(),!Hi)return N(null);const U=Tu(z.url);Hi.then(q=>{q.match(U).then(Y=>{const ie=function(ce){if(!ce)return!1;const he=new Date(ce.headers.get("Expires")||0),fe=Us(ce.headers.get("Cache-Control")||"");return he>Date.now()&&!fe["no-cache"]}(Y);q.delete(U),ie&&q.put(U,Y.clone()),N(null,Y,ie)}).catch(N)}).catch(N)}(_,S):S(null,null),{cancel:()=>{w=!0,v||p.abort()}}}(i,e);if($i()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var s;return function(l,u){const p=new Pe.XMLHttpRequest;p.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(p.responseType="arraybuffer");for(const _ in l.headers)p.setRequestHeader(_,l.headers[_]);return"json"===l.type&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials="include"===l.credentials,p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||0===p.status)&&null!==p.response){let _=p.response;if("json"===l.type)try{_=JSON.parse(p.response)}catch(v){return u(v)}u(null,_,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else u(new ln(p.statusText,p.status,l.url))},p.send(l.body),{cancel:()=>p.abort()}}(i,e)},Gs=function(i,e){return Nt(Fn(i,{type:"arrayBuffer"}),e)},co=function(i,e){return Nt(Fn(i,{method:"POST"}),e)},Du=function(i,e){return Nt(Fn(i,{method:"GET"}),e)};function It(i){const e=Pe.document.createElement("a");return e.href=i,e.protocol===Pe.document.location.protocol&&e.host===Pe.document.location.host}const Hs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Al,Kt;Al=[],Kt=0;const Ec=function(i,e){if(V.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Kt>=F.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Al.push(p),p}Kt++;let s=!1;const l=()=>{if(!s)for(s=!0,Kt--;Al.length&&Kt<F.MAX_PARALLEL_IMAGE_REQUESTS;){const p=Al.shift(),{requestParameters:_,callback:v,cancelled:w}=p;w||(p.cancel=Ec(_,v).cancel)}},u=Gs(i,(p,_,v,w)=>{l(),p?e(p):_&&(Pe.createImageBitmap?function(T,M){const S=new Pe.Blob([new Uint8Array(T)],{type:"image/png"});Pe.createImageBitmap(S).then(A=>{M(null,A)}).catch(A=>{M(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(T,M)=>e(T,M,v,w)):function(T,M){const S=new Pe.Image,A=Pe.URL;S.onload=()=>{M(null,S),A.revokeObjectURL(S.src),S.onload=null,Pe.requestAnimationFrame(()=>{S.src=Hs})},S.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new Pe.Blob([new Uint8Array(T)],{type:"image/png"});S.src=T.byteLength?A.createObjectURL(z):Hs}(_,(T,M)=>e(T,M,v,w)))});return{cancel:()=>{u.cancel(),l()}}};function wt(i,e,s){s[i]&&-1!==s[i].indexOf(e)||(s[i]=s[i]||[],s[i].push(e))}function dr(i,e,s){if(s&&s[i]){const l=s[i].indexOf(e);-1!==l&&s[i].splice(l,1)}}class gs{constructor(e,s={}){Fn(this,s),this.type=e}}class Cu extends gs{constructor(e,s={}){super("error",Fn({error:e},s))}}class qs{on(e,s){return this._listeners=this._listeners||{},wt(e,s,this._listeners),this}off(e,s){return dr(e,s,this._listeners),dr(e,s,this._oneTimeListeners),this}once(e,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},wt(e,s,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,s){"string"==typeof e&&(e=new gs(e,s||{}));const l=e.type;if(this.listens(l)){e.target=this;const u=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const v of u)v.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const v of p)dr(l,v,this._oneTimeListeners),v.call(this,e);const _=this._eventedParent;_&&(Fn(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof Cu&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,s){return this._eventedParent=e,this._eventedParentData=s,this}}var be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Ge{constructor(e,s,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),null!=s&&s.__line__&&(this.line=s.__line__)}}function Jd(i){const e=i.value;return e?[new Ge(i.key,e,"constants have been deprecated as of v8")]:[]}function _s(i,...e){for(const s of e)for(const l in s)i[l]=s[l];return i}function Hn(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function br(i){if(Array.isArray(i))return i.map(br);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const s in i)e[s]=br(i[s]);return e}return Hn(i)}class Vo extends Error{constructor(e,s){super(s),this.message=s,this.key=e}}class Mu{constructor(e,s=[]){this.parent=e,this.bindings={};for(const[l,u]of s)this.bindings[l]=u}concat(e){return new Mu(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Zs={kind:"null"},Xe={kind:"number"},Vt={kind:"string"},Rt={kind:"boolean"},uo={kind:"color"},Pl={kind:"object"},ft={kind:"value"},dn={kind:"collator"},Ws={kind:"formatted"},Tc={kind:"resolvedImage"};function qi(i,e){return{kind:"array",itemType:i,N:e}}function pt(i){if("array"===i.kind){const e=pt(i.itemType);return"number"==typeof i.N?`array<${e}, ${i.N}>`:"value"===i.itemType.kind?"array":`array<${e}>`}return i.kind}const Wf=[Zs,Xe,Vt,Rt,uo,Ws,Pl,qi(ft),Tc];function zn(i,e){if("error"===e.kind)return null;if("array"===i.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!zn(i.itemType,e.itemType))&&("number"!=typeof i.N||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if("value"===i.kind)for(const s of Wf)if(!zn(s,e))return null}return`Expected ${pt(i)} but found ${pt(e)} instead.`}function Ma(i,e){return e.some(s=>s.kind===i.kind)}function Xs(i,e){return e.some(s=>"null"===s?null===i:"array"===s?Array.isArray(i):"object"===s?i&&!Array.isArray(i)&&"object"==typeof i:s===typeof i)}function Ia(i){var e={exports:{}};return i(e,e.exports),e.exports}var Sa=Ia(function(i,e){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(v){return(v=Math.round(v))<0?0:v>255?255:v}function u(v){return l("%"===v[v.length-1]?parseFloat(v)/100*255:parseInt(v))}function p(v){return(w="%"===v[v.length-1]?parseFloat(v)/100:parseFloat(v))<0?0:w>1?1:w;var w}function _(v,w,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?v+(w-v)*T*6:2*T<1?w:3*T<2?v+(w-v)*(2/3-T)*6:v}try{e.parseCSSColor=function(v){var w,T=v.replace(/ /g,"").toLowerCase();if(T in s)return s[T].slice();if("#"===T[0])return 4===T.length?(w=parseInt(T.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:7===T.length&&(w=parseInt(T.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var M=T.indexOf("("),S=T.indexOf(")");if(-1!==M&&S+1===T.length){var A=T.substr(0,M),z=T.substr(M+1,S-(M+1)).split(","),N=1;switch(A){case"rgba":if(4!==z.length)return null;N=p(z.pop());case"rgb":return 3!==z.length?null:[u(z[0]),u(z[1]),u(z[2]),N];case"hsla":if(4!==z.length)return null;N=p(z.pop());case"hsl":if(3!==z.length)return null;var U=(parseFloat(z[0])%360+360)%360/360,q=p(z[1]),Y=p(z[2]),ie=Y<=.5?Y*(q+1):Y+q-Y*q,ce=2*Y-ie;return[l(255*_(ce,ie,U+1/3)),l(255*_(ce,ie,U)),l(255*_(ce,ie,U-1/3)),N];default:return null}}return null}}catch(v){}});class qt{constructor(e,s,l,u=1){this.r=e,this.g=s,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof qt)return e;if("string"!=typeof e)return;const s=Sa.parseCSSColor(e);return s?new qt(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[e,s,l,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(s)},${Math.round(l)},${u})`}toArray(){const{r:e,g:s,b:l,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*s/u,255*l/u,u]}}qt.black=new qt(0,0,0,1),qt.white=new qt(1,1,1,1),qt.transparent=new qt(0,0,0,0),qt.red=new qt(1,0,0,1),qt.blue=new qt(0,0,1,1);class Ks{constructor(e,s,l){this.sensitivity=e?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,s){return this.collator.compare(e,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class kl{constructor(e,s,l,u,p){this.text=e.normalize?e.normalize():e,this.image=s,this.scale=l,this.fontStack=u,this.textColor=p}}class xt{constructor(e){this.sections=e}static fromString(e){return new xt([new kl(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof xt?e:xt.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const s of this.sections){if(s.image){e.push(["image",s.image.name]);continue}e.push(s.text);const l={};s.fontStack&&(l["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(l["font-scale"]=s.scale),s.textColor&&(l["text-color"]=["rgba"].concat(s.textColor.toArray())),e.push(l)}return e}}class Ti{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ti({name:e,available:!1}):null}serialize(){return["image",this.name]}}function St(i,e,s,l){return"number"==typeof i&&i>=0&&i<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[i,e,s,l]:[i,e,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Aa(i){if(null===i||"string"==typeof i||"boolean"==typeof i||"number"==typeof i||i instanceof qt||i instanceof Ks||i instanceof xt||i instanceof Ti)return!0;if(Array.isArray(i)){for(const e of i)if(!Aa(e))return!1;return!0}if("object"==typeof i){for(const e in i)if(!Aa(i[e]))return!1;return!0}return!1}function qn(i){if(null===i)return Zs;if("string"==typeof i)return Vt;if("boolean"==typeof i)return Rt;if("number"==typeof i)return Xe;if(i instanceof qt)return uo;if(i instanceof Ks)return dn;if(i instanceof xt)return Ws;if(i instanceof Ti)return Tc;if(Array.isArray(i)){const e=i.length;let s;for(const l of i){const u=qn(l);if(s){if(s===u)continue;s=ft;break}s=u}return qi(s||ft,e)}return Pl}function Di(i){const e=typeof i;return null===i?"":"string"===e||"number"===e||"boolean"===e?String(i):i instanceof qt||i instanceof xt||i instanceof Ti?i.toString():JSON.stringify(i)}class jo{constructor(e,s){this.type=e,this.value=s}static parse(e,s){if(2!==e.length)return s.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Aa(e[1]))return s.error("invalid value");const l=e[1];let u=qn(l);const p=s.expectedType;return"array"!==u.kind||0!==u.N||!p||"array"!==p.kind||"number"==typeof p.N&&0!==p.N||(u=p),new jo(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof qt?["rgba"].concat(this.value.toArray()):this.value instanceof xt?this.value.serialize():this.value}}class wr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Zi={string:Vt,number:Xe,boolean:Rt,object:Pl};class On{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");let l,u=1;const p=e[0];if("array"===p){let v,w;if(e.length>2){const T=e[1];if("string"!=typeof T||!(T in Zi)||"object"===T)return s.error('The item type argument of "array" must be one of string, number, boolean',1);v=Zi[T],u++}else v=ft;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=e[2],u++}l=qi(v,w)}else l=Zi[p];const _=[];for(;u<e.length;u++){const v=s.parse(e[u],u,ft);if(!v)return null;_.push(v)}return new On(l,_)}evaluate(e){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(e);if(!zn(this.type,qn(l)))return l;if(s===this.args.length-1)throw new wr(`Expected value to be of type ${pt(this.type)}, but found ${pt(qn(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,s=[e.kind];if("array"===e.kind){const l=e.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){s.push(l.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&s.push(u)}}return s.concat(this.args.map(l=>l.serialize()))}}class Uo{constructor(e){this.type=Ws,this.sections=e}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&"object"==typeof l)return s.error("First argument must be an image or text section.");const u=[];let p=!1;for(let _=1;_<=e.length-1;++_){const v=e[_];if(p&&"object"==typeof v&&!Array.isArray(v)){p=!1;let w=null;if(v["font-scale"]&&(w=s.parse(v["font-scale"],1,Xe),!w))return null;let T=null;if(v["text-font"]&&(T=s.parse(v["text-font"],1,qi(Vt)),!T))return null;let M=null;if(v["text-color"]&&(M=s.parse(v["text-color"],1,uo),!M))return null;const S=u[u.length-1];S.scale=w,S.font=T,S.textColor=M}else{const w=s.parse(e[_],1,ft);if(!w)return null;const T=w.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new Uo(u)}evaluate(e){return new xt(this.sections.map(s=>{const l=s.content.evaluate(e);return qn(l)===Tc?new kl("",l,null,null,null):new kl(Di(l),null,s.scale?s.scale.evaluate(e):null,s.font?s.font.evaluate(e).join(","):null,s.textColor?s.textColor.evaluate(e):null)}))}eachChild(e){for(const s of this.sections)e(s.content),s.scale&&e(s.scale),s.font&&e(s.font),s.textColor&&e(s.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const s of this.sections){e.push(s.content.serialize());const l={};s.scale&&(l["font-scale"]=s.scale.serialize()),s.font&&(l["text-font"]=s.font.serialize()),s.textColor&&(l["text-color"]=s.textColor.serialize()),e.push(l)}return e}}class Pa{constructor(e){this.type=Tc,this.input=e}static parse(e,s){if(2!==e.length)return s.error("Expected two arguments.");const l=s.parse(e[1],1,Vt);return l?new Pa(l):s.error("No image name provided.")}evaluate(e){const s=this.input.evaluate(e),l=Ti.fromString(s);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(s)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ho={"to-boolean":Rt,"to-color":uo,"to-number":Xe,"to-string":Vt};class po{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expected at least one argument.");const l=e[0];if(("to-boolean"===l||"to-string"===l)&&2!==e.length)return s.error("Expected one argument.");const u=ho[l],p=[];for(let _=1;_<e.length;_++){const v=s.parse(e[_],_,ft);if(!v)return null;p.push(v)}return new po(u,p)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let s,l;for(const u of this.args){if(s=u.evaluate(e),l=null,s instanceof qt)return s;if("string"==typeof s){const p=e.parseColor(s);if(p)return p}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:St(s[0],s[1],s[2],s[3]),!l))return new qt(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new wr(l||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const l of this.args){if(s=l.evaluate(e),null===s)return 0;const u=Number(s);if(!isNaN(u))return u}throw new wr(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?xt.fromString(Di(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Ti.fromString(Di(this.args[0].evaluate(e))):Di(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Uo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Pa(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(s=>{e.push(s.serialize())}),e}}const vh=["Unknown","Point","LineString","Polygon"];class xh{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?vh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:l,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*s-e[0])+this.featureDistanceData.bearing[1]*(u*s-e[1])}return 0}parseColor(e){let s=this._parseColorCache[e];return s||(s=this._parseColorCache[e]=qt.parse(e)),s}}class Ci{constructor(e,s,l,u){this.name=e,this.type=s,this._evaluate=l,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,s){const l=e[0],u=Ci.definitions[l];if(!u)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=_.filter(([T])=>!Array.isArray(T)||T.length===e.length-1);let w=null;for(const[T,M]of v){w=new tr(s.registry,s.path,null,s.scope);const S=[];let A=!1;for(let z=1;z<e.length;z++){const N=e[z],U=Array.isArray(T)?T[z-1]:T.type,q=w.parse(N,1+S.length,U);if(!q){A=!0;break}S.push(q)}if(!A)if(Array.isArray(T)&&T.length!==S.length)w.error(`Expected ${T.length} arguments, but found ${S.length} instead.`);else{for(let z=0;z<S.length;z++){const N=Array.isArray(T)?T[z]:T.type,U=S[z];w.concat(z+1).checkSubtype(N,U.type)}if(0===w.errors.length)return new Ci(l,p,M,S)}}if(1===v.length)s.errors.push(...w.errors);else{const T=(v.length?v:_).map(([S])=>{return A=S,Array.isArray(A)?`(${A.map(pt).join(", ")})`:`(${pt(A.type)}...)`;var A}).join(" | "),M=[];for(let S=1;S<e.length;S++){const A=s.parse(e[S],1+M.length);if(!A)return null;M.push(pt(A.type))}s.error(`Expected arguments of type ${T}, but found (${M.join(", ")}) instead.`)}return null}static register(e,s){Ci.definitions=s;for(const l in s)e[l]=Ci}}class rn{constructor(e,s,l){this.type=dn,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=s}static parse(e,s){if(2!==e.length)return s.error("Expected one argument.");const l=e[1];if("object"!=typeof l||Array.isArray(l))return s.error("Collator options argument must be an object.");const u=s.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,Rt);if(!u)return null;const p=s.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,Rt);if(!p)return null;let _=null;return l.locale&&(_=s.parse(l.locale,1,Vt),!_)?null:new rn(u,p,_)}evaluate(e){return new Ks(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ys=8192;function Iu(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function fo(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function _n(i,e){const s=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(s*u*Ys),Math.round(l*u*Ys)]}function Ll(i,e,s){const l=i[0]-e[0],u=i[1]-e[1],p=i[0]-s[0],_=i[1]-s[1];return l*_-p*u==0&&l*p<=0&&u*_<=0}function Rl(i,e){let s=!1;for(let _=0,v=e.length;_<v;_++){const w=e[_];for(let T=0,M=w.length;T<M-1;T++){if(Ll(i,w[T],w[T+1]))return!1;(u=w[T])[1]>(l=i)[1]!=(p=w[T+1])[1]>l[1]&&l[0]<(p[0]-u[0])*(l[1]-u[1])/(p[1]-u[1])+u[0]&&(s=!s)}}var l,u,p;return s}function Dc(i,e){for(let s=0;s<e.length;s++)if(Rl(i,e[s]))return!0;return!1}function Cc(i,e,s,l){const u=l[0]-s[0],p=l[1]-s[1],_=(i[0]-s[0])*p-u*(i[1]-s[1]),v=(e[0]-s[0])*p-u*(e[1]-s[1]);return _>0&&v<0||_<0&&v>0}function $o(i,e,s){for(const T of s)for(let M=0;M<T.length-1;++M)if((v=[(_=T[M+1])[0]-(p=T[M])[0],_[1]-p[1]])[0]*(w=[(u=e)[0]-(l=i)[0],u[1]-l[1]])[1]-v[1]*w[0]!=0&&Cc(l,u,p,_)&&Cc(p,_,l,u))return!0;var l,u,p,_,v,w;return!1}function ka(i,e){for(let s=0;s<i.length;++s)if(!Rl(i[s],e))return!1;for(let s=0;s<i.length-1;++s)if($o(i[s],i[s+1],e))return!1;return!0}function Qd(i,e){for(let s=0;s<e.length;s++)if(ka(i,e[s]))return!0;return!1}function Mi(i,e,s){const l=[];for(let u=0;u<i.length;u++){const p=[];for(let _=0;_<i[u].length;_++){const v=_n(i[u][_],s);Iu(e,v),p.push(v)}l.push(p)}return l}function bh(i,e,s){const l=[];for(let u=0;u<i.length;u++){const p=Mi(i[u],e,s);l.push(p)}return l}function Mc(i,e,s,l){if(i[0]<s[0]||i[0]>s[2]){const u=.5*l;let p=i[0]-s[0]>u?-l:s[0]-i[0]>u?l:0;0===p&&(p=i[0]-s[2]>u?-l:s[2]-i[0]>u?l:0),i[0]+=p}Iu(e,i)}function Su(i,e,s,l){const u=Math.pow(2,l.z)*Ys,p=[l.x*Ys,l.y*Ys],_=[];for(const v of i)for(const w of v){const T=[w.x+p[0],w.y+p[1]];Mc(T,e,s,u),_.push(T)}return _}function Au(i,e,s,l){const u=Math.pow(2,l.z)*Ys,p=[l.x*Ys,l.y*Ys],_=[];for(const w of i){const T=[];for(const M of w){const S=[M.x+p[0],M.y+p[1]];Iu(e,S),T.push(S)}_.push(T)}if(e[2]-e[0]<=u/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of _)for(const T of w)Mc(T,e,s,u)}var v;return _}class ei{constructor(e,s){this.type=Rt,this.geojson=e,this.geometries=s}static parse(e,s){if(2!==e.length)return s.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Aa(e[1])){const l=e[1];if("FeatureCollection"===l.type)for(let u=0;u<l.features.length;++u){const p=l.features[u].geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new ei(l,l.features[u].geometry)}else if("Feature"===l.type){const u=l.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new ei(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new ei(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(s,l){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const v=Mi(l.coordinates,p,_),w=Su(s.geometry(),u,p,_);if(!fo(u,p))return!1;for(const T of w)if(!Rl(T,v))return!1}if("MultiPolygon"===l.type){const v=bh(l.coordinates,p,_),w=Su(s.geometry(),u,p,_);if(!fo(u,p))return!1;for(const T of w)if(!Dc(T,v))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(s,l){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const v=Mi(l.coordinates,p,_),w=Au(s.geometry(),u,p,_);if(!fo(u,p))return!1;for(const T of w)if(!ka(T,v))return!1}if("MultiPolygon"===l.type){const v=bh(l.coordinates,p,_),w=Au(s.geometry(),u,p,_);if(!fo(u,p))return!1;for(const T of w)if(!Qd(T,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function La(i){if(i instanceof Ci&&("get"===i.name&&1===i.args.length||"feature-state"===i.name||"has"===i.name&&1===i.args.length||"properties"===i.name||"geometry-type"===i.name||"id"===i.name||/^filter-/.test(i.name))||i instanceof ei)return!1;let e=!0;return i.eachChild(s=>{e&&!La(s)&&(e=!1)}),e}function Ra(i){if(i instanceof Ci&&"feature-state"===i.name)return!1;let e=!0;return i.eachChild(s=>{e&&!Ra(s)&&(e=!1)}),e}function Ir(i,e){if(i instanceof Ci&&e.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(l=>{s&&!Ir(l,e)&&(s=!1)}),s}class Er{constructor(e,s){this.type=s.type,this.name=e,this.boundExpression=s}static parse(e,s){if(2!==e.length||"string"!=typeof e[1])return s.error("'var' expression requires exactly one string literal argument.");const l=e[1];return s.scope.has(l)?new Er(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class tr{constructor(e,s=[],l,u=new Mu,p=[]){this.registry=e,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=u,this.errors=p,this.expectedType=l}parse(e,s,l,u,p={}){return s?this.concat(s,l,u)._parse(e,p):this._parse(e,p)}_parse(e,s){function l(u,p,_){return"assert"===_?new On(p,[u]):"coerce"===_?new po(p,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let _=p.parse(e,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,w=_.type;if("string"!==v.kind&&"number"!==v.kind&&"boolean"!==v.kind&&"object"!==v.kind&&"array"!==v.kind||"value"!==w.kind)if("color"!==v.kind&&"formatted"!==v.kind&&"resolvedImage"!==v.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(v,w))return null}else _=l(_,v,s.typeAnnotation||"coerce");else _=l(_,v,s.typeAnnotation||"assert")}if(!(_ instanceof jo)&&"resolvedImage"!==_.type.kind&&Wi(_)){const v=new xh;try{_=new jo(_.type,_.evaluate(v))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,s,l){const u="number"==typeof e?this.path.concat(e):this.path,p=l?this.scope.concat(l):this.scope;return new tr(this.registry,u,s||null,p,this.errors)}error(e,...s){const l=`${this.key}${s.map(u=>`[${u}]`).join("")}`;this.errors.push(new Vo(l,e))}checkSubtype(e,s){const l=zn(e,s);return l&&this.error(l),l}}function Wi(i){if(i instanceof Er)return Wi(i.boundExpression);if(i instanceof Ci&&"error"===i.name||i instanceof rn||i instanceof ei)return!1;const e=i instanceof po||i instanceof On;let s=!0;return i.eachChild(l=>{s=e?s&&Wi(l):s&&l instanceof jo}),!!s&&La(i)&&Ir(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Xi(i,e){const s=i.length-1;let l,u,p=0,_=s,v=0;for(;p<=_;)if(v=Math.floor((p+_)/2),l=i[v],u=i[v+1],l<=e){if(v===s||e<u)return v;p=v+1}else{if(!(l>e))throw new wr("Input is not a number.");_=v-1}return 0}class Sr{constructor(e,s,l){this.type=e,this.input=s,this.labels=[],this.outputs=[];for(const[u,p]of l)this.labels.push(u),this.outputs.push(p)}static parse(e,s){if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(e[1],1,Xe);if(!l)return null;const u=[];let p=null;s.expectedType&&"value"!==s.expectedType.kind&&(p=s.expectedType);for(let _=1;_<e.length;_+=2){const v=1===_?-1/0:e[_],w=e[_+1],T=_,M=_+1;if("number"!=typeof v)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=v)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const S=s.parse(w,M,p);if(!S)return null;p=p||S.type,u.push([v,S])}return new Sr(p,l,u)}evaluate(e){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=s[0])return l[0].evaluate(e);const p=s.length;return u>=s[p-1]?l[p-1].evaluate(e):l[Xi(s,u)].evaluate(e)}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&e.push(this.labels[s]),e.push(this.outputs[s].serialize());return e}}function Xt(i,e,s){return i*(1-s)+e*s}var Fa=Object.freeze({__proto__:null,number:Xt,color:function(i,e,s){return new qt(Xt(i.r,e.r,s),Xt(i.g,e.g,s),Xt(i.b,e.b,s),Xt(i.a,e.a,s))},array:function(i,e,s){return i.map((l,u)=>Xt(l,e[u],s))}});const Go=4/29,nr=6/29,wh=3*nr*nr,Ii=Math.PI/180,Qe=180/Math.PI;function Ft(i){return i>.008856451679035631?Math.pow(i,1/3):i/wh+Go}function vn(i){return i>nr?i*i*i:wh*(i-Go)}function Ar(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Ki(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function rr(i){const e=Ki(i.r),s=Ki(i.g),l=Ki(i.b),u=Ft((.4124564*e+.3575761*s+.1804375*l)/.95047),p=Ft((.2126729*e+.7151522*s+.072175*l)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-Ft((.0193339*e+.119192*s+.9503041*l)/1.08883)),alpha:i.a}}function vs(i){let e=(i.l+16)/116,s=isNaN(i.a)?e:e+i.a/500,l=isNaN(i.b)?e:e-i.b/200;return e=1*vn(e),s=.95047*vn(s),l=1.08883*vn(l),new qt(Ar(3.2404542*s-1.5371385*e-.4985314*l),Ar(-.969266*s+1.8760108*e+.041556*l),Ar(.0556434*s-.2040259*e+1.0572252*l),i.alpha)}function Zn(i,e,s){const l=e-i;return i+s*(l>180||l<-180?l-360*Math.round(l/360):l)}const Ho={forward:rr,reverse:vs,interpolate:function(i,e,s){return{l:Xt(i.l,e.l,s),a:Xt(i.a,e.a,s),b:Xt(i.b,e.b,s),alpha:Xt(i.alpha,e.alpha,s)}}},mo={forward:function(i){const{l:e,a:s,b:l}=rr(i),u=Math.atan2(l,s)*Qe;return{h:u<0?u+360:u,c:Math.sqrt(s*s+l*l),l:e,alpha:i.a}},reverse:function(i){const e=i.h*Ii,s=i.c;return vs({l:i.l,a:Math.cos(e)*s,b:Math.sin(e)*s,alpha:i.alpha})},interpolate:function(i,e,s){return{h:Zn(i.h,e.h,s),c:Xt(i.c,e.c,s),l:Xt(i.l,e.l,s),alpha:Xt(i.alpha,e.alpha,s)}}};var At=Object.freeze({__proto__:null,lab:Ho,hcl:mo});class Tr{constructor(e,s,l,u,p){this.type=e,this.operator=s,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[_,v]of p)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(e,s,l,u){let p=0;if("exponential"===e.name)p=qo(s,e.base,l,u);else if("linear"===e.name)p=qo(s,1,l,u);else if("cubic-bezier"===e.name){const _=e.controlPoints;p=new Ao(_[0],_[1],_[2],_[3]).solve(qo(s,1,l,u))}return p}static parse(e,s){let[l,u,p,..._]=e;if(!Array.isArray(u)||0===u.length)return s.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const T=u[1];if("number"!=typeof T)return s.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if("cubic-bezier"!==u[0])return s.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(4!==T.length||T.some(M=>"number"!=typeof M||M<0||M>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(p=s.parse(p,2,Xe),!p)return null;const v=[];let w=null;"interpolate-hcl"===l||"interpolate-lab"===l?w=uo:s.expectedType&&"value"!==s.expectedType.kind&&(w=s.expectedType);for(let T=0;T<_.length;T+=2){const M=_[T],S=_[T+1],A=T+3,z=T+4;if("number"!=typeof M)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(v.length&&v[v.length-1][0]>=M)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const N=s.parse(S,z,w);if(!N)return null;w=w||N.type,v.push([M,N])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new Tr(w,l,u,p,v):s.error(`Type ${pt(w)} is not interpolatable.`)}evaluate(e){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=s[0])return l[0].evaluate(e);const p=s.length;if(u>=s[p-1])return l[p-1].evaluate(e);const _=Xi(s,u),v=Tr.interpolationFactor(this.interpolation,u,s[_],s[_+1]),w=l[_].evaluate(e),T=l[_+1].evaluate(e);return"interpolate"===this.operator?Fa[this.type.kind.toLowerCase()](w,T,v):"interpolate-hcl"===this.operator?mo.reverse(mo.interpolate(mo.forward(w),mo.forward(T),v)):Ho.reverse(Ho.interpolate(Ho.forward(w),Ho.forward(T),v))}eachChild(e){e(this.input);for(const s of this.outputs)e(s)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s}}function qo(i,e,s,l){const u=l-s,p=i-s;return 0===u?0:1===e?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}class Zo{constructor(e,s){this.type=e,this.args=s}static parse(e,s){if(e.length<2)return s.error("Expectected at least one argument.");let l=null;const u=s.expectedType;u&&"value"!==u.kind&&(l=u);const p=[];for(const v of e.slice(1)){const w=s.parse(v,1+p.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,p.push(w)}const _=u&&p.some(v=>zn(u,v.type));return new Zo(_?ft:l,p)}evaluate(e){let s,l=null,u=0;for(const p of this.args){if(u++,l=p.evaluate(e),l&&l instanceof Ti&&!l.available&&(s||(s=l),l=null,u===this.args.length))return s;if(null!==l)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class Wo{constructor(e,s){this.type=s.type,this.bindings=[].concat(e),this.result=s}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const s of this.bindings)e(s[1]);e(this.result)}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let p=1;p<e.length-1;p+=2){const _=e[p];if("string"!=typeof _)return s.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=s.parse(e[p+1],p+1);if(!v)return null;l.push([_,v])}const u=s.parse(e[e.length-1],e.length-1,s.expectedType,l);return u?new Wo(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[s,l]of this.bindings)e.push(s,l.serialize());return e.push(this.result.serialize()),e}}class Pr{constructor(e,s,l){this.type=e,this.index=s,this.input=l}static parse(e,s){if(3!==e.length)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,Xe),u=s.parse(e[2],2,qi(s.expectedType||ft));return l&&u?new Pr(u.type.itemType,l,u):null}evaluate(e){const s=this.index.evaluate(e),l=this.input.evaluate(e);if(s<0)throw new wr(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new wr(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new wr(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Js{constructor(e,s){this.type=Rt,this.needle=e,this.haystack=s}static parse(e,s){if(3!==e.length)return s.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,ft),u=s.parse(e[2],2,ft);return l&&u?Ma(l.type,[Rt,Vt,Xe,Zs,ft])?new Js(l,u):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${pt(l.type)} instead`):null}evaluate(e){const s=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!Xs(s,["boolean","string","number","null"]))throw new wr(`Expected first argument to be of type boolean, string, number or null, but found ${pt(qn(s))} instead.`);if(!Xs(l,["string","array"]))throw new wr(`Expected second argument to be of type array or string, but found ${pt(qn(l))} instead.`);return l.indexOf(s)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class kr{constructor(e,s,l){this.type=Xe,this.needle=e,this.haystack=s,this.fromIndex=l}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,ft),u=s.parse(e[2],2,ft);if(!l||!u)return null;if(!Ma(l.type,[Rt,Vt,Xe,Zs,ft]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${pt(l.type)} instead`);if(4===e.length){const p=s.parse(e[3],3,Xe);return p?new kr(l,u,p):null}return new kr(l,u)}evaluate(e){const s=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Xs(s,["boolean","string","number","null"]))throw new wr(`Expected first argument to be of type boolean, string, number or null, but found ${pt(qn(s))} instead.`);if(!Xs(l,["string","array"]))throw new wr(`Expected second argument to be of type array or string, but found ${pt(qn(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return l.indexOf(s,u)}return l.indexOf(s)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ti{constructor(e,s,l,u,p,_){this.inputType=e,this.type=s,this.input=l,this.cases=u,this.outputs=p,this.otherwise=_}static parse(e,s){if(e.length<5)return s.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return s.error("Expected an even number of arguments.");let l,u;s.expectedType&&"value"!==s.expectedType.kind&&(u=s.expectedType);const p={},_=[];for(let T=2;T<e.length-1;T+=2){let M=e[T];const S=e[T+1];Array.isArray(M)||(M=[M]);const A=s.concat(T);if(0===M.length)return A.error("Expected at least one branch label.");for(const N of M){if("number"!=typeof N&&"string"!=typeof N)return A.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return A.error("Numeric branch labels must be integer values.");if(l){if(A.checkSubtype(l,qn(N)))return null}else l=qn(N);if(void 0!==p[String(N)])return A.error("Branch labels must be unique.");p[String(N)]=_.length}const z=s.parse(S,T,u);if(!z)return null;u=u||z.type,_.push(z)}const v=s.parse(e[1],1,ft);if(!v)return null;const w=s.parse(e[e.length-1],e.length-1,u);return w?"value"!==v.type.kind&&s.concat(1).checkSubtype(l,v.type)?null:new ti(l,u,v,p,_,w):null}evaluate(e){const s=this.input.evaluate(e);return(qn(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),l=[],u={};for(const _ of s){const v=u[this.cases[_]];void 0===v?(u[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[v][1].push(_)}const p=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,v]of l)e.push(1===v.length?p(v[0]):v.map(p)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class en{constructor(e,s,l){this.type=e,this.branches=s,this.otherwise=l}static parse(e,s){if(e.length<4)return s.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&"value"!==s.expectedType.kind&&(l=s.expectedType);const u=[];for(let _=1;_<e.length-1;_+=2){const v=s.parse(e[_],_,Rt);if(!v)return null;const w=s.parse(e[_+1],_+1,l);if(!w)return null;u.push([v,w]),l=l||w.type}const p=s.parse(e[e.length-1],e.length-1,l);return p?new en(l,u,p):null}evaluate(e){for(const[s,l]of this.branches)if(s.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[s,l]of this.branches)e(s),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(s=>{e.push(s.serialize())}),e}}class Fl{constructor(e,s,l,u){this.type=e,this.input=s,this.beginIndex=l,this.endIndex=u}static parse(e,s){if(e.length<=2||e.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=s.parse(e[1],1,ft),u=s.parse(e[2],2,Xe);if(!l||!u)return null;if(!Ma(l.type,[qi(ft),Vt,ft]))return s.error(`Expected first argument to be of type array or string, but found ${pt(l.type)} instead`);if(4===e.length){const p=s.parse(e[3],3,Xe);return p?new Fl(l.type,l,u,p):null}return new Fl(l.type,l,u)}evaluate(e){const s=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Xs(s,["string","array"]))throw new wr(`Expected first argument to be of type array or string, but found ${pt(qn(s))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return s.slice(l,u)}return s.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Eh(i,e){return"=="===i||"!="===i?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function hi(i,e,s,l){return 0===l.compare(e,s)}function pr(i,e,s){const l="=="!==i&&"!="!==i;return class Vb{constructor(p,_,v){this.type=Rt,this.lhs=p,this.rhs=_,this.collator=v,this.hasUntypedArgument="value"===p.type.kind||"value"===_.type.kind}static parse(p,_){if(3!==p.length&&4!==p.length)return _.error("Expected two or three arguments.");const v=p[0];let w=_.parse(p[1],1,ft);if(!w)return null;if(!Eh(v,w.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${pt(w.type)}'.`);let T=_.parse(p[2],2,ft);if(!T)return null;if(!Eh(v,T.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${pt(T.type)}'.`);if(w.type.kind!==T.type.kind&&"value"!==w.type.kind&&"value"!==T.type.kind)return _.error(`Cannot compare types '${pt(w.type)}' and '${pt(T.type)}'.`);l&&("value"===w.type.kind&&"value"!==T.type.kind?w=new On(T.type,[w]):"value"!==w.type.kind&&"value"===T.type.kind&&(T=new On(w.type,[T])));let M=null;if(4===p.length){if("string"!==w.type.kind&&"string"!==T.type.kind&&"value"!==w.type.kind&&"value"!==T.type.kind)return _.error("Cannot use collator to compare non-string types.");if(M=_.parse(p[3],3,dn),!M)return null}return new Vb(w,T,M)}evaluate(p){const _=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(l&&this.hasUntypedArgument){const w=qn(_),T=qn(v);if(w.kind!==T.kind||"string"!==w.kind&&"number"!==w.kind)throw new wr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${T.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=qn(_),T=qn(v);if("string"!==w.kind||"string"!==T.kind)return e(p,_,v)}return this.collator?s(p,_,v,this.collator.evaluate(p)):e(p,_,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[i];return this.eachChild(_=>{p.push(_.serialize())}),p}}}const Ic=pr("==",function(i,e,s){return e===s},hi),Oa=pr("!=",function(i,e,s){return e!==s},function(i,e,s,l){return!hi(0,e,s,l)}),Ba=pr("<",function(i,e,s){return e<s},function(i,e,s,l){return l.compare(e,s)<0}),Si=pr(">",function(i,e,s){return e>s},function(i,e,s,l){return l.compare(e,s)>0}),Pu=pr("<=",function(i,e,s){return e<=s},function(i,e,s,l){return l.compare(e,s)<=0}),ep=pr(">=",function(i,e,s){return e>=s},function(i,e,s,l){return l.compare(e,s)>=0});class Sc{constructor(e,s,l,u,p){this.type=Vt,this.number=e,this.locale=s,this.currency=l,this.minFractionDigits=u,this.maxFractionDigits=p}static parse(e,s){if(3!==e.length)return s.error("Expected two arguments.");const l=s.parse(e[1],1,Xe);if(!l)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return s.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=s.parse(u.locale,1,Vt),!p))return null;let _=null;if(u.currency&&(_=s.parse(u.currency,1,Vt),!_))return null;let v=null;if(u["min-fraction-digits"]&&(v=s.parse(u["min-fraction-digits"],1,Xe),!v))return null;let w=null;return u["max-fraction-digits"]&&(w=s.parse(u["max-fraction-digits"],1,Xe),!w)?null:new Sc(l,p,_,v,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ac{constructor(e){this.type=Xe,this.input=e}static parse(e,s){if(2!==e.length)return s.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=s.parse(e[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?s.error(`Expected argument of type string or array, but found ${pt(l.type)} instead.`):new Ac(l):null}evaluate(e){const s=this.input.evaluate(e);if("string"==typeof s||Array.isArray(s))return s.length;throw new wr(`Expected value to be of type string or array, but found ${pt(qn(s))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(s=>{e.push(s.serialize())}),e}}const go={"==":Ic,"!=":Oa,">":Si,"<":Ba,">=":ep,"<=":Pu,array:On,at:Pr,boolean:On,case:en,coalesce:Zo,collator:rn,format:Uo,image:Pa,in:Js,"index-of":kr,interpolate:Tr,"interpolate-hcl":Tr,"interpolate-lab":Tr,length:Ac,let:Wo,literal:jo,match:ti,number:On,"number-format":Sc,object:On,slice:Fl,step:Sr,string:On,"to-boolean":po,"to-color":po,"to-number":po,"to-string":po,var:Er,within:ei};function Th(i,[e,s,l,u]){e=e.evaluate(i),s=s.evaluate(i),l=l.evaluate(i);const p=u?u.evaluate(i):1,_=St(e,s,l,p);if(_)throw new wr(_);return new qt(e/255*p,s/255*p,l/255*p,p)}function Dh(i,e){return i in e}function Pc(i,e){const s=e[i];return void 0===s?null:s}function Qs(i){return{type:i}}function tp(i){return{result:"success",value:i}}function xs(i){return{result:"error",value:i}}function zl(i){return"data-driven"===i["property-type"]||"cross-faded-data-driven"===i["property-type"]}function np(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Ch(i){return!!i.expression&&i.expression.interpolated}function tn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":null===i?"null":typeof i}function ku(i){return"object"==typeof i&&null!==i&&!Array.isArray(i)}function Lu(i){return i}function kc(i,e){const s="color"===e.type,l=i.stops&&"object"==typeof i.stops[0][0],u=l||!(l||void 0!==i.property),p=i.type||(Ch(e)?"exponential":"interval");if(s&&((i=_s({},i)).stops&&(i.stops=i.stops.map(T=>[T[0],qt.parse(T[1])])),i.default=qt.parse(i.default?i.default:e.default)),i.colorSpace&&"rgb"!==i.colorSpace&&!At[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,v,w;if("exponential"===p)_=rp;else if("interval"===p)_=Xf;else if("categorical"===p){_=Na,v=Object.create(null);for(const T of i.stops)v[T[0]]=T[1];w=typeof i.stops[0][0]}else{if("identity"!==p)throw new Error(`Unknown function type "${p}"`);_=Kf}if(l){const T={},M=[];for(let z=0;z<i.stops.length;z++){const N=i.stops[z],U=N[0].zoom;void 0===T[U]&&(T[U]={zoom:U,type:i.type,property:i.property,default:i.default,stops:[]},M.push(U)),T[U].stops.push([N[0].value,N[1]])}const S=[];for(const z of M)S.push([T[z].zoom,kc(T[z],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:Tr.interpolationFactor.bind(void 0,A),zoomStops:S.map(z=>z[0]),evaluate:({zoom:z},N)=>rp({stops:S,base:i.base},e,z).evaluate(z,N)}}if(u){const T="exponential"===p?{name:"exponential",base:void 0!==i.base?i.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Tr.interpolationFactor.bind(void 0,T),zoomStops:i.stops.map(M=>M[0]),evaluate:({zoom:M})=>_(i,e,M,v,w)}}return{kind:"source",evaluate(T,M){const S=M&&M.properties?M.properties[i.property]:void 0;return void 0===S?fr(i.default,e.default):_(i,e,S,v,w)}}}function fr(i,e,s){return void 0!==i?i:void 0!==e?e:void 0!==s?s:void 0}function Na(i,e,s,l,u){return fr(typeof s===u?l[s]:void 0,i.default,e.default)}function Xf(i,e,s){if("number"!==tn(s))return fr(i.default,e.default);const l=i.stops.length;if(1===l||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[l-1][0])return i.stops[l-1][1];const u=Xi(i.stops.map(p=>p[0]),s);return i.stops[u][1]}function rp(i,e,s){const l=void 0!==i.base?i.base:1;if("number"!==tn(s))return fr(i.default,e.default);const u=i.stops.length;if(1===u||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[u-1][0])return i.stops[u-1][1];const p=Xi(i.stops.map(M=>M[0]),s),_=function(M,S,A,z){const N=z-A,U=M-A;return 0===N?0:1===S?U/N:(Math.pow(S,U)-1)/(Math.pow(S,N)-1)}(s,l,i.stops[p][0],i.stops[p+1][0]),v=i.stops[p][1],w=i.stops[p+1][1];let T=Fa[e.type]||Lu;if(i.colorSpace&&"rgb"!==i.colorSpace){const M=At[i.colorSpace];T=(S,A)=>M.reverse(M.interpolate(M.forward(S),M.forward(A),_))}return"function"==typeof v.evaluate?{evaluate(...M){const S=v.evaluate.apply(void 0,M),A=w.evaluate.apply(void 0,M);if(void 0!==S&&void 0!==A)return T(S,A,_)}}:T(v,w,_)}function Kf(i,e,s){return"color"===e.type?s=qt.parse(s):"formatted"===e.type?s=xt.fromString(s.toString()):"resolvedImage"===e.type?s=Ti.fromString(s.toString()):tn(s)===e.type||"enum"===e.type&&e.values[s]||(s=void 0),fr(s,i.default,e.default)}Ci.register(go,{error:[{kind:"error"},[Vt],(i,[e])=>{throw new wr(e.evaluate(i))}],typeof:[Vt,[ft],(i,[e])=>pt(qn(e.evaluate(i)))],"to-rgba":[qi(Xe,4),[uo],(i,[e])=>e.evaluate(i).toArray()],rgb:[uo,[Xe,Xe,Xe],Th],rgba:[uo,[Xe,Xe,Xe,Xe],Th],has:{type:Rt,overloads:[[[Vt],(i,[e])=>Dh(e.evaluate(i),i.properties())],[[Vt,Pl],(i,[e,s])=>Dh(e.evaluate(i),s.evaluate(i))]]},get:{type:ft,overloads:[[[Vt],(i,[e])=>Pc(e.evaluate(i),i.properties())],[[Vt,Pl],(i,[e,s])=>Pc(e.evaluate(i),s.evaluate(i))]]},"feature-state":[ft,[Vt],(i,[e])=>Pc(e.evaluate(i),i.featureState||{})],properties:[Pl,[],i=>i.properties()],"geometry-type":[Vt,[],i=>i.geometryType()],id:[ft,[],i=>i.id()],zoom:[Xe,[],i=>i.globals.zoom],pitch:[Xe,[],i=>i.globals.pitch||0],"distance-from-center":[Xe,[],i=>i.distanceFromCenter()],"heatmap-density":[Xe,[],i=>i.globals.heatmapDensity||0],"line-progress":[Xe,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Xe,[],i=>i.globals.skyRadialProgress||0],accumulated:[ft,[],i=>void 0===i.globals.accumulated?null:i.globals.accumulated],"+":[Xe,Qs(Xe),(i,e)=>{let s=0;for(const l of e)s+=l.evaluate(i);return s}],"*":[Xe,Qs(Xe),(i,e)=>{let s=1;for(const l of e)s*=l.evaluate(i);return s}],"-":{type:Xe,overloads:[[[Xe,Xe],(i,[e,s])=>e.evaluate(i)-s.evaluate(i)],[[Xe],(i,[e])=>-e.evaluate(i)]]},"/":[Xe,[Xe,Xe],(i,[e,s])=>e.evaluate(i)/s.evaluate(i)],"%":[Xe,[Xe,Xe],(i,[e,s])=>e.evaluate(i)%s.evaluate(i)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(i,[e,s])=>Math.pow(e.evaluate(i),s.evaluate(i))],sqrt:[Xe,[Xe],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Xe,[Xe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Xe,[Xe],(i,[e])=>Math.log(e.evaluate(i))],log2:[Xe,[Xe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Xe,[Xe],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Xe,[Xe],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Xe,[Xe],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Xe,[Xe],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Xe,[Xe],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Xe,[Xe],(i,[e])=>Math.atan(e.evaluate(i))],min:[Xe,Qs(Xe),(i,e)=>Math.min(...e.map(s=>s.evaluate(i)))],max:[Xe,Qs(Xe),(i,e)=>Math.max(...e.map(s=>s.evaluate(i)))],abs:[Xe,[Xe],(i,[e])=>Math.abs(e.evaluate(i))],round:[Xe,[Xe],(i,[e])=>{const s=e.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[Xe,[Xe],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Xe,[Xe],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Rt,[Vt,ft],(i,[e,s])=>i.properties()[e.value]===s.value],"filter-id-==":[Rt,[ft],(i,[e])=>i.id()===e.value],"filter-type-==":[Rt,[Vt],(i,[e])=>i.geometryType()===e.value],"filter-<":[Rt,[Vt,ft],(i,[e,s])=>{const l=i.properties()[e.value],u=s.value;return typeof l==typeof u&&l<u}],"filter-id-<":[Rt,[ft],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s<l}],"filter->":[Rt,[Vt,ft],(i,[e,s])=>{const l=i.properties()[e.value],u=s.value;return typeof l==typeof u&&l>u}],"filter-id->":[Rt,[ft],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s>l}],"filter-<=":[Rt,[Vt,ft],(i,[e,s])=>{const l=i.properties()[e.value],u=s.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[Rt,[ft],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s<=l}],"filter->=":[Rt,[Vt,ft],(i,[e,s])=>{const l=i.properties()[e.value],u=s.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[Rt,[ft],(i,[e])=>{const s=i.id(),l=e.value;return typeof s==typeof l&&s>=l}],"filter-has":[Rt,[ft],(i,[e])=>e.value in i.properties()],"filter-has-id":[Rt,[],i=>null!==i.id()&&void 0!==i.id()],"filter-type-in":[Rt,[qi(Vt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Rt,[qi(ft)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Rt,[Vt,qi(ft)],(i,[e,s])=>s.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Rt,[Vt,qi(ft)],(i,[e,s])=>function(l,u,p,_){for(;p<=_;){const v=p+_>>1;if(u[v]===l)return!0;u[v]>l?_=v-1:p=v+1}return!1}(i.properties()[e.value],s.value,0,s.value.length-1)],all:{type:Rt,overloads:[[[Rt,Rt],(i,[e,s])=>e.evaluate(i)&&s.evaluate(i)],[Qs(Rt),(i,e)=>{for(const s of e)if(!s.evaluate(i))return!1;return!0}]]},any:{type:Rt,overloads:[[[Rt,Rt],(i,[e,s])=>e.evaluate(i)||s.evaluate(i)],[Qs(Rt),(i,e)=>{for(const s of e)if(s.evaluate(i))return!0;return!1}]]},"!":[Rt,[Rt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Rt,[Vt],(i,[e])=>{const s=i.globals&&i.globals.isSupportedScript;return!s||s(e.evaluate(i))}],upcase:[Vt,[Vt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Vt,[Vt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Vt,Qs(ft),(i,e)=>e.map(s=>Di(s.evaluate(i))).join("")],"resolved-locale":[Vt,[dn],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Xo{constructor(e,s){var l;this.expression=e,this._warningHistory={},this._evaluator=new xh,this._defaultValue=s?"color"===(l=s).type&&ku(l.default)?new qt(0,0,0,0):"color"===l.type?qt.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(e,s,l,u,p,_,v,w){return this._evaluator.globals=e,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,s,l,u,p,_,v,w){this._evaluator.globals=e,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const T=this.expression.evaluate(this._evaluator);if(null==T||"number"==typeof T&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new wr(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,"undefined"!=typeof console&&console.warn(T.message)),this._defaultValue}}}function Va(i){return Array.isArray(i)&&i.length>0&&"string"==typeof i[0]&&i[0]in go}function bs(i,e){const s=new tr(go,[],e?function(u){const p={color:uo,string:Vt,number:Xe,enum:Vt,boolean:Rt,formatted:Ws,resolvedImage:Tc};return"array"===u.type?qi(p[u.value]||ft,u.length):p[u.type]}(e):void 0),l=s.parse(i,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return l?tp(new Xo(l,e)):xs(s.errors)}class ja{constructor(e,s){this.kind=e,this._styleExpression=s,this.isStateDependent="constant"!==e&&!Ra(s.expression)}evaluateWithoutErrorHandling(e,s,l,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,s,l,u,p,_)}evaluate(e,s,l,u,p,_){return this._styleExpression.evaluate(e,s,l,u,p,_)}}class Ru{constructor(e,s,l,u){this.kind=e,this.zoomStops=l,this._styleExpression=s,this.isStateDependent="camera"!==e&&!Ra(s.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,s,l,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,s,l,u,p,_)}evaluate(e,s,l,u,p,_){return this._styleExpression.evaluate(e,s,l,u,p,_)}interpolationFactor(e,s,l){return this.interpolationType?Tr.interpolationFactor(this.interpolationType,e,s,l):0}}function Mh(i,e){if("error"===(i=bs(i,e)).result)return i;const s=i.value.expression,l=La(s);if(!l&&!zl(e))return xs([new Vo("","data expressions not supported")]);const u=Ir(s,["zoom","pitch","distance-from-center"]);if(!u&&!np(e))return xs([new Vo("","zoom expressions not supported")]);const p=Ol(s);return p||u?p instanceof Vo?xs([p]):p instanceof Tr&&!Ch(e)?xs([new Vo("",'"interpolate" expressions cannot be used with this property')]):tp(p?new Ru(l?"camera":"composite",i.value,p.labels,p instanceof Tr?p.interpolation:void 0):new ja(l?"constant":"source",i.value)):xs([new Vo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ea{constructor(e,s){this._parameters=e,this._specification=s,_s(this,kc(this._parameters,this._specification))}static deserialize(e){return new ea(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ol(i){let e=null;if(i instanceof Wo)e=Ol(i.result);else if(i instanceof Zo){for(const s of i.args)if(e=Ol(s),e)break}else(i instanceof Sr||i instanceof Tr)&&i.input instanceof Ci&&"zoom"===i.input.name&&(e=i);return e instanceof Vo||i.eachChild(s=>{const l=Ol(s);l instanceof Vo?e=l:!e&&l?e=new Vo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new Vo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ai(i){const e=i.key,s=i.value,l=i.valueSpec||{},u=i.objectElementValidators||{},p=i.style,_=i.styleSpec;let v=[];const w=tn(s);if("object"!==w)return[new Ge(e,s,`object expected, ${w} found`)];for(const T in s){const M=T.split(".")[0],S=l[M]||l["*"];let A;if(u[M])A=u[M];else if(l[M])A=mr;else if(u["*"])A=u["*"];else{if(!l["*"]){v.push(new Ge(e,s[T],`unknown property "${T}"`));continue}A=mr}v=v.concat(A({key:(e&&`${e}.`)+T,value:s[T],valueSpec:S,style:p,styleSpec:_,object:s,objectKey:T},s))}for(const T in l)u[T]||l[T].required&&void 0===l[T].default&&void 0===s[T]&&v.push(new Ge(e,s,`missing required property "${T}"`));return v}function Bl(i){const e=i.value,s=i.valueSpec,l=i.style,u=i.styleSpec,p=i.key,_=i.arrayElementValidator||mr;if("array"!==tn(e))return[new Ge(p,e,`array expected, ${tn(e)} found`)];if(s.length&&e.length!==s.length)return[new Ge(p,e,`array length ${s.length} expected, length ${e.length} found`)];if(s["min-length"]&&e.length<s["min-length"])return[new Ge(p,e,`array length at least ${s["min-length"]} expected, length ${e.length} found`)];let v={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum};u.$version<7&&(v.function=s.function),"object"===tn(s.value)&&(v=s.value);let w=[];for(let T=0;T<e.length;T++)w=w.concat(_({array:e,arrayIndex:T,value:e[T],valueSpec:v,style:l,styleSpec:u,key:`${p}[${T}]`}));return w}function Ih(i){const e=i.key,s=i.value,l=i.valueSpec;let u=tn(s);if("number"===u&&s!=s&&(u="NaN"),"number"!==u)return[new Ge(e,s,`number expected, ${u} found`)];if("minimum"in l){let p=l.minimum;if("array"===tn(l.minimum)&&(p=l.minimum[i.arrayIndex]),s<p)return[new Ge(e,s,`${s} is less than the minimum value ${p}`)]}if("maximum"in l){let p=l.maximum;if("array"===tn(l.maximum)&&(p=l.maximum[i.arrayIndex]),s>p)return[new Ge(e,s,`${s} is greater than the maximum value ${p}`)]}return[]}function Gr(i){const e=i.valueSpec,s=Hn(i.value.type);let l,u,p,_={};const v="categorical"!==s&&void 0===i.value.property,w=!v,T="array"===tn(i.value.stops)&&"array"===tn(i.value.stops[0])&&"object"===tn(i.value.stops[0][0]),M=Ai({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(z){if("identity"===s)return[new Ge(z.key,z.value,'identity function may not have a "stops" property')];let N=[];const U=z.value;return N=N.concat(Bl({key:z.key,value:U,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:S})),"array"===tn(U)&&0===U.length&&N.push(new Ge(z.key,U,"array must have at least one stop")),N},default:function(z){return mr({key:z.key,value:z.value,valueSpec:e,style:z.style,styleSpec:z.styleSpec})}}});return"identity"===s&&v&&M.push(new Ge(i.key,i.value,'missing required property "property"')),"identity"===s||i.value.stops||M.push(new Ge(i.key,i.value,'missing required property "stops"')),"exponential"===s&&i.valueSpec.expression&&!Ch(i.valueSpec)&&M.push(new Ge(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(w&&!zl(i.valueSpec)?M.push(new Ge(i.key,i.value,"property functions not supported")):v&&!np(i.valueSpec)&&M.push(new Ge(i.key,i.value,"zoom functions not supported"))),"categorical"!==s&&!T||void 0!==i.value.property||M.push(new Ge(i.key,i.value,'"property" property is required')),M;function S(z){let N=[];const U=z.value,q=z.key;if("array"!==tn(U))return[new Ge(q,U,`array expected, ${tn(U)} found`)];if(2!==U.length)return[new Ge(q,U,`array length 2 expected, length ${U.length} found`)];if(T){if("object"!==tn(U[0]))return[new Ge(q,U,`object expected, ${tn(U[0])} found`)];if(void 0===U[0].zoom)return[new Ge(q,U,"object stop key must have zoom")];if(void 0===U[0].value)return[new Ge(q,U,"object stop key must have value")];if(p&&p>Hn(U[0].zoom))return[new Ge(q,U[0].zoom,"stop zoom values must appear in ascending order")];Hn(U[0].zoom)!==p&&(p=Hn(U[0].zoom),u=void 0,_={}),N=N.concat(Ai({key:`${q}[0]`,value:U[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Ih,value:A}}))}else N=N.concat(A({key:`${q}[0]`,value:U[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},U));return Va(br(U[1]))?N.concat([new Ge(`${q}[1]`,U[1],"expressions are not allowed in function stops.")]):N.concat(mr({key:`${q}[1]`,value:U[1],valueSpec:e,style:z.style,styleSpec:z.styleSpec}))}function A(z,N){const U=tn(z.value),q=Hn(z.value),Y=null!==z.value?z.value:N;if(l){if(U!==l)return[new Ge(z.key,Y,`${U} stop domain type must match previous stop domain type ${l}`)]}else l=U;if("number"!==U&&"string"!==U&&"boolean"!==U)return[new Ge(z.key,Y,"stop domain value must be a number, string, or boolean")];if("number"!==U&&"categorical"!==s){let ie=`number expected, ${U} found`;return zl(e)&&void 0===s&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ge(z.key,Y,ie)]}return"categorical"!==s||"number"!==U||isFinite(q)&&Math.floor(q)===q?"categorical"!==s&&"number"===U&&void 0!==u&&q<u?[new Ge(z.key,Y,"stop domain values must appear in ascending order")]:(u=q,"categorical"===s&&q in _?[new Ge(z.key,Y,"stop domain values must be unique")]:(_[q]=!0,[])):[new Ge(z.key,Y,`integer expected, found ${q}`)]}}function Yi(i){const e=("property"===i.expressionContext?Mh:bs)(br(i.value),i.valueSpec);if("error"===e.result)return e.value.map(l=>new Ge(`${i.key}${l.key}`,i.value,l.message));const s=e.value.expression||e.value._styleExpression.expression;if("property"===i.expressionContext&&"text-font"===i.propertyKey&&!s.outputDefined())return[new Ge(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===i.expressionContext&&"layout"===i.propertyType&&!Ra(s))return[new Ge(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===i.expressionContext)return Fu(s,i);if(i.expressionContext&&0===i.expressionContext.indexOf("cluster")){if(!Ir(s,["zoom","feature-state"]))return[new Ge(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===i.expressionContext&&!La(s))return[new Ge(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fu(i,e){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const u of e.valueSpec.expression.parameters)s.delete(u);if(0===s.size)return[];const l=[];return i instanceof Ci&&s.has(i.name)?[new Ge(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(u=>{l.push(...Fu(u,e))}),l)}function Ua(i){const e=i.key,s=i.value,l=i.valueSpec,u=[];return Array.isArray(l.values)?-1===l.values.indexOf(Hn(s))&&u.push(new Ge(e,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(l.values).indexOf(Hn(s))&&u.push(new Ge(e,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),u}function Lc(i){if(!0===i||!1===i)return!0;if(!Array.isArray(i)||0===i.length)return!1;switch(i[0]){case"has":return i.length>=2&&"$id"!==i[1]&&"$type"!==i[1];case"in":return i.length>=3&&("string"!=typeof i[1]||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==i.length||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Lc(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Rc(i,e="fill"){if(null==i)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Lc(i)||(i=zc(i));const s=i;let l=!0;try{l=function(T){if(!ws(T))return T;let M=br(T);return Sh(M),M=$a(M),M}(s)}catch(T){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const u=be[`filter_${e}`],p=bs(l,u);let _=null;if("error"===p.result)throw new Error(p.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,M,S)=>p.value.evaluate(T,M,{},S);let v=null,w=null;if(l!==s){const T=bs(s,u);if("error"===T.result)throw new Error(T.value.map(M=>`${M.key}: ${M.message}`).join(", "));v=(M,S,A,z,N)=>T.value.evaluate(M,S,{},A,void 0,void 0,z,N),w=!La(T.value.expression)}return _=_,{filter:_,dynamicFilter:v||void 0,needGeometry:Fc(l),needFeature:!!w}}function $a(i){if(!Array.isArray(i))return i;const e=function(s){if(Yf.has(s[0]))for(let l=1;l<s.length;l++)if(ws(s[l]))return!0;return s}(i);return!0===e?e:e.map(s=>$a(s))}function Sh(i){let e=!1;const s=[];if("case"===i[0]){for(let l=1;l<i.length-1;l+=2)e=e||ws(i[l]),s.push(i[l+1]);s.push(i[i.length-1])}else if("match"===i[0]){e=e||ws(i[1]);for(let l=2;l<i.length-1;l+=2)s.push(i[l+1]);s.push(i[i.length-1])}else if("step"===i[0]){e=e||ws(i[1]);for(let l=1;l<i.length-1;l+=2)s.push(i[l+1])}e&&(i.length=0,i.push("any",...s));for(let l=1;l<i.length;l++)Sh(i[l])}function ws(i){if(!Array.isArray(i))return!1;if("pitch"===(e=i[0])||"distance-from-center"===e)return!0;var e;for(let s=1;s<i.length;s++)if(ws(i[s]))return!0;return!1}const Yf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Bn(i,e){return i<e?-1:i>e?1:0}function Fc(i){if(!Array.isArray(i))return!1;if("within"===i[0])return!0;for(let e=1;e<i.length;e++)if(Fc(i[e]))return!0;return!1}function zc(i){if(!i)return!0;const e=i[0];return i.length<=1?"any"!==e:"=="===e?Nn(i[1],i[2],"=="):"!="===e?ta(Nn(i[1],i[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Nn(i[1],i[2],e):"any"===e?(s=i.slice(1),["any"].concat(s.map(zc))):"all"===e?["all"].concat(i.slice(1).map(zc)):"none"===e?["all"].concat(i.slice(1).map(zc).map(ta)):"in"===e?Ah(i[1],i.slice(2)):"!in"===e?ta(Ah(i[1],i.slice(2))):"has"===e?ip(i[1]):"!has"===e?ta(ip(i[1])):"within"!==e||i;var s}function Nn(i,e,s){switch(i){case"$type":return[`filter-type-${s}`,e];case"$id":return[`filter-id-${s}`,e];default:return[`filter-${s}`,i,e]}}function Ah(i,e){if(0===e.length)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(s=>typeof s!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Bn)]]:["filter-in-small",i,["literal",e]]}}function ip(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ta(i){return["!",i]}function ni(i){if(Lc(br(i.value))){const e=br(i.layerType);return Yi(_s({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${e||"fill"}`]}))}return Ph(i)}function Ph(i){const e=i.value,s=i.key;if("array"!==tn(e))return[new Ge(s,e,`array expected, ${tn(e)} found`)];const l=i.styleSpec;let u,p=[];if(e.length<1)return[new Ge(s,e,"filter array must have at least 1 element")];switch(p=p.concat(Ua({key:`${s}[0]`,value:e[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Hn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Hn(e[1])&&p.push(new Ge(s,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&p.push(new Ge(s,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=tn(e[1]),"string"!==u&&p.push(new Ge(`${s}[1]`,e[1],`string expected, ${u} found`)));for(let _=2;_<e.length;_++)u=tn(e[_]),"$type"===Hn(e[1])?p=p.concat(Ua({key:`${s}[${_}]`,value:e[_],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&p.push(new Ge(`${s}[${_}]`,e[_],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)p=p.concat(Ph({key:`${s}[${_}]`,value:e[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":u=tn(e[1]),2!==e.length?p.push(new Ge(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&p.push(new Ge(`${s}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=tn(e[1]),2!==e.length?p.push(new Ge(s,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&p.push(new Ge(`${s}[1]`,e[1],`object expected, ${u} found`))}return p}function na(i,e){const s=i.key,l=i.style,u=i.styleSpec,p=i.value,_=i.objectKey,v=u[`${e}_${i.layerType}`];if(!v)return[];const w=_.match(/^(.*)-transition$/);if("paint"===e&&w&&v[w[1]]&&v[w[1]].transition)return mr({key:s,value:p,valueSpec:u.transition,style:l,styleSpec:u});const T=i.valueSpec||v[_];if(!T)return[new Ge(s,p,`unknown property "${_}"`)];let M;if("string"===tn(p)&&zl(T)&&!T.tokens&&(M=/^{([^}]+)}$/.exec(p)))return[new Ge(s,p,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const S=[];return"symbol"===i.layerType&&("text-field"===_&&l&&!l.glyphs&&S.push(new Ge(s,p,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&ku(br(p))&&"identity"===Hn(p.type)&&S.push(new Ge(s,p,'"text-font" does not support identity functions'))),S.concat(mr({key:i.key,value:p,valueSpec:T,style:l,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:_}))}function ra(i){return na(i,"paint")}function ri(i){return na(i,"layout")}function Ga(i){let e=[];const s=i.value,l=i.key,u=i.style,p=i.styleSpec;s.type||s.ref||e.push(new Ge(l,s,'either "type" or "ref" is required'));let _=Hn(s.type);const v=Hn(s.ref);if(s.id){const w=Hn(s.id);for(let T=0;T<i.arrayIndex;T++){const M=u.layers[T];Hn(M.id)===w&&e.push(new Ge(l,s.id,`duplicate layer id "${s.id}", previously used at line ${M.id.__line__}`))}}if("ref"in s){let w;["type","source","source-layer","filter","layout"].forEach(T=>{T in s&&e.push(new Ge(l,s[T],`"${T}" is prohibited for ref layers`))}),u.layers.forEach(T=>{Hn(T.id)===v&&(w=T)}),w?w.ref?e.push(new Ge(l,s.ref,"ref cannot reference another ref layer")):_=Hn(w.type):e.push(new Ge(l,s.ref,`ref layer "${v}" not found`))}else if("background"!==_&&"sky"!==_)if(s.source){const w=u.sources&&u.sources[s.source],T=w&&Hn(w.type);w?"vector"===T&&"raster"===_?e.push(new Ge(l,s.source,`layer "${s.id}" requires a raster source`)):"raster"===T&&"raster"!==_?e.push(new Ge(l,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==T||s["source-layer"]?"raster-dem"===T&&"hillshade"!==_?e.push(new Ge(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!s.paint||!s.paint["line-gradient"]||"geojson"===T&&w.lineMetrics||e.push(new Ge(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ge(l,s,`layer "${s.id}" must specify a "source-layer"`)):e.push(new Ge(l,s.source,`source "${s.source}" not found`))}else e.push(new Ge(l,s,'missing required property "source"'));return e=e.concat(Ai({key:l,value:s,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>mr({key:`${l}.type`,value:s.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,object:s,objectKey:"type"}),filter:w=>ni(_s({layerType:_},w)),layout:w=>Ai({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":T=>ri(_s({layerType:_},T))}}),paint:w=>Ai({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":T=>ra(_s({layerType:_},T))}})}})),e}function Es(i){const e=i.value,s=i.key,l=tn(e);return"string"!==l?[new Ge(s,e,`string expected, ${l} found`)]:[]}const zu={promoteId:function({key:i,value:e}){if("string"===tn(e))return Es({key:i,value:e});{const s=[];for(const l in e)s.push(...Es({key:`${i}.${l}`,value:e[l]}));return s}}};function Ko(i){const e=i.value,s=i.key,l=i.styleSpec,u=i.style;if(!e.type)return[new Ge(s,e,'"type" is required')];const p=Hn(e.type);let _;switch(p){case"vector":case"raster":case"raster-dem":return _=Ai({key:s,value:e,valueSpec:l[`source_${p.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:zu}),_;case"geojson":if(_=Ai({key:s,value:e,valueSpec:l.source_geojson,style:u,styleSpec:l,objectElementValidators:zu}),e.cluster)for(const v in e.clusterProperties){const[w,T]=e.clusterProperties[v],M="string"==typeof w?[w,["accumulated"],["get",v]]:w;_.push(...Yi({key:`${s}.${v}.map`,value:T,expressionContext:"cluster-map"})),_.push(...Yi({key:`${s}.${v}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return _;case"video":return Ai({key:s,value:e,valueSpec:l.source_video,style:u,styleSpec:l});case"image":return Ai({key:s,value:e,valueSpec:l.source_image,style:u,styleSpec:l});case"canvas":return[new Ge(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ua({key:`${s}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:u,styleSpec:l})}}function Oc(i){const e=i.value,s=i.styleSpec,l=s.light,u=i.style;let p=[];const _=tn(e);if(void 0===e)return p;if("object"!==_)return p=p.concat([new Ge("light",e,`object expected, ${_} found`)]),p;for(const v in e){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&l[w[1]]&&l[w[1]].transition?mr({key:v,value:e[v],valueSpec:s.transition,style:u,styleSpec:s}):l[v]?mr({key:v,value:e[v],valueSpec:l[v],style:u,styleSpec:s}):[new Ge(v,e[v],`unknown property "${v}"`)])}return p}function Nl(i){const e=i.value,s=i.key,l=i.style,u=i.styleSpec,p=u.terrain;let _=[];const v=tn(e);if(void 0===e)return _;if("object"!==v)return _=_.concat([new Ge("terrain",e,`object expected, ${v} found`)]),_;for(const w in e){const T=w.match(/^(.*)-transition$/);_=_.concat(T&&p[T[1]]&&p[T[1]].transition?mr({key:w,value:e[w],valueSpec:u.transition,style:l,styleSpec:u}):p[w]?mr({key:w,value:e[w],valueSpec:p[w],style:l,styleSpec:u}):[new Ge(w,e[w],`unknown property "${w}"`)])}if(e.source){const w=l.sources&&l.sources[e.source],T=w&&Hn(w.type);w?"raster-dem"!==T&&_.push(new Ge(s,e.source,`terrain cannot be used with a source of type ${T}, it only be used with a "raster-dem" source type`)):_.push(new Ge(s,e.source,`source "${e.source}" not found`))}else _.push(new Ge(s,e,'terrain is missing required property "source"'));return _}function vt(i){const e=i.value,s=i.style,l=i.styleSpec,u=l.fog;let p=[];const _=tn(e);if(void 0===e)return p;if("object"!==_)return p=p.concat([new Ge("fog",e,`object expected, ${_} found`)]),p;for(const v in e){const w=v.match(/^(.*)-transition$/);p=p.concat(w&&u[w[1]]&&u[w[1]].transition?mr({key:v,value:e[v],valueSpec:l.transition,style:s,styleSpec:l}):u[v]?mr({key:v,value:e[v],valueSpec:u[v],style:s,styleSpec:l}):[new Ge(v,e[v],`unknown property "${v}"`)])}return p}const kh={"*":()=>[],array:Bl,boolean:function(i){const e=i.value,s=i.key,l=tn(e);return"boolean"!==l?[new Ge(s,e,`boolean expected, ${l} found`)]:[]},number:Ih,color:function(i){const e=i.key,s=i.value,l=tn(s);return"string"!==l?[new Ge(e,s,`color expected, ${l} found`)]:null===Sa.parseCSSColor(s)?[new Ge(e,s,`color expected, "${s}" found`)]:[]},constants:Jd,enum:Ua,filter:ni,function:Gr,layer:Ga,object:Ai,source:Ko,light:Oc,terrain:Nl,fog:vt,string:Es,formatted:function(i){return 0===Es(i).length?[]:Yi(i)},resolvedImage:function(i){return 0===Es(i).length?[]:Yi(i)},projection:function(i){const e=i.value,s=i.styleSpec,l=s.projection,u=i.style;let p=[];const _=tn(e);if("object"===_)for(const v in e)p=p.concat(mr({key:v,value:e[v],valueSpec:l[v],style:u,styleSpec:s}));else"string"!==_&&(p=p.concat([new Ge("projection",e,`object or string expected, ${_} found`)]));return p}};function mr(i){const e=i.value,s=i.valueSpec,l=i.styleSpec;return s.expression&&ku(Hn(e))?Gr(i):s.expression&&Va(br(e))?Yi(i):s.type&&kh[s.type]?kh[s.type](i):Ai(_s({},i,{valueSpec:s.type?l[s.type]:s}))}function Ou(i){const e=i.value,s=i.key,l=Es(i);return l.length||(-1===e.indexOf("{fontstack}")&&l.push(new Ge(s,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&l.push(new Ge(s,e,'"glyphs" url must include a "{range}" token'))),l}function Yo(i,e=be){let s=[];return s=s.concat(mr({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:Ou,"*":()=>[]}})),i.constants&&(s=s.concat(Jd({key:"constants",value:i.constants,style:i,styleSpec:e}))),Bu(s)}function Bu(i){return[].concat(i).sort((e,s)=>e.line-s.line)}function Ji(i){return function(...e){return Bu(i.apply(this,e))}}Yo.source=Ji(Ko),Yo.light=Ji(Oc),Yo.terrain=Ji(Nl),Yo.fog=Ji(vt),Yo.layer=Ji(Ga),Yo.filter=Ji(ni),Yo.paintProperty=Ji(ra),Yo.layoutProperty=Ji(ri);const Ha=Yo,Ne=Ha.light,Jt=Ha.fog,qa=Ha.paintProperty,ir=Ha.layoutProperty;function Nu(i,e){let s=!1;if(e&&e.length)for(const l of e)i.fire(new Cu(new Error(l.message))),s=!0;return s}var Jo=Dn;function Dn(i,e,s){var l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var u=new Int32Array(this.arrayBuffer);i=u[0],this.d=(e=u[1])+2*(s=u[2]);for(var p=0;p<this.d*this.d;p++){var _=u[3+p],v=u[3+p+1];l.push(_===v?null:u.subarray(_,v))}var w=u[3+l.length+1];this.keys=u.subarray(u[3+l.length],w),this.bboxes=u.subarray(w),this.insert=this._insertReadonly}else{this.d=e+2*s;for(var T=0;T<this.d*this.d;T++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=s,this.scale=e/i,this.uid=0;var M=s/e*i;this.min=-M,this.max=i+M}Dn.prototype.insert=function(i,e,s,l,u){this._forEachCell(e,s,l,u,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u)},Dn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Dn.prototype._insertCell=function(i,e,s,l,u,p){this.cells[u].push(p)},Dn.prototype.query=function(i,e,s,l,u){var p=this.min,_=this.max;if(i<=p&&e<=p&&_<=s&&_<=l&&!u)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(i,e,s,l,this._queryCell,v,{},u),v},Dn.prototype._queryCell=function(i,e,s,l,u,p,_,v){var w=this.cells[u];if(null!==w)for(var T=this.keys,M=this.bboxes,S=0;S<w.length;S++){var A=w[S];if(void 0===_[A]){var z=4*A;(v?v(M[z+0],M[z+1],M[z+2],M[z+3]):i<=M[z+2]&&e<=M[z+3]&&s>=M[z+0]&&l>=M[z+1])?(_[A]=!0,p.push(T[A])):_[A]=!1}}},Dn.prototype._forEachCell=function(i,e,s,l,u,p,_,v){for(var w=this._convertToCellCoord(i),T=this._convertToCellCoord(e),M=this._convertToCellCoord(s),S=this._convertToCellCoord(l),A=w;A<=M;A++)for(var z=T;z<=S;z++){var N=this.d*z+A;if((!v||v(this._convertFromCellCoord(A),this._convertFromCellCoord(z),this._convertFromCellCoord(A+1),this._convertFromCellCoord(z+1)))&&u.call(this,i,e,s,l,N,p,_,v))return}},Dn.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Dn.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Dn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,s=0,l=0;l<this.cells.length;l++)s+=this.cells[l].length;var u=new Int32Array(e+s+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var p=e,_=0;_<i.length;_++){var v=i[_];u[3+_]=p,u.set(v,p),p+=v.length}return u[3+i.length]=p,u.set(this.keys,p),u[3+i.length+1]=p+=this.keys.length,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer};const{ImageData:ia,ImageBitmap:Ts}=Pe,Bc={};function Ye(i,e,s={}){Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Bc[i]={klass:e,omit:s.omit||[],shallow:s.shallow||[]}}Ye("Object",Object),Jo.serialize=function(i,e){const s=i.toArrayBuffer();return e&&e.push(s),{buffer:s}},Jo.deserialize=function(i){return new Jo(i.buffer)},Ye("Grid",Jo),Ye("Color",qt),Ye("Error",Error),Ye("ResolvedImage",Ti),Ye("StylePropertyFunction",ea),Ye("StyleExpression",Xo,{omit:["_evaluator"]}),Ye("ZoomDependentExpression",Ru),Ye("ZoomConstantExpression",ja),Ye("CompoundExpression",Ci,{omit:["_evaluate"]});for(const i in go)go[i]._classRegistryKey||Ye(`Expression_${i}`,go[i]);function Qo(i){return i&&"undefined"!=typeof ArrayBuffer&&(i instanceof ArrayBuffer||i.constructor&&"ArrayBuffer"===i.constructor.name)}function Vl(i){return Ts&&i instanceof Ts}function or(i,e){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Qo(i)||Vl(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const s=i;return e&&e.push(s.buffer),s}if(i instanceof ia)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const s=[];for(const l of i)s.push(or(l,e));return s}if("object"==typeof i){const s=i.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");const u=s.serialize?s.serialize(i,e):{};if(!s.serialize){for(const p in i){if(!i.hasOwnProperty(p)||Bc[l].omit.indexOf(p)>=0)continue;const _=i[p];u[p]=Bc[l].shallow.indexOf(p)>=0?_:or(_,e)}i instanceof Error&&(u.message=i.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof i)}function Lr(i){if(null==i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Qo(i)||Vl(i)||ArrayBuffer.isView(i)||i instanceof ia)return i;if(Array.isArray(i))return i.map(Lr);if("object"==typeof i){const e=i.$name||"Object",{klass:s}=Bc[e];if(!s)throw new Error(`can't deserialize unregistered class ${e}`);if(s.deserialize)return s.deserialize(i);const l=Object.create(s.prototype);for(const u of Object.keys(i)){if("$name"===u)continue;const p=i[u];l[u]=Bc[e].shallow.indexOf(u)>=0?p:Lr(p)}return l}throw new Error("can't deserialize object of type "+typeof i)}class f{constructor(){this.first=!0}update(e,s){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}const o=i=>i>=1536&&i<=1791,c=i=>i>=1872&&i<=1919,m=i=>i>=2208&&i<=2303,y=i=>i>=11904&&i<=12031,x=i=>i>=12032&&i<=12255,E=i=>i>=12272&&i<=12287,C=i=>i>=12288&&i<=12351,P=i=>i>=12352&&i<=12447,k=i=>i>=12448&&i<=12543,R=i=>i>=12544&&i<=12591,O=i=>i>=12704&&i<=12735,j=i=>i>=12736&&i<=12783,Z=i=>i>=12784&&i<=12799,G=i=>i>=12800&&i<=13055,W=i=>i>=13056&&i<=13311,se=i=>i>=13312&&i<=19903,H=i=>i>=19968&&i<=40959,ne=i=>i>=40960&&i<=42127,re=i=>i>=42128&&i<=42191,te=i=>i>=44032&&i<=55215,Q=i=>i>=63744&&i<=64255,oe=i=>i>=64336&&i<=65023,de=i=>i>=65040&&i<=65055,xe=i=>i>=65072&&i<=65103,Ue=i=>i>=65104&&i<=65135,Re=i=>i>=65136&&i<=65279,Le=i=>i>=65280&&i<=65519;function we(i){for(const e of i)if(De(e.charCodeAt(0)))return!0;return!1}function ve(i){for(const e of i)if(!ke(e.charCodeAt(0)))return!1;return!0}function ke(i){return!(o(i)||c(i)||m(i)||oe(i)||Re(i))}function De(i){return!(746!==i&&747!==i&&(i<4352||!(O(i)||R(i)||xe(i)&&!(i>=65097&&i<=65103)||Q(i)||W(i)||y(i)||j(i)||!(!C(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||12336===i)||se(i)||H(i)||G(i)||(e=i,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||te(i)||P(i)||E(i)||(e=>e>=12688&&e<=12703)(i)||x(i)||Z(i)||k(i)&&12540!==i||!(!Le(i)||65288===i||65289===i||65293===i||i>=65306&&i<=65310||65339===i||65341===i||65343===i||i>=65371&&i<=65503||65507===i||i>=65512&&i<=65519)||!(!Ue(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||de(i)||(e=>e>=19904&&e<=19967)(i)||ne(i)||re(i))));var e}function tt(i){return!(De(i)||(e=i,(s=e)>=128&&s<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(s=>s>=8192&&s<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(s=>s>=8448&&s<=8527)(e)||(s=>s>=8528&&s<=8591)(e)||(s=>s>=8960&&s<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(s=>s>=9216&&s<=9279)(e)&&9251!==e||(s=>s>=9280&&s<=9311)(e)||(s=>s>=9312&&s<=9471)(e)||(s=>s>=9632&&s<=9727)(e)||(s=>s>=9728&&s<=9983)(e)&&!(e>=9754&&e<=9759)||(s=>s>=11008&&s<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||C(e)||k(e)||(s=>s>=57344&&s<=63743)(e)||xe(e)||Ue(e)||Le(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,s}function lt(i){return i>=1424&&i<=2303||oe(i)||Re(i)}function Tt(i,e){return!(!e&&lt(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(s=i,s>=6016&&s<=6143));var s}function je(i){for(const e of i)if(lt(e.charCodeAt(0)))return!0;return!1}const nt="deferred",mt="loading",on="loaded";let pn=null,ut="unavailable",Ct=null;const wn=function(i){i&&"string"==typeof i&&i.indexOf("NetworkError")>-1&&(ut="error"),pn&&pn(i)};function Jn(){di.fire(new gs("pluginStateChange",{pluginStatus:ut,pluginURL:Ct}))}const di=new qs,Qi=function(){return ut},ii=function(){if(ut!==nt||!Ct)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ut=mt,Jn(),Ct&&Gs({url:Ct},i=>{i?wn(i):(ut=on,Jn())})},Gt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ut===on||null!=Gt.applyArabicShaping,isLoading:()=>ut===mt,setState(i){ut=i.pluginStatus,Ct=i.pluginURL},isParsed:()=>null!=Gt.applyArabicShaping&&null!=Gt.processBidirectionalText&&null!=Gt.processStyledBidirectionalText,getPluginURL:()=>Ct};class gt{constructor(e,s){this.zoom=e,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new f,this.transition={},this.pitch=0)}isSupportedScript(e){return function(s,l){for(const u of s)if(!Tt(u.charCodeAt(0),l))return!1;return!0}(e,Gt.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,s=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class Pt{constructor(e,s){this.property=e,this.value=s,this.expression=function(l,u){if(ku(l))return new ea(l,u);if(Va(l)){const p=Mh(l,u);if("error"===p.result)throw new Error(p.value.map(_=>`${_.key}: ${_.message}`).join(", "));return p.value}{let p=l;return"string"==typeof l&&"color"===u.type&&(p=qt.parse(l)),{kind:"constant",evaluate:()=>p}}}(void 0===s?e.specification.default:s,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,s,l){return this.property.possiblyEvaluate(this,e,s,l)}}class Cn{constructor(e){this.property=e,this.value=new Pt(e,void 0)}transitioned(e,s){return new sn(this.property,this.value,s,Fn({},e.transition,this.transition),e.now)}untransitioned(){return new sn(this.property,this.value,null,{},0)}}class oi{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ui(this._values[e].value.value)}setValue(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Cn(this._values[e].property)),this._values[e].value=new Pt(this._values[e].property,null===s?void 0:Ui(s))}getTransition(e){return Ui(this._values[e].transition)}setTransition(e,s){this._values.hasOwnProperty(e)||(this._values[e]=new Cn(this._values[e].property)),this._values[e].transition=Ui(s)||void 0}serialize(){const e={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(e[s]=l);const u=this.getTransition(s);void 0!==u&&(e[`${s}-transition`]=u)}return e}transitioned(e,s){const l=new pi(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,s._values[u]);return l}untransitioned(){const e=new pi(this._properties);for(const s of Object.keys(this._values))e._values[s]=this._values[s].untransitioned();return e}}class sn{constructor(e,s,l,u,p){const _=u.delay||0,v=u.duration||0;p=p||0,this.property=e,this.value=s,this.begin=p+_,this.end=this.begin+v,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,s,l){const u=e.now||0,p=this.value.possiblyEvaluate(e,s,l),_=this.prior;if(_){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return _.possiblyEvaluate(e,s,l);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,s,l),p,_c(v))}}return p}}class pi{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,s,l){const u=new yo(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,s,l);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class _o{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Ui(this._values[e].value)}setValue(e,s){this._values[e]=new Pt(this._values[e].property,null===s?void 0:Ui(s))}serialize(){const e={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(e[s]=l)}return e}possiblyEvaluate(e,s,l){const u=new yo(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,s,l);return u}}class Rr{constructor(e,s,l){this.property=e,this.value=s,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,s,l,u){return this.property.evaluate(this.value,this.parameters,e,s,l,u)}}class yo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class et{constructor(e){this.specification=e}possiblyEvaluate(e,s){return e.expression.evaluate(s)}interpolate(e,s,l){const u=Fa[this.specification.type];return u?u(e,s,l):e}}class at{constructor(e,s){this.specification=e,this.overrides=s}possiblyEvaluate(e,s,l,u){return new Rr(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(s,null,{},l,u)}:e.expression,s)}interpolate(e,s,l){if("constant"!==e.value.kind||"constant"!==s.value.kind)return e;if(void 0===e.value.value||void 0===s.value.value)return new Rr(this,{kind:"constant",value:void 0},e.parameters);const u=Fa[this.specification.type];return u?new Rr(this,{kind:"constant",value:u(e.value.value,s.value.value,l)},e.parameters):e}evaluate(e,s,l,u,p,_){return"constant"===e.kind?e.value:e.evaluate(s,l,u,p,_)}}class sr extends at{possiblyEvaluate(e,s,l,u){if(void 0===e.value)return new Rr(this,{kind:"constant",value:void 0},s);if("constant"===e.expression.kind){const p=e.expression.evaluate(s,null,{},l,u),_="resolvedImage"===e.property.specification.type&&"string"!=typeof p?p.name:p,v=this._calculate(_,_,_,s);return new Rr(this,{kind:"constant",value:v},s)}if("camera"===e.expression.kind){const p=this._calculate(e.expression.evaluate({zoom:s.zoom-1}),e.expression.evaluate({zoom:s.zoom}),e.expression.evaluate({zoom:s.zoom+1}),s);return new Rr(this,{kind:"constant",value:p},s)}return new Rr(this,e.expression,s)}evaluate(e,s,l,u,p,_){if("source"===e.kind){const v=e.evaluate(s,l,u,p,_);return this._calculate(v,v,v,s)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(s.zoom)-1},l,u),e.evaluate({zoom:Math.floor(s.zoom)},l,u),e.evaluate({zoom:Math.floor(s.zoom)+1},l,u),s):e.value}_calculate(e,s,l,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:s,other:l}:{from:l,to:s,other:e}}interpolate(e){return e}}class oa{constructor(e){this.specification=e}possiblyEvaluate(e,s,l,u){if(void 0!==e.value){if("constant"===e.expression.kind){const p=e.expression.evaluate(s,null,{},l,u);return this._calculate(p,p,p,s)}return this._calculate(e.expression.evaluate(new gt(Math.floor(s.zoom-1),s)),e.expression.evaluate(new gt(Math.floor(s.zoom),s)),e.expression.evaluate(new gt(Math.floor(s.zoom+1),s)),s)}}_calculate(e,s,l,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:s}:{from:l,to:s}}interpolate(e){return e}}class Ds{constructor(e){this.specification=e}possiblyEvaluate(e,s,l,u){return!!e.expression.evaluate(s,null,{},l,u)}interpolate(){return!1}}class Wn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in e){const l=e[s];l.specification.overridable&&this.overridableProperties.push(s);const u=this.defaultPropertyValues[s]=new Pt(l,void 0),p=this.defaultTransitionablePropertyValues[s]=new Cn(l);this.defaultTransitioningPropertyValues[s]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=u.possiblyEvaluate({})}}}function Lh(i,e){return 256*(i=cn(Math.floor(i),0,255))+cn(Math.floor(e),0,255)}Ye("DataDrivenProperty",at),Ye("DataConstantProperty",et),Ye("CrossFadedDataDrivenProperty",sr),Ye("CrossFadedProperty",oa),Ye("ColorRampProperty",Ds);const op={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Za{constructor(e,s){this._structArray=e,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Mn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,s){return e._trim(),s&&(e.isTransferred=!0,s.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const s=Object.create(this.prototype);return s.arrayBuffer=e.arrayBuffer,s.length=e.length,s.capacity=e.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function In(i,e=1){let s=0,l=0;return{members:i.map(u=>{const p=op[u.type].BYTES_PER_ELEMENT,_=s=sp(s,Math.max(e,p)),v=u.components||1;return l=Math.max(l,p),s+=p*v,{name:u.name,type:u.type,components:v,offset:_}}),size:sp(s,Math.max(l,e)),alignment:e}}function sp(i,e){return Math.ceil(i/e)*e}class jl extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const u=2*e;return this.int16[u+0]=s,this.int16[u+1]=l,e}}jl.prototype.bytesPerElement=4,Ye("StructArrayLayout2i4",jl);class Ul extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,u)}emplace(e,s,l,u,p){const _=4*e;return this.int16[_+0]=s,this.int16[_+1]=l,this.int16[_+2]=u,this.int16[_+3]=p,e}}Ul.prototype.bytesPerElement=8,Ye("StructArrayLayout4i8",Ul);class Rh extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,u,p,_,v)}emplace(e,s,l,u,p,_,v,w){const T=6*e,M=12*e,S=3*e;return this.int16[T+0]=s,this.int16[T+1]=l,this.uint8[M+4]=u,this.uint8[M+5]=p,this.uint8[M+6]=_,this.uint8[M+7]=v,this.float32[S+2]=w,e}}Rh.prototype.bytesPerElement=12,Ye("StructArrayLayout2i4ub1f12",Rh);class Nc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,s,l)}emplace(e,s,l,u){const p=3*e;return this.float32[p+0]=s,this.float32[p+1]=l,this.float32[p+2]=u,e}}Nc.prototype.bytesPerElement=12,Ye("StructArrayLayout3f12",Nc);class Wa extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w,T,M){const S=this.length;return this.resize(S+1),this.emplace(S,e,s,l,u,p,_,v,w,T,M)}emplace(e,s,l,u,p,_,v,w,T,M,S){const A=10*e;return this.uint16[A+0]=s,this.uint16[A+1]=l,this.uint16[A+2]=u,this.uint16[A+3]=p,this.uint16[A+4]=_,this.uint16[A+5]=v,this.uint16[A+6]=w,this.uint16[A+7]=T,this.uint16[A+8]=M,this.uint16[A+9]=S,e}}Wa.prototype.bytesPerElement=20,Ye("StructArrayLayout10ui20",Wa);class $l extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,s,l,u,p,_,v,w)}emplace(e,s,l,u,p,_,v,w,T){const M=8*e;return this.uint16[M+0]=s,this.uint16[M+1]=l,this.uint16[M+2]=u,this.uint16[M+3]=p,this.uint16[M+4]=_,this.uint16[M+5]=v,this.uint16[M+6]=w,this.uint16[M+7]=T,e}}$l.prototype.bytesPerElement=16,Ye("StructArrayLayout8ui16",$l);class Gl extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w,T,M,S,A,z,N,U,q){const Y=this.length;return this.resize(Y+1),this.emplace(Y,e,s,l,u,p,_,v,w,T,M,S,A,z,N,U,q)}emplace(e,s,l,u,p,_,v,w,T,M,S,A,z,N,U,q,Y){const ie=16*e;return this.int16[ie+0]=s,this.int16[ie+1]=l,this.int16[ie+2]=u,this.int16[ie+3]=p,this.uint16[ie+4]=_,this.uint16[ie+5]=v,this.uint16[ie+6]=w,this.uint16[ie+7]=T,this.int16[ie+8]=M,this.int16[ie+9]=S,this.int16[ie+10]=A,this.int16[ie+11]=z,this.int16[ie+12]=N,this.int16[ie+13]=U,this.int16[ie+14]=q,this.int16[ie+15]=Y,e}}Gl.prototype.bytesPerElement=32,Ye("StructArrayLayout4i4ui4i4i32",Gl);class ap extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint32[1*e+0]=s,e}}ap.prototype.bytesPerElement=4,Ye("StructArrayLayout1ul4",ap);class Fh extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w,T,M,S,A,z){const N=this.length;return this.resize(N+1),this.emplace(N,e,s,l,u,p,_,v,w,T,M,S,A,z)}emplace(e,s,l,u,p,_,v,w,T,M,S,A,z,N){const U=20*e,q=10*e;return this.int16[U+0]=s,this.int16[U+1]=l,this.int16[U+2]=u,this.int16[U+3]=p,this.int16[U+4]=_,this.float32[q+3]=v,this.float32[q+4]=w,this.float32[q+5]=T,this.float32[q+6]=M,this.int16[U+14]=S,this.uint32[q+8]=A,this.uint16[U+18]=z,this.uint16[U+19]=N,e}}Fh.prototype.bytesPerElement=40,Ye("StructArrayLayout5i4f1i1ul2ui40",Fh);class Vu extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,u,p,_,v)}emplace(e,s,l,u,p,_,v,w){const T=8*e;return this.int16[T+0]=s,this.int16[T+1]=l,this.int16[T+2]=u,this.int16[T+4]=p,this.int16[T+5]=_,this.int16[T+6]=v,this.int16[T+7]=w,e}}Vu.prototype.bytesPerElement=16,Ye("StructArrayLayout3i2i2i16",Vu);class Xa extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,s,l,u,p)}emplace(e,s,l,u,p,_){const v=4*e,w=8*e;return this.float32[v+0]=s,this.float32[v+1]=l,this.float32[v+2]=u,this.int16[w+6]=p,this.int16[w+7]=_,e}}Xa.prototype.bytesPerElement=16,Ye("StructArrayLayout2f1f2i16",Xa);class lp extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,u)}emplace(e,s,l,u,p){const _=12*e,v=3*e;return this.uint8[_+0]=s,this.uint8[_+1]=l,this.float32[v+1]=u,this.float32[v+2]=p,e}}lp.prototype.bytesPerElement=12,Ye("StructArrayLayout2ub2f12",lp);class fi extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,s,l)}emplace(e,s,l,u){const p=3*e;return this.uint16[p+0]=s,this.uint16[p+1]=l,this.uint16[p+2]=u,e}}fi.prototype.bytesPerElement=6,Ye("StructArrayLayout3ui6",fi);class ju extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w,T,M,S,A,z,N,U,q,Y,ie,ce,he,fe){const me=this.length;return this.resize(me+1),this.emplace(me,e,s,l,u,p,_,v,w,T,M,S,A,z,N,U,q,Y,ie,ce,he,fe)}emplace(e,s,l,u,p,_,v,w,T,M,S,A,z,N,U,q,Y,ie,ce,he,fe,me){const Ce=30*e,Ee=15*e,$e=60*e;return this.int16[Ce+0]=s,this.int16[Ce+1]=l,this.int16[Ce+2]=u,this.float32[Ee+2]=p,this.float32[Ee+3]=_,this.uint16[Ce+8]=v,this.uint16[Ce+9]=w,this.uint32[Ee+5]=T,this.uint32[Ee+6]=M,this.uint32[Ee+7]=S,this.uint16[Ce+16]=A,this.uint16[Ce+17]=z,this.uint16[Ce+18]=N,this.float32[Ee+10]=U,this.float32[Ee+11]=q,this.uint8[$e+48]=Y,this.uint8[$e+49]=ie,this.uint8[$e+50]=ce,this.uint32[Ee+13]=he,this.int16[Ce+28]=fe,this.uint8[$e+58]=me,e}}ju.prototype.bytesPerElement=60,Ye("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",ju);class Ka extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v,w,T,M,S,A,z,N,U,q,Y,ie,ce,he,fe,me,Ce,Ee,$e,Oe,Te,Ve,Ze,Ie){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,s,l,u,p,_,v,w,T,M,S,A,z,N,U,q,Y,ie,ce,he,fe,me,Ce,Ee,$e,Oe,Te,Ve,Ze,Ie)}emplace(e,s,l,u,p,_,v,w,T,M,S,A,z,N,U,q,Y,ie,ce,he,fe,me,Ce,Ee,$e,Oe,Te,Ve,Ze,Ie,Ke){const Je=38*e,Ht=19*e;return this.int16[Je+0]=s,this.int16[Je+1]=l,this.int16[Je+2]=u,this.float32[Ht+2]=p,this.float32[Ht+3]=_,this.int16[Je+8]=v,this.int16[Je+9]=w,this.int16[Je+10]=T,this.int16[Je+11]=M,this.int16[Je+12]=S,this.int16[Je+13]=A,this.uint16[Je+14]=z,this.uint16[Je+15]=N,this.uint16[Je+16]=U,this.uint16[Je+17]=q,this.uint16[Je+18]=Y,this.uint16[Je+19]=ie,this.uint16[Je+20]=ce,this.uint16[Je+21]=he,this.uint16[Je+22]=fe,this.uint16[Je+23]=me,this.uint16[Je+24]=Ce,this.uint16[Je+25]=Ee,this.uint16[Je+26]=$e,this.uint16[Je+27]=Oe,this.uint16[Je+28]=Te,this.uint32[Ht+15]=Ve,this.float32[Ht+16]=Ze,this.float32[Ht+17]=Ie,this.float32[Ht+18]=Ke,e}}Ka.prototype.bytesPerElement=76,Ye("StructArrayLayout3i2f6i15ui1ul3f76",Ka);class sa extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.float32[1*e+0]=s,e}}sa.prototype.bytesPerElement=4,Ye("StructArrayLayout1f4",sa);class Ya extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,s,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,s,l)}emplace(e,s,l,u){const p=3*e;return this.int16[p+0]=s,this.int16[p+1]=l,this.int16[p+2]=u,e}}Ya.prototype.bytesPerElement=6,Ye("StructArrayLayout3i6",Ya);class Vc extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,u,p,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,s,l,u,p,_,v)}emplace(e,s,l,u,p,_,v,w){const T=7*e;return this.float32[T+0]=s,this.float32[T+1]=l,this.float32[T+2]=u,this.float32[T+3]=p,this.float32[T+4]=_,this.float32[T+5]=v,this.float32[T+6]=w,e}}Vc.prototype.bytesPerElement=28,Ye("StructArrayLayout7f28",Vc);class Uu extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,u)}emplace(e,s,l,u,p){const _=6*e;return this.uint32[3*e+0]=s,this.uint16[_+2]=l,this.uint16[_+3]=u,this.uint16[_+4]=p,e}}Uu.prototype.bytesPerElement=12,Ye("StructArrayLayout1ul3ui12",Uu);class eo extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const u=2*e;return this.uint16[u+0]=s,this.uint16[u+1]=l,e}}eo.prototype.bytesPerElement=4,Ye("StructArrayLayout2ui4",eo);class cp extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const s=this.length;return this.resize(s+1),this.emplace(s,e)}emplace(e,s){return this.uint16[1*e+0]=s,e}}cp.prototype.bytesPerElement=2,Ye("StructArrayLayout1ui2",cp);class zh extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,s)}emplace(e,s,l){const u=2*e;return this.float32[u+0]=s,this.float32[u+1]=l,e}}zh.prototype.bytesPerElement=8,Ye("StructArrayLayout2f8",zh);class an extends Mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,s,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,s,l,u)}emplace(e,s,l,u,p){const _=4*e;return this.float32[_+0]=s,this.float32[_+1]=l,this.float32[_+2]=u,this.float32[_+3]=p,e}}an.prototype.bytesPerElement=16,Ye("StructArrayLayout4f16",an);class Hg extends Za{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Hg.prototype.size=40;class Jf extends Fh{get(e){return new Hg(this,e)}}Ye("CollisionBoxArray",Jf);class qg extends Za{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}qg.prototype.size=60;class Zg extends ju{get(e){return new qg(this,e)}}Ye("PlacedSymbolArray",Zg);class Wg extends Za{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Wg.prototype.size=76;class Xg extends Ka{get(e){return new Wg(this,e)}}Ye("SymbolInstanceArray",Xg);class Kg extends sa{getoffsetX(e){return this.float32[1*e+0]}}Ye("GlyphOffsetArray",Kg);class jc extends Ya{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ye("SymbolLineVertexArray",jc);class Yg extends Za{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Yg.prototype.size=12;class gr extends Uu{get(e){return new Yg(this,e)}}Ye("FeatureIndexArray",gr);class Oh extends Za{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Oh.prototype.size=4;class Uc extends eo{get(e){return new Oh(this,e)}}Ye("FillExtrusionCentroidArray",Uc);const zv=In([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Jg=In([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var to=Ia(function(i){i.exports=function(e,s){var l,u,p,_,v,w,T,M;for(u=e.length-(l=3&e.length),p=s,v=3432918353,w=461845907,M=0;M<u;)T=255&e.charCodeAt(M)|(255&e.charCodeAt(++M))<<8|(255&e.charCodeAt(++M))<<16|(255&e.charCodeAt(++M))<<24,++M,p=27492+(65535&(_=5*(65535&(p=(p^=T=(65535&(T=(T=(65535&T)*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(T=0,l){case 3:T^=(255&e.charCodeAt(M+2))<<16;case 2:T^=(255&e.charCodeAt(M+1))<<8;case 1:p^=T=(65535&(T=(T=(65535&(T^=255&e.charCodeAt(M)))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return p^=e.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}}),Cs=Ia(function(i){i.exports=function(e,s){for(var l,u=e.length,p=s^u,_=0;u>=4;)l=1540483477*(65535&(l=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),u-=4,++_;switch(u){case 3:p^=(255&e.charCodeAt(_+2))<<16;case 2:p^=(255&e.charCodeAt(_+1))<<8;case 1:p=1540483477*(65535&(p^=255&e.charCodeAt(_)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}}),$c=to,Bh=Cs;$c.murmur3=to,$c.murmur2=Bh;class Ja{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,s,l,u){this.ids.push(up(e)),this.positions.push(s,l,u)}getPositions(e){const s=up(e);let l=0,u=this.ids.length-1;for(;l<u;){const _=l+u>>1;this.ids[_]>=s?u=_:l=_+1}const p=[];for(;this.ids[l]===s;)p.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return p}static serialize(e,s){const l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return hp(l,u,0,l.length-1),s&&s.push(l.buffer,u.buffer),{ids:l,positions:u}}static deserialize(e){const s=new Ja;return s.ids=e.ids,s.positions=e.positions,s.indexed=!0,s}}function up(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:$c(String(i))}function hp(i,e,s,l){for(;s<l;){const u=i[s+l>>1];let p=s-1,_=l+1;for(;;){do{p++}while(i[p]<u);do{_--}while(i[_]>u);if(p>=_)break;Nh(i,p,_),Nh(e,3*p,3*_),Nh(e,3*p+1,3*_+1),Nh(e,3*p+2,3*_+2)}_-s<l-_?(hp(i,e,s,_),s=_+1):(hp(i,e,_+1,l),l=_)}}function Nh(i,e,s){const l=i[e];i[e]=i[s],i[s]=l}Ye("FeaturePositionMap",Ja);class Qa{constructor(e,s){this.gl=e.gl,this.location=s}}class dp extends Qa{constructor(e,s){super(e,s),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class pp extends Qa{constructor(e,s){super(e,s),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Pi extends Qa{constructor(e,s){super(e,s),this.current=qt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const fp=new Float32Array(16),Gc=new Float32Array(9),Ov=new Float32Array(4);function Vh(i){return[Lh(255*i.r,255*i.g),Lh(255*i.b,255*i.a)]}class $u{constructor(e,s,l){this.value=e,this.uniformNames=s.map(u=>`u_${u}`),this.type=l}setUniform(e,s,l){e.set(l.constantOr(this.value))}getBinding(e,s,l){return"color"===this.type?new Pi(e,s):new dp(e,s)}}class Hc{constructor(e,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=s.tl.concat(s.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,s,l,u){const p="u_pattern_to"===u||"u_dash_to"===u?this.patternTo:"u_pattern_from"===u||"u_dash_from"===u?this.patternFrom:"u_pixel_ratio_to"===u?this.pixelRatioTo:"u_pixel_ratio_from"===u?this.pixelRatioFrom:null;p&&e.set(p)}getBinding(e,s,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new pp(e,s):new dp(e,s)}}class aa{constructor(e,s,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,s,l,u,p,_){const v=this.paintVertexArray.length,w=this.expression.evaluate(new gt(0),s,{},p,u,_);this.paintVertexArray.resize(e),this._setPaintValue(v,e,w)}updatePaintArray(e,s,l,u,p){const _=this.expression.evaluate({zoom:0},l,u,void 0,p);this._setPaintValue(e,s,_)}_setPaintValue(e,s,l){if("color"===this.type){const u=Vh(l);for(let p=e;p<s;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<s;u++)this.paintVertexArray.emplace(u,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class es{constructor(e,s,l,u,p,_){this.expression=e,this.uniformNames=s.map(v=>`u_${v}_t`),this.type=l,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=s.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,s,l,u,p,_){const v=this.expression.evaluate(new gt(this.zoom),s,{},p,u,_),w=this.expression.evaluate(new gt(this.zoom+1),s,{},p,u,_),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,v,w)}updatePaintArray(e,s,l,u,p){const _=this.expression.evaluate({zoom:this.zoom},l,u,void 0,p),v=this.expression.evaluate({zoom:this.zoom+1},l,u,void 0,p);this._setPaintValue(e,s,_,v)}_setPaintValue(e,s,l,u){if("color"===this.type){const p=Vh(l),_=Vh(u);for(let v=e;v<s;v++)this.paintVertexArray.emplace(v,p[0],p[1],_[0],_[1])}else{for(let p=e;p<s;p++)this.paintVertexArray.emplace(p,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,u=cn(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,s,l){return new dp(e,s)}}class el{constructor(e,s,l,u,p,_,v){this.expression=e,this.type=l,this.useIntegerZoom=u,this.zoom=p,this.layerId=v,this.paintVertexAttributes=("array"===l?Jg:zv).members;for(let w=0;w<s.length;++w);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,s,l){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(e,s,l,u,p,_){this._setPaintValues(e,s,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(e,s,l,u){if(!u||!l)return;const{min:p,mid:_,max:v}=l,w=u[p],T=u[_],M=u[v];if(w&&T&&M)for(let S=e;S<s;S++)this._setPaintValue(this.zoomInPaintVertexArray,S,T,w),this._setPaintValue(this.zoomOutPaintVertexArray,S,T,M)}_setPaintValue(e,s,l,u){e.emplace(s,l.tl[0],l.tl[1],l.br[0],l.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],l.pixelRatio,u.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ms{constructor(e,s,l=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const p in e.paint._values){if(!l(p))continue;const _=e.paint.get(p);if(!(_ instanceof Rr&&zl(_.property.specification)))continue;const v=Bv(p,e.type),w=_.value,T=_.property.specification.type,M=_.property.useIntegerZoom,S=_.property.specification["property-type"],A="cross-faded"===S||"cross-faded-data-driven"===S,z="line-dasharray"===String(p)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==w.kind||z)if("source"===w.kind||z||A){const N=Hu(p,T,"source");this.binders[p]=A?new el(w,v,T,M,s,N,e.id):new aa(w,v,T,N),u.push(`/a_${p}`)}else{const N=Hu(p,T,"composite");this.binders[p]=new es(w,v,T,M,s,N),u.push(`/z_${p}`)}else this.binders[p]=A?new Hc(w.value,v):new $u(w.value,v,T),u.push(`/u_${p}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const s=this.binders[e];return s instanceof aa||s instanceof es?s.maxValue:0}populatePaintArrays(e,s,l,u,p,_){for(const v in this.binders){const w=this.binders[v];(w instanceof aa||w instanceof es||w instanceof el)&&w.populatePaintArray(e,s,l,u,p,_)}}setConstantPatternPositions(e,s){for(const l in this.binders){const u=this.binders[l];u instanceof Hc&&u.setConstantPatternPositions(e,s)}}updatePaintArrays(e,s,l,u,p,_){let v=!1;for(const w in e){const T=s.getPositions(w);for(const M of T){const S=l.feature(M.index);for(const A in this.binders){const z=this.binders[A];if((z instanceof aa||z instanceof es||z instanceof el)&&!0===z.expression.isStateDependent){const N=u.paint.get(A);z.expression=N.value,z.updatePaintArray(M.start,M.end,S,e[w],p,_),v=!0}}}}return v}defines(){const e=[];for(const s in this.binders){const l=this.binders[s];(l instanceof $u||l instanceof Hc)&&e.push(...l.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof aa||l instanceof es||l instanceof el)for(let u=0;u<l.paintVertexAttributes.length;u++)e.push(l.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof $u||l instanceof Hc||l instanceof es)for(const u of l.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,s){const l=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof $u||p instanceof Hc||p instanceof es)for(const _ of p.uniformNames)if(s[_]){const v=p.getBinding(e,s[_],_);l.push({name:_,property:u,binding:v})}}return l}setUniforms(e,s,l,u){for(const{name:p,property:_,binding:v}of s)this.binders[_].setUniform(v,u,l.get(_),p)}updatePaintBuffers(e){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(e&&l instanceof el){const u=2===e.fromScale?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(l instanceof aa||l instanceof es)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const s in this.binders){const l=this.binders[s];(l instanceof aa||l instanceof es||l instanceof el)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const s=this.binders[e];(s instanceof aa||s instanceof es||s instanceof el)&&s.destroy()}}}class la{constructor(e,s,l=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Ms(u,s,l);this.needsUpload=!1,this._featureMap=new Ja,this._bufferOffset=0}populatePaintArrays(e,s,l,u,p,_,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,s,u,p,_,v);void 0!==s.id&&this._featureMap.add(s.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,s,l,u,p){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,s,_,u,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const jh={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Bv(i,e){return jh[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const Gu={"line-pattern":{source:Wa,composite:Wa},"fill-pattern":{source:Wa,composite:Wa},"fill-extrusion-pattern":{source:Wa,composite:Wa},"line-dasharray":{source:$l,composite:$l}},mp={color:{source:zh,composite:an},number:{source:sa,composite:zh}};function Hu(i,e,s){const l=Gu[i];return l&&l[s]||mp[e][s]}Ye("ConstantBinder",$u),Ye("CrossFadedConstantBinder",Hc),Ye("SourceExpressionBinder",aa),Ye("CrossFadedCompositeBinder",el),Ye("CompositeExpressionBinder",es),Ye("ProgramConfiguration",Ms,{omit:["_buffers"]}),Ye("ProgramConfigurationSet",la);const Uh="-transition";class ts extends qs{constructor(e,s){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),s.layout&&(this._unevaluatedLayout=new _o(s.layout)),s.paint)){this._transitionablePaint=new oi(s.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new yo(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,s,l={}){null!=s&&this._validate(ir,`layers.${this.id}.layout.${e}`,e,s,l)||("visibility"!==e?this._unevaluatedLayout.setValue(e,s):this.visibility=s)}getPaintProperty(e){return Dl(e,Uh)?this._transitionablePaint.getTransition(e.slice(0,-Uh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,s,l={}){if(null!=s&&this._validate(qa,`layers.${this.id}.paint.${e}`,e,s,l))return!1;if(Dl(e,Uh))return this._transitionablePaint.setTransition(e.slice(0,-Uh.length),s||void 0),!1;{const u=this._transitionablePaint._values[e],p="cross-faded-data-driven"===u.property.specification["property-type"],_=u.value.isDataDriven(),v=u.value;this._transitionablePaint.setValue(e,s),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value;return w.isDataDriven()||_||p||this._handleOverridablePaintPropertyUpdate(e,v,w)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,s,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,s){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,s)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Cl(e,(s,l)=>!(void 0===s||"layout"===l&&!Object.keys(s).length||"paint"===l&&!Object.keys(s).length))}_validate(e,s,l,u,p={}){return(!p||!1!==p.validate)&&Nu(this,e.call(Ha,{key:s,layerType:this.type,objectKey:l,value:u,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const s=this.paint.get(e);if(s instanceof Rr&&zl(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Rc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Qg=In([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qf}=Qg;class Xn{constructor(e=[]){this.segments=e}prepareSegment(e,s,l,u){let p=this.segments[this.segments.length-1];return e>Xn.MAX_VERTEX_ARRAY_LENGTH&&Pn(`Max vertices per segment is ${Xn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Xn.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==u&&(p.sortKey=u),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const s in e.vaos)e.vaos[s].destroy()}static simpleSegment(e,s,l,u){return new Xn([{vertexOffset:e,primitiveOffset:s,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}Xn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ye("SegmentVector",Xn);var Dt=8192;class tl{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof rt?new rt(e.lng,e.lat):rt.convert(e),this}setSouthWest(e){return this._sw=e instanceof rt?new rt(e.lng,e.lat):rt.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,p;if(e instanceof rt)u=e,p=e;else{if(!(e instanceof tl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(tl.convert(e)):this.extend(rt.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new rt(u.lng,u.lat),this._ne=new rt(p.lng,p.lat)),this}getCenter(){return new rt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new rt(this.getWest(),this.getNorth())}getSouthEast(){return new rt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=rt.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return!e||e instanceof tl?e:new tl(e)}}const em=6371008.8;class rt{constructor(e,s){if(isNaN(e)||isNaN(s))throw new Error(`Invalid LngLat object: (${e}, ${s})`);if(this.lng=+e,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new rt(hs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const s=Math.PI/180,l=this.lat*s,u=e.lat*s,p=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*s);return em*Math.acos(Math.min(p,1))}toBounds(e=0){const s=360*e/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new tl(new rt(this.lng-l,this.lat-s),new rt(this.lng+l,this.lat+s))}static convert(e){if(e instanceof rt)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new rt(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new rt(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const gp=2*Math.PI*em;function e_(i){return gp*Math.cos(i*Math.PI/180)}function nl(i){return(180+i)/360}function Is(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ns(i,e){return i/e_(e)}function ca(i){return 360*i-180}function vo(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function qu(i,e){return i*e_(vo(e))}const mi=85.051129;class Zu{constructor(e,s,l=0){this.x=+e,this.y=+s,this.z=+l}static fromLngLat(e,s=0){const l=rt.convert(e);return new Zu(nl(l.lng),Is(l.lat),ns(s,l.lat))}toLngLat(){return new rt(ca(this.x),vo(this.y))}toAltitude(){return qu(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/gp*(e=vo(this.y),1/Math.cos(e*Math.PI/180));var e}}function Hl(i,e,s,l,u,p,_,v,w){const T=(e+l)/2,M=(s+u)/2,S=new We(T,M);v(S),function(A,z,N,U,q,Y){const ie=N-q,ce=U-Y;return Math.abs((U-z)*ie-(N-A)*ce)/Math.hypot(ie,ce)}(S.x,S.y,p.x,p.y,_.x,_.y)>=w?(Hl(i,e,s,T,M,p,S,v,w),Hl(i,T,M,l,u,S,_,v,w)):i.push(_)}function t_(i,e,s){const l=[];let u,p,_;for(const v of i){const{x:w,y:T}=v;e(v),_?Hl(l,u,p,w,T,_,v,e,s):l.push(v),u=w,p=T,_=v}return l}const $h=Math.pow(2,14)-1,Gh=-$h-1;function Hh(i,e){const s=Math.round(i.x*e),l=Math.round(i.y*e);return i.x=cn(s,Gh,$h),i.y=cn(l,Gh,$h),(s<i.x||s>i.x+1||l<i.y||l>i.y+1)&&Pn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Ss(i,e,s){const l=i.loadGeometry(),u=i.extent,p=Dt/u;if(e&&s&&s.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:v,x:w,y:T,projection:M}=s,S=A=>{const z=ca((e.x+A.x/u)/_),N=vo((e.y+A.y/u)/_),U=M.project(z,N);A.x=(U.x*v-w)*u,A.y=(U.y*v-T)*u};for(let A=0;A<l.length;A++)if(1!==i.type)l[A]=t_(l[A],S,1);else{const z=[];for(const N of l[A])N.x<0||N.x>=u||N.y<0||N.y>=u||(S(N),z.push(N));l[A]=z}}for(const _ of l)for(const v of _)Hh(v,p);return l}function ql(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Ss(i):[]}}function qh(i,e,s,l,u){i.emplaceBack(2*e+(l+1)/2,2*s+(u+1)/2)}class rl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new jl,this.indexArray=new fi,this.segments=new Xn,this.programConfigurations=new la(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,l,u){const p=this.layers[0],_=[];let v=null;"circle"===p.type&&(v=p.layout.get("circle-sort-key"));for(const{feature:w,id:T,index:M,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,z=ql(w,A);if(!this.layers[0]._featureFilter.filter(new gt(this.zoom),z,l))continue;const N=v?v.evaluate(z,{},l):void 0,U={id:T,properties:w.properties,type:w.type,sourceLayerIndex:S,index:M,geometry:A?z.geometry:Ss(w,l,u),patterns:{},sortKey:N};_.push(U)}v&&_.sort((w,T)=>w.sortKey-T.sortKey);for(const w of _){const{geometry:T,index:M,sourceLayerIndex:S}=w,A=e[M].feature;this.addFeature(w,T,M,s.availableImages,l),s.featureIndex.insert(A,T,M,S,this.index)}}update(e,s,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,l,u,p){for(const _ of s)for(const v of _){const w=v.x,T=v.y;if(w<0||w>=Dt||T<0||T>=Dt)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=M.vertexLength;qh(this.layoutVertexArray,w,T,-1,-1),qh(this.layoutVertexArray,w,T,1,-1),qh(this.layoutVertexArray,w,T,1,1),qh(this.layoutVertexArray,w,T,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+3,S+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,p)}}function qc(i,e){for(let s=0;s<i.length;s++)if(ua(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(ua(i,e[s]))return!0;return!!_p(i,e)}function n_(i,e,s){return!!ua(i,e)||!!yp(e,i,s)}function r_(i,e){if(1===i.length)return rm(e,i[0]);for(let s=0;s<e.length;s++){const l=e[s];for(let u=0;u<l.length;u++)if(ua(i,l[u]))return!0}for(let s=0;s<i.length;s++)if(rm(e,i[s]))return!0;for(let s=0;s<e.length;s++)if(_p(i,e[s]))return!0;return!1}function tm(i,e,s){if(i.length>1){if(_p(i,e))return!0;for(let l=0;l<e.length;l++)if(yp(e[l],i,s))return!0}for(let l=0;l<i.length;l++)if(yp(i[l],e,s))return!0;return!1}function _p(i,e){if(0===i.length||0===e.length)return!1;for(let s=0;s<i.length-1;s++){const l=i[s],u=i[s+1];for(let p=0;p<e.length-1;p++)if(Nv(l,u,e[p],e[p+1]))return!0}return!1}function Nv(i,e,s,l){return ui(i,s,l)!==ui(e,s,l)&&ui(i,e,s)!==ui(i,e,l)}function yp(i,e,s){const l=s*s;if(1===e.length)return i.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(nm(i,e[u-1],e[u])<l)return!0;return!1}function nm(i,e,s){const l=e.distSqr(s);if(0===l)return i.distSqr(e);const u=((i.x-e.x)*(s.x-e.x)+(i.y-e.y)*(s.y-e.y))/l;return i.distSqr(u<0?e:u>1?s:s.sub(e)._mult(u)._add(e))}function rm(i,e){let s,l,u,p=!1;for(let _=0;_<i.length;_++){s=i[_];for(let v=0,w=s.length-1;v<s.length;w=v++)l=s[v],u=s[w],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(p=!p)}return p}function ua(i,e){let s=!1;for(let l=0,u=i.length-1;l<i.length;u=l++){const p=i[l],_=i[u];p.y>e.y!=_.y>e.y&&e.x<(_.x-p.x)*(e.y-p.y)/(_.y-p.y)+p.x&&(s=!s)}return s}function Zh(i,e,s,l,u){for(const _ of i)if(e<=_.x&&s<=_.y&&l>=_.x&&u>=_.y)return!0;const p=[new We(e,s),new We(e,u),new We(l,u),new We(l,s)];if(i.length>2)for(const _ of p)if(ua(i,_))return!0;for(let _=0;_<i.length-1;_++)if(Zc(i[_],i[_+1],p))return!0;return!1}function Zc(i,e,s){const l=s[0],u=s[2];if(i.x<l.x&&e.x<l.x||i.x>u.x&&e.x>u.x||i.y<l.y&&e.y<l.y||i.y>u.y&&e.y>u.y)return!1;const p=ui(i,e,s[0]);return p!==ui(i,e,s[1])||p!==ui(i,e,s[2])||p!==ui(i,e,s[3])}function Wc(i,e,s){const l=e.paint.get(i).value;return"constant"===l.kind?l.value:s.programConfigurations.get(e.id).getMaxValue(i)}function Wh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function i_(i,e,s,l,u){if(!e[0]&&!e[1])return i;const p=We.convert(e)._mult(u);"viewport"===s&&p._rotate(-l);const _=[];for(let v=0;v<i.length;v++)_.push(i[v].sub(p));return _}function Wu(i,e,s,l){const u=We.convert(i)._mult(l);return"viewport"===e&&u._rotate(-s),u}Ye("CircleBucket",rl,{omit:["layers"]});const vp=new Wn({"circle-sort-key":new at(be.layout_circle["circle-sort-key"])});var im={paint:new Wn({"circle-radius":new at(be.paint_circle["circle-radius"]),"circle-color":new at(be.paint_circle["circle-color"]),"circle-blur":new at(be.paint_circle["circle-blur"]),"circle-opacity":new at(be.paint_circle["circle-opacity"]),"circle-translate":new et(be.paint_circle["circle-translate"]),"circle-translate-anchor":new et(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new et(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new et(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new at(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new at(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new at(be.paint_circle["circle-stroke-opacity"])}),layout:vp};class Xh{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l,u){const p=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const T=lo([],w,e),M=1/T[3]/s*p;return(S=T)[0]=(A=T)[0]*(z=[M,M,u?1/T[3]:M,M])[0],S[1]=A[1]*z[1],S[2]=A[2]*z[2],S[3]=A[3]*z[3],S;var S,A,z}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const T=bl([],Yn([],Ns([],_[w[0]],_[w[1]]),Ns([],_[w[2]],_[w[1]]))),M=-Ni(T,_[w[1]]);return T.concat(M)});return new Xh(_,v)}}class xo{constructor(e,s){this.min=e,this.max=s,this.center=xi([],cs([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],l=Lo(this.min),u=Lo(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new xo(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,s=this.max;return[[e[0],e[1],e[2]],[s[0],e[1],e[2]],[s[0],s[1],e[2]],[e[0],s[1],e[2]],[e[0],e[1],s[2]],[s[0],e[1],s[2]],[s[0],s[1],s[2]],[e[0],s[1],s[2]]]}intersects(e){const s=this.getCorners();let l=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let _=0;for(let v=0;v<s.length;v++)_+=Ni(p,s[v])+p[3]>=0;if(0===_)return 0;_!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let v=0;v<e.points.length;v++){const w=e.points[v][u]-this.min[u];p=Math.min(p,w),_=Math.max(_,w)}if(_<0||p>this.max[u]-this.min[u])return 0}return 1}}function xp(i,e,s,l,u,p,_,v,w){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(w*=i.pixelToTileUnitsFactor);for(const T of e)for(const M of T){const S=M.add(v),A=u&&s.elevation?s.elevation.exaggeration()*u.getElevationAt(S.x,S.y,!0):0,z=p?S:o_(S,A,l),N=p?i.tilespaceRays.map(q=>a_(q,A)):i.queryGeometry.screenGeometry,U=lo([],[M.x,M.y,A,1],l);if(!_&&p?w*=U[3]/s.cameraToCenterDistance:_&&!p&&(w*=s.cameraToCenterDistance/U[3]),n_(N,z,w))return!0}return!1}function o_(i,e,s){const l=lo([],[i.x,i.y,e,1],s);return new We(l[0]/l[3],l[1]/l[3])}const om=vi(0,0,0),s_=vi(0,0,1);function a_(i,e){const s=xl();return om[2]=e,i.intersectsPlane(om,s_,s),new We(s[0],s[1])}class sm extends rl{}function As(i,{width:e,height:s},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*s*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*s*l);return i.width=e,i.height=s,i.data=u,i}function Xc(i,{width:e,height:s},l){if(e===i.width&&s===i.height)return;const u=As({},{width:e,height:s},l);bp(i,u,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,s)},l),i.width=e,i.height=s,i.data=u.data}function bp(i,e,s,l,u,p){if(0===u.width||0===u.height)return e;if(u.width>i.width||u.height>i.height||s.x>i.width-u.width||s.y>i.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,v=e.data;for(let w=0;w<u.height;w++){const T=((s.y+w)*i.width+s.x)*p,M=((l.y+w)*e.width+l.x)*p;for(let S=0;S<u.width*p;S++)v[M+S]=_[T+S]}return e}Ye("HeatmapBucket",sm,{omit:["layers"]});class Zl{constructor(e,s){As(this,e,1,s)}resize(e){Xc(this,e,1)}clone(){return new Zl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,l,u,p){bp(e,s,l,u,p,1)}}class bo{constructor(e,s){As(this,e,4,s)}resize(e){Xc(this,e,4)}replace(e,s){s?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,s,l,u,p){bp(e,s,l,u,p,4)}}Ye("AlphaImage",Zl),Ye("RGBAImage",bo);var Vv={paint:new Wn({"heatmap-radius":new at(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new at(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new et(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ds(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new et(be.paint_heatmap["heatmap-opacity"])})};function am(i){const e={},s=i.resolution||256,l=i.clips?i.clips.length:1,u=i.image||new bo({width:s,height:l}),p=(_,v,w)=>{e[i.evaluationKey]=w;const T=i.expression.evaluate(e);u.data[_+v+0]=Math.floor(255*T.r/T.a),u.data[_+v+1]=Math.floor(255*T.g/T.a),u.data[_+v+2]=Math.floor(255*T.b/T.a),u.data[_+v+3]=Math.floor(255*T.a)};if(i.clips)for(let _=0,v=0;_<l;++_,v+=4*s)for(let w=0,T=0;w<s;w++,T+=4){const M=w/(s-1),{start:S,end:A}=i.clips[_];p(v,T,S*(1-M)+A*M)}else for(let _=0,v=0;_<s;_++,v+=4)p(0,v,_/(s-1));return u}var jv={paint:new Wn({"hillshade-illumination-direction":new et(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new et(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new et(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new et(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new et(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new et(be.paint_hillshade["hillshade-accent-color"])})};const lm=In([{name:"a_pos",components:2,type:"Int16"}],4),{members:l_}=lm;var Kh=Yh,c_=Yh;function Yh(i,e,s){s=s||2;var l,u,p,_,v,w,T,M=e&&e.length,S=M?e[0]*s:i.length,A=u_(i,0,S,s,!0),z=[];if(!A||A.next===A.prev)return z;if(M&&(A=function(U,q,Y,ie){var ce,he,fe,me=[];for(ce=0,he=q.length;ce<he;ce++)(fe=u_(U,q[ce]*ie,ce<he-1?q[ce+1]*ie:U.length,ie,!1))===fe.next&&(fe.steiner=!0),me.push($v(fe));for(me.sort(hm),ce=0;ce<me.length;ce++)Y=il(Y=dm(me[ce],Y),Y.next);return Y}(i,e,A,s)),i.length>80*s){l=p=i[0],u=_=i[1];for(var N=s;N<S;N+=s)(v=i[N])<l&&(l=v),(w=i[N+1])<u&&(u=w),v>p&&(p=v),w>_&&(_=w);T=0!==(T=Math.max(p-l,_-u))?1/T:0}return ol(A,z,s,l,u,T),z}function u_(i,e,s,l,u){var p,_;if(u===Tp(i,e,s,l)>0)for(p=e;p<s;p+=l)_=mm(p,i[p],i[p+1],_);else for(p=s-l;p>=e;p-=l)_=mm(p,i[p],i[p+1],_);return _&&Ep(_,_.next)&&(Kc(_),_=_.next),_}function il(i,e){if(!i)return i;e||(e=i);var s,l=i;do{if(s=!1,l.steiner||!Ep(l,l.next)&&0!==kn(l.prev,l,l.next))l=l.next;else{if(Kc(l),(l=e=l.prev)===l.next)break;s=!0}}while(s||l!==e);return e}function ol(i,e,s,l,u,p,_){if(i){!_&&p&&function(M,S,A,z){var N=M;do{null===N.z&&(N.z=pm(N.x,N.y,S,A,z)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==M);N.prevZ.nextZ=null,N.prevZ=null,function(U){var q,Y,ie,ce,he,fe,me,Ce,Ee=1;do{for(Y=U,U=null,he=null,fe=0;Y;){for(fe++,ie=Y,me=0,q=0;q<Ee&&(me++,ie=ie.nextZ);q++);for(Ce=Ee;me>0||Ce>0&&ie;)0!==me&&(0===Ce||!ie||Y.z<=ie.z)?(ce=Y,Y=Y.nextZ,me--):(ce=ie,ie=ie.nextZ,Ce--),he?he.nextZ=ce:U=ce,ce.prevZ=he,he=ce;Y=ie}he.nextZ=null,Ee*=2}while(fe>1)}(N)}(i,l,u,p);for(var v,w,T=i;i.prev!==i.next;)if(v=i.prev,w=i.next,p?Ps(i,l,u,p):cm(i))e.push(v.i/s),e.push(i.i/s),e.push(w.i/s),Kc(i),i=w.next,T=w.next;else if((i=w)===T){_?1===_?ol(i=Xu(il(i),e,s),e,s,l,u,p,2):2===_&&um(i,e,s,l,u,p):ol(il(i),e,s,l,u,p,1);break}}}function cm(i){var e=i.prev,s=i,l=i.next;if(kn(e,s,l)>=0)return!1;for(var u=i.next.next;u!==i.prev;){if(sl(e.x,e.y,s.x,s.y,l.x,l.y,u.x,u.y)&&kn(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function Ps(i,e,s,l){var u=i.prev,p=i,_=i.next;if(kn(u,p,_)>=0)return!1;for(var v=u.x>p.x?u.x>_.x?u.x:_.x:p.x>_.x?p.x:_.x,w=u.y>p.y?u.y>_.y?u.y:_.y:p.y>_.y?p.y:_.y,T=pm(u.x<p.x?u.x<_.x?u.x:_.x:p.x<_.x?p.x:_.x,u.y<p.y?u.y<_.y?u.y:_.y:p.y<_.y?p.y:_.y,e,s,l),M=pm(v,w,e,s,l),S=i.prevZ,A=i.nextZ;S&&S.z>=T&&A&&A.z<=M;){if(S!==i.prev&&S!==i.next&&sl(u.x,u.y,p.x,p.y,_.x,_.y,S.x,S.y)&&kn(S.prev,S,S.next)>=0||(S=S.prevZ,A!==i.prev&&A!==i.next&&sl(u.x,u.y,p.x,p.y,_.x,_.y,A.x,A.y)&&kn(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;S&&S.z>=T;){if(S!==i.prev&&S!==i.next&&sl(u.x,u.y,p.x,p.y,_.x,_.y,S.x,S.y)&&kn(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;A&&A.z<=M;){if(A!==i.prev&&A!==i.next&&sl(u.x,u.y,p.x,p.y,_.x,_.y,A.x,A.y)&&kn(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function Xu(i,e,s){var l=i;do{var u=l.prev,p=l.next.next;!Ep(u,p)&&h_(u,l,l.next,p)&&Yu(u,p)&&Yu(p,u)&&(e.push(u.i/s),e.push(l.i/s),e.push(p.i/s),Kc(l),Kc(l.next),l=i=p),l=l.next}while(l!==i);return il(l)}function um(i,e,s,l,u,p){var _=i;do{for(var v=_.next.next;v!==_.prev;){if(_.i!==v.i&&wp(_,v)){var w=fm(_,v);return _=il(_,_.next),w=il(w,w.next),ol(_,e,s,l,u,p),void ol(w,e,s,l,u,p)}v=v.next}_=_.next}while(_!==i)}function hm(i,e){return i.x-e.x}function dm(i,e){var s=function(p,_){var v,w=_,T=p.x,M=p.y,S=-1/0;do{if(M<=w.y&&M>=w.next.y&&w.next.y!==w.y){var A=w.x+(M-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(A<=T&&A>S){if(S=A,A===T){if(M===w.y)return w;if(M===w.next.y)return w.next}v=w.x<w.next.x?w:w.next}}w=w.next}while(w!==_);if(!v)return null;if(T===S)return v;var z,N=v,U=v.x,q=v.y,Y=1/0;w=v;do{T>=w.x&&w.x>=U&&T!==w.x&&sl(M<q?T:S,M,U,q,M<q?S:T,M,w.x,w.y)&&(z=Math.abs(M-w.y)/(T-w.x),Yu(w,p)&&(z<Y||z===Y&&(w.x>v.x||w.x===v.x&&Uv(v,w)))&&(v=w,Y=z)),w=w.next}while(w!==N);return v}(i,e);if(!s)return e;var l=fm(s,i),u=il(s,s.next);return il(l,l.next),e===s?u:e}function Uv(i,e){return kn(i.prev,i,e.prev)<0&&kn(e.next,i,i.next)<0}function pm(i,e,s,l,u){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-s)*u)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-l)*u)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $v(i){var e=i,s=i;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==i);return s}function sl(i,e,s,l,u,p,_,v){return(u-_)*(e-v)-(i-_)*(p-v)>=0&&(i-_)*(l-v)-(s-_)*(e-v)>=0&&(s-_)*(p-v)-(u-_)*(l-v)>=0}function wp(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(s,l){var u=s;do{if(u.i!==s.i&&u.next.i!==s.i&&u.i!==l.i&&u.next.i!==l.i&&h_(u,u.next,s,l))return!0;u=u.next}while(u!==s);return!1}(i,e)&&(Yu(i,e)&&Yu(e,i)&&function(s,l){var u=s,p=!1,_=(s.x+l.x)/2,v=(s.y+l.y)/2;do{u.y>v!=u.next.y>v&&u.next.y!==u.y&&_<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next}while(u!==s);return p}(i,e)&&(kn(i.prev,i,e.prev)||kn(i,e.prev,e))||Ep(i,e)&&kn(i.prev,i,i.next)>0&&kn(e.prev,e,e.next)>0)}function kn(i,e,s){return(e.y-i.y)*(s.x-e.x)-(e.x-i.x)*(s.y-e.y)}function Ep(i,e){return i.x===e.x&&i.y===e.y}function h_(i,e,s,l){var u=Jh(kn(i,e,s)),p=Jh(kn(i,e,l)),_=Jh(kn(s,l,i)),v=Jh(kn(s,l,e));return u!==p&&_!==v||!(0!==u||!Ku(i,s,e))||!(0!==p||!Ku(i,l,e))||!(0!==_||!Ku(s,i,l))||!(0!==v||!Ku(s,e,l))}function Ku(i,e,s){return e.x<=Math.max(i.x,s.x)&&e.x>=Math.min(i.x,s.x)&&e.y<=Math.max(i.y,s.y)&&e.y>=Math.min(i.y,s.y)}function Jh(i){return i>0?1:i<0?-1:0}function Yu(i,e){return kn(i.prev,i,i.next)<0?kn(i,e,i.next)>=0&&kn(i,i.prev,e)>=0:kn(i,e,i.prev)<0||kn(i,i.next,e)<0}function fm(i,e){var s=new Yc(i.i,i.x,i.y),l=new Yc(e.i,e.x,e.y),u=i.next,p=e.prev;return i.next=e,e.prev=i,s.next=u,u.prev=s,l.next=s,s.prev=l,p.next=l,l.prev=p,l}function mm(i,e,s,l){var u=new Yc(i,e,s);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function Kc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Yc(i,e,s){this.i=i,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Tp(i,e,s,l){for(var u=0,p=e,_=s-l;p<s;p+=l)u+=(i[_]-i[p])*(i[p+1]+i[_+1]),_=p;return u}function Dp(i,e,s,l,u){gm(i,e,s||0,l||i.length-1,u||d_)}function gm(i,e,s,l,u){for(;l>s;){if(l-s>600){var p=l-s+1,_=e-s+1,v=Math.log(p),w=.5*Math.exp(2*v/3),T=.5*Math.sqrt(v*w*(p-w)/p)*(_-p/2<0?-1:1);gm(i,e,Math.max(s,Math.floor(e-_*w/p+T)),Math.min(l,Math.floor(e+(p-_)*w/p+T)),u)}var M=i[e],S=s,A=l;for(Vn(i,s,e),u(i[l],M)>0&&Vn(i,s,l);S<A;){for(Vn(i,S,A),S++,A--;u(i[S],M)<0;)S++;for(;u(i[A],M)>0;)A--}0===u(i[s],M)?Vn(i,s,A):Vn(i,++A,l),A<=e&&(s=A+1),e<=A&&(l=A-1)}}function Vn(i,e,s){var l=i[e];i[e]=i[s],i[s]=l}function d_(i,e){return i<e?-1:i>e?1:0}function Cp(i,e){const s=i.length;if(s<=1)return[i];const l=[];let u,p;for(let _=0;_<s;_++){const v=js(i[_]);0!==v&&(i[_].area=Math.abs(v),void 0===p&&(p=v<0),p===v<0?(u&&l.push(u),u=[i[_]]):u.push(i[_]))}if(u&&l.push(u),e>1)for(let _=0;_<l.length;_++)l[_].length<=e||(Dp(l[_],e,1,l[_].length-1,_m),l[_]=l[_].slice(0,e));return l}function _m(i,e){return e.area-i.area}function Qh(i,e,s){const l=s.patternDependencies;let u=!1;for(const p of e){const _=p.paint.get(`${i}-pattern`);_.isConstant()||(u=!0);const v=_.constantOr(null);v&&(u=!0,l[v.to]=!0,l[v.from]=!0)}return u}function Mp(i,e,s,l,u){const p=u.patternDependencies;for(const _ of e){const v=_.paint.get(`${i}-pattern`).value;if("constant"!==v.kind){let w=v.evaluate({zoom:l-1},s,{},u.availableImages),T=v.evaluate({zoom:l},s,{},u.availableImages),M=v.evaluate({zoom:l+1},s,{},u.availableImages);w=w&&w.name?w.name:w,T=T&&T.name?T.name:T,M=M&&M.name?M.name:M,p[w]=!0,p[T]=!0,p[M]=!0,s.patterns[_.id]={min:w,mid:T,max:M}}}return s}Yh.deviation=function(i,e,s,l){var u=e&&e.length,p=Math.abs(Tp(i,0,u?e[0]*s:i.length,s));if(u)for(var _=0,v=e.length;_<v;_++)p-=Math.abs(Tp(i,e[_]*s,_<v-1?e[_+1]*s:i.length,s));var w=0;for(_=0;_<l.length;_+=3){var T=l[_]*s,M=l[_+1]*s,S=l[_+2]*s;w+=Math.abs((i[T]-i[S])*(i[M+1]-i[T+1])-(i[T]-i[M])*(i[S+1]-i[T+1]))}return 0===p&&0===w?0:Math.abs((w-p)/p)},Yh.flatten=function(i){for(var e=i[0][0].length,s={vertices:[],holes:[],dimensions:e},l=0,u=0;u<i.length;u++){for(var p=0;p<i[u].length;p++)for(var _=0;_<e;_++)s.vertices.push(i[u][p][_]);u>0&&s.holes.push(l+=i[u-1].length)}return s},Kh.default=c_;class ed{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new jl,this.indexArray=new fi,this.indexArray2=new eo,this.programConfigurations=new la(e.layers,e.zoom),this.segments=new Xn,this.segments2=new Xn,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,l,u){this.hasPattern=Qh("fill",this.layers,s);const p=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:w,index:T,sourceLayerIndex:M}of e){const S=this.layers[0]._featureFilter.needGeometry,A=ql(v,S);if(!this.layers[0]._featureFilter.filter(new gt(this.zoom),A,l))continue;const z=p?p.evaluate(A,{},l,s.availableImages):void 0,N={id:w,properties:v.properties,type:v.type,sourceLayerIndex:M,index:T,geometry:S?A.geometry:Ss(v,l,u),patterns:{},sortKey:z};_.push(N)}p&&_.sort((v,w)=>v.sortKey-w.sortKey);for(const v of _){const{geometry:w,index:T,sourceLayerIndex:M}=v;if(this.hasPattern){const S=Mp("fill",this.layers,v,this.zoom,s);this.patternFeatures.push(S)}else this.addFeature(v,w,T,l,{},s.availableImages);s.featureIndex.insert(e[T].feature,w,T,M,this.index)}}update(e,s,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,u)}addFeatures(e,s,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,l_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,s,l,u,p,_=[]){for(const v of Cp(s,500)){let w=0;for(const N of v)w+=N.length;const T=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),M=T.vertexLength,S=[],A=[];for(const N of v){if(0===N.length)continue;N!==v[0]&&A.push(S.length/2);const U=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),q=U.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(q+N.length-1,q),S.push(N[0].x),S.push(N[0].y);for(let Y=1;Y<N.length;Y++)this.layoutVertexArray.emplaceBack(N[Y].x,N[Y].y),this.indexArray2.emplaceBack(q+Y-1,q+Y),S.push(N[Y].x),S.push(N[Y].y);U.vertexLength+=N.length,U.primitiveLength+=N.length}const z=Kh(S,A);for(let N=0;N<z.length;N+=3)this.indexArray.emplaceBack(M+z[N],M+z[N+1],M+z[N+2]);T.vertexLength+=w,T.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,_,u)}}Ye("FillBucket",ed,{omit:["layers","patternFeatures"]});const p_=new Wn({"fill-sort-key":new at(be.layout_fill["fill-sort-key"])});var f_={paint:new Wn({"fill-antialias":new et(be.paint_fill["fill-antialias"]),"fill-opacity":new at(be.paint_fill["fill-opacity"]),"fill-color":new at(be.paint_fill["fill-color"]),"fill-outline-color":new at(be.paint_fill["fill-outline-color"]),"fill-translate":new et(be.paint_fill["fill-translate"]),"fill-translate-anchor":new et(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new sr(be.paint_fill["fill-pattern"])}),layout:p_};const m_=In([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Gv=In([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Hv}=m_;var Jc=_r;function _r(i,e,s,l,u){this.properties={},this.extent=s,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=u,i.readFields(Ip,this,e)}function Ip(i,e,s){1==i?e.id=s.readVarint():2==i?function(l,u){for(var p=l.readVarint()+l.pos;l.pos<p;){var _=u._keys[l.readVarint()],v=u._values[l.readVarint()];u.properties[_]=v}}(s,e):3==i?e.type=s.readVarint():4==i&&(e._geometry=s.pos)}function ym(i){for(var e,s,l=0,u=0,p=i.length,_=p-1;u<p;_=u++)l+=((s=i[_]).x-(e=i[u]).x)*(e.y+s.y);return l}_r.types=["Unknown","Point","LineString","Polygon"],_r.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,s=i.readVarint()+i.pos,l=1,u=0,p=0,_=0,v=[];i.pos<s;){if(u<=0){var w=i.readVarint();l=7&w,u=w>>3}if(u--,1===l||2===l)p+=i.readSVarint(),_+=i.readSVarint(),1===l&&(e&&v.push(e),e=[]),e.push(new We(p,_));else{if(7!==l)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&v.push(e),v},_r.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,s=1,l=0,u=0,p=0,_=1/0,v=-1/0,w=1/0,T=-1/0;i.pos<e;){if(l<=0){var M=i.readVarint();s=7&M,l=M>>3}if(l--,1===s||2===s)(u+=i.readSVarint())<_&&(_=u),u>v&&(v=u),(p+=i.readSVarint())<w&&(w=p),p>T&&(T=p);else if(7!==s)throw new Error("unknown command "+s)}return[_,w,v,T]},_r.prototype.toGeoJSON=function(i,e,s){var l,u,p=this.extent*Math.pow(2,s),_=this.extent*i,v=this.extent*e,w=this.loadGeometry(),T=_r.types[this.type];function M(z){for(var N=0;N<z.length;N++){var U=z[N];z[N]=[360*(U.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var S=[];for(l=0;l<w.length;l++)S[l]=w[l][0];M(w=S);break;case 2:for(l=0;l<w.length;l++)M(w[l]);break;case 3:for(w=function(z){var N=z.length;if(N<=1)return[z];for(var U,q,Y=[],ie=0;ie<N;ie++){var ce=ym(z[ie]);0!==ce&&(void 0===q&&(q=ce<0),q===ce<0?(U&&Y.push(U),U=[z[ie]]):U.push(z[ie]))}return U&&Y.push(U),Y}(w),l=0;l<w.length;l++)for(u=0;u<w[l].length;u++)M(w[l][u])}1===w.length?w=w[0]:T="Multi"+T;var A={type:"Feature",geometry:{type:T,coordinates:w},properties:this.properties};return"id"in this&&(A.id=this.id),A};var Sp=Hr;function Hr(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Ju,this,e),this.length=this._features.length}function Ju(i,e,s){15===i?e.version=s.readVarint():1===i?e.name=s.readString():5===i?e.extent=s.readVarint():2===i?e._features.push(s.pos):3===i?e._keys.push(s.readString()):4===i&&e._values.push(function(l){for(var u=null,p=l.readVarint()+l.pos;l.pos<p;){var _=l.readVarint()>>3;u=1===_?l.readString():2===_?l.readFloat():3===_?l.readDouble():4===_?l.readVarint64():5===_?l.readVarint():6===_?l.readSVarint():7===_?l.readBoolean():null}return u}(s))}function Ap(i,e,s){if(3===i){var l=new Sp(s,s.readVarint()+s.pos);l.length&&(e[l.name]=l)}}Hr.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Jc(this._pbf,e,this.extent,this._keys,this._values)};var Wl={VectorTile:function(i,e){this.layers=i.readFields(Ap,{},e)},VectorTileFeature:Jc,VectorTileLayer:Sp};const g_=Wl.VectorTileFeature.types,vm=Math.pow(2,13);function Qu(i,e,s,l,u,p,_,v){i.emplaceBack((e<<1)+_,(s<<1)+p,(Math.floor(l*vm)<<1)+u,Math.round(v))}class Pp{constructor(){this.acc=new We(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new We(e.x,e.y),this.max=new We(e.x,e.y))}append(e,s){this.currentPolyCount.edges++,this.acc._add(e);let l=!!this.borders;const u=this.min,p=this.max;e.x<u.x?(u.x=e.x,l=!0):e.x>p.x&&(p.x=e.x,l=!0),e.y<u.y?(u.y=e.y,l=!0):e.y>p.y&&(p.y=e.y,l=!0),((0===e.x||e.x===Dt)&&e.x===s.x)!=((0===e.y||e.y===Dt)&&e.y===s.y)&&this.processBorderOverlap(e,s),l&&this.checkBorderIntersection(e,s)}checkBorderIntersection(e,s){s.x<0!=e.x<0&&this.addBorderIntersection(0,Xt(s.y,e.y,(0-s.x)/(e.x-s.x))),s.x>Dt!=e.x>Dt&&this.addBorderIntersection(1,Xt(s.y,e.y,(Dt-s.x)/(e.x-s.x))),s.y<0!=e.y<0&&this.addBorderIntersection(2,Xt(s.x,e.x,(0-s.y)/(e.y-s.y))),s.y>Dt!=e.y>Dt&&this.addBorderIntersection(3,Xt(s.x,e.x,(Dt-s.y)/(e.y-s.y)))}addBorderIntersection(e,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];s<l[0]&&(l[0]=s),s>l[1]&&(l[1]=s)}processBorderOverlap(e,s){if(e.x===s.x){if(e.y===s.y)return;const l=0===e.x?0:1;this.addBorderIntersection(l,s.y),this.addBorderIntersection(l,e.y)}else{const l=0===e.y?2:3;this.addBorderIntersection(l,s.x),this.addBorderIntersection(l,e.x)}}centroid(){const e=this.polyCount.reduce((s,l)=>s+l.edges,0);return 0!==e?this.acc.div(e)._round():new We(0,0)}span(){return new We(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,s)=>e+ +(s[0]!==Number.MAX_VALUE),0)}}class kp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ul,this.centroidVertexArray=new Uc,this.indexArray=new fi,this.programConfigurations=new la(e.layers,e.zoom),this.segments=new Xn,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=e.enableTerrain}populate(e,s,l,u){this.features=[],this.hasPattern=Qh("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(p){const _=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*_/(_*_+1)/Dt/(1<<p.z)}(l);for(const{feature:p,id:_,index:v,sourceLayerIndex:w}of e){const T=this.layers[0]._featureFilter.needGeometry,M=ql(p,T);if(!this.layers[0]._featureFilter.filter(new gt(this.zoom),M,l))continue;const S={id:_,sourceLayerIndex:w,index:v,geometry:T?M.geometry:Ss(p,l,u),properties:p.properties,type:p.type,patterns:{}},A=this.layoutVertexArray.length;this.hasPattern?this.features.push(Mp("fill-extrusion",this.layers,S,this.zoom,s)):this.addFeature(S,S.geometry,v,l,{},s.availableImages),s.featureIndex.insert(p,S.geometry,v,w,this.index,A)}this.sortBorders()}addFeatures(e,s,l,u){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,s,l,u)}this.sortBorders()}update(e,s,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hv),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Gv.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,s,l,u,p,_){const v=this.enableTerrain?new Pp:null;for(const T of Cp(s,500)){let M=0,S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===T.length||(w=T[0]).every(q=>q.x<=0)||w.every(q=>q.x>=Dt)||w.every(q=>q.y<=0)||w.every(q=>q.y>=Dt))continue;for(let q=0;q<T.length;q++){const Y=T[q];if(0===Y.length)continue;M+=Y.length;let ie=0;v&&v.startRing(Y[0]);for(let ce=0;ce<Y.length;ce++){const he=Y[ce];if(ce>=1){const fe=Y[ce-1];if(!xm(he,fe)){v&&v.append(he,fe),S.vertexLength+4>Xn.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const me=he.sub(fe)._perp(),Ce=me.x/(Math.abs(me.x)+Math.abs(me.y)),Ee=me.y>0?1:0,$e=fe.dist(he);ie+$e>32768&&(ie=0),Qu(this.layoutVertexArray,he.x,he.y,Ce,Ee,0,0,ie),Qu(this.layoutVertexArray,he.x,he.y,Ce,Ee,0,1,ie),ie+=$e,Qu(this.layoutVertexArray,fe.x,fe.y,Ce,Ee,0,0,ie),Qu(this.layoutVertexArray,fe.x,fe.y,Ce,Ee,0,1,ie);const Oe=S.vertexLength;this.indexArray.emplaceBack(Oe,Oe+2,Oe+1),this.indexArray.emplaceBack(Oe+1,Oe+2,Oe+3),S.vertexLength+=4,S.primitiveLength+=2}}}}if(S.vertexLength+M>Xn.MAX_VERTEX_ARRAY_LENGTH&&(S=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray)),"Polygon"!==g_[e.type])continue;const A=[],z=[],N=S.vertexLength;for(let q=0;q<T.length;q++){const Y=T[q];if(0!==Y.length){Y!==T[0]&&z.push(A.length/2);for(let ie=0;ie<Y.length;ie++){const ce=Y[ie];Qu(this.layoutVertexArray,ce.x,ce.y,0,0,1,1,0),A.push(ce.x),A.push(ce.y),v&&v.currentPolyCount.top++}}}const U=Kh(A,z);for(let q=0;q<U.length;q+=3)this.indexArray.emplaceBack(N+U[q],N+U[q+2],N+U[q+1]);S.primitiveLength+=U.length/3,S.vertexLength+=M}var w;if(v&&v.polyCount.length>0){if(v.borders){v.vertexArrayOffset=this.centroidVertexArray.length;const T=v.borders,M=this.featuresOnBorder.push(v)-1;for(let S=0;S<4;S++)T[S][0]!==Number.MAX_VALUE&&this.borders[S].push(M)}this.encodeCentroid(v.borders?void 0:v.centroid(),v)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,_,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((s,l)=>this.featuresOnBorder[s].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}encodeCentroid(e,s,l=!0){let u,p;if(e)if(0!==e.y){const v=s.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(v.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else u=Math.ceil(7*(e.x+450)),p=0;else u=0,p=+l;let _=l?this.centroidVertexArray.length:s.vertexArrayOffset;for(const v of s.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let w=0;w<2*v.edges;w++)this.centroidVertexArray.emplace(_++,0,p),this.centroidVertexArray.emplace(_++,u,p);for(let w=0;w<v.top;w++)this.centroidVertexArray.emplace(_++,u,p)}}}function xm(i,e){return i.x===e.x&&(i.x<0||i.x>Dt)||i.y===e.y&&(i.y<0||i.y>Dt)}Ye("FillExtrusionBucket",kp,{omit:["layers","features"]}),Ye("PartMetadata",Pp);var __={paint:new Wn({"fill-extrusion-opacity":new et(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new at(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new et(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new et(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sr(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new at(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new at(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new et(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function eh(i,e){return i.x*e.x+i.y*e.y}function td(i,e){if(1===i.length){let s=0;const l=e[s++];let u;for(;!u||l.equals(u);)if(u=e[s++],!u)return 1/0;for(;s<e.length;s++){const p=e[s],_=i[0],v=u.sub(l),w=p.sub(l),T=_.sub(l),M=eh(v,v),S=eh(v,w),A=eh(w,w),z=eh(T,v),N=eh(T,w),U=M*A-S*S,q=(A*z-S*N)/U,Y=(M*N-S*z)/U,ie=l.z*(1-q-Y)+u.z*q+p.z*Y;if(isFinite(ie))return ie}return 1/0}{let s=1/0;for(const l of e)s=Math.min(s,l.z);return s}}function bm(i){const e=new We(i[0],i[1]);return e.z=i[2],e}function y_(i,e,s,l,u,p,_,v){const w=_*u.getElevationAt(i,e,!0,!0),T=0!==p[0],M=T?0===p[1]?_*(p[0]/7-450):_*function(S,A,z){const N=Math.floor(A[0]/8),U=Math.floor(A[1]/8),q=10*(A[0]-8*N),Y=10*(A[1]-8*U),ie=S.getElevationAt(N,U,!0,!0),ce=S.getMeterToDEM(z),he=Math.floor(.5*(q*ce-1)),fe=Math.floor(.5*(Y*ce-1)),me=S.tileCoordToPixel(N,U),Ce=2*he+1,Ee=2*fe+1,$e=(fn=Ce,yt=Ee,[(Ke=S).getElevationAtPixel(Je=me.x-he,Ht=me.y-fe,!0),Ke.getElevationAtPixel(Je+yt,Ht,!0),Ke.getElevationAtPixel(Je,Ht+yt,!0),Ke.getElevationAtPixel(Je+fn,Ht+yt,!0)]),Oe=Math.abs($e[0]-$e[1]),Te=Math.abs($e[2]-$e[3]),Ve=Math.abs($e[0]-$e[2])+Math.abs($e[1]-$e[3]),Ze=Math.min(.25,.5*ce*(Oe+Te)/Ce),Ie=Math.min(.25,.5*ce*Ve/Ee);var Ke,Je,Ht,fn,yt;return ie+Math.max(Ze*q,Ie*Y)}(u,p,v):w;return{base:w+(0===s)?-1:s,top:T?Math.max(M+l,w+s+2):w+l}}const Lp=In([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:v_}=Lp,x_=In([{name:"a_packed",components:3,type:"Float32"}]),{members:Qc}=x_,b_=Wl.VectorTileFeature.types,w_=Math.cos(Math.PI/180*37.5);class nd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(s=>s.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Rh,this.layoutVertexArray2=new Nc,this.indexArray=new fi,this.programConfigurations=new la(e.layers,e.zoom),this.segments=new Xn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(e,s,l,u){this.hasPattern=Qh("line",this.layers,s);const p=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:M,id:S,index:A,sourceLayerIndex:z}of e){const N=this.layers[0]._featureFilter.needGeometry,U=ql(M,N);if(!this.layers[0]._featureFilter.filter(new gt(this.zoom),U,l))continue;const q=p?p.evaluate(U,{},l):void 0,Y={id:S,properties:M.properties,type:M.type,sourceLayerIndex:z,index:A,geometry:N?U.geometry:Ss(M,l,u),patterns:{},sortKey:q};_.push(Y)}p&&_.sort((M,S)=>M.sortKey-S.sortKey);const{lineAtlas:v,featureIndex:w}=s,T=this.addConstantDashes(v);for(const M of _){const{geometry:S,index:A,sourceLayerIndex:z}=M;if(T&&this.addFeatureDashes(M,v),this.hasPattern){const N=Mp("line",this.layers,M,this.zoom,s);this.patternFeatures.push(N)}else this.addFeature(M,S,A,l,v.positions,s.availableImages);w.insert(e[A].feature,S,A,z,this.index)}}addConstantDashes(e){let s=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==p.kind)s=!0;else{const _=p.value,v=u.value;if(!v)continue;e.addDash(v.from,_),e.addDash(v.to,_),v.other&&e.addDash(v.other,_)}}return s}addFeatureDashes(e,s){const l=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if("constant"===p.kind&&"constant"===_.kind)continue;let v,w,T,M,S,A;if("constant"===p.kind){const q=p.value;if(!q)continue;v=q.other||q.to,w=q.to,T=q.from}else v=p.evaluate({zoom:l-1},e),w=p.evaluate({zoom:l},e),T=p.evaluate({zoom:l+1},e);"constant"===_.kind?M=S=A=_.value:(M=_.evaluate({zoom:l-1},e),S=_.evaluate({zoom:l},e),A=_.evaluate({zoom:l+1},e)),s.addDash(v,M),s.addDash(w,S),s.addDash(T,A);const z=s.getKey(v,M),N=s.getKey(w,S),U=s.getKey(T,A);e.patterns[u.id]={min:z,mid:N,max:U}}}update(e,s,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,s,this.stateDependentLayers,l,u)}addFeatures(e,s,l,u){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,s,l,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Qc)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,v_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,s,l,u,p,_){const v=this.layers[0].layout,w=v.get("line-join").evaluate(e,{}),T=v.get("line-cap").evaluate(e,{}),M=v.get("line-miter-limit"),S=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const A of s)this.addLine(A,e,w,T,M,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,_,u)}addLine(e,s,l,u,p,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v="Polygon"===b_[s.type];let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let T=0;for(;T<w-1&&e[T].equals(e[T+1]);)T++;if(w<(v?3:2))return;"bevel"===l&&(p=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,S=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let A,z,N,U,q;this.e1=this.e2=-1,v&&(A=e[w-2],q=e[T].sub(A)._unit()._perp());for(let Y=T;Y<w;Y++){if(N=Y===w-1?v?e[T+1]:void 0:e[Y+1],N&&e[Y].equals(N))continue;q&&(U=q),A&&(z=A),A=e[Y],q=N?N.sub(A)._unit()._perp():U,U=U||q;let ie=U.add(q);0===ie.x&&0===ie.y||ie._unit();const ce=U.x*q.x+U.y*q.y,he=ie.x*q.x+ie.y*q.y,fe=0!==he?1/he:1/0,me=2*Math.sqrt(2-2*he),Ce=he<w_&&z&&N,Ee=U.x*q.y-U.y*q.x>0;if(Ce&&Y>T){const Te=A.dist(z);if(Te>2*M){const Ve=A.sub(A.sub(z)._mult(M/Te)._round());this.updateDistance(z,Ve),this.addCurrentVertex(Ve,U,0,0,S),z=Ve}}const $e=z&&N;let Oe=$e?l:v?"butt":u;if($e&&"round"===Oe&&(fe<_?Oe="miter":fe<=2&&(Oe="fakeround")),"miter"===Oe&&fe>p&&(Oe="bevel"),"bevel"===Oe&&(fe>2&&(Oe="flipbevel"),fe<p&&(Oe="miter")),z&&this.updateDistance(z,A),"miter"===Oe)ie._mult(fe),this.addCurrentVertex(A,ie,0,0,S);else if("flipbevel"===Oe){if(fe>100)ie=q.mult(-1);else{const Te=fe*U.add(q).mag()/U.sub(q).mag();ie._perp()._mult(Te*(Ee?-1:1))}this.addCurrentVertex(A,ie,0,0,S),this.addCurrentVertex(A,ie.mult(-1),0,0,S)}else if("bevel"===Oe||"fakeround"===Oe){const Te=-Math.sqrt(fe*fe-1),Ve=Ee?Te:0,Ze=Ee?0:Te;if(z&&this.addCurrentVertex(A,U,Ve,Ze,S),"fakeround"===Oe){const Ie=Math.round(180*me/Math.PI/20);for(let Ke=1;Ke<Ie;Ke++){let Je=Ke/Ie;if(.5!==Je){const fn=Je-.5;Je+=Je*fn*(Je-1)*((1.0904+ce*(ce*(3.55645-1.43519*ce)-3.2452))*fn*fn+(.848013+ce*(.215638*ce-1.06021)))}const Ht=q.sub(U)._mult(Je)._add(U)._unit()._mult(Ee?-1:1);this.addHalfVertex(A,Ht.x,Ht.y,!1,Ee,0,S)}}N&&this.addCurrentVertex(A,q,-Ve,-Ze,S)}else if("butt"===Oe)this.addCurrentVertex(A,ie,0,0,S);else if("square"===Oe){const Te=z?1:-1;z||this.addCurrentVertex(A,ie,Te,Te,S),this.addCurrentVertex(A,ie,0,0,S),z&&this.addCurrentVertex(A,ie,Te,Te,S)}else"round"===Oe&&(z&&(this.addCurrentVertex(A,U,0,0,S),this.addCurrentVertex(A,U,1,1,S,!0)),N&&(this.addCurrentVertex(A,q,-1,-1,S,!0),this.addCurrentVertex(A,q,0,0,S)));if(Ce&&Y<w-1){const Te=A.dist(N);if(Te>2*M){const Ve=A.add(N.sub(A)._mult(M/Te)._round());this.updateDistance(A,Ve),this.addCurrentVertex(Ve,q,0,0,S),A=Ve}}}}addCurrentVertex(e,s,l,u,p,_=!1){const v=s.y*u-s.x,w=-s.y-s.x*u;this.addHalfVertex(e,s.x+s.y*l,s.y-s.x*l,_,!1,l,p),this.addHalfVertex(e,v,w,_,!0,-u,p)}addHalfVertex({x:e,y:s},l,u,p,_,v,w){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(s<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(0===v?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const T=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),w.primitiveLength++),_?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,s){this.distance+=e.dist(s),this.updateScaledDistance()}}Ye("LineBucket",nd,{omit:["layers","patternFeatures"]});const E_=new Wn({"line-cap":new at(be.layout_line["line-cap"]),"line-join":new at(be.layout_line["line-join"]),"line-miter-limit":new et(be.layout_line["line-miter-limit"]),"line-round-limit":new et(be.layout_line["line-round-limit"]),"line-sort-key":new at(be.layout_line["line-sort-key"])});var wm={paint:new Wn({"line-opacity":new at(be.paint_line["line-opacity"]),"line-color":new at(be.paint_line["line-color"]),"line-translate":new et(be.paint_line["line-translate"]),"line-translate-anchor":new et(be.paint_line["line-translate-anchor"]),"line-width":new at(be.paint_line["line-width"]),"line-gap-width":new at(be.paint_line["line-gap-width"]),"line-offset":new at(be.paint_line["line-offset"]),"line-blur":new at(be.paint_line["line-blur"]),"line-dasharray":new sr(be.paint_line["line-dasharray"]),"line-pattern":new sr(be.paint_line["line-pattern"]),"line-gradient":new Ds(be.paint_line["line-gradient"])}),layout:E_};const Rp=new class extends at{possiblyEvaluate(i,e){return e=new gt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,s,l){return e=Fn({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,s,l)}}(wm.paint.properties["line-width"].specification);function Em(i,e){return e>0?e+2*i:i}Rp.useIntegerZoom=!0;const T_=In([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),D_=In([{name:"a_projected_pos",components:3,type:"Float32"}],4);In([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const C_=In([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Tm=In([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);In([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Dm=In([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),M_=In([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);In([{name:"triangle",components:3,type:"Uint16"}]),In([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),In([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),In([{type:"Float32",name:"offsetX"}]),In([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const gi=128;function wo(i,e){const{expression:s}=e;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new gt(i+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:u}=s;let p=0;for(;p<l.length&&l[p]<=i;)p++;p=Math.max(0,p-1);let _=p;for(;_<l.length&&l[_]<i+1;)_++;_=Math.min(l.length-1,_);const v=l[p],w=l[_];return"composite"===s.kind?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:v,maxZoom:w,minSize:s.evaluate(new gt(v)),maxSize:s.evaluate(new gt(w)),interpolationType:u}}}function Fp(i,{uSize:e,uSizeT:s},{lowerSize:l,upperSize:u}){return"source"===i.kind?l/gi:"composite"===i.kind?Xt(l/gi,u/gi,s):e}function th(i,e){let s=0,l=0;if("constant"===i.kind)l=i.layoutSize;else if("source"!==i.kind){const{interpolationType:u,minZoom:p,maxZoom:_}=i,v=u?cn(Tr.interpolationFactor(u,e,p,_),0,1):0;"camera"===i.kind?l=Xt(i.minSize,i.maxSize,v):s=v}return{uSizeT:s,uSize:l}}var Cm=Object.freeze({__proto__:null,getSizeData:wo,evaluateSizeForFeature:Fp,evaluateSizeForZoom:th,SIZE_PACK_FACTOR:gi});function qv(i,e,s){return i.sections.forEach(l=>{l.text=function(u,p,_){const v=p.layout.get("text-transform").evaluate(_,{});return"uppercase"===v?u=u.toLocaleUpperCase():"lowercase"===v&&(u=u.toLocaleLowerCase()),Gt.applyArabicShaping&&(u=Gt.applyArabicShaping(u)),u}(l.text,e,s)}),i}const qr={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function zp(i){return"\ufe36"===i||"\ufe48"===i||"\ufe38"===i||"\ufe44"===i||"\ufe42"===i||"\ufe3e"===i||"\ufe3c"===i||"\ufe3a"===i||"\ufe18"===i||"\ufe40"===i||"\ufe10"===i||"\ufe13"===i||"\ufe14"===i||"\uff40"===i||"\uffe3"===i||"\ufe11"===i||"\ufe12"===i}function Op(i){return"\ufe35"===i||"\ufe47"===i||"\ufe37"===i||"\ufe43"===i||"\ufe41"===i||"\ufe3d"===i||"\ufe3b"===i||"\ufe39"===i||"\ufe17"===i||"\ufe3f"===i}var Mm=function(i,e,s,l,u){var p,_,v=8*u-l-1,w=(1<<v)-1,T=w>>1,M=-7,S=s?u-1:0,A=s?-1:1,z=i[e+S];for(S+=A,p=z&(1<<-M)-1,z>>=-M,M+=v;M>0;p=256*p+i[e+S],S+=A,M-=8);for(_=p&(1<<-M)-1,p>>=-M,M+=l;M>0;_=256*_+i[e+S],S+=A,M-=8);if(0===p)p=1-T;else{if(p===w)return _?NaN:1/0*(z?-1:1);_+=Math.pow(2,l),p-=T}return(z?-1:1)*_*Math.pow(2,p-l)},Bp=function(i,e,s,l,u,p){var _,v,w,T=8*p-u-1,M=(1<<T)-1,S=M>>1,A=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,z=l?0:p-1,N=l?1:-1,U=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,_=M):(_=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-_))<1&&(_--,w*=2),(e+=_+S>=1?A/w:A*Math.pow(2,1-S))*w>=2&&(_++,w/=2),_+S>=M?(v=0,_=M):_+S>=1?(v=(e*w-1)*Math.pow(2,u),_+=S):(v=e*Math.pow(2,S-1)*Math.pow(2,u),_=0));u>=8;i[s+z]=255&v,z+=N,v/=256,u-=8);for(_=_<<u|v,T+=u;T>0;i[s+z]=255&_,z+=N,_/=256,T-=8);i[s+z-N]|=128*U},ha=hn;function hn(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}hn.Varint=0,hn.Fixed64=1,hn.Bytes=2,hn.Fixed32=5;var rd=4294967296,id=1/rd,od="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function ks(i){return i.type===hn.Bytes?i.readVarint()+i.pos:i.pos+1}function Xl(i,e,s){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));s.realloc(l);for(var u=s.pos-1;u>=i;u--)s.buf[u+l]=s.buf[u]}function Np(i,e){for(var s=0;s<i.length;s++)e.writeVarint(i[s])}function Im(i,e){for(var s=0;s<i.length;s++)e.writeSVarint(i[s])}function I_(i,e){for(var s=0;s<i.length;s++)e.writeFloat(i[s])}function Vp(i,e){for(var s=0;s<i.length;s++)e.writeDouble(i[s])}function S_(i,e){for(var s=0;s<i.length;s++)e.writeBoolean(i[s])}function A_(i,e){for(var s=0;s<i.length;s++)e.writeFixed32(i[s])}function P_(i,e){for(var s=0;s<i.length;s++)e.writeSFixed32(i[s])}function k_(i,e){for(var s=0;s<i.length;s++)e.writeFixed64(i[s])}function L_(i,e){for(var s=0;s<i.length;s++)e.writeSFixed64(i[s])}function sd(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Kl(i,e,s){i[s]=e,i[s+1]=e>>>8,i[s+2]=e>>>16,i[s+3]=e>>>24}function ad(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function Sm(i,e,s){e.glyphs=[],1===i&&s.readMessage(jp,e)}function jp(i,e,s){if(3===i){const{id:l,bitmap:u,width:p,height:_,left:v,top:w,advance:T}=s.readMessage(R_,{});e.glyphs.push({id:l,bitmap:new Zl({width:p+6,height:_+6},u),metrics:{width:p,height:_,left:v,top:w,advance:T}})}else 4===i?e.ascender=s.readSVarint():5===i&&(e.descender=s.readSVarint())}function R_(i,e,s){1===i?e.id=s.readVarint():2===i?e.bitmap=s.readBytes():3===i?e.width=s.readVarint():4===i?e.height=s.readVarint():5===i?e.left=s.readSVarint():6===i?e.top=s.readSVarint():7===i&&(e.advance=s.readVarint())}function Up(i){let e=0,s=0;for(const _ of i)e+=_.w*_.h,s=Math.max(s,_.w);i.sort((_,v)=>v.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),s),h:1/0}];let u=0,p=0;for(const _ of i)for(let v=l.length-1;v>=0;v--){const w=l[v];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,p=Math.max(p,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===w.w&&_.h===w.h){const T=l.pop();v<l.length&&(l[v]=T)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(l.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}hn.prototype={destroy:function(){this.buf=null},readFields:function(i,e,s){for(s=s||this.length;this.pos<s;){var l=this.readVarint(),u=l>>3,p=this.pos;this.type=7&l,i(u,e,this),this.pos===p&&this.skip(l)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=sd(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=ad(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=sd(this.buf,this.pos)+sd(this.buf,this.pos+4)*rd;return this.pos+=8,i},readSFixed64:function(){var i=sd(this.buf,this.pos)+ad(this.buf,this.pos+4)*rd;return this.pos+=8,i},readFloat:function(){var i=Mm(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Mm(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,s,l=this.buf;return e=127&(s=l[this.pos++]),s<128?e:(e|=(127&(s=l[this.pos++]))<<7,s<128?e:(e|=(127&(s=l[this.pos++]))<<14,s<128?e:(e|=(127&(s=l[this.pos++]))<<21,s<128?e:function(u,p,_){var v,w,T=_.buf;if(v=(112&(w=T[_.pos++]))>>4,w<128||(v|=(127&(w=T[_.pos++]))<<3,w<128)||(v|=(127&(w=T[_.pos++]))<<10,w<128)||(v|=(127&(w=T[_.pos++]))<<17,w<128)||(v|=(127&(w=T[_.pos++]))<<24,w<128)||(v|=(1&(w=T[_.pos++]))<<31,w<128))return function nh(i,e,s){return s?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}(u,v,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(s=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&od?od.decode(this.buf.subarray(e,i)):function(s,l,u){for(var p="",_=l;_<u;){var v,w,T,M=s[_],S=null,A=M>239?4:M>223?3:M>191?2:1;if(_+A>u)break;1===A?M<128&&(S=M):2===A?128==(192&(v=s[_+1]))&&(S=(31&M)<<6|63&v)<=127&&(S=null):3===A?(w=s[_+2],128==(192&(v=s[_+1]))&&128==(192&w)&&((S=(15&M)<<12|(63&v)<<6|63&w)<=2047||S>=55296&&S<=57343)&&(S=null)):4===A&&(w=s[_+2],T=s[_+3],128==(192&(v=s[_+1]))&&128==(192&w)&&128==(192&T)&&((S=(15&M)<<18|(63&v)<<12|(63&w)<<6|63&T)<=65535||S>=1114112)&&(S=null)),null===S?(S=65533,A=1):S>65535&&(S-=65536,p+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),p+=String.fromCharCode(S),_+=A}return p}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==hn.Bytes)return i.push(this.readVarint(e));var s=ks(this);for(i=i||[];this.pos<s;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==hn.Bytes)return i.push(this.readSVarint());var e=ks(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==hn.Bytes)return i.push(this.readBoolean());var e=ks(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==hn.Bytes)return i.push(this.readFloat());var e=ks(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==hn.Bytes)return i.push(this.readDouble());var e=ks(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==hn.Bytes)return i.push(this.readFixed32());var e=ks(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==hn.Bytes)return i.push(this.readSFixed32());var e=ks(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==hn.Bytes)return i.push(this.readFixed64());var e=ks(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==hn.Bytes)return i.push(this.readSFixed64());var e=ks(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===hn.Varint)for(;this.buf[this.pos++]>127;);else if(e===hn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===hn.Fixed32)this.pos+=4;else{if(e!==hn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var s=new Uint8Array(e);s.set(this.buf),this.buf=s,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Kl(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Kl(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Kl(this.buf,-1&i,this.pos),Kl(this.buf,Math.floor(i*id),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Kl(this.buf,-1&i,this.pos),Kl(this.buf,Math.floor(i*id),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,s){var l,u,p,v;if(e>=0?(l=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),p=l,(v=s).buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7),function(p,_){var v=(7&p)<<4;_.buf[_.pos++]|=v|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))}(u,s)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(l,u,p){for(var _,v,w=0;w<u.length;w++){if((_=u.charCodeAt(w))>55295&&_<57344){if(!v){_>56319||w+1===u.length?(l[p++]=239,l[p++]=191,l[p++]=189):v=_;continue}if(_<56320){l[p++]=239,l[p++]=191,l[p++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(l[p++]=239,l[p++]=191,l[p++]=189,v=null);_<128?l[p++]=_:(_<2048?l[p++]=_>>6|192:(_<65536?l[p++]=_>>12|224:(l[p++]=_>>18|240,l[p++]=_>>12&63|128),l[p++]=_>>6&63|128),l[p++]=63&_|128)}return p}(this.buf,i,this.pos);var s=this.pos-e;s>=128&&Xl(e,s,this),this.pos=e-1,this.writeVarint(s),this.pos+=s},writeFloat:function(i){this.realloc(4),Bp(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Bp(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var s=0;s<e;s++)this.buf[this.pos++]=i[s]},writeRawMessage:function(i,e){this.pos++;var s=this.pos;i(e,this);var l=this.pos-s;l>=128&&Xl(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,e,s){this.writeTag(i,hn.Bytes),this.writeRawMessage(e,s)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Np,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Im,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,S_,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,I_,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,Vp,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,A_,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,P_,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,k_,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,L_,e)},writeBytesField:function(i,e){this.writeTag(i,hn.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,hn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,hn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,hn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,hn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,hn.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,hn.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,hn.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,hn.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,hn.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class ld{constructor(e,{pixelRatio:s,version:l,stretchX:u,stretchY:p,content:_}){this.paddedRect=e,this.pixelRatio=s,this.stretchX=u,this.stretchY=p,this.content=_,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class $p{constructor(e,s){const l={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,l,p),this.addImages(s,u,p);const{w:_,h:v}=Up(p),w=new bo({width:_||1,height:v||1});for(const T in e){const M=e[T],S=l[T].paddedRect;bo.copy(M.data,w,{x:0,y:0},{x:S.x+1,y:S.y+1},M.data)}for(const T in s){const M=s[T],S=u[T].paddedRect,A=S.x+1,z=S.y+1,N=M.data.width,U=M.data.height;bo.copy(M.data,w,{x:0,y:0},{x:A,y:z},M.data),bo.copy(M.data,w,{x:0,y:U-1},{x:A,y:z-1},{width:N,height:1}),bo.copy(M.data,w,{x:0,y:0},{x:A,y:z+U},{width:N,height:1}),bo.copy(M.data,w,{x:N-1,y:0},{x:A-1,y:z},{width:1,height:U}),bo.copy(M.data,w,{x:0,y:0},{x:A+N,y:z},{width:1,height:U})}this.image=w,this.iconPositions=l,this.patternPositions=u}addImages(e,s,l){for(const u in e){const p=e[u],_={x:0,y:0,w:p.data.width+2,h:p.data.height+2};l.push(_),s[u]=new ld(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,s){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),s)}patchUpdatedImage(e,s,l){if(!e||!s||e.version===s.version)return;e.version=s.version;const[u,p]=e.tl;l.update(s.data,void 0,{x:u,y:p})}}Ye("ImagePosition",ld),Ye("ImageAtlas",$p);const Dr={horizontal:1,vertical:2,horizontalOnly:3};class eu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,s){const l=new eu;return l.scale=e||1,l.fontStack=s,l}static forImage(e){const s=new eu;return s.imageName=e,s}}class Yl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,s){const l=new Yl;for(let u=0;u<e.sections.length;u++){const p=e.sections[u];p.image?l.addImageSection(p):l.addTextSection(p,s)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(s,l){let u="";for(let p=0;p<s.length;p++){const _=s.charCodeAt(p+1)||null,v=s.charCodeAt(p-1)||null;u+=!l&&(_&&tt(_)&&!qr[s[p+1]]||v&&tt(v)&&!qr[s[p-1]])||!qr[s[p]]?s[p]:qr[s[p]]}return u}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Jl[this.text.charCodeAt(l)];l++)e++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Jl[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(e,s),this.sectionIndex=this.sectionIndex.slice(e,s)}substring(e,s){const l=new Yl;return l.text=this.text.substring(e,s),l.sectionIndex=this.sectionIndex.slice(e,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,s)=>Math.max(e,this.sections[s].scale),0)}addTextSection(e,s){this.text+=e.text,this.sections.push(eu.forText(e.scale,e.fontStack||s));const l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e){const s=e.image?e.image.name:"";if(0===s.length)return void Pn("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(eu.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Pn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Gp(i,e,s,l,u,p,_,v,w,T,M,S,A,z,N,U){const q=Yl.fromFeature(i,u);let Y;S===Dr.vertical&&q.verticalizePunctuation(A);const{processBidirectionalText:ie,processStyledBidirectionalText:ce}=Gt;if(ie&&1===q.sections.length){Y=[];const me=ie(q.toString(),tu(q,T,p,e,l,z,N));for(const Ce of me){const Ee=new Yl;Ee.text=Ce,Ee.sections=q.sections;for(let $e=0;$e<Ce.length;$e++)Ee.sectionIndex.push(0);Y.push(Ee)}}else if(ce){Y=[];const me=ce(q.text,q.sectionIndex,tu(q,T,p,e,l,z,N));for(const Ce of me){const Ee=new Yl;Ee.text=Ce[0],Ee.sectionIndex=Ce[1],Ee.sections=q.sections,Y.push(Ee)}}else Y=function(me,Ce){const Ee=[],$e=me.text;let Oe=0;for(const Te of Ce)Ee.push(me.substring(Oe,Te)),Oe=Te;return Oe<$e.length&&Ee.push(me.substring(Oe,$e.length)),Ee}(q,tu(q,T,p,e,l,z,N));const he=[],fe={positionedLines:he,text:q.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(me,Ce,Ee,$e,Oe,Te,Ve,Ze,Ie,Ke,Je,Ht){let fn=0,yt=0,jt=0;const Be="right"===Ze?1:"left"===Ze?0:.5;let Yt=!1;for(const Qt of Oe){const Ot=Qt.getSections();for(const Sn of Ot){if(Sn.imageName)continue;const Un=Ce[Sn.fontStack];if(Un&&(Yt=void 0!==Un.ascender&&void 0!==Un.descender,!Yt))break}if(!Yt)break}let Zt=0;for(const Qt of Oe){Qt.trim();const Ot=Qt.getMaxScale(),Sn=24*(Ot-1),Un={positionedGlyphs:[],lineOffset:0};me.positionedLines[Zt]=Un;const $n=Un.positionedGlyphs;let Qn=0;if(!Qt.length()){yt+=Te,++Zt;continue}let Wr=0,zi=0;for(let En=0;En<Qt.length();En++){const ar=Qt.getSection(En),ro=Qt.getSectionIndex(En),Or=Qt.getCharCode(En);let Bt=ar.scale,Cr=null,An=null,Br=null,er=24,Nr=0;const ai=!(Ie===Dr.horizontal||!Je&&!De(Or)||Je&&(Jl[Or]||(jn=Or,o(jn)||c(jn)||m(jn)||oe(jn)||Re(jn))));if(ar.imageName){const _i=$e[ar.imageName];if(!_i)continue;Br=ar.imageName,me.iconsInText=me.iconsInText||!0,An=_i.paddedRect;const lr=_i.displaySize;Bt=24*Bt/Ht,Cr={width:lr[0],height:lr[1],left:1,top:-3,advance:ai?lr[1]:lr[0],localGlyph:!1},Nr=Yt?-Cr.height*Bt:24*Ot-17-lr[1]*Bt,er=Cr.advance;const Co=(ai?lr[0]:lr[1])*Bt-24*Ot;Co>0&&Co>Qn&&(Qn=Co)}else{const _i=Ee[ar.fontStack];if(!_i)continue;_i[Or]&&(An=_i[Or]);const lr=Ce[ar.fontStack];if(!lr)continue;const Co=lr.glyphs[Or];if(!Co)continue;if(Cr=Co.metrics,er=8203!==Or?24:0,Yt){const fu=void 0!==lr.ascender?Math.abs(lr.ascender):0,oc=void 0!==lr.descender?Math.abs(lr.descender):0,hh=(fu+oc)*Bt;Wr<hh&&(Wr=hh,zi=(fu-oc)/2*Bt),Nr=-fu*Bt}else Nr=24*(Ot-Bt)-17}ai?(me.verticalizable=!0,$n.push({glyph:Or,imageName:Br,x:fn,y:yt+Nr,vertical:ai,scale:Bt,localGlyph:Cr.localGlyph,fontStack:ar.fontStack,sectionIndex:ro,metrics:Cr,rect:An}),fn+=er*Bt+Ke):($n.push({glyph:Or,imageName:Br,x:fn,y:yt+Nr,vertical:ai,scale:Bt,localGlyph:Cr.localGlyph,fontStack:ar.fontStack,sectionIndex:ro,metrics:Cr,rect:An}),fn+=Cr.advance*Bt+Ke)}0!==$n.length&&(jt=Math.max(fn-Ke,jt),Yt?Wp($n,Be,Qn,zi,Te*Ot/2):Wp($n,Be,Qn,0,Te/2)),fn=0;const Xr=Te*Ot+Qn;Un.lineOffset=Math.max(Qn,Sn),yt+=Xr,++Zt}var jn;const Ln=yt,{horizontalAlign:yr,verticalAlign:Zr}=nu(Ve);(function(Qt,Ot,Sn,Un,$n,Qn){const Wr=(Ot-Sn)*$n,zi=-Qn*Un;for(const Xr of Qt)for(const En of Xr.positionedGlyphs)En.x+=Wr,En.y+=zi})(me.positionedLines,Be,yr,Zr,jt,Ln),me.top+=-Zr*Ln,me.bottom=me.top+Ln,me.left+=-yr*jt,me.right=me.left+jt,me.hasBaseline=Yt}(fe,e,s,l,Y,_,v,w,S,T,A,U),!function(me){for(const Ce of me)if(0!==Ce.positionedGlyphs.length)return!1;return!0}(he)&&fe}const Jl={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},F_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Hp(i,e,s,l,u,p){if(e.imageName){const _=l[e.imageName];return _?_.displaySize[0]*e.scale*24/p+u:0}{const _=s[e.fontStack],v=_&&_.glyphs[i];return v?v.metrics.advance*e.scale+u:0}}function qp(i,e,s,l){const u=Math.pow(i-e,2);return l?i<e?u/2:2*u:u+Math.abs(s)*s}function Am(i,e,s){let l=0;return 10===i&&(l-=1e4),s&&(l+=150),40!==i&&65288!==i||(l+=50),41!==e&&65289!==e||(l+=50),l}function cd(i,e,s,l,u,p){let _=null,v=qp(e,s,u,p);for(const w of l){const T=qp(e-w.x,s,u,p)+w.badness;T<=v&&(_=w,v=T)}return{index:i,x:e,priorBreak:_,badness:v}}function Zp(i){return i?Zp(i.priorBreak).concat(i.index):[]}function tu(i,e,s,l,u,p,_){if("point"!==p)return[];if(!i)return[];const v=[],w=function(A,z,N,U,q,Y){let ie=0;for(let ce=0;ce<A.length();ce++){const he=A.getSection(ce);ie+=Hp(A.getCharCode(ce),he,U,q,z,Y)}return ie/Math.max(1,Math.ceil(ie/N))}(i,e,s,l,u,_),T=i.text.indexOf("\u200b")>=0;let M=0;for(let A=0;A<i.length();A++){const z=i.getSection(A),N=i.getCharCode(A);if(Jl[N]||(M+=Hp(N,z,l,u,e,_)),A<i.length()-1){const U=!((S=N)<11904||!(O(S)||R(S)||xe(S)||Q(S)||W(S)||y(S)||j(S)||C(S)||se(S)||H(S)||G(S)||Le(S)||P(S)||E(S)||x(S)||Z(S)||k(S)||de(S)||re(S)||ne(S)));(F_[N]||U||z.imageName)&&v.push(cd(A+1,M,w,v,Am(N,i.getCharCode(A+1),U&&T),!1))}}var S;return Zp(cd(i.length(),M,w,v,0,!0))}function nu(i){let e=.5,s=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:e,verticalAlign:s}}function Wp(i,e,s,l,u){if(!(e||s||l||u))return;const p=i.length-1,_=i[p],v=(_.x+_.metrics.advance*_.scale)*e;for(let w=0;w<=p;w++)i[w].x-=v,i[w].y+=s+l+u}function Xp(i,e,s){const{horizontalAlign:l,verticalAlign:u}=nu(s),p=e[0]-i.displaySize[0]*l,_=e[1]-i.displaySize[1]*u;return{image:i,top:_,bottom:_+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function Kp(i,e,s,l,u,p){const _=i.image;let v;if(_.content){const q=_.content,Y=_.pixelRatio||1;v=[q[0]/Y,q[1]/Y,_.displaySize[0]-q[2]/Y,_.displaySize[1]-q[3]/Y]}const w=e.left*p,T=e.right*p;let M,S,A,z;"width"===s||"both"===s?(z=u[0]+w-l[3],S=u[0]+T+l[1]):(z=u[0]+(w+T-_.displaySize[0])/2,S=z+_.displaySize[0]);const N=e.top*p,U=e.bottom*p;return"height"===s||"both"===s?(M=u[1]+N-l[0],A=u[1]+U+l[2]):(M=u[1]+(N+U-_.displaySize[1])/2,A=M+_.displaySize[1]),{image:_,top:M,right:S,bottom:A,left:z,collisionPadding:v}}class rs extends We{constructor(e,s,l,u,p){super(e,s),this.angle=u,this.z=l,void 0!==p&&(this.segment=p)}clone(){return new rs(this.x,this.y,this.z,this.angle,this.segment)}}function ru(i,e,s,l,u){if(void 0===e.segment)return!0;let p=e,_=e.segment+1,v=0;for(;v>-s/2;){if(_--,_<0)return!1;v-=i[_].dist(p),p=i[_]}v+=i[_].dist(i[_+1]),_++;const w=[];let T=0;for(;v<s/2;){const M=i[_],S=i[_+1];if(!S)return!1;let A=i[_-1].angleTo(M)-M.angleTo(S);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:A}),T+=A;v-w[0].distance>l;)T-=w.shift().angleDelta;if(T>u)return!1;_++,v+=M.dist(S)}return!0}function Pm(i){let e=0;for(let s=0;s<i.length-1;s++)e+=i[s].dist(i[s+1]);return e}function Yp(i,e,s){return i?.6*e*s:0}function km(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function z_(i,e,s,l,u,p){const _=Yp(s,u,p),v=km(s,l)*p;let w=0;const T=Pm(i)/2;for(let M=0;M<i.length-1;M++){const S=i[M],A=i[M+1],z=S.dist(A);if(w+z>T){const N=(T-w)/z,U=Xt(S.x,A.x,N),q=Xt(S.y,A.y,N),Y=new rs(U,q,0,A.angleTo(S),M);return!_||ru(i,Y,v,_,e)?Y:void 0}w+=z}}function Lm(i,e,s,l,u,p,_,v,w){const T=Yp(l,p,_),M=km(l,u),S=M*_,A=0===i[0].x||i[0].x===w||0===i[0].y||i[0].y===w;return e-S<e/4&&(e=S+e/4),ud(i,A?e/2*v%e:(M/2+2*p)*_*v%e,e,T,s,S,A,!1,w)}function ud(i,e,s,l,u,p,_,v,w){const T=p/2,M=Pm(i);let S=0,A=e-s,z=[];for(let N=0;N<i.length-1;N++){const U=i[N],q=i[N+1],Y=U.dist(q),ie=q.angleTo(U);for(;A+s<S+Y;){A+=s;const ce=(A-S)/Y,he=Xt(U.x,q.x,ce),fe=Xt(U.y,q.y,ce);if(he>=0&&he<w&&fe>=0&&fe<w&&A-T>=0&&A+T<=M){const me=new rs(he,fe,0,ie,N);me._round(),l&&!ru(i,me,p,l,u)||z.push(me)}}S+=Y}return v||z.length||_||(z=ud(i,S/2,s,l,u,p,_,!0,w)),z}function Jp(i,e,s,l,u){const p=[];for(let _=0;_<i.length;_++){const v=i[_];let w;for(let T=0;T<v.length-1;T++){let M=v[T],S=v[T+1];M.x<e&&S.x<e||(M.x<e?M=new We(e,M.y+(e-M.x)/(S.x-M.x)*(S.y-M.y))._round():S.x<e&&(S=new We(e,M.y+(e-M.x)/(S.x-M.x)*(S.y-M.y))._round()),M.y<s&&S.y<s||(M.y<s?M=new We(M.x+(s-M.y)/(S.y-M.y)*(S.x-M.x),s)._round():S.y<s&&(S=new We(M.x+(s-M.y)/(S.y-M.y)*(S.x-M.x),s)._round()),M.x>=l&&S.x>=l||(M.x>=l?M=new We(l,M.y+(l-M.x)/(S.x-M.x)*(S.y-M.y))._round():S.x>=l&&(S=new We(l,M.y+(l-M.x)/(S.x-M.x)*(S.y-M.y))._round()),M.y>=u&&S.y>=u||(M.y>=u?M=new We(M.x+(u-M.y)/(S.y-M.y)*(S.x-M.x),u)._round():S.y>=u&&(S=new We(M.x+(u-M.y)/(S.y-M.y)*(S.x-M.x),u)._round()),w&&M.equals(w[w.length-1])||(w=[M],p.push(w)),w.push(S)))))}}return p}Ye("Anchor",rs);const hd=1e20;function Qp(i,e,s,l,u,p,_,v,w){for(let T=e;T<e+l;T++)Rm(i,s*p+T,p,u,_,v,w);for(let T=s;T<s+u;T++)Rm(i,T*p+e,1,l,_,v,w)}function Rm(i,e,s,l,u,p,_){p[0]=0,_[0]=-hd,_[1]=hd,u[0]=i[e];for(let v=1,w=0,T=0;v<l;v++){u[v]=i[e+v*s];const M=v*v;do{const S=p[w];T=(u[v]-u[S]+M-S*S)/(v-S)/2}while(T<=_[w]&&--w>-1);w++,p[w]=v,_[w]=T,_[w+1]=hd}for(let v=0,w=0;v<l;v++){for(;_[w+1]<v;)w++;const T=p[w],M=v-T;i[e+v*s]=u[T]+M*M}}const dd={none:0,ideographs:1,all:2};class iu{constructor(e,s,l){this.requestManager=e,this.localGlyphMode=s,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,s){const l=[];for(const u in e)for(const p of e[u])l.push({stack:u,id:p});ds(l,({stack:u,id:p},_)=>{let v=this.entries[u];v||(v=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=v.glyphs[p];if(void 0!==w)return void _(null,{stack:u,id:p,glyph:w});if(w=this._tinySDF(v,u,p),w)return v.glyphs[p]=w,void _(null,{stack:u,id:p,glyph:w});const T=Math.floor(p/256);if(256*T>65535)return void _(new Error("glyphs > 65535 not supported"));if(v.ranges[T])return void _(null,{stack:u,id:p,glyph:w});let M=v.requests[T];M||(M=v.requests[T]=[],iu.loadGlyphRange(u,T,this.url,this.requestManager,(S,A)=>{if(A){v.ascender=A.ascender,v.descender=A.descender;for(const z in A.glyphs)this._doesCharSupportLocalGlyph(+z)||(v.glyphs[+z]=A.glyphs[+z]);v.ranges[T]=!0}for(const z of M)z(S,A);delete v.requests[T]})),M.push((S,A)=>{S?_(S):A&&_(null,{stack:u,id:p,glyph:A.glyphs[p]||null})})},(u,p)=>{if(u)s(u);else if(p){const _={};for(const{stack:v,id:w,glyph:T}of p)void 0===_[v]&&(_[v]={}),void 0===_[v].glyphs&&(_[v].glyphs={}),_[v].glyphs[w]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},_[v].ascender=this.entries[v].ascender,_[v].descender=this.entries[v].descender;s(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==dd.none&&(this.localGlyphMode===dd.all?!!this.localFontFamily:!!this.localFontFamily&&(H(e)||te(e)||P(e)||k(e))||C(e))}_tinySDF(e,s,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let U="400";/bold/i.test(s)?U="900":/medium/i.test(s)?U="500":/light/i.test(s)&&(U="200"),p=e.tinySDF=new iu.TinySDF({fontFamily:u,fontWeight:U,fontSize:48,buffer:6,radius:16}),p.fontWeight=U}if(this.localGlyphs[p.fontWeight][l])return this.localGlyphs[p.fontWeight][l];const _=String.fromCharCode(l),{data:v,width:w,height:T,glyphWidth:M,glyphHeight:S,glyphLeft:A,glyphTop:z,glyphAdvance:N}=p.draw(_);return this.localGlyphs[p.fontWeight][l]={id:l,bitmap:new Zl({width:w,height:T},v),metrics:{width:M/2,height:S/2,left:A/2,top:z/2-27,advance:N/2,localGlyph:!0}}}}function Fm(i,e,s,l){const u=[],p=i.image,_=p.pixelRatio,v=p.paddedRect.w-2,w=p.paddedRect.h-2,T=i.right-i.left,M=i.bottom-i.top,S=p.stretchX||[[0,v]],A=p.stretchY||[[0,w]],z=(Te,Ve)=>Te+Ve[1]-Ve[0],N=S.reduce(z,0),U=A.reduce(z,0),q=v-N,Y=w-U;let ie=0,ce=N,he=0,fe=U,me=0,Ce=q,Ee=0,$e=Y;if(p.content&&l){const Te=p.content;ie=ki(S,0,Te[0]),he=ki(A,0,Te[1]),ce=ki(S,Te[0],Te[2]),fe=ki(A,Te[1],Te[3]),me=Te[0]-ie,Ee=Te[1]-he,Ce=Te[2]-Te[0]-ce,$e=Te[3]-Te[1]-fe}const Oe=(Te,Ve,Ze,Ie)=>{const Ke=rh(Te.stretch-ie,ce,T,i.left),Je=pd(Te.fixed-me,Ce,Te.stretch,N),Ht=rh(Ve.stretch-he,fe,M,i.top),fn=pd(Ve.fixed-Ee,$e,Ve.stretch,U),yt=rh(Ze.stretch-ie,ce,T,i.left),jt=pd(Ze.fixed-me,Ce,Ze.stretch,N),Be=rh(Ie.stretch-he,fe,M,i.top),Yt=pd(Ie.fixed-Ee,$e,Ie.stretch,U),Zt=new We(Ke,Ht),jn=new We(yt,Ht),Ln=new We(yt,Be),yr=new We(Ke,Be),Zr=new We(Je/_,fn/_),Qt=new We(jt/_,Yt/_),Ot=e*Math.PI/180;if(Ot){const $n=Math.sin(Ot),Qn=Math.cos(Ot),Wr=[Qn,-$n,$n,Qn];Zt._matMult(Wr),jn._matMult(Wr),yr._matMult(Wr),Ln._matMult(Wr)}const Sn=Te.stretch+Te.fixed,Un=Ve.stretch+Ve.fixed;return{tl:Zt,tr:jn,bl:yr,br:Ln,tex:{x:p.paddedRect.x+1+Sn,y:p.paddedRect.y+1+Un,w:Ze.stretch+Ze.fixed-Sn,h:Ie.stretch+Ie.fixed-Un},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zr,pixelOffsetBR:Qt,minFontScaleX:Ce/_/T,minFontScaleY:$e/_/M,isSDF:s}};if(l&&(p.stretchX||p.stretchY)){const Te=zm(S,q,N),Ve=zm(A,Y,U);for(let Ze=0;Ze<Te.length-1;Ze++){const Ie=Te[Ze],Ke=Te[Ze+1];for(let Je=0;Je<Ve.length-1;Je++)u.push(Oe(Ie,Ve[Je],Ke,Ve[Je+1]))}}else u.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return u}function ki(i,e,s){let l=0;for(const u of i)l+=Math.max(e,Math.min(s,u[1]))-Math.max(e,Math.min(s,u[0]));return l}function zm(i,e,s){const l=[{fixed:-1,stretch:0}];for(const[u,p]of i){const _=l[l.length-1];l.push({fixed:u-_.stretch,stretch:_.stretch}),l.push({fixed:u-_.stretch,stretch:_.stretch+(p-u)})}return l.push({fixed:e+1,stretch:s}),l}function rh(i,e,s,l){return i/e*s+l}function pd(i,e,s,l){return i-e*s/l}function O_(i,e,s,l){const u=e+i.positionedLines[l].lineOffset;return 0===l?s+u/2:s+(u+(e+i.positionedLines[l-1].lineOffset))/2}iu.loadGlyphRange=function(i,e,s,l,u){const p=256*e,_=p+255,v=l.transformRequest(l.normalizeGlyphsURL(s).replace("{fontstack}",i).replace("{range}",`${p}-${_}`),Ca.Glyphs);Gs(v,(w,T)=>{if(w)u(w);else if(T){const M={},S=new ha(T).readFields(Sm,{});for(const A of S.glyphs)M[A.id]=A;u(null,{glyphs:M,ascender:S.ascender,descender:S.descender})}})},iu.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:_="normal"}){this.buffer=e,this.cutoff=l,this.radius=s;const v=this.size=i+4*e,w=this._createCanvas(v),T=this.ctx=w.getContext("2d",{willReadFrequently:!0});T.font=`${_} ${p} ${i}px ${u}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(i),_=Math.floor(s),v=Math.min(this.size-this.buffer,Math.ceil(p-u)),w=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(l)),T=v+2*this.buffer,M=w+2*this.buffer,S=T*M,A=new Uint8ClampedArray(S),z={data:A,width:T,height:M,glyphWidth:v,glyphHeight:w,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(0===v||0===w)return z;const{ctx:N,buffer:U,gridInner:q,gridOuter:Y}=this;N.clearRect(U,U,v,w),N.fillText(i,U,U+_+1);const ie=N.getImageData(U,U,v,w);Y.fill(hd,0,S),q.fill(0,0,S);for(let ce=0;ce<w;ce++)for(let he=0;he<v;he++){const fe=ie.data[4*(ce*v+he)+3]/255;if(0===fe)continue;const me=(ce+U)*T+he+U;if(1===fe)Y[me]=0,q[me]=hd;else{const Ce=.5-fe;Y[me]=Ce>0?Ce*Ce:0,q[me]=Ce<0?Ce*Ce:0}}Qp(Y,0,0,T,M,T,this.f,this.v,this.z),Qp(q,U,U,v,w,T,this.f,this.v,this.z);for(let ce=0;ce<S;ce++){const he=Math.sqrt(Y[ce])-Math.sqrt(q[ce]);A[ce]=Math.round(255-255*(he/this.radius+this.cutoff))}return z}};class B_{constructor(e=[],s=N_){if(this.data=e,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:s,compare:l}=this,u=s[e];for(;e>0;){const p=e-1>>1,_=s[p];if(l(u,_)>=0)break;s[e]=_,e=p}s[e]=u}_down(e){const{data:s,compare:l}=this,u=this.length>>1,p=s[e];for(;e<u;){let _=1+(e<<1),v=s[_];const w=_+1;if(w<this.length&&l(s[w],v)<0&&(_=w,v=s[w]),l(v,p)>=0)break;s[e]=v,e=_}s[e]=p}}function N_(i,e){return i<e?-1:i>e?1:0}function Om(i,e=1,s=!1){let l=1/0,u=1/0,p=-1/0,_=-1/0;const v=i[0];for(let z=0;z<v.length;z++){const N=v[z];(!z||N.x<l)&&(l=N.x),(!z||N.y<u)&&(u=N.y),(!z||N.x>p)&&(p=N.x),(!z||N.y>_)&&(_=N.y)}const w=Math.min(p-l,_-u);let T=w/2;const M=new B_([],V_);if(0===w)return new We(l,u);for(let z=l;z<p;z+=w)for(let N=u;N<_;N+=w)M.push(new ou(z+T,N+T,T,i));let S=function(z){let N=0,U=0,q=0;const Y=z[0];for(let ie=0,ce=Y.length,he=ce-1;ie<ce;he=ie++){const fe=Y[ie],me=Y[he],Ce=fe.x*me.y-me.x*fe.y;U+=(fe.x+me.x)*Ce,q+=(fe.y+me.y)*Ce,N+=3*Ce}return new ou(U/N,q/N,0,z)}(i),A=M.length;for(;M.length;){const z=M.pop();(z.d>S.d||!S.d)&&(S=z,s&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,A)),z.max-S.d<=e||(T=z.h/2,M.push(new ou(z.p.x-T,z.p.y-T,T,i)),M.push(new ou(z.p.x+T,z.p.y-T,T,i)),M.push(new ou(z.p.x-T,z.p.y+T,T,i)),M.push(new ou(z.p.x+T,z.p.y+T,T,i)),A+=4)}return s&&(console.log(`num probes: ${A}`),console.log(`best distance: ${S.d}`)),S.p}function V_(i,e){return e.max-i.max}function ou(i,e,s,l){this.p=new We(i,e),this.h=s,this.d=function(u,p){let _=!1,v=1/0;for(let w=0;w<p.length;w++){const T=p[w];for(let M=0,S=T.length,A=S-1;M<S;A=M++){const z=T[M],N=T[A];z.y>u.y!=N.y>u.y&&u.x<(N.x-z.x)*(u.y-z.y)/(N.y-z.y)+z.x&&(_=!_),v=Math.min(v,nm(u,z,N))}}return(_?1:-1)*Math.sqrt(v)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const ef=Number.POSITIVE_INFINITY,kt=Math.sqrt(2);function Ql(i,e){return e[1]!==ef?function(s,l,u){let p=0,_=0;switch(l=Math.abs(l),u=Math.abs(u),s){case"top-right":case"top-left":case"top":_=u-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-u}switch(s){case"top-right":case"bottom-right":case"right":p=-l;break;case"top-left":case"bottom-left":case"left":p=l}return[p,_]}(i,e[0],e[1]):function(s,l){let u=0,p=0;l<0&&(l=0);const _=l/kt;switch(s){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-l;break;case"top":p=l-7}switch(s){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=l;break;case"right":u=-l}return[u,p]}(i,e[0])}function Bm(i,e,s,l,u,p,_,v,w,T){i.createArrays(),i.tilePixelRatio=Dt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const M=i.layers[0].layout,S=i.layers[0]._unevaluatedLayout._values,A={};if("composite"===i.textSizeData.kind){const{minZoom:U,maxZoom:q}=i.textSizeData;A.compositeTextSizes=[S["text-size"].possiblyEvaluate(new gt(U),v),S["text-size"].possiblyEvaluate(new gt(q),v)]}if("composite"===i.iconSizeData.kind){const{minZoom:U,maxZoom:q}=i.iconSizeData;A.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new gt(U),v),S["icon-size"].possiblyEvaluate(new gt(q),v)]}A.layoutTextSize=S["text-size"].possiblyEvaluate(new gt(w+1),v),A.layoutIconSize=S["icon-size"].possiblyEvaluate(new gt(w+1),v),A.textMaxSize=S["text-size"].possiblyEvaluate(new gt(18),v);const z="map"===M.get("text-rotation-alignment")&&"point"!==M.get("symbol-placement"),N=M.get("text-size");for(const U of i.features){const q=M.get("text-font").evaluate(U,{},v).join(","),Y=N.evaluate(U,{},v),ie=A.layoutTextSize.evaluate(U,{},v),ce=(A.layoutIconSize.evaluate(U,{},v),{horizontal:{},vertical:void 0}),he=U.text;let fe,me=[0,0];if(he){const $e=he.toString(),Oe=24*M.get("text-letter-spacing").evaluate(U,{},v),Te=24*M.get("text-line-height").evaluate(U,{},v),Ve=ve($e)?Oe:0,Ze=M.get("text-anchor").evaluate(U,{},v),Ie=M.get("text-variable-anchor");if(!Ie){const jt=M.get("text-radial-offset").evaluate(U,{},v);me=jt?Ql(Ze,[24*jt,ef]):M.get("text-offset").evaluate(U,{},v).map(Be=>24*Be)}let Ke=z?"center":M.get("text-justify").evaluate(U,{},v);const Je=M.get("symbol-placement"),Ht="point"===Je,fn="point"===Je?24*M.get("text-max-width").evaluate(U,{},v):0,yt=jt=>{i.allowVerticalPlacement&&we($e)&&(ce.vertical=Gp(he,e,s,u,q,fn,Te,Ze,jt,Ve,me,Dr.vertical,!0,Je,ie,Y))};if(!z&&Ie){const jt="auto"===Ke?Ie.map(Yt=>fd(Yt)):[Ke];let Be=!1;for(let Yt=0;Yt<jt.length;Yt++){const Zt=jt[Yt];if(!ce.horizontal[Zt])if(Be)ce.horizontal[Zt]=ce.horizontal[0];else{const jn=Gp(he,e,s,u,q,fn,Te,"center",Zt,Ve,me,Dr.horizontal,!1,Je,ie,Y);jn&&(ce.horizontal[Zt]=jn,Be=1===jn.positionedLines.length)}}yt("left")}else{if("auto"===Ke&&(Ke=fd(Ze)),Ht||M.get("text-writing-mode").indexOf("horizontal")>=0||!we($e)){const jt=Gp(he,e,s,u,q,fn,Te,Ze,Ke,Ve,me,Dr.horizontal,!1,Je,ie,Y);jt&&(ce.horizontal[Ke]=jt)}yt("point"===Je?"left":Ke)}}let Ce=!1;if(U.icon&&U.icon.name){const $e=l[U.icon.name];$e&&(fe=Xp(u[U.icon.name],M.get("icon-offset").evaluate(U,{},v),M.get("icon-anchor").evaluate(U,{},v)),Ce=$e.sdf,void 0===i.sdfIcons?i.sdfIcons=$e.sdf:i.sdfIcons!==$e.sdf&&Pn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($e.pixelRatio!==i.pixelRatio||0!==M.get("icon-rotate").constantOr(1))&&(i.iconsNeedLinear=!0))}const Ee=Nm(ce.horizontal)||ce.vertical;i.iconsInText||(i.iconsInText=!!Ee&&Ee.iconsInText),(Ee||fe)&&md(i,U,ce,fe,l,A,ie,0,me,Ce,_,v,T)}p&&i.generateCollisionDebugBuffers(w,i.collisionBoxArray)}function fd(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function md(i,e,s,l,u,p,_,v,w,T,M,S,A){let z=p.textMaxSize.evaluate(e,{},S);void 0===z&&(z=_);const N=i.layers[0].layout,U=N.get("icon-offset").evaluate(e,{},S),q=Nm(s.horizontal)||s.vertical,Y=_/24,ie=i.tilePixelRatio*z/24,ce=i.tilePixelRatio*N.get("symbol-spacing"),he=N.get("text-padding")*i.tilePixelRatio,fe=N.get("icon-padding")*i.tilePixelRatio,me=Lt(N.get("text-max-angle")),Ce="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),Ee="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),$e=N.get("symbol-placement"),Oe=ce/2,Te=N.get("icon-text-fit");let Ve;l&&"none"!==Te&&(i.allowVerticalPlacement&&s.vertical&&(Ve=Kp(l,s.vertical,Te,N.get("icon-text-fit-padding"),U,Y)),q&&(l=Kp(l,q,Te,N.get("icon-text-fit-padding"),U,Y)));const Ze=(Ie,Ke,Je)=>{if(Ke.x<0||Ke.x>=Dt||Ke.y<0||Ke.y>=Dt)return;const{x:Ht,y:fn,z:yt}=A.projectTilePoint(Ke.x,Ke.y,Je),jt=new rs(Ht,fn,yt,0,void 0);!function(Be,Yt,Zt,jn,Ln,yr,Zr,Qt,Ot,Sn,Un,$n,Qn,Wr,zi,Xr,En,ar,ro,Or,Bt,Cr,An,Br,er){const Nr=Be.addToLineVertexArray(Yt,jn);let ai,_i,lr,Co,fu,oc,hh,ig=0,og=0,sg=0,ag=0,Cf=-1,mu=-1;const yi={};let lg=$c(""),sc=0,Mf=0;if(void 0===Ot._unevaluatedLayout.getValue("text-radial-offset")?[sc,Mf]=Ot.layout.get("text-offset").evaluate(Bt,{},er).map(Vr=>24*Vr):(sc=24*Ot.layout.get("text-radial-offset").evaluate(Bt,{},er),Mf=ef),Be.allowVerticalPlacement&&Ln.vertical){const Vr=Ln.vertical;if(zi)oc=is(Vr),Qt&&(hh=is(Qt));else{const xn=Ot.layout.get("text-rotate").evaluate(Bt,{},er)+90;lr=su(Sn,Zt,Yt,Un,$n,Qn,Vr,Wr,xn,Xr),Qt&&(Co=su(Sn,Zt,Yt,Un,$n,Qn,Qt,ar,xn))}}if(yr){const Vr=Ot.layout.get("icon-rotate").evaluate(Bt,{},er),xn="none"!==Ot.layout.get("icon-text-fit"),as=Fm(yr,Vr,An,xn),gu=Qt?Fm(Qt,Vr,An,xn):void 0;_i=su(Sn,Zt,Yt,Un,$n,Qn,yr,ar,Vr),ig=4*as.length;const io=Be.iconSizeData;let pl=null;"source"===io.kind?(pl=[gi*Ot.layout.get("icon-size").evaluate(Bt,{},er)],pl[0]>zr&&Pn(`${Be.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===io.kind&&(pl=[gi*Cr.compositeIconSizes[0].evaluate(Bt,{},er),gi*Cr.compositeIconSizes[1].evaluate(Bt,{},er)],(pl[0]>zr||pl[1]>zr)&&Pn(`${Be.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Be.addSymbols(Be.icon,as,pl,Or,ro,Bt,!1,Zt,Yt,Nr.lineStartIndex,Nr.lineLength,-1,Br,er),Cf=Be.icon.placedSymbolArray.length-1,gu&&(og=4*gu.length,Be.addSymbols(Be.icon,gu,pl,Or,ro,Bt,Dr.vertical,Zt,Yt,Nr.lineStartIndex,Nr.lineLength,-1,Br,er),mu=Be.icon.placedSymbolArray.length-1)}for(const Vr in Ln.horizontal){const xn=Ln.horizontal[Vr];ai||(lg=$c(xn.text),zi?fu=is(xn):ai=su(Sn,Zt,Yt,Un,$n,Qn,xn,Wr,Ot.layout.get("text-rotate").evaluate(Bt,{},er),Xr));const as=1===xn.positionedLines.length;if(sg+=tf(Be,Zt,Yt,xn,Zr,Ot,zi,Bt,Xr,Nr,Ln.vertical?Dr.horizontal:Dr.horizontalOnly,as?Object.keys(Ln.horizontal):[Vr],yi,Cf,Cr,Br,er),as)break}Ln.vertical&&(ag+=tf(Be,Zt,Yt,Ln.vertical,Zr,Ot,zi,Bt,Xr,Nr,Dr.vertical,["vertical"],yi,mu,Cr,Br,er));let dl=-1;const dh=(Vr,xn)=>Vr?Math.max(Vr,xn):xn;dl=dh(fu,dl),dl=dh(oc,dl),dl=dh(hh,dl);const Fs=dl>-1?1:0;Be.glyphOffsetArray.length>=Ls.MAX_GLYPHS&&Pn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Bt.sortKey&&Be.addToSortKeyRanges(Be.symbolInstances.length,Bt.sortKey),Be.symbolInstances.emplaceBack(Zt.x,Zt.y,Zt.z,Yt.x,Yt.y,yi.right>=0?yi.right:-1,yi.center>=0?yi.center:-1,yi.left>=0?yi.left:-1,yi.vertical>=0?yi.vertical:-1,Cf,mu,lg,void 0!==ai?ai:Be.collisionBoxArray.length,void 0!==ai?ai+1:Be.collisionBoxArray.length,void 0!==lr?lr:Be.collisionBoxArray.length,void 0!==lr?lr+1:Be.collisionBoxArray.length,void 0!==_i?_i:Be.collisionBoxArray.length,void 0!==_i?_i+1:Be.collisionBoxArray.length,Co||Be.collisionBoxArray.length,Co?Co+1:Be.collisionBoxArray.length,Un,sg,ag,ig,og,Fs,0,sc,Mf,dl)}(i,Ke,jt,Ie,s,l,u,Ve,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,he,Ce,w,0,fe,Ee,U,e,p,T,M,S)};if("line"===$e)for(const Ie of Jp(e.geometry,0,0,Dt,Dt)){const Ke=Lm(Ie,ce,me,s.vertical||q,l,24,ie,i.overscaling,Dt);for(const Je of Ke){const Ht=q;Ht&&nf(i,Ht.text,Oe,Je)||Ze(Ie,Je,S)}}else if("line-center"===$e){for(const Ie of e.geometry)if(Ie.length>1){const Ke=z_(Ie,me,s.vertical||q,l,24,ie);Ke&&Ze(Ie,Ke,S)}}else if("Polygon"===e.type)for(const Ie of Cp(e.geometry,0)){const Ke=Om(Ie,16);Ze(Ie[0],new rs(Ke.x,Ke.y,0,0,void 0),S)}else if("LineString"===e.type)for(const Ie of e.geometry)Ze(Ie,new rs(Ie[0].x,Ie[0].y,0,0,void 0),S);else if("Point"===e.type)for(const Ie of e.geometry)for(const Ke of Ie)Ze([Ke],new rs(Ke.x,Ke.y,0,0,void 0),S)}const zr=32640;function tf(i,e,s,l,u,p,_,v,w,T,M,S,A,z,N,U,q){const Y=function(he,fe,me,Ce,Ee,$e,Oe,Te){const Ve=[];if(0===fe.positionedLines.length)return Ve;const Ze=Ce.layout.get("text-rotate").evaluate($e,{})*Math.PI/180,Ie=function(yt){const jt=yt[0],Be=yt[1],Yt=jt*Be;return Yt>0?[jt,-Be]:Yt<0?[-jt,Be]:0===jt?[Be,jt]:[Be,-jt]}(me);let Ke=Math.abs(fe.top-fe.bottom);for(const yt of fe.positionedLines)Ke-=yt.lineOffset;const Je=fe.positionedLines.length,Ht=Ke/Je;let fn=fe.top-me[1];for(let yt=0;yt<Je;++yt){const jt=fe.positionedLines[yt];fn=O_(fe,Ht,fn,yt);for(const Be of jt.positionedGlyphs){if(!Be.rect)continue;const Yt=Be.rect||{};let Zt=4,jn=!0,Ln=1,yr=0;if(Be.imageName){const An=Oe[Be.imageName];if(!An)continue;if(An.sdf){Pn("SDF images are not supported in formatted text and will be ignored.");continue}jn=!1,Ln=An.pixelRatio,Zt=1/Ln}const Zr=(Ee||Te)&&Be.vertical,Qt=Be.metrics.advance*Be.scale/2,Ot=Be.metrics,Sn=Be.rect;if(null===Sn)continue;Te&&fe.verticalizable&&(yr=Be.imageName?Qt-Be.metrics.width*Be.scale/2:0);const Un=Ee?[Be.x+Qt,Be.y]:[0,0];let $n=[0,0],Qn=[0,0],Wr=!1;Ee||(Zr?(Qn=[Be.x+Qt+Ie[0],Be.y+Ie[1]-yr],Wr=!0):$n=[Be.x+Qt+me[0],Be.y+me[1]-yr]);const zi=Sn.w*Be.scale/(Ln*(Be.localGlyph?2:1)),Xr=Sn.h*Be.scale/(Ln*(Be.localGlyph?2:1));let En,ar,ro,Or;if(Zr){const An=Be.y-fn,Br=new We(-Qt,Qt-An),er=-Math.PI/2,Nr=new We(...Qn);En=new We(-Qt+$n[0],$n[1]),En._rotateAround(er,Br)._add(Nr),En.x+=-An+Qt,En.y-=(Ot.left-Zt)*Be.scale;const ai=Be.imageName?Ot.advance*Be.scale:24*Be.scale,_i=String.fromCharCode(Be.glyph);zp(_i)?En.x+=(1-Zt)*Be.scale:Op(_i)?En.x+=ai-Ot.height*Be.scale+(-Zt-1)*Be.scale:En.x+=Be.imageName||Ot.width+2*Zt===Sn.w&&Ot.height+2*Zt===Sn.h?(ai-Xr)/2:(ai-(Ot.height+2*Zt)*Be.scale)/2,ar=new We(En.x,En.y-zi),ro=new We(En.x+Xr,En.y),Or=new We(En.x+Xr,En.y-zi)}else{const An=(Ot.left-Zt)*Be.scale-Qt+$n[0],Br=(-Ot.top-Zt)*Be.scale+$n[1],er=An+zi,Nr=Br+Xr;En=new We(An,Br),ar=new We(er,Br),ro=new We(An,Nr),Or=new We(er,Nr)}if(Ze){let An;An=Ee?new We(0,0):Wr?new We(Ie[0],Ie[1]):new We(me[0],me[1]),En._rotateAround(Ze,An),ar._rotateAround(Ze,An),ro._rotateAround(Ze,An),Or._rotateAround(Ze,An)}const Bt=new We(0,0),Cr=new We(0,0);Ve.push({tl:En,tr:ar,bl:ro,br:Or,tex:Yt,writingMode:fe.writingMode,glyphOffset:Un,sectionIndex:Be.sectionIndex,isSDF:jn,pixelOffsetTL:Bt,pixelOffsetBR:Cr,minFontScaleX:0,minFontScaleY:0})}}return Ve}(0,l,w,p,_,v,u,i.allowVerticalPlacement),ie=i.textSizeData;let ce=null;"source"===ie.kind?(ce=[gi*p.layout.get("text-size").evaluate(v,{},q)],ce[0]>zr&&Pn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ie.kind&&(ce=[gi*N.compositeTextSizes[0].evaluate(v,{},q),gi*N.compositeTextSizes[1].evaluate(v,{},q)],(ce[0]>zr||ce[1]>zr)&&Pn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,Y,ce,w,_,v,M,e,s,T.lineStartIndex,T.lineLength,z,U,q);for(const he of S)A[he]=i.text.placedSymbolArray.length-1;return 4*Y.length}function Nm(i){for(const e in i)return i[e];return null}function su(i,e,s,l,u,p,_,v,w,T){let M=_.top,S=_.bottom,A=_.left,z=_.right;const N=_.collisionPadding;if(N&&(A-=N[0],M-=N[1],z+=N[2],S+=N[3]),w){const U=new We(A,M),q=new We(z,M),Y=new We(A,S),ie=new We(z,S),ce=Lt(w);let he=new We(0,0);T&&(he=new We(T[0],T[1])),U._rotateAround(ce,he),q._rotateAround(ce,he),Y._rotateAround(ce,he),ie._rotateAround(ce,he),A=Math.min(U.x,q.x,Y.x,ie.x),z=Math.max(U.x,q.x,Y.x,ie.x),M=Math.min(U.y,q.y,Y.y,ie.y),S=Math.max(U.y,q.y,Y.y,ie.y)}return i.emplaceBack(e.x,e.y,e.z,s.x,s.y,A,M,z,S,v,l,u,p),i.length-1}function is(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function nf(i,e,s,l){const u=i.compareText;if(e in u){const p=u[e];for(let _=p.length-1;_>=0;_--)if(l.dist(p[_])<s)return!0}else u[e]=[];return u[e].push(l),!1}const Vm=Wl.VectorTileFeature.types,rf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function of(i,e,s,l,u,p,_,v,w,T,M,S,A,z,N,U){const q=M?Math.min(zr,Math.round(M[0])):0,Y=M?Math.min(zr,Math.round(M[1])):0;i.emplaceBack(e,s,Math.round(32*_),Math.round(32*v),w,T,(q<<1)+(S?1:0),Y,16*A,16*z,256*N,256*U,l,u,p,0)}function gd(i,e,s){i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s),i.emplaceBack(e.x,e.y,s)}function Zv(i){for(const e of i.sections)if(je(e.text))return!0;return!1}class au{constructor(e){this.layoutVertexArray=new Gl,this.indexArray=new fi,this.programConfigurations=e,this.segments=new Xn,this.dynamicLayoutVertexArray=new Nc,this.opacityVertexArray=new ap,this.placedSymbolArray=new Zg}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,s,l,u){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,T_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,D_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rf,!0),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ye("SymbolBuffers",au);class lu{constructor(e,s,l){this.layoutVertexArray=new e,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Xn,this.collisionVertexArray=new lp,this.collisionVertexArrayExt=new Nc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,C_.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Tm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ye("CollisionBuffers",lu);class Ls{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Qr([]),this.placementViewportMatrix=Qr([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wo(this.zoom,s["text-size"]),this.iconSizeData=wo(this.zoom,s["icon-size"]);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),p=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==p&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===p||"auto"===p&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(_=>Dr[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new au(new la(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new au(new la(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Kg,this.lineVertexArray=new jc,this.symbolInstances=new Xg}calculateGlyphDependencies(e,s,l,u,p){for(let _=0;_<e.length;_++)if(s[e.charCodeAt(_)]=!0,u&&p){const v=qr[e.charAt(_)];v&&(s[v.charCodeAt(0)]=!0)}}populate(e,s,l,u){const p=this.layers[0],_=p.layout,v=_.get("text-font"),w=_.get("text-field"),T=_.get("icon-image"),M=("constant"!==w.value.kind||w.value.value instanceof xt&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==v.value.kind||v.value.value.length>0),S="constant"!==T.value.kind||!!T.value.value||Object.keys(T.parameters).length>0,A=_.get("symbol-sort-key");if(this.features=[],!M&&!S)return;const z=s.iconDependencies,N=s.glyphDependencies,U=s.availableImages,q=new gt(this.zoom);for(const{feature:Y,id:ie,index:ce,sourceLayerIndex:he}of e){const fe=p._featureFilter.needGeometry,me=ql(Y,fe);if(!p._featureFilter.filter(q,me,l))continue;let Ce,Ee;if(fe||(me.geometry=Ss(Y,l,u)),M){const Oe=p.getValueAndResolveTokens("text-field",me,l,U),Te=xt.factory(Oe);Zv(Te)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Qi()||this.hasRTLText&&Gt.isParsed())&&(Ce=qv(Te,p,me))}if(S){const Oe=p.getValueAndResolveTokens("icon-image",me,l,U);Ee=Oe instanceof Ti?Oe:Ti.fromString(Oe)}if(!Ce&&!Ee)continue;const $e=this.sortFeaturesByKey?A.evaluate(me,{},l):void 0;if(this.features.push({id:ie,text:Ce,icon:Ee,index:ce,sourceLayerIndex:he,geometry:me.geometry,properties:Y.properties,type:Vm[Y.type],sortKey:$e}),Ee&&(z[Ee.name]=!0),Ce){const Oe=v.evaluate(me,{},l).join(","),Te="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Dr.vertical)>=0;for(const Ve of Ce.sections)if(Ve.image)z[Ve.image.name]=!0;else{const Ze=we(Ce.toString()),Ie=Ve.fontStack||Oe,Ke=N[Ie]=N[Ie]||{};this.calculateGlyphDependencies(Ve.text,Ke,Te,this.allowVerticalPlacement,Ze)}}}"line"===_.get("symbol-placement")&&(this.features=function(Y){const ie={},ce={},he=[];let fe=0;function me(Oe){he.push(Y[Oe]),fe++}function Ce(Oe,Te,Ve){const Ze=ce[Oe];return delete ce[Oe],ce[Te]=Ze,he[Ze].geometry[0].pop(),he[Ze].geometry[0]=he[Ze].geometry[0].concat(Ve[0]),Ze}function Ee(Oe,Te,Ve){const Ze=ie[Te];return delete ie[Te],ie[Oe]=Ze,he[Ze].geometry[0].shift(),he[Ze].geometry[0]=Ve[0].concat(he[Ze].geometry[0]),Ze}function $e(Oe,Te,Ve){const Ze=Ve?Te[0][Te[0].length-1]:Te[0][0];return`${Oe}:${Ze.x}:${Ze.y}`}for(let Oe=0;Oe<Y.length;Oe++){const Te=Y[Oe],Ve=Te.geometry,Ze=Te.text?Te.text.toString():null;if(!Ze){me(Oe);continue}const Ie=$e(Ze,Ve),Ke=$e(Ze,Ve,!0);if(Ie in ce&&Ke in ie&&ce[Ie]!==ie[Ke]){const Je=Ee(Ie,Ke,Ve),Ht=Ce(Ie,Ke,he[Je].geometry);delete ie[Ie],delete ce[Ke],ce[$e(Ze,he[Ht].geometry,!0)]=Ht,he[Je].geometry=null}else Ie in ce?Ce(Ie,Ke,Ve):Ke in ie?Ee(Ie,Ke,Ve):(me(Oe),ie[Ie]=fe-1,ce[Ke]=fe-1)}return he.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Y,ie)=>Y.sortKey-ie.sortKey)}update(e,s,l,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,s,this.layers,l,u),this.icon.programConfigurations.updatePaintArrays(e,s,this.layers,l,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,s){const l=this.lineVertexArray.length;if(void 0!==e.segment){let u=e.dist(s[e.segment+1]),p=e.dist(s[e.segment]);const _={};for(let v=e.segment+1;v<s.length;v++)_[v]={x:s[v].x,y:s[v].y,tileUnitDistanceFromAnchor:u},v<s.length-1&&(u+=s[v+1].dist(s[v]));for(let v=e.segment||0;v>=0;v--)_[v]={x:s[v].x,y:s[v].y,tileUnitDistanceFromAnchor:p},v>0&&(p+=s[v-1].dist(s[v]));for(let v=0;v<s.length;v++){const w=_[v];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,s,l,u,p,_,v,w,T,M,S,A,z,N){const U=e.indexArray,q=e.layoutVertexArray,Y=e.segments.prepareSegment(4*s.length,q,U,this.canOverlap?_.sortKey:void 0),ie=this.glyphOffsetArray.length,ce=Y.vertexLength,he=this.allowVerticalPlacement&&v===Dr.vertical?Math.PI/2:0,fe=_.text&&_.text.sections;for(let me=0;me<s.length;me++){const{tl:Ce,tr:Ee,bl:$e,br:Oe,tex:Te,pixelOffsetTL:Ve,pixelOffsetBR:Ze,minFontScaleX:Ie,minFontScaleY:Ke,glyphOffset:Je,isSDF:Ht,sectionIndex:fn}=s[me],yt=Y.vertexLength,jt=Je[1];of(q,w.x,w.y,w.z,T.x,T.y,Ce.x,jt+Ce.y,Te.x,Te.y,l,Ht,Ve.x,Ve.y,Ie,Ke),of(q,w.x,w.y,w.z,T.x,T.y,Ee.x,jt+Ee.y,Te.x+Te.w,Te.y,l,Ht,Ze.x,Ve.y,Ie,Ke),of(q,w.x,w.y,w.z,T.x,T.y,$e.x,jt+$e.y,Te.x,Te.y+Te.h,l,Ht,Ve.x,Ze.y,Ie,Ke),of(q,w.x,w.y,w.z,T.x,T.y,Oe.x,jt+Oe.y,Te.x+Te.w,Te.y+Te.h,l,Ht,Ze.x,Ze.y,Ie,Ke),gd(e.dynamicLayoutVertexArray,w,he),U.emplaceBack(yt,yt+1,yt+2),U.emplaceBack(yt+1,yt+2,yt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Je[0]),me!==s.length-1&&fn===s[me+1].sectionIndex||e.programConfigurations.populatePaintArrays(q.length,_,_.index,{},z,N,fe&&fe[fn])}e.placedSymbolArray.emplaceBack(w.x,w.y,w.z,T.x,T.y,ie,this.glyphOffsetArray.length-ie,ce,M,S,T.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],v,0,!1,0,A,0)}_commitLayoutVertex(e,s,l,u,p,_,v){e.emplaceBack(s,l,u,p,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,s,l,u,p,_,v){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),T=w.vertexLength,M=v.tileAnchorX,S=v.tileAnchorY;for(let z=0;z<4;z++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(s,-e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(s,e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(s,e.padding,e.padding),l.collisionVertexArrayExt.emplaceBack(s,-e.padding,e.padding),this._commitLayoutVertex(l.layoutVertexArray,u,p,_,M,S,new We(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,p,_,M,S,new We(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,p,_,M,S,new We(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,p,_,M,S,new We(e.x1,e.y2)),w.vertexLength+=4;const A=l.indexArray;A.emplaceBack(T,T+1),A.emplaceBack(T+1,T+2),A.emplaceBack(T+2,T+3),A.emplaceBack(T+3,T),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,s,l,u,p,_){for(let v=u;v<p;v++){const w=l.get(v),T=this.getSymbolInstanceTextSize(e,_,s,v);this._addCollisionDebugVertices(w,T,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,s,l,u,p,_){for(let v=u;v<p;v++){const w=l.get(v),T=this.getSymbolInstanceIconSize(e,s,v);this._addCollisionDebugVertices(w,T,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lu(Vu,Dm.members,eo),this.iconCollisionBox=new lu(Vu,Dm.members,eo);const l=th(this.iconSizeData,e),u=th(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(u,e,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(u,e,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,e,s,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,e,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,s,l,u){const p=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:u),_=Fp(this.textSizeData,e,p)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,s,l){const u=this.icon.placedSymbolArray.get(l),p=Fp(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,s,l){e.emplaceBack(s,-l,-l),e.emplaceBack(s,l,-l),e.emplaceBack(s,l,l),e.emplaceBack(s,-l,l)}_updateTextDebugCollisionBoxes(e,s,l,u,p,_){for(let v=u;v<p;v++){const w=l.get(v),T=this.getSymbolInstanceTextSize(e,_,s,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,w.padding)}}_updateIconDebugCollisionBoxes(e,s,l,u,p){for(let _=u;_<p;_++){const v=l.get(_),w=this.getSymbolInstanceIconSize(e,s,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,v.padding)}}updateCollisionDebugBuffers(e,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=th(this.iconSizeData,e),u=th(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(u,e,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(u,e,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(l,e,s,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(l,e,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,s,l,u,p,_,v,w,T){const M={};for(let S=s;S<l;S++){const A=e.get(S);M.textBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},M.textFeatureIndex=A.featureIndex;break}for(let S=u;S<p;S++){const A=e.get(S);M.verticalTextBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},M.verticalTextFeatureIndex=A.featureIndex;break}for(let S=_;S<v;S++){const A=e.get(S);M.iconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},M.iconFeatureIndex=A.featureIndex;break}for(let S=w;S<T;S++){const A=e.get(S);M.verticalIconBox={x1:A.x1,y1:A.y1,x2:A.x2,y2:A.y2,padding:A.padding,projectedAnchorX:A.projectedAnchorX,projectedAnchorY:A.projectedAnchorY,projectedAnchorZ:A.projectedAnchorZ,tileAnchorX:A.tileAnchorX,tileAnchorY:A.tileAnchorY},M.verticalIconFeatureIndex=A.featureIndex;break}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,s){const l=e.placedSymbolArray.get(s),u=l.vertexStartIndex+4*l.numGlyphs;for(let p=l.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(e),l=Math.cos(e),u=[],p=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const w=this.symbolInstances.get(v);u.push(0|Math.round(s*w.tileAnchorX+l*w.tileAnchorY)),p.push(w.featureIndex)}return _.sort((v,w)=>u[v]-u[w]||p[w]-p[v]),_}addToSortKeyRanges(e,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((u,p,_)=>{u>=0&&_.indexOf(u)===p&&this.addIndicesForPlacedSymbol(this.text,u)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ye("SymbolBucket",Ls,{omit:["layers","collisionBoxArray","features","compareText"]}),Ls.MAX_GLYPHS=65535,Ls.addDynamicAttributes=gd;const sf=new Wn({"symbol-placement":new et(be.layout_symbol["symbol-placement"]),"symbol-spacing":new et(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new et(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new at(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new et(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new et(be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new et(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new et(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new et(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new at(be.layout_symbol["icon-size"]),"icon-text-fit":new et(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new et(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new at(be.layout_symbol["icon-image"]),"icon-rotate":new at(be.layout_symbol["icon-rotate"]),"icon-padding":new et(be.layout_symbol["icon-padding"]),"icon-keep-upright":new et(be.layout_symbol["icon-keep-upright"]),"icon-offset":new at(be.layout_symbol["icon-offset"]),"icon-anchor":new at(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new et(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new et(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new et(be.layout_symbol["text-rotation-alignment"]),"text-field":new at(be.layout_symbol["text-field"]),"text-font":new at(be.layout_symbol["text-font"]),"text-size":new at(be.layout_symbol["text-size"]),"text-max-width":new at(be.layout_symbol["text-max-width"]),"text-line-height":new at(be.layout_symbol["text-line-height"]),"text-letter-spacing":new at(be.layout_symbol["text-letter-spacing"]),"text-justify":new at(be.layout_symbol["text-justify"]),"text-radial-offset":new at(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new et(be.layout_symbol["text-variable-anchor"]),"text-anchor":new at(be.layout_symbol["text-anchor"]),"text-max-angle":new et(be.layout_symbol["text-max-angle"]),"text-writing-mode":new et(be.layout_symbol["text-writing-mode"]),"text-rotate":new at(be.layout_symbol["text-rotate"]),"text-padding":new et(be.layout_symbol["text-padding"]),"text-keep-upright":new et(be.layout_symbol["text-keep-upright"]),"text-transform":new at(be.layout_symbol["text-transform"]),"text-offset":new at(be.layout_symbol["text-offset"]),"text-allow-overlap":new et(be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new et(be.layout_symbol["text-ignore-placement"]),"text-optional":new et(be.layout_symbol["text-optional"])});var ih={paint:new Wn({"icon-opacity":new at(be.paint_symbol["icon-opacity"]),"icon-color":new at(be.paint_symbol["icon-color"]),"icon-halo-color":new at(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new at(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new at(be.paint_symbol["icon-halo-blur"]),"icon-translate":new et(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new et(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new at(be.paint_symbol["text-opacity"]),"text-color":new at(be.paint_symbol["text-color"],{runtimeType:uo,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new at(be.paint_symbol["text-halo-color"]),"text-halo-width":new at(be.paint_symbol["text-halo-width"]),"text-halo-blur":new at(be.paint_symbol["text-halo-blur"]),"text-translate":new et(be.paint_symbol["text-translate"]),"text-translate-anchor":new et(be.paint_symbol["text-translate-anchor"])}),layout:sf};class j_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Zs,this.defaultValue=e}evaluate(e){if(e.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(e.formattedSection))return s.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ye("FormatSectionOverride",j_,{omit:["defaultValue"]});class _d extends ts{constructor(e){super(e,ih)}recalculate(e,s){super.recalculate(e,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const p of l)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,s,l,u){const p=this.layout.get(e).evaluate(s,{},l,u),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||Va(_.value)||!p?p:(v=s.properties,p.replace(/{([^{}]+)}/g,(T,M)=>M in v?String(v[M]):""));var v}createBucket(e){return new Ls(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of ih.paint.overridableProperties){if(!_d.hasPaintOverride(this.layout,e))continue;const s=this.paint.get(e),l=new j_(s),u=new Xo(l,s.property.specification);let p=null;p="constant"===s.value.kind||"source"===s.value.kind?new ja("source",u):new Ru("composite",u,s.value.zoomStops,s.value._interpolationType),this.paint._values[e]=new Rr(s.property,p,s.parameters)}}_handleOverridablePaintPropertyUpdate(e,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&_d.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,s){const l=e.get("text-field"),u=ih.paint.properties[s];let p=!1;const _=v=>{for(const w of v)if(u.overrides&&u.overrides.hasOverride(w))return void(p=!0)};if("constant"===l.value.kind&&l.value.value instanceof xt)_(l.value.value.sections);else if("source"===l.value.kind){const v=T=>{p||(T instanceof jo&&qn(T.value)===Ws?_(T.value.sections):T instanceof Uo?_(T.sections):T.eachChild(v))},w=l.value;w._styleExpression&&v(w._styleExpression.expression)}return p}getProgramConfiguration(e){return new Ms(this,e)}}var U_={paint:new Wn({"background-color":new et(be.paint_background["background-color"]),"background-pattern":new oa(be.paint_background["background-pattern"]),"background-opacity":new et(be.paint_background["background-opacity"])})},$_={paint:new Wn({"raster-opacity":new et(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new et(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new et(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new et(be.paint_raster["raster-brightness-max"]),"raster-saturation":new et(be.paint_raster["raster-saturation"]),"raster-contrast":new et(be.paint_raster["raster-contrast"]),"raster-resampling":new et(be.paint_raster["raster-resampling"]),"raster-fade-duration":new et(be.paint_raster["raster-fade-duration"])})};class G_ extends ts{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var jm={paint:new Wn({"sky-type":new et(be.paint_sky["sky-type"]),"sky-atmosphere-sun":new et(be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new et(be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new et(be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new et(be.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ds(be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new et(be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new et(be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new et(be.paint_sky["sky-opacity"])})};function Um(i,e,s){const l=vi(0,0,1),u=Ro(Vi());return function(p,_,v){v*=.5;var w=_[0],T=_[1],M=_[2],S=_[3],A=Math.sin(v),z=Math.cos(v);p[0]=w*z-M*A,p[1]=T*z+S*A,p[2]=M*z+w*A,p[3]=S*z-T*A}(u,u,s?-Lt(i)+Math.PI:Lt(i)),gc(u,u,-Lt(e)),mc(l,l,u),bl(l,l)}const H_={circle:class extends ts{constructor(i){super(i,im)}createBucket(i){return new rl(i)}queryRadius(i){const e=i;return Wc("circle-radius",this,e)+Wc("circle-stroke-width",this,e)+Wh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,s,l,u,p,_,v){const w=Wu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,s)+this.paint.get("circle-stroke-width").evaluate(e,s);return xp(i,l,p,_,v,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,T)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new Ms(this,i)}},heatmap:class extends ts{createBucket(i){return new sm(i)}constructor(i){super(i,Vv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"heatmap-color"===i&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=am({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Wc("heatmap-radius",this,i)}queryIntersectsFeature(i,e,s,l,u,p,_,v){const w=this.paint.get("heatmap-radius").evaluate(e,s);return xp(i,l,p,_,v,!0,!0,new We(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new Ms(this,i)}},hillshade:class extends ts{constructor(i){super(i,jv)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(i){return new Ms(this,i)}},fill:class extends ts{constructor(i){super(i,f_)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),s=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(i){return new Ms(this,i)}recalculate(i,e){super.recalculate(i,e);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new ed(i)}queryRadius(){return Wh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,s,l,u,p){return!i.queryGeometry.isAboveHorizon&&r_(i_(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends ts{constructor(i){super(i,__)}createBucket(i){return new kp(i)}queryRadius(){return Wh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new Ms(this,i)}queryIntersectsFeature(i,e,s,l,u,p,_,v,w){const T=Wu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,s),S=this.paint.get("fill-extrusion-base").evaluate(e,s),A=[0,0],z=v&&p.elevation,N=p.elevation?p.elevation.exaggeration():1;if(z){const Y=i.tile.getBucket(this).centroidVertexArray,ie=w+1;if(ie<Y.length){const ce=Y.get(ie);A[0]=ce.a_centroid_pos0,A[1]=ce.a_centroid_pos1}}if(0===A[0]&&1===A[1])return!1;const U=(Y=l,ie=S,ce=M,he=T,fe=_,(me=z?v:null)?function(Oe,Te,Ve,Ze,Ie,Ke,Je,Ht,fn){const yt=[],jt=[],Be=[0,0,0,1];for(const Yt of Oe){const Zt=[],jn=[];for(const Ln of Yt){const yr=Ln.x+Ze.x,Zr=Ln.y+Ze.y,Qt=y_(yr,Zr,Te,Ve,Ke,Je,Ht,fn);Be[0]=yr,Be[1]=Zr,Be[2]=Qt.base,Be[3]=1,lo(Be,Be,Ie),Be[3]=Math.max(Be[3],1e-5);const Ot=bm([Be[0]/Be[3],Be[1]/Be[3],Be[2]/Be[3]]);Be[0]=yr,Be[1]=Zr,Be[2]=Qt.top,Be[3]=1,lo(Be,Be,Ie),Be[3]=Math.max(Be[3],1e-5);const Sn=bm([Be[0]/Be[3],Be[1]/Be[3],Be[2]/Be[3]]);Zt.push(Ot),jn.push(Sn)}yt.push(Zt),jt.push(jn)}return[yt,jt]}(Y,ie,ce,he,fe,me,A,N,p.center.lat):function(Oe,Te,Ve,Ze,Ie){const Ke=[],Je=[],Ht=Ie[8]*Te,fn=Ie[9]*Te,yt=Ie[10]*Te,jt=Ie[11]*Te,Be=Ie[8]*Ve,Yt=Ie[9]*Ve,Zt=Ie[10]*Ve,jn=Ie[11]*Ve;for(const Ln of Oe){const yr=[],Zr=[];for(const Qt of Ln){const Ot=Qt.x+Ze.x,Sn=Qt.y+Ze.y,Un=Ie[0]*Ot+Ie[4]*Sn+Ie[12],$n=Ie[1]*Ot+Ie[5]*Sn+Ie[13],Qn=Ie[2]*Ot+Ie[6]*Sn+Ie[14],Wr=Ie[3]*Ot+Ie[7]*Sn+Ie[15],zi=Un+Ht,Xr=$n+fn,En=Qn+yt,ar=Math.max(Wr+jt,1e-5),ro=Un+Be,Or=$n+Yt,Bt=Qn+Zt,Cr=Math.max(Wr+jn,1e-5),An=new We(zi/ar,Xr/ar);An.z=En/ar,yr.push(An);const Br=new We(ro/Cr,Or/Cr);Br.z=Bt/Cr,Zr.push(Br)}Ke.push(yr),Je.push(Zr)}return[Ke,Je]}(Y,ie,ce,he,fe)),q=i.queryGeometry;var Y,ie,ce,he,fe,me;return function(Y,ie,ce){let he=1/0;r_(ce,ie)&&(he=td(ce,ie[0]));for(let fe=0;fe<ie.length;fe++){const me=ie[fe],Ce=Y[fe];for(let Ee=0;Ee<me.length-1;Ee++){const $e=me[Ee],Oe=[$e,me[Ee+1],Ce[Ee+1],Ce[Ee],$e];qc(ce,Oe)&&(he=Math.min(he,td(ce,Oe)))}}return he!==1/0&&he}(U[0],U[1],q.isPointQuery()?q.screenBounds:q.screenGeometry)}},line:class extends ts{constructor(i){super(i,wm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if("line-gradient"===i){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Sr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=Rp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new nd(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new Ms(this,i)}queryRadius(i){const e=i,s=Em(Wc("line-width",this,e),Wc("line-gap-width",this,e)),l=Wc("line-offset",this,e);return s/2+Math.abs(l)+Wh(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,s,l,u,p){if(i.queryGeometry.isAboveHorizon)return!1;const _=i_(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),v=i.pixelToTileUnitsFactor/2*Em(this.paint.get("line-width").evaluate(e,s),this.paint.get("line-gap-width").evaluate(e,s)),w=this.paint.get("line-offset").evaluate(e,s);return w&&(l=function(T,M){const S=[],A=new We(0,0);for(let z=0;z<T.length;z++){const N=T[z],U=[];for(let q=0;q<N.length;q++){const Y=N[q-1],ie=N[q],ce=N[q+1],he=0===q?A:ie.sub(Y)._unit()._perp(),fe=q===N.length-1?A:ce.sub(ie)._unit()._perp(),me=he._add(fe)._unit();me._mult(1/(me.x*fe.x+me.y*fe.y)),U.push(me._mult(M)._add(ie))}S.push(U)}return S}(l,w*i.pixelToTileUnitsFactor)),function(T,M,S){for(let A=0;A<M.length;A++){const z=M[A];if(T.length>=3)for(let N=0;N<z.length;N++)if(ua(T,z[N]))return!0;if(tm(T,z,S))return!0}return!1}(_,l,v)}isTileClipped(){return!0}},symbol:_d,background:class extends ts{constructor(i){super(i,U_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ts{constructor(i){super(i,$_)}getProgramIds(){return["raster"]}},sky:class extends ts{constructor(i){super(i,jm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){"sky-gradient"===i?this._updateColorRamp():"sky-atmosphere-sun"!==i&&"sky-atmosphere-halo-color"!==i&&"sky-atmosphere-color"!==i&&"sky-atmosphere-sun-intensity"!==i||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=am({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(i,e){const s=this.paint.get("sky-type");if("atmosphere"===s){const l=this.paint.get("sky-atmosphere-sun"),u=!l,p=i.style.light,_=p.properties.get("position");return u&&"viewport"===p.properties.get("anchor")&&Pn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Um(_.azimuthal,90-_.polar,e):Um(l[0],90-l[1],e)}if("gradient"===s){const l=this.paint.get("sky-gradient-center");return Um(l[0],90-l[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return"atmosphere"===i?["skyboxCapture","skybox"]:"gradient"===i?["skyboxGradient"]:null}}},{HTMLImageElement:q_,HTMLCanvasElement:af,HTMLVideoElement:lf,ImageData:$m,ImageBitmap:cu}=Pe;class cf{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:p}=e,{context:_}=this,{gl:v}=_;if(v.bindTexture(v.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!s||!1!==s.premultiply)),l||this.size&&this.size[0]===u&&this.size[1]===p){const{x:w,y:T}=l||{x:0,y:0};e instanceof q_||e instanceof af||e instanceof lf||e instanceof $m||cu&&e instanceof cu?v.texSubImage2D(v.TEXTURE_2D,0,w,T,v.RGBA,v.UNSIGNED_BYTE,e):v.texSubImage2D(v.TEXTURE_2D,0,w,T,u,p,v.RGBA,v.UNSIGNED_BYTE,e.data)}else this.size=[u,p],e instanceof q_||e instanceof af||e instanceof lf||e instanceof $m||cu&&e instanceof cu?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,e):v.texImage2D(v.TEXTURE_2D,0,this.format,u,p,0,this.format,v.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(e,s){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),s!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,s),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Gm{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.image=new Zl({width:e,height:s}),this.positions={},this.uploaded=!1}getDash(e,s){const l=this.getKey(e,s);return this.positions[l]}trim(){const e=this.width,s=this.height=wi(this.nextRow);this.image.resize({width:e,height:s})}getKey(e,s){return e.join(",")+s}getDashRanges(e,s,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,_=e[0]*l,v=!0;u.push({left:p,right:_,isDash:v,zeroLength:0===e[0]});let w=e[0];for(let T=1;T<e.length;T++){v=!v;const M=e[T];p=w*l,w+=M,_=w*l,u.push({left:p,right:_,isDash:v,zeroLength:0===M})}return u}addRoundDash(e,s,l){const u=s/2;for(let p=-l;p<=l;p++){const _=this.width*(this.nextRow+l+p);let v=0,w=e[v];for(let T=0;T<this.width;T++){T/w.right>1&&(w=e[++v]);const M=Math.abs(T-w.left),S=Math.abs(T-w.right),A=Math.min(M,S);let z;const N=p/l*(u+1);if(w.isDash){const U=u-Math.abs(N);z=Math.sqrt(A*A+U*U)}else z=u-Math.sqrt(A*A+N*N);this.image.data[_+T]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(e,s){for(let w=e.length-1;w>=0;--w){const T=e[w],M=e[w+1];T.zeroLength?e.splice(w,1):M&&M.isDash===T.isDash&&(M.left=T.left,e.splice(w,1))}const l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const p=this.width*this.nextRow;let _=0,v=e[_];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++_]);const T=Math.abs(w-v.left),M=Math.abs(w-v.right),S=Math.min(T,M);this.image.data[p+w]=Math.max(0,Math.min(255,(v.isDash?S:-S)+s+128))}}addDash(e,s){const l=this.getKey(e,s);if(this.positions[l])return this.positions[l];const u="round"===s,p=u?7:0,_=2*p+1;if(this.nextRow+_>this.height)return Pn("LineAtlas out of space"),null;0===e.length&&e.push(1);let v=0;for(let M=0;M<e.length;M++)e[M]<0&&(Pn("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),v+=e[M];if(0!==v){const M=this.width/v,S=this.getDashRanges(e,this.width,M);u?this.addRoundDash(S,M,p):this.addRegularDash(S,"square"===s?.5*M:0)}const w=this.nextRow+p;this.nextRow+=_;const T={tl:[w,p],br:[v,0]};return this.positions[l]=T,T}}Ye("LineAtlas",Gm);class Wv{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Xv=Pe.performance;function Z_(i){const e=i?i.url.toString():void 0;return Xv.getEntriesByName(e)}class Kv{constructor(){this.tasks={},this.taskQueue=[],Da(["process"],this),this.invoker=new Wv(this.process),this.nextId=0}add(e,s){const l=this.nextId++,u=function({type:p,isSymbolTile:_,zoom:v}){return v=v||0,"message"===p?0:"maybePrepare"!==p||_?"parseTile"!==p||_?"parseTile"===p&&_?300-v:"maybePrepare"===p&&_?400-v:500:200-v:100-v}(s);if(0===u){$i();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:e,metadata:s,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){$i();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const s=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let e=null,s=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<s&&(s=p.priority,e=u)}if(null===e)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}function W_(i,e,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[i*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class uf{constructor(e,s,l){this.z=e,this.x=s,this.y=l,this.key=Eo(0,e,e,s,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,s){const l=(_=this.y,v=this.z,w=W_(256*(p=this.x),256*(_=Math.pow(2,v)-_-1),v),T=W_(256*(p+1),256*(_+1),v),w[0]+","+w[1]+","+T[0]+","+T[1]),u=function(p,_,v){let w,T="";for(let M=p;M>0;M--)w=1<<M-1,T+=(_&w?1:0)+(v&w?2:0);return T}(this.z,this.x,this.y);var p,_,v,w,T;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hm{constructor(e,s){this.wrap=e,this.canonical=s,this.key=Eo(e,s.z,s.z,s.x,s.y)}}class Li{constructor(e,s,l,u,p){this.overscaledZ=e,this.wrap=s,this.canonical=new uf(l,+u,+p),this.key=0===s&&e===l?this.canonical.key:Eo(s,e,l,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const s=this.canonical.z-e;return e>this.canonical.z?new Li(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Li(e,this.wrap,e,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(e,s=!0){if(this.overscaledZ===e&&s)return this.key;if(e>this.canonical.z)return Eo(this.wrap*+s,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Eo(this.wrap*+s,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const s=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>s&&e.canonical.y===this.canonical.y>>s}children(e){if(this.overscaledZ>=e)return[new Li(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new Li(s,this.wrap,s,l,u),new Li(s,this.wrap,s,l+1,u),new Li(s,this.wrap,s,l,u+1),new Li(s,this.wrap,s,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Li(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Li(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Eo(i,e,s,l,u){const p=1<<Math.min(s,22);let _=p*(u%p)+l%p;return i&&s<22&&(_+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-s)))),16*(32*_+s)+(e-s)}Ye("CanonicalTileID",uf),Ye("OverscaledTileID",Li,{omit:["projMatrix"]});class al{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}al.ReadOnly=!1,al.ReadWrite=!0,al.disabled=new al(519,al.ReadOnly,[0,1]);class yd{constructor(e,s,l,u,p,_){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=p,this.pass=_}}yd.disabled=new yd({func:519,mask:0},0,0,7680,7680,7680);class To{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}To.Replace=[1,0],To.disabled=new To(To.Replace,qt.transparent,[!1,!1,!1,!1]),To.unblended=new To(To.Replace,qt.transparent,[!0,!0,!0,!0]),To.alphaBlended=new To([1,771],qt.transparent,[!0,!0,!0,!0]);class os{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}os.disabled=new os(!1,1029,2305),os.backCCW=new os(!0,1029,2305),os.backCW=new os(!0,1029,2304),os.frontCW=new os(!0,1028,2304),os.frontCCW=new os(!0,1028,2305);class da{constructor(e){this._stringToNumber={},this._numberToString=[];for(let s=0;s<e.length;s++){const l=e[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class df{constructor(e,s,l,u,p){this.type="Feature",this._vectorTileFeature=e,e._z=s,e._x=l,e._y=u,this.properties=e.properties,this.id=p}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const s in this)"_geometry"!==s&&"_vectorTileFeature"!==s&&(e[s]=this[s]);return e}}class X_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Fn(this.stateChanges[e][u],l),null===this.deletedStates[e]){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const p in this.state[e][u])l[p]||(this.deletedStates[e][u][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][p]&&delete this.deletedStates[e][u][p]}removeFeatureState(e,s,l){if(null===this.deletedStates[e])return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&void 0!==s)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(void 0!==s)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=Fn({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(null===p)return{};for(const _ in p)delete u[_]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const _ in this.stateChanges[u])this.state[u][_]||(this.state[u][_]={}),Fn(this.state[u][_],this.stateChanges[u][_]),p[_]=this.state[u][_];l[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(null===this.deletedStates[u])for(const _ in this.state[u])p[_]={},this.state[u][_]={};else for(const _ in this.deletedStates[u]){if(null===this.deletedStates[u][_])this.state[u][_]={};else for(const v of Object.keys(this.deletedStates[u][_]))delete this.state[u][_][v];p[_]=this.state[u][_]}l[u]=l[u]||{},Fn(l[u],p)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const u in e)e[u].setFeatureState(l,s)}}class xd{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,s){const l=this.toIdx(e,s);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,s){return this.leaves[this.toIdx(e,s)]}toIdx(e,s){return s*this.size+e}}function qm(i,e,s,l){let u=0,p=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(s[_]<i[_]||s[_]>e[_])return null}else{const v=1/l[_];let w=(i[_]-s[_])*v,T=(e[_]-s[_])*v;if(w>T){const M=w;w=T,T=M}if(w>u&&(u=w),T<p&&(p=T),u>p)return null}return u}function pf(i,e,s,l,u,p,_,v,w,T,M){const S=l-i,A=u-e,z=p-s,N=_-i,U=v-e,q=w-s,Y=M[1]*q-M[2]*U,ie=M[2]*N-M[0]*q,ce=M[0]*U-M[1]*N,he=S*Y+A*ie+z*ce;if(Math.abs(he)<1e-15)return null;const fe=1/he,me=T[0]-i,Ce=T[1]-e,Ee=T[2]-s,$e=(me*Y+Ce*ie+Ee*ce)*fe;if($e<0||$e>1)return null;const Oe=Ce*z-Ee*A,Te=Ee*S-me*z,Ve=me*A-Ce*S,Ze=(M[0]*Oe+M[1]*Te+M[2]*Ve)*fe;return Ze<0||$e+Ze>1?null:(N*Oe+U*Te+q*Ve)*fe}function Zm(i,e,s){return(i-e)/(s-e)}function Wm(i,e,s,l,u,p,_,v,w){const T=1<<s,M=p-l,S=_-u,A=(i+1)/T*M+l,z=(e+0)/T*S+u,N=(e+1)/T*S+u;v[0]=(i+0)/T*M+l,v[1]=z,w[0]=A,w[1]=N}class uu{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(p){const _=Math.ceil(Math.log2(p.dim/8)),v=[];let w=Math.ceil(Math.pow(2,_));const T=1/w,M=(z,N,U,q,Y)=>{const ie=q?1:0,ce=(z+1)*U-ie,he=N*U,fe=(N+1)*U-ie;Y[0]=z*U,Y[1]=he,Y[2]=ce,Y[3]=fe};let S=new xd(w);const A=[];for(let z=0;z<w*w;z++){M(z%w,Math.floor(z/w),T,!1,A);const N=Rs(A[0],A[1],p),U=Rs(A[2],A[1],p),q=Rs(A[2],A[3],p),Y=Rs(A[0],A[3],p);S.minimums.push(Math.min(N,U,q,Y)),S.maximums.push(Math.max(N,U,q,Y)),S.leaves.push(1)}for(v.push(S),w/=2;w>=1;w/=2){const z=v[v.length-1];S=new xd(w);for(let N=0;N<w*w;N++){M(N%w,Math.floor(N/w),2,!0,A);const U=z.getElevation(A[0],A[1]),q=z.getElevation(A[2],A[1]),Y=z.getElevation(A[2],A[3]),ie=z.getElevation(A[0],A[3]),ce=z.isLeaf(A[0],A[1]),he=z.isLeaf(A[2],A[1]),fe=z.isLeaf(A[2],A[3]),me=z.isLeaf(A[0],A[3]),Ce=Math.min(U.min,q.min,Y.min,ie.min),Ee=Math.max(U.max,q.max,Y.max,ie.max),$e=ce&&he&&fe&&me;S.maximums.push(Ee),S.minimums.push(Ce),S.leaves.push(Ee-Ce<=5&&$e?1:0)}v.push(S)}return v}(this.dem),l=s.length-1,u=s[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(s,0,0,l,0)}raycastRoot(e,s,l,u,p,_,v=1){return qm([e,s,-100],[l,u,this.maximums[0]*v],p,_)}raycast(e,s,l,u,p,_,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,s,l,u,p,_,v);if(null==w)return null;const T=[],M=[],S=[],A=[],z=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:N,t:U,nodex:q,nodey:Y,depth:ie}=z.pop();if(this.leaves[N]){Wm(q,Y,ie,e,s,l,u,S,A);const he=1<<ie,fe=(q+0)/he,me=(q+1)/he,Ce=(Y+0)/he,Ee=(Y+1)/he,$e=Rs(fe,Ce,this.dem)*v,Oe=Rs(me,Ce,this.dem)*v,Te=Rs(me,Ee,this.dem)*v,Ve=Rs(fe,Ee,this.dem)*v,Ze=pf(S[0],S[1],$e,A[0],S[1],Oe,A[0],A[1],Te,p,_),Ie=pf(A[0],A[1],Te,S[0],A[1],Ve,S[0],S[1],$e,p,_),Ke=Math.min(null!==Ze?Ze:Number.MAX_VALUE,null!==Ie?Ie:Number.MAX_VALUE);if(Ke!==Number.MAX_VALUE)return Ke;{const Je=ci([],p,_,U);if(ec($e,Oe,Ve,Te,Zm(Je[0],S[0],A[0]),Zm(Je[1],S[1],A[1]))>=Je[2])return U}continue}let ce=0;for(let he=0;he<this._siblingOffset.length;he++){Wm((q<<1)+this._siblingOffset[he][0],(Y<<1)+this._siblingOffset[he][1],ie+1,e,s,l,u,S,A),S[2]=-100,A[2]=this.maximums[this.childOffsets[N]+he]*v;const fe=qm(S,A,p,_);if(null!=fe){const me=fe;T[he]=me;let Ce=!1;for(let Ee=0;Ee<ce&&!Ce;Ee++)me>=T[M[Ee]]&&(M.splice(Ee,0,he),Ce=!0);Ce||(M[ce]=he),ce++}}for(let he=0;he<ce;he++){const fe=M[he];z.push({idx:this.childOffsets[N]+fe,t:T[fe],nodex:(q<<1)+this._siblingOffset[fe][0],nodey:(Y<<1)+this._siblingOffset[fe][1],depth:ie+1})}}return null}_addNode(e,s,l){return this.minimums.push(e),this.maximums.push(s),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,s,l,u,p){if(1===e[u].isLeaf(s,l))return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const _=u-1,v=e[_];let w,T=0;for(let M=0;M<this._siblingOffset.length;M++){const S=2*s+this._siblingOffset[M][0],A=2*l+this._siblingOffset[M][1],z=v.getElevation(S,A),N=v.isLeaf(S,A),U=this._addNode(z.min,z.max,N);N&&(T|=1<<M),w||(w=U)}for(let M=0;M<this._siblingOffset.length;M++)T&1<<M||this._construct(e,2*s+this._siblingOffset[M][0],2*l+this._siblingOffset[M][1],_,w+M)}}function ec(i,e,s,l,u,p){return Xt(Xt(i,s,p),Xt(e,l,p),u)}function Rs(i,e,s){const l=s.dim,u=cn(i*l-.5,0,l-1),p=cn(e*l-.5,0,l-1),_=Math.floor(u),v=Math.floor(p),w=Math.min(_+1,l-1),T=Math.min(v+1,l-1);return ec(s.get(_,v),s.get(w,v),s.get(_,T),s.get(w,T),u-_,p-v)}const tc={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ll{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,s,l,u=!1,p=!1){if(this.uid=e,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return Pn(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const _=this.dim=s.height-2;if(this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox",this.borderReady=u,!u){for(let v=0;v<_;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(_,v)]=this.data[this._idx(_-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,_)]=this.data[this._idx(v,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new uu(this)}get(e,s,l=!1){const u=new Uint8Array(this.data.buffer);l&&(e=cn(e,-1,this.dim),s=cn(s,-1,this.dim));const p=4*this._idx(e,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])}static getUnpackVector(e){return tc[e]}get unpackVector(){return tc[this.encoding]}_idx(e,s){if(e<-1||e>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(e+1)}_unpackMapbox(e,s,l){return(256*e*256+256*s+l)/10-1e4}_unpackTerrarium(e,s,l){return 256*e+s+l/256-32768}static pack(e,s){const l=[0,0,0,0],u=ll.getUnpackVector(s);let p=Math.floor((e+u[3])/u[2]);return l[2]=p%256,p=Math.floor(p/256),l[1]=p%256,p=Math.floor(p/256),l[0]=p,l}getPixels(){return new bo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,s,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=s*this.dim,p=s*this.dim+this.dim,_=l*this.dim,v=l*this.dim+this.dim;switch(s){case-1:u=p-1;break;case 1:p=u+1}switch(l){case-1:_=v-1;break;case 1:v=_+1}const w=-s*this.dim,T=-l*this.dim;for(let M=_;M<v;M++)for(let S=u;S<p;S++)this.data[this._idx(S,M)]=e.data[this._idx(S+w,M+T)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ye("DEMData",ll),Ye("DemMinMaxQuadTree",uu,{omit:["dem"]});class hu{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(void 0!==l&&(p.timeout=setTimeout(()=>{this.remove(e,p)},l)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=void 0===s?0:this.data[l].indexOf(s),p=this.data[l][u];return this.data[l].splice(u,1),p.timeout&&clearTimeout(p.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class nc extends qs{constructor(e,s,l){super(),this.id=e,this._onlySymbols=l,s.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new hu(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new X_}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const s=this._tiles[e];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,s){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,s)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Ta(this._tiles).map(e=>e.tileID).sort(ff).map(e=>e.key)}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(+l,e)&&s.push(this._tiles[l]);return e?s.sort((l,u)=>{const p=l.tileID,_=u.tileID,v=new We(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),w=new We(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||w.y-v.y||w.x-v.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(ff).map(l=>l.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,s){const l=this._tiles[e];l&&("loading"!==l.state&&(l.state=s),this._loadTile(l,this._tileLoaded.bind(this,l,e,s)))}_tileLoaded(e,s,l,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new Cu(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=hr.now(),"expired"===l&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new gs("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const _=this.getTileByID(p);l(e,_),l(_,e)}}function l(u,p){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let _=p.tileID.canonical.x-u.tileID.canonical.x;const v=p.tileID.canonical.y-u.tileID.canonical.y,w=Math.pow(2,u.tileID.canonical.z),T=p.tileID.key;0===_&&0===v||Math.abs(v)>1||(Math.abs(_)>1&&(1===Math.abs(_+w)?_+=w:1===Math.abs(_-w)&&(_-=w)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,_,v),u.neighboringTiles&&u.neighboringTiles[T]&&(u.neighboringTiles[T].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const p in this._tiles){let _=this._tiles[p];if(u[p]||!_.hasData()||_.tileID.overscaledZ<=s||_.tileID.overscaledZ>l)continue;let v=_.tileID;for(;_&&_.tileID.overscaledZ>s+1;){const T=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[T.key],_&&_.hasData()&&(v=T)}let w=v;for(;w.overscaledZ>s;)if(w=w.scaledTo(w.overscaledZ-1),e[w.key]){u[v.key]=v;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),p=this._getLoadedTile(u);if(p)return p}}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,s){s=s||this._source.tileSize;const l=Math.ceil(e.width/s)+1,u=Math.ceil(e.height/s)+1,p=Math.floor(l*u*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,p):p,v="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(e){const s=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,s,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let u;this.updateCacheSize(e,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new Li(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(u=e.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(v=>this._source.hasTile(v)))):u=[];const p=this._updateRetainedTiles(u);if(mf(this._source.type)&&0!==u.length){const v={},w={},T=Object.keys(p);for(const S of T){const A=p[S],z=this._tiles[S];if(!z||z.fadeEndTime&&z.fadeEndTime<=hr.now())continue;const N=this.findLoadedParent(A,Math.max(A.overscaledZ-nc.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),v[N.tileID.key]=N.tileID),w[S]=A}const M=u[u.length-1].overscaledZ;for(const S in this._tiles){const A=this._tiles[S];if(p[S]||!A.hasData())continue;let z=A.tileID;for(;z.overscaledZ>M;){z=z.scaledTo(z.overscaledZ-1);const N=this._tiles[z.key];if(N&&N.hasData()&&w[z.key]){p[S]=A.tileID;break}}}for(const S in v)p[S]||(this._coveredTiles[S]=!0,p[S]=v[S])}for(const v in p)this._tiles[v].clearFadeHold();const _=function(v,w){const T=[];for(const M in v)M in w||T.push(M);return T}(this._tiles,p);for(const v of _){const w=this._tiles[v];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const s={};if(0===e.length)return s;const l={},u=e.reduce((T,M)=>Math.min(T,M.overscaledZ),1/0),p=e[0].overscaledZ,_=Math.max(p-nc.maxOverzooming,this._source.minzoom),v=Math.max(p+nc.maxUnderzooming,this._source.minzoom),w={};for(const T of e){const M=this._addTile(T);s[T.key]=T,M.hasData()||u<this._source.maxzoom&&(w[T.key]=T)}this._retainLoadedChildren(w,u,v,s);for(const T of e){let M=this._tiles[T.key];if(M.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const A=T.children(this._source.maxzoom)[0],z=this.getTile(A);if(z&&z.hasData()){s[A.key]=A;continue}}else{const A=T.children(this._source.maxzoom);if(s[A[0].key]&&s[A[1].key]&&s[A[2].key]&&s[A[3].key])continue}let S=M.wasRequested();for(let A=T.overscaledZ-1;A>=_;--A){const z=T.scaledTo(A);if(l[z.key]||(l[z.key]=!0,M=this.getTile(z),!M&&S&&(M=this._addTile(z)),M&&(s[z.key]=z,S=M.wasRequested(),M.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;u=p}for(const p of s)this._loadedParentTiles[p]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=Boolean(s);if(!l){const u=this.map?this.map.painter:null,p="raster"===this._source.type||"raster-dem"===this._source.type;s=new yf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,p),this._loadTile(s,this._tileLoaded.bind(this,s,e.key,s.state))}return s?(s.uses++,this._tiles[e.key]=s,l||this._source.fire(new gs("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,s,l){const u=[],p=this.transform;if(!p)return u;for(const _ in this._tiles){const v=this._tiles[_];if(l&&v.clearQueryDebugViz(),v.holdingForFade())continue;const w=e.containsTile(v,p,s);w&&u.push(w)}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of s)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(mf(this._source.type))for(const e in this._tiles){const s=this._tiles[e];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=hr.now())return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,s))}_preloadTiles(e,s){const l=new Map,u=Array.isArray(e)?e:[e],p=this.map.painter.terrain,_=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const T of u){const M=T.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of M)l.set(S.key,S);this.usedForTerrain&&T.updateElevation(!1)}const v=Array.from(l.values()),w="raster"===this._source.type||"raster-dem"===this._source.type;ds(v,(T,M)=>{const S=new yf(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,w);this._loadTile(S,A=>{"raster-dem"===this._source.type&&S.dem&&this._backfillDEM(S),M(A,S)})},s)}}function ff(i,e){const s=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||l-s||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function mf(i){return"raster"===i||"image"===i||"video"===i}nc.maxOverzooming=10,nc.maxUnderzooming=3;class du{constructor(e,s,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=s,this._offset=l}static create(e,s,l){const u=l||e.findDEMTileFor(s);if(!u||!u.dem)return;const p=u.dem,_=u.tileID,v=1<<s.canonical.z-_.canonical.z;return new du(u,u.tileSize/Dt/v,[(s.canonical.x/v-_.canonical.x)*p.dim,(s.canonical.y/v-_.canonical.y)*p.dim])}tileCoordToPixel(e,s){const l=s*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(l);return new We(u,p)}getElevationAt(e,s,l,u){const p=e*this._scale+this._offset[0],_=s*this._scale+this._offset[1],v=Math.floor(p),w=Math.floor(_),T=this._dem;return u=!!u,l?Xt(Xt(T.get(v,w,u),T.get(v,w+1,u),_-w),Xt(T.get(v+1,w,u),T.get(v+1,w+1,u),_-w),p-v):T.get(v,w,u)}getElevationAtPixel(e,s,l){return this._dem.get(e,s,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ns(1,e)*this._dem.stride}}class bd{constructor(e,s){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Jo(Dt,16,0),this.featureIndexArray=new gr,this.promoteId=s}insert(e,s,l,u,p,_=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,p,_);const w=this.grid;for(let T=0;T<s.length;T++){const M=s[T],S=[1/0,1/0,-1/0,-1/0];for(let A=0;A<M.length;A++){const z=M[A];S[0]=Math.min(S[0],z.x),S[1]=Math.min(S[1],z.y),S[2]=Math.max(S[2],z.x),S[3]=Math.max(S[3],z.y)}S[0]<Dt&&S[1]<Dt&&S[2]>=0&&S[3]>=0&&w.insert(v,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Wl.VectorTile(new ha(this.rawTileData)).layers,this.sourceLayerCoder=new da(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,s,l,u){this.loadVTLayers();const p=e.params||{},_=Rc(p.filter),v=e.tileResult,w=e.transform,T=v.bufferedTilespaceBounds,M=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(N,U,q,Y)=>Zh(v.bufferedTilespaceGeometry,N,U,q,Y));M.sort(wd);let S=null;w.elevation&&M.length>0&&(S=du.create(w.elevation,this.tileID));const A={};let z;for(let N=0;N<M.length;N++){const U=M[N];if(U===z)continue;z=U;const q=this.featureIndexArray.get(U);let Y=null;this.loadMatchingFeature(A,q,_,p.layers,p.availableImages,s,l,u,(ie,ce,he,fe=0)=>(Y||(Y=Ss(ie,this.tileID.canonical,e.tileTransform)),ce.queryIntersectsFeature(v,ie,he,Y,this.z,e.transform,e.pixelPosMatrix,S,fe)))}return A}loadMatchingFeature(e,s,l,u,p,_,v,w,T){const{featureIndex:M,bucketIndex:S,sourceLayerIndex:A,layoutVertexArrayOffset:z}=s,N=this.bucketLayerIDs[S];if(u&&!function(ie,ce){for(let he=0;he<ie.length;he++)if(ce.indexOf(ie[he])>=0)return!0;return!1}(u,N))return;const U=this.sourceLayerCoder.decode(A),q=this.vtLayers[U].feature(M);if(l.needGeometry){const ie=ql(q,!0);if(!l.filter(new gt(this.tileID.overscaledZ),ie,this.tileID.canonical))return}else if(!l.filter(new gt(this.tileID.overscaledZ),q))return;const Y=this.getId(q,U);for(let ie=0;ie<N.length;ie++){const ce=N[ie];if(u&&u.indexOf(ce)<0)continue;const he=_[ce];if(!he)continue;let fe={};void 0!==Y&&w&&(fe=w.getState(he.sourceLayer||"_geojsonTileLayer",Y));const me=Fn({},v[ce]);me.paint=gf(me.paint,he.paint,q,fe,p),me.layout=gf(me.layout,he.layout,q,fe,p);const Ce=!T||T(q,he,fe,z);if(!Ce)continue;const Ee=new df(q,this.z,this.x,this.y,Y);Ee.layer=me;let $e=e[ce];void 0===$e&&($e=e[ce]=[]),$e.push({featureIndex:M,feature:Ee,intersectionZ:Ce})}}lookupSymbolFeatures(e,s,l,u,p,_,v,w){const T={};this.loadVTLayers();const M=Rc(p);for(const S of e)this.loadMatchingFeature(T,{bucketIndex:l,sourceLayerIndex:u,featureIndex:S,layoutVertexArrayOffset:0},M,_,v,w,s);return T}loadFeature(e){const{featureIndex:s,sourceLayerIndex:l}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(l),p=this.vtFeatures[u];if(p[s])return p[s];const _=this.vtLayers[u].feature(s);return p[s]=_,_}hasLayer(e){for(const s of this.bucketLayerIDs)for(const l of s)if(e===l)return!0;return!1}getId(e,s){let l=e.id;return this.promoteId&&(l=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof l&&(l=Number(l))),l}}function gf(i,e,s,l,u){return ps(i,(p,_)=>{const v=e instanceof yo?e.get(_):null;return v&&v.evaluate?v.evaluate(s,l,u):v})}function wd(i,e){return e-i}Ye("FeatureIndex",bd,{omit:["rawTileData","sourceLayerCoder"]});var K_=In([{name:"a_pos",type:"Int16",components:2}]);const fa=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,s=0,l=0,u=0,p=0,_=0,v=0;for(1&e?u=p=_=32:s=l=v=32;(e>>=1)>1;){const T=s+u>>1,M=l+p>>1;1&e?(u=s,p=l,s=_,l=v):(s=u,l=p,u=_,p=v),_=T,v=M}const w=4*i;fa[w+0]=s,fa[w+1]=l,fa[w+2]=u,fa[w+3]=p}const ss=new Uint16Array(2178),cl=new Uint8Array(1089),sh=new Uint16Array(1089);function Xm(i){return 0===i?-.03125:32===i?.03125:0}var _f=In([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Ri={type:2,extent:Dt,loadGeometry:()=>[[new We(0,0),new We(8193,0),new We(8193,8193),new We(0,8193),new We(0,0)]]};class yf{constructor(e,s,l,u,p){this.tileID=e,this.uid=xc(),this.uses=0,this.tileSize=s,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const s=e+this.timeAdded;s<hr.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=rc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,s,l){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const _={};if(!p)return _;for(const v of u){const w=v.layerIds.map(T=>p.getLayer(T)).filter(Boolean);if(0!==w.length){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(T=>w.filter(M=>M.id===T)[0]));for(const T of w)_[T.id]=v}}return _}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof Ls){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof Ls&&p.hasRTLText){this.hasRTLText=!0,Gt.isLoading()||Gt.isLoaded()||"deferred"!==Qi()||ii();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Jf}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new cf(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new cf(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new cf(e,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,p,_,v,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:v,transform:_,params:p,tileTransform:this.tileTransform},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),p=s?s.sourceLayer:"",_=u._geojsonTileLayer||u[p];if(!_)return;const v=Rc(s&&s.filter),{z:w,x:T,y:M}=this.tileID.canonical,S={z:w,x:T,y:M};for(let A=0;A<_.length;A++){const z=_.feature(A);if(v.needGeometry){const q=ql(z,!0);if(!v.filter(new gt(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!v.filter(new gt(this.tileID.overscaledZ),z))continue;const N=l.getId(z,p),U=new df(z,w,T,M,N);U.tile=S,e.push(U)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=Us(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!s)return;const l=this.latestFeatureIndex.loadVTLayers(),u=s.style.listImages();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const _=this.buckets[p],v=_.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],T=e[v];if(!w||!T||0===Object.keys(T).length)continue;if(_.update(T,w,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof nd||_ instanceof ed){const S=s.style._getSourceCache(_.layers[0].source);s._terrain&&s._terrain.enabled&&S&&_.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(S.id,this.tileID)}const M=s&&s.style&&s.style.getLayer(p);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<hr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=hr.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u)for(const p of s)if(u[p])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const l=Ss(Ri,this.tileID.canonical,this.tileTransform)[0],u=new jl,p=new cp;for(let _=0;_<l.length;_++){const{x:v,y:w}=l[_];u.emplaceBack(v,w),p.emplaceBack(_)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(u,_f.members),this._tileDebugSegments=Xn.simpleSegment(0,0,u.length,p.length)}_makeTileBoundsBuffers(e,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const l=Ss(Ri,this.tileID.canonical,this.tileTransform)[0];let u,p;if(this.isRaster){const _=function(v,w){const T=rc(v,w),M=Math.pow(2,v.z);for(let q=0;q<33;q++)for(let Y=0;Y<33;Y++){const ie=ca((v.x+(Y+Xm(Y))/32)/M),ce=vo((v.y+(q+Xm(q))/32)/M),he=w.project(ie,ce),fe=33*q+Y;ss[2*fe+0]=Math.round((he.x*T.scale-T.x)*Dt),ss[2*fe+1]=Math.round((he.y*T.scale-T.y)*Dt)}cl.fill(0),sh.fill(0);for(let q=2045;q>=0;q--){const Y=4*q,ie=fa[Y+0],ce=fa[Y+1],he=fa[Y+2],fe=fa[Y+3],me=ie+he>>1,Ce=ce+fe>>1,Ee=me+Ce-ce,$e=Ce+ie-me,Oe=33*ce+ie,Te=33*fe+he,Ve=33*Ce+me,Ze=Math.hypot((ss[2*Oe+0]+ss[2*Te+0])/2-ss[2*Ve+0],(ss[2*Oe+1]+ss[2*Te+1])/2-ss[2*Ve+1])>=16;if(cl[Ve]=cl[Ve]||(Ze?1:0),q<1022){const Ie=33*(ce+$e>>1)+(ie+Ee>>1),Ke=33*(fe+$e>>1)+(he+Ee>>1);cl[Ve]=cl[Ve]||cl[Ie]||cl[Ke]}}const S=new Ul,A=new fi;let z=0;function N(q,Y){const ie=33*Y+q;return 0===sh[ie]&&(S.emplaceBack(ss[2*ie+0],ss[2*ie+1],q*Dt/32,Y*Dt/32),sh[ie]=++z),sh[ie]-1}function U(q,Y,ie,ce,he,fe){const me=q+ie>>1,Ce=Y+ce>>1;if(Math.abs(q-he)+Math.abs(Y-fe)>1&&cl[33*Ce+me])U(he,fe,q,Y,me,Ce),U(ie,ce,he,fe,me,Ce);else{const Ee=N(q,Y),$e=N(ie,ce),Oe=N(he,fe);A.emplaceBack(Ee,$e,Oe)}}return U(0,0,32,32,32,0),U(32,32,0,0,0,32),{vertices:S,indices:A}}(this.tileID.canonical,s);u=_.vertices,p=_.indices}else{u=new Ul,p=new fi;for(const{x:v,y:w}of l)u.emplaceBack(v,w,0,0);const _=Kh(u.int16,void 0,4);for(let v=0;v<_.length;v+=3)p.emplaceBack(_[v],_[v+1],_[v+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,_f.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=Xn.simpleSegment(0,0,u.length,p.length)}}const Y_=In([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),Yv=In([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:J_}=Y_;function ul(i,e){const s=i.fovAboveCenter,l=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,u=(i._camera.position[2]*i.worldSize-l)/Math.cos(i._pitch),p=Math.sin(s)*u/Math.sin(Math.max(Math.PI/2-i._pitch-s,.01)),_=Math.sin(i._pitch)*p+u;return Math.min(1.01*_,u*(1/i._horizonShift))}const Km=Dt/Math.PI/2,Fi=-Km,si=Km,Ym=[new xo([Fi,Fi,Fi],[si,si,si]),new xo([Fi,Fi,Fi],[0,0,si]),new xo([0,Fi,Fi],[si,0,si]),new xo([Fi,0,Fi],[0,si,si]),new xo([0,0,Fi],[si,si,si])];function Ed(i){if(i.z<=1)return Ym[i.z+2*i.y+i.x];const[e,s]=Jm(i),l=[ah(e[0],e[1]),ah(e[0],s[1]),ah(s[0],e[1]),ah(s[0],s[1])],u=[si,si,si],p=[Fi,Fi,Fi];for(const _ of l)u[0]=Math.min(u[0],_[0]),u[1]=Math.min(u[1],_[1]),u[2]=Math.min(u[2],_[2]),p[0]=Math.max(p[0],_[0]),p[1]=Math.max(p[1],_[1]),p[2]=Math.max(p[2],_[2]);return new xo(u,p)}function Jm(i){const e=Math.pow(2,i.z),s=i.x/e,l=(i.x+1)/e,u=(i.y+1)/e;return[[vo(i.y/e),ca(s)],[vo(u),ca(l)]]}function vf(i,e,s,l){return s=Lt(s),l||(l=Km),[i*Math.sin(s)*l,-e*l,i*Math.cos(s)*l]}function ah(i,e,s){return vf(Math.cos(Lt(i)),Math.sin(Lt(i)),e,s)}function Qm(i){return 16383/Math.max(...Ns([],i.max,i.min))}function xf(i){const e=Qr(new Float64Array(16)),s=1/Qm(i);return Bi(e,e,i.min),ur(e,e,[s,s,s]),e}function eg(i,e,s){const l=e/(2*Math.PI),u=function(_){const v=Dt/(2*Math.PI);return _/(2*Math.PI)/v}(e);if(!s){const _=cn(i.center.lat,-85.051129,mi);s=[nl(i.center.lng)*e,Is(_)*e]}const p=Qr(new Float64Array(16));return Bi(p,p,[s[0],s[1],-l]),ur(p,p,[u,u,u]),Po(p,p,Lt(-i._center.lat)),ao(p,p,Lt(-i._center.lng)),p}class bf{constructor(e){const s=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(s,!0),this.gridSegments=Xn.simpleSegment(0,0,4225,8192);const l=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(l,!0),this.poleSegments=Xn.simpleSegment(0,0,66,64);const u=new Vc;u.emplaceBack(-1,1,1,0,0,0,0),u.emplaceBack(1,1,1,0,0,1,0),u.emplaceBack(1,-1,1,0,0,1,1),u.emplaceBack(-1,-1,1,0,0,0,1);const p=new fi;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(u,Yv.members),this.atmosphereIndexBuffer=e.createIndexBuffer(p),this.atmosphereSegments=Xn.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,s,l){const u=new Vc,p=s/Math.PI/2;u.emplaceBack(0,-p,0,0,0,.5,l?0:1);const _=360/e,v=Math.cos(Lt(85)),w=Math.sin(Lt(85));for(let M=0;M<=64;M++){const S=M/64,A=vf(v,w,0*(1-(T=S))+_*T,p);u.emplaceBack(A[0],A[1],A[2],0,0,S,l?0:1)}var T;return u}_createPoleTriangleIndices(){const e=new fi;for(let s=0;s<=64;s++)e.emplaceBack(0,s+1,s+2);return e}static createGridVertices(e){const s=Math.pow(2,e.z),l=(w,T,M)=>w*(1-M)+T*M,[u,p]=Jm(e),_=new Vc,v=function(w){const T=Qr(new Float64Array(16)),M=Qm(w);var S,A;return ur(T,T,[M,M,M]),Bi(T,T,((S=[])[0]=-(A=w.min)[0],S[1]=-A[1],S[2]=-A[2],S)),T}(Ed(e));_.reserve(4096);for(let w=0;w<65;w++){const T=l(u[0],p[0],w/64),M=Is(T),S=M*s-e.y,A=Math.sin(Lt(T)),z=Math.cos(Lt(T));for(let N=0;N<65;N++){const U=N/64,q=l(u[1],p[1],U),Y=vf(z,A,q);$t(Y,Y,v);const ie=nl(q);_.emplaceBack(Y[0],Y[1],Y[2],ie,M,U,S)}}return _}_createGridIndices(){const e=new fi,s=(l,u)=>{const p=65*u+l;e.emplaceBack(p+1,p,p+65),e.emplaceBack(p+65,p+65+1,p+1)};for(let l=0;l<64;l++)for(let u=0;u<64;u++)s(u,l);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const s=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(s),this.wireframeSegments=Xn.simpleSegment(0,0,4096,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new eo,s=(l,u)=>{const p=65*u+l;e.emplaceBack(p,p+1),e.emplaceBack(p,p+65),e.emplaceBack(p,p+65+1)};for(let l=0;l<64;l++)for(let u=0;u<64;u++)s(u,l);return e}}function rc(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const s=Math.pow(2,-i.z),l=i.x*s,u=(i.x+1)*s,p=i.y*s,_=(i.y+1)*s,v=ca(l),w=ca(u),T=vo(p),M=vo(_),S=e.project(v,T),A=e.project(w,T),z=e.project(w,M),N=e.project(v,M);let U=Math.min(S.x,A.x,z.x,N.x),q=Math.min(S.y,A.y,z.y,N.y),Y=Math.max(S.x,A.x,z.x,N.x),ie=Math.max(S.y,A.y,z.y,N.y);const ce=s/16;function he(me,Ce,Ee,$e,Oe,Te){const Ve=(Ee+Oe)/2,Ze=($e+Te)/2,Ie=e.project(ca(Ve),vo(Ze)),Ke=Math.max(0,U-Ie.x,q-Ie.y,Ie.x-Y,Ie.y-ie);U=Math.min(U,Ie.x),Y=Math.max(Y,Ie.x),q=Math.min(q,Ie.y),ie=Math.max(ie,Ie.y),Ke>ce&&(he(me,Ie,Ee,$e,Ve,Ze),he(Ie,Ce,Ve,Ze,Oe,Te))}he(S,A,l,p,u,p),he(A,z,u,p,u,_),he(z,N,u,_,l,_),he(N,S,l,_,l,p),U-=ce,q-=ce,Y+=ce,ie+=ce;const fe=1/Math.max(Y-U,ie-q);return{scale:fe,x:U*fe,y:q*fe,x2:Y*fe,y2:ie*fe,projection:e}}class wf{constructor(e){const s={},l=[];for(const v in e){const w=e[v],T=s[v]={};for(const M in w.glyphs){const S=w.glyphs[+M];if(!S||0===S.bitmap.width||0===S.bitmap.height)continue;const A=S.metrics.localGlyph?2:1,z={x:0,y:0,w:S.bitmap.width+2*A,h:S.bitmap.height+2*A};l.push(z),T[M]=z}}const{w:u,h:p}=Up(l),_=new Zl({width:u||1,height:p||1});for(const v in e){const w=e[v];for(const T in w.glyphs){const M=w.glyphs[+T];if(!M||0===M.bitmap.width||0===M.bitmap.height)continue;const S=s[v][T],A=M.metrics.localGlyph?2:1;Zl.copy(M.bitmap,_,{x:0,y:0},{x:S.x+A,y:S.y+A},M.bitmap)}}this.image=_,this.positions=s}}Ye("GlyphAtlas",wf);class Q_{constructor(e){this.tileID=new Li(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=rc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,s,l,u,p){this.status="parsing",this.data=e,this.collisionBoxArray=new Jf;const _=new da(Object.keys(e.layers).sort()),v=new bd(this.tileID,this.promoteId);v.bucketLayerIDs=[];const w={},T=new Gm(256,256),M={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:l},S=s.familiesBySource[this.source];for(const fe in S){const me=e.layers[fe];if(!me)continue;let Ce=!1,Ee=!1;for(const Te of S[fe])"symbol"===Te[0].type?Ce=!0:Ee=!0;if(!0===this.isSymbolTile&&!Ce||!1===this.isSymbolTile&&!Ee)continue;1===me.version&&Pn(`Vector tile source "${this.source}" layer "${fe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const $e=_.encode(fe),Oe=[];for(let Te=0;Te<me.length;Te++){const Ve=me.feature(Te),Ze=v.getId(Ve,fe);Oe.push({feature:Ve,id:Ze,index:Te,sourceLayerIndex:$e})}for(const Te of S[fe]){const Ve=Te[0];void 0!==this.isSymbolTile&&"symbol"===Ve.type!==this.isSymbolTile||Ve.minzoom&&this.zoom<Math.floor(Ve.minzoom)||Ve.maxzoom&&this.zoom>=Ve.maxzoom||"none"!==Ve.visibility&&(Do(Te,this.zoom,l),(w[Ve.id]=Ve.createBucket({index:v.bucketLayerIDs.length,layers:Te,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$e,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:l})).populate(Oe,M,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(Te.map(Ze=>Ze.id)))}}let A,z,N,U;T.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Y=ps(M.glyphDependencies,fe=>Object.keys(fe).map(Number));Object.keys(Y).length?u.send("getGlyphs",{uid:this.uid,stacks:Y},(fe,me)=>{A||(A=fe,z=me,he.call(this))},void 0,!1,q):z={};const ie=Object.keys(M.iconDependencies);ie.length?u.send("getImages",{icons:ie,source:this.source,tileID:this.tileID,type:"icons"},(fe,me)=>{A||(A=fe,N=me,he.call(this))},void 0,!1,q):N={};const ce=Object.keys(M.patternDependencies);function he(){if(A)return p(A);if(z&&N&&U){const fe=new wf(z),me=new $p(N,U);for(const Ce in w){const Ee=w[Ce];Ee instanceof Ls?(Do(Ee.layers,this.zoom,l),Bm(Ee,z,fe.positions,N,me.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection),Ee.projection=this.projection.name):Ee.hasPattern&&(Ee instanceof nd||Ee instanceof ed||Ee instanceof kp)&&(Do(Ee.layers,this.zoom,l),Ee.addFeatures(M,this.tileID.canonical,me.patternPositions,l))}this.status="done",p(null,{buckets:Ta(w).filter(Ce=>!Ce.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:fe.image,lineAtlas:T,imageAtlas:me,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?fe.positions:null})}}ce.length?u.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"patterns"},(fe,me)=>{A||(A=fe,U=me,he.call(this))},void 0,!1,q):U={},he.call(this)}}function Do(i,e,s){const l=new gt(e);for(const u of i)u.recalculate(l,s)}class Td{constructor(e){this.entries={},this.scheduler=e}request(e,s,l,u){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[_,v]=p.result;return this.scheduler?this.scheduler.add(()=>{u(_,v)},s):u(_,v),()=>{}}return p.callbacks.push(u),p.cancel||(p.cancel=l((_,v)=>{p.result=[_,v];for(const w of p.callbacks)this.scheduler?this.scheduler.add(()=>{w(_,v)},s):w(_,v);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==u),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function tg(i,e,s){const l=JSON.stringify(i.request);return i.data&&(this.deduped.entries[l]={result:[null,i.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},u=>{const p=Gs(i.request,(_,v,w,T)=>{_?u(_):v&&u(null,{vectorTile:s?void 0:new Wl.VectorTile(new ha(v)),rawData:v,cacheControl:w,expires:T})});return()=>{p.cancel(),u()}},e)}const ey=Qr(new Float64Array(16));class pu{constructor(e,s){this._tr=e,this._worldSize=s}createInversionMatrix(){return ey}createTileMatrix(e){let s,l,u;const p=e.canonical,_=Qr(new Float64Array(16)),v=this._tr.projection;if(v.isReprojectedInTileSpace){const w=rc(p,v);s=1,l=w.x+e.wrap*w.scale,u=w.y,ur(_,_,[s/w.scale,s/w.scale,this._tr.pixelsPerMeter/this._worldSize])}else s=this._worldSize/this._tr.zoomScale(p.z),l=(p.x+Math.pow(2,p.z)*e.wrap)*s,u=p.y*s;return Bi(_,_,[l,u,0]),ur(_,_,[s/Dt,s/Dt,1]),_}pointCoordinate(e,s,l){const u=this._tr.horizonLineFromTop(!1),p=new We(e,Math.max(u,s));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(p,l))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var ng={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Fo(this.parallels,this.constants.parallels))return;const i=Math.sin(Lt(this.parallels[0])),e=(i+Math.sin(Lt(this.parallels[1])))/2,s=1+i*(2*e-i),l=Math.sqrt(s)/e;this.constants={n:e,c:s,r0:l,parallels:this.parallels}},project(i,e){this.initializeConstants();const s=Lt(i-this.center[0]),l=Lt(e),{n:u,c:p,r0:_}=this.constants,v=Math.sqrt(p-2*u*Math.sin(l))/u;return{x:v*Math.sin(s*u),y:v*Math.cos(s*u)-_,z:0}},unproject(i,e){this.initializeConstants();const{n:s,c:l,r0:u}=this.constants,p=u+e;let _=Math.atan2(i,Math.abs(p))*Math.sign(p);p*s<0&&(_-=Math.PI*Math.sign(i)*Math.sign(p));const v=Lt(this.center[0])*s;_=hs(_,-Math.PI-v,Math.PI-v);const w=bi(_/s)+this.center[0],T=Math.asin(cn((l-(i*i+p*p)*s*s)/(2*s),-1,1)),M=cn(bi(T),-85.051129,mi);return new rt(w,M)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ns(1,i)*e,farthestPixelDistance(i){return ul(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new pu(i,e)};const lh=1.340264,ch=-.081106,uh=893e-6,ic=.003796,Dd=Math.sqrt(3)/2;var ty={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,e){e=e/180*Math.PI,i=i/180*Math.PI;const s=Math.asin(Dd*Math.sin(e)),l=s*s,u=l*l*l;return{x:.5*(i*Math.cos(s)/(Dd*(lh+3*ch*l+u*(7*uh+9*ic*l)))/Math.PI+.5),y:1-.5*(s*(lh+ch*l+u*(uh+ic*l))/Math.PI+1),z:0}},unproject(i,e){i=(2*i-.5)*Math.PI;let s=e=(2*(1-e)-1)*Math.PI,l=s*s,u=l*l*l;for(let T,M,S,A=0;A<12&&(M=s*(lh+ch*l+u*(uh+ic*l))-e,S=lh+3*ch*l+u*(7*uh+9*ic*l),T=M/S,s=cn(s-T,-Math.PI/3,Math.PI/3),l=s*s,u=l*l*l,!(Math.abs(T)<1e-12));++A);const p=Dd*i*(lh+3*ch*l+u*(7*uh+9*ic*l))/Math.cos(s),_=Math.asin(Math.sin(s)/Dd),v=cn(180*p/Math.PI,-180,180),w=cn(180*_/Math.PI,-85.051129,mi);return new rt(v,w)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ns(1,i)*e,farthestPixelDistance(i){return ul(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new pu(i,e)},Cd={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(i,e)=>({x:.5+i/360,y:.5-e/360,z:0}),unproject(i,e){const s=360*(i-.5),l=cn(360*(.5-e),-85.051129,mi);return new rt(s,l)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ns(1,i)*e,farthestPixelDistance(i){return ul(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new pu(i,e)};const hl=Math.PI/2;function Md(i){return Math.tan((hl+i)/2)}var Ef={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Fo(this.parallels,this.constants.parallels))return;const i=Lt(this.parallels[0]),e=Lt(this.parallels[1]),s=Math.cos(i),l=i===e?Math.sin(i):Math.log(s/Math.cos(e))/Math.log(Md(e)/Md(i)),u=s*Math.pow(Md(i),l)/l;this.constants={n:l,f:u,parallels:this.parallels}},project(i,e){this.initializeConstants(),e=Lt(e),i=Lt(i-this.center[0]);const s=1e-6,{n:l,f:u}=this.constants;u>0?e<-hl+s&&(e=-hl+s):e>hl-s&&(e=hl-s);const p=u/Math.pow(Md(e),l),_=p*Math.sin(l*i),v=u-p*Math.cos(l*i);return{x:.5*(_/Math.PI+.5),y:1-.5*(v/Math.PI+.5),z:0}},unproject(i,e){this.initializeConstants(),i=(2*i-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:s,f:l}=this.constants,u=l-e,p=Math.sign(u),_=Math.sign(s)*Math.sqrt(i*i+u*u);let v=Math.atan2(i,Math.abs(u))*p;u*s<0&&(v-=Math.PI*Math.sign(i)*p);const w=cn(bi(v/s)+this.center[0],-180,180),T=cn(bi(2*Math.atan(Math.pow(l/_,1/s))-hl),-85.051129,mi);return new rt(w,T)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ns(1,i)*e,farthestPixelDistance(i){return ul(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new pu(i,e)},Tf={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(i,e)=>({x:nl(i),y:Is(e),z:0}),unproject(i,e){const s=ca(i),l=vo(e);return new rt(s,l)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ns(1,i)*e,farthestPixelDistance(i){return ul(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new pu(i,e)};const Df=Lt(mi);var ny={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(i,e){const s=(e=Lt(e))*e,l=s*s;return{x:.5*((i=Lt(i))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1),z:0}},unproject(i,e){i=(2*i-.5)*Math.PI;let s=e=(2*(1-e)-1)*Math.PI,l=25,u=0,p=s*s;do{p=s*s;const w=p*p;u=(s*(1.007226+p*(.015085+w*(.028874*p-.044475-.005916*w)))-e)/(1.007226+p*(.045255+w*(.259866*p-.311325-.005916*11*w))),s=cn(s-u,-Df,Df)}while(Math.abs(u)>1e-6&&--l>0);p=s*s;const _=cn(bi(i/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),v=bi(s);return new rt(_,v)},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ns(1,i)*e,farthestPixelDistance(i){return ul(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new pu(i,e)};const rg=Lt(mi),Id={albers:ng,equalEarth:ty,equirectangular:Cd,lambertConformalConic:Ef,mercator:Tf,naturalEarth:ny,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(i,e){e=Lt(e),i=Lt(i);const s=Math.cos(e),l=2/Math.PI,u=Math.acos(s*Math.cos(i/2)),p=Math.sin(u)/u,_=.5*(i*l+2*s*Math.sin(i/2)/p)||0,v=.5*(e+Math.sin(e)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}},unproject(i,e){let s=i=(2*i-.5)*Math.PI,l=e=(2*(1-e)-1)*Math.PI,u=25;const p=1e-6;let _=0,v=0;do{const w=Math.cos(l),T=Math.sin(l),M=2*T*w,S=T*T,A=w*w,z=Math.cos(s/2),N=Math.sin(s/2),U=2*z*N,q=N*N,Y=1-A*z*z,ie=Y?1/Y:0,ce=Y?Math.acos(w*z)*Math.sqrt(1/Y):0,he=.5*(2*ce*w*N+2*s/Math.PI)-i,fe=.5*(ce*T+l)-e,me=.5*ie*(A*q+ce*w*z*S)+1/Math.PI,Ce=ie*(U*M/4-ce*T*N),Ee=.125*ie*(M*N-ce*T*A*U),$e=.5*ie*(S*z+ce*q*w)+.5,Oe=Ce*Ee-$e*me;_=(fe*Ce-he*$e)/Oe,v=(he*Ee-fe*me)/Oe,s=cn(s-_,-Math.PI,Math.PI),l=cn(l-v,-rg,rg)}while((Math.abs(_)>p||Math.abs(v)>p)&&--u>0);return new rt(bi(s),bi(l))},projectTilePoint:(i,e)=>({x:i,y:e,z:0}),locationPoint:(i,e)=>i._coordinatePoint(i.locationCoordinate(e),!1),pixelsPerMeter:(i,e)=>ns(1,i)*e,farthestPixelDistance(i){return ul(i,this.pixelsPerMeter(i.center.lat,i.worldSize))},createTileTransform:(i,e)=>new pu(i,e)}};d.ARRAY_TYPE=Tn,d.AUTH_ERR_MSG=_e,d.Aabb=xo,d.Actor=class{constructor(i,e,s){this.target=i,this.parent=e,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Da(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=$i()?i:Pe,this.scheduler=new Kv}send(i,e,s,l,u=!1,p){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=p,this.callbacks[_]=s);const v=Gi(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!s,targetMapId:l,mustQueue:u,sourceMapId:this.mapId,data:or(e,v)},v),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(i){const e=i.data,s=e.id;if(s&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(e.mustQueue||$i()){const l=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,e),l&&l.metadata||{type:"message"})}else this.processTask(s,e)}processTask(i,e){if("<response>"===e.type){const s=this.callbacks[i];delete this.callbacks[i],s&&(e.error?s(Lr(e.error)):s(null,Lr(e.data)))}else{const s=Gi(this.globalScope)?void 0:[],l=e.hasCallback?(p,_)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:p?or(p):null,data:or(_,s)},s)}:p=>{},u=Lr(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,l);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],u.source)[p[1]](u,l)}else l(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=uf,d.Color=qt,d.ColorMode=To,d.CullFaceMode=os,d.DEMData=ll,d.DataConstantProperty=et,d.DedupedRequest=Td,d.DepthMode=al,d.EXTENT=Dt,d.Elevation=class{getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,s=!0){null==e&&(e=null);const l=this._source();if(!l||i.y<0||i.y>1)return e;const u=l.getSource().maxzoom,p=1<<u,_=Math.floor(i.x),v=i.x-_,w=new Li(u,_,u,Math.floor(v*p),Math.floor(i.y*p)),T=this.findDEMTileFor(w);if(!T||!T.dem)return e;const M=T.dem,S=1<<T.tileID.canonical.z,A=(v*S-T.tileID.canonical.x)*M.dim,z=(i.y*S-T.tileID.canonical.y)*M.dim,N=Math.floor(A),U=Math.floor(z);return(s?this.exaggeration():1)*Xt(Xt(M.get(N,U),M.get(N,U+1),z-U),Xt(M.get(N+1,U),M.get(N+1,U+1),z-U),A-N)}getAtTileOffset(i,e,s){const l=1<<i.canonical.z;return this.getAtPointOrZero(new Zu(i.wrap+(i.canonical.x+e/Dt)/l,(i.canonical.y+s/Dt)/l))}getAtTileOffsetFunc(i,e){return s=>{const l=this.getAtTileOffset(i,s.x,s.y),u=e.upVector(i.canonical,s.x,s.y);return xi(u,u,l*e.upVectorScale(i.canonical)),u}}getForTilePoints(i,e,s,l){const u=du.create(this,i,l);return!!u&&(e.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],s)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const s=e.dem.tree,l=e.tileID,u=1<<i.canonical.z-l.canonical.z;let p=i.canonical.x/u-l.canonical.x,_=i.canonical.y/u-l.canonical.y,v=0;for(let w=0;w<i.canonical.z-l.canonical.z&&!s.leaves[v];w++){p*=2,_*=2;const T=2*Math.floor(_)+Math.floor(p);v=s.childOffsets[v]+T,p%=1,_%=1}return{min:this.exaggeration()*s.minimums[v],max:this.exaggeration()*s.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,s){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=Cu,d.EvaluationParameters=gt,d.Event=gs,d.Evented=qs,d.Frustum=Xh,d.GLOBE_ZOOM_THRESHOLD_MAX=6,d.GlobeSharedBuffers=bf,d.GlyphManager=iu,d.ImagePosition=ld,d.LineAtlas=Gm,d.LngLat=rt,d.LngLatBounds=tl,d.LocalGlyphMode=dd,d.MAX_MERCATOR_LATITUDE=mi,d.MercatorCoordinate=Zu,d.ONE_EM=24,d.OverscaledTileID=Li,d.Properties=Wn,d.RGBAImage=bo,d.Ray=class{constructor(i,e){this.pos=i,this.dir=e}intersectsPlane(i,e,s){const l=Ni(e,this.dir);if(Math.abs(l)<1e-6)return!1;const u=((i[0]-this.pos[0])*e[0]+(i[1]-this.pos[1])*e[1]+(i[2]-this.pos[2])*e[2])/l;return s[0]=this.pos[0]+this.dir[0]*u,s[1]=this.pos[1]+this.dir[1]*u,s[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(i,e,s){if(N=(A=this.pos)[0],U=A[1],q=A[2],Y=(z=i)[0],ie=z[1],ce=z[2],Math.abs(N-Y)<=li*Math.max(1,Math.abs(N),Math.abs(Y))&&Math.abs(U-ie)<=li*Math.max(1,Math.abs(U),Math.abs(ie))&&Math.abs(q-ce)<=li*Math.max(1,Math.abs(q),Math.abs(ce))||0===e)return s[0]=s[1]=s[2]=0,!1;var A,z,N,U,q,Y,ie,ce;const[l,u,p]=this.dir,_=this.pos[0]-i[0],v=this.pos[1]-i[1],w=this.pos[2]-i[2],T=l*l+u*u+p*p,M=2*(_*l+v*u+w*p),S=M*M-4*T*(_*_+v*v+w*w-e*e);if(S<0){const A=Math.max(-M/2,0),z=_+l*A,N=v+u*A,U=w+p*A,q=Math.hypot(z,N,U);return s[0]=z*e/q,s[1]=N*e/q,s[2]=U*e/q,!1}{const A=(-M-Math.sqrt(S))/(2*T);if(A<0){const z=Math.hypot(_,v,w);return s[0]=_*e/z,s[1]=v*e/z,s[2]=w*e/z,!1}return s[0]=_+l*A,s[1]=v+u*A,s[2]=w+p*A,!0}}},d.RequestManager=class{constructor(i,e,s){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let s=0;s<10;s++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ue,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Me(i))return i;const s=it(i);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Me(i))return i;const s=it(i);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||e)}normalizeSourceURL(i,e){if(!Me(i))return i;const s=it(i);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(i,e,s,l){const u=it(i);return Me(i)?(u.path=`/styles/v1${u.path}/sprite${e}${s}`,this._makeAPIURL(u,this._customAccessToken||l)):(u.path+=`${e}${s}`,ct(u))}normalizeTileURL(i,e,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Me(i))return i;const l=it(i);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||s&&"raster"!==l.authority&&512===s?"@2x":""}${V.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${F.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${F.TILE_URL_VERSION}${l.path}`);const u=this._customAccessToken||function(p){for(const _ of p){const v=_.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(l.params)||F.ACCESS_TOKEN;return F.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,u)}canonicalizeTileURL(i,e){const s=it(i);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return i;let l="mapbox://";s.path.match(/^\/raster\/v1\//)?l+=`raster/${s.path.replace(`/${F.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${s.path.replace(`/${F.TILE_URL_VERSION}/`,"")}`;let u=s.params;return e&&(u=u.filter(p=>!p.match(/^access_token=/))),u.length&&(l+=`?${u.join("&")}`),l}canonicalizeTileset(i,e){const s=!!e&&Me(e),l=[];for(const u of i.tiles||[])Ae(u)?l.push(this.canonicalizeTileURL(u,s)):l.push(u);return l}_makeAPIURL(i,e){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",l=it(F.API_URL);if(i.protocol=l.protocol,i.authority=l.authority,"http"===i.protocol){const u=i.params.indexOf("secure");u>=0&&i.params.splice(u,1)}if("/"!==l.path&&(i.path=`${l.path}${i.path}`),!F.REQUIRE_ACCESS_TOKEN)return ct(i);if(e=e||F.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return i.params=i.params.filter(u=>-1===u.indexOf("access_token")),i.params.push(`access_token=${e||""}`),ct(i)}},d.ResourceType=Ca,d.SegmentVector=Xn,d.SourceCache=nc,d.StencilMode=yd,d.StructArrayLayout1ui2=cp,d.StructArrayLayout2f1f2i16=Xa,d.StructArrayLayout2i4=jl,d.StructArrayLayout2ui4=eo,d.StructArrayLayout3f12=Nc,d.StructArrayLayout3ui6=fi,d.StructArrayLayout4i8=Ul,d.Texture=cf,d.Tile=yf,d.Transitionable=oi,d.Uniform1f=dp,d.Uniform1i=class extends Qa{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},d.Uniform2f=class extends Qa{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},d.Uniform3f=class extends Qa{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},d.Uniform4f=pp,d.UniformColor=Pi,d.UniformMatrix2f=class extends Qa{constructor(i,e){super(i,e),this.current=Ov}set(i){for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},d.UniformMatrix3f=class extends Qa{constructor(i,e){super(i,e),this.current=Gc}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},d.UniformMatrix4f=class extends Qa{constructor(i,e){super(i,e),this.current=fp}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},d.UnwrappedTileID=Hm,d.ValidationError=Ge,d.VectorTileWorkerSource=class extends qs{constructor(i,e,s,l,u){super(),this.actor=i,this.layerIndex=e,this.availableImages=s,this.loadVectorData=u||tg,this.loading={},this.loaded={},this.deduped=new Td(i.scheduler),this.isSpriteLoaded=l,this.scheduler=i.scheduler}loadTile(i,e){const s=i.uid,l=i&&i.request,u=l&&l.collectResourceTiming,p=this.loading[s]=new Q_(i);p.abort=this.loadVectorData(i,(_,v)=>{const w=!this.loading[s];if(delete this.loading[s],w||_||!v)return p.status="done",w||(this.loaded[s]=p),e(_);const T=v.rawData,M={};v.expires&&(M.expires=v.expires),v.cacheControl&&(M.cacheControl=v.cacheControl),p.vectorTile=v.vectorTile||new Wl.VectorTile(new ha(T));const S=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(A,z)=>{if(A||!z)return e(A);const N={};if(u){const U=Z_(l);U.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify(U)))}e(null,Fn({rawTileData:T.slice(0)},z,M,N))})};this.isSpriteLoaded?S():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(S,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):S()}),this.loaded=this.loaded||{},this.loaded[s]=p})}reloadTile(i,e){const s=this.loaded,l=i.uid,u=this;if(s&&s[l]){const p=s[l];p.showCollisionBoxes=i.showCollisionBoxes,p.enableTerrain=!!i.enableTerrain,p.projection=i.projection;const _=(v,w)=>{const T=p.reloadCallback;T&&(delete p.reloadCallback,p.parse(p.vectorTile,u.layerIndex,this.availableImages,u.actor,T)),e(v,w)};"parsing"===p.status?p.reloadCallback=_:"done"===p.status&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(i,e){const s=i.uid,l=this.loading[s];l&&(l.abort&&l.abort(),delete this.loading[s]),e()}removeTile(i,e){const s=this.loaded,l=i.uid;s&&s[l]&&delete s[l],e()}},d.WritingMode=Dr,d.ZoomHistory=f,d.add=cs,d.addDynamicAttributes=gd,d.adjoint=function(i,e){var s=e[0],l=e[1],u=e[2],p=e[3],_=e[4],v=e[5],w=e[6],T=e[7],M=e[8];return i[0]=_*M-v*T,i[1]=u*T-l*M,i[2]=l*v-u*_,i[3]=v*w-p*M,i[4]=s*M-u*w,i[5]=u*p-s*v,i[6]=p*T-_*w,i[7]=l*w-s*T,i[8]=s*_-l*p,i},d.asyncAll=ds,d.bezier=yc,d.bindAll=Da,d.boundsAttributes=_f,d.bufferConvexPolygon=function(i,e){const s=[];for(let l=0;l<i.length;l++){const u=hs(l-1,-1,i.length-1),p=hs(l+1,-1,i.length-1),_=i[l],v=i[p],w=i[u].sub(_).unit(),T=v.sub(_).unit(),M=T.angleWithSep(w.x,w.y),S=w.add(T).unit().mult(-1*e/Math.sin(M/2));s.push(_.add(S))}return s},d.cacheEntryPossiblyAdded=function(i){wc++,wc>Ml&&(i.getActor().send("enforceCacheSizeLimit",yh),wc=0)},d.calculateGlobeMatrix=eg,d.calculateGlobeMercatorMatrix=function(i){const e=i.worldSize,s=cn(i.center.lat,-85.051129,mi),l=new We(nl(i.center.lng)*e,Is(s)*e),u=ns(1,i.center.lat)*e,p=i.pixelsPerMeter,_=e/(u/i.pixelsPerMeter),v=Qr(new Float64Array(16));return Bi(v,v,[l.x,l.y,0]),ur(v,v,[_,_,p]),v},d.clamp=cn,d.clearTileCache=function(i){const e=Pe.caches.delete(xr);i&&e.catch(i).then(()=>i())},d.clipLine=Jp,d.clone=function(i){var e=new Tn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},d.clone$1=Ui,d.collisionCircleLayout=M_,d.config=F,d.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},d.create=function(){var i=new Tn(16);return Tn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},d.create$1=yl,d.createExpression=bs,d.createLayout=In,d.createStyleLayer=function(i){return"custom"===i.type?new G_(i):new H_[i.type](i)},d.cross=Yn,d.degToRad=Lt,d.div=function(i,e,s){return i[0]=e[0]/s[0],i[1]=e[1]/s[1],i[2]=e[2]/s[2],i},d.dot=Ni,d.ease=Tl,d.easeCubicInOut=_c,d.emitValidationErrors=Nu,d.endsWith=Dl,d.enforceCacheSizeLimit=function(i){Il(),Hi&&Hi.then(e=>{e.keys().then(s=>{for(let l=0;l<s.length-i;l++)e.delete(s[l])})})},d.evaluateSizeForFeature=Fp,d.evaluateSizeForZoom=th,d.evaluateVariableOffset=Ql,d.evented=di,d.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},d.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},d.exported=hr,d.exported$1=V,d.extend=Fn,d.extend$1=_s,d.filterObject=Cl,d.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},d.fromQuat=function(i,e){var s=e[0],l=e[1],u=e[2],p=e[3],_=s+s,v=l+l,w=u+u,T=s*_,M=l*_,S=l*v,A=u*_,z=u*v,N=u*w,U=p*_,q=p*v,Y=p*w;return i[0]=1-S-N,i[1]=M+Y,i[2]=A-q,i[3]=0,i[4]=M-Y,i[5]=1-T-N,i[6]=z+U,i[7]=0,i[8]=A+q,i[9]=z-U,i[10]=1-T-S,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},d.fromRotation=function(i,e){var s=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=s,i[2]=0,i[3]=-s,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},d.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},d.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return Ea[e]},d.getAABBPointSquareDist=function(i,e,s){let l=0;for(let u=0;u<2;++u){const p=s?s[u]:0;i[u]>p&&(l+=(i[u]-p)*(i[u]-p)),e[u]<p&&(l+=(p-e[u])*(p-e[u]))}return l},d.getAnchorAlignment=nu,d.getAnchorJustification=fd,d.getBounds=function(i){let e=1/0,s=1/0,l=-1/0,u=-1/0;for(const p of i)e=Math.min(e,p.x),s=Math.min(s,p.y),l=Math.max(l,p.x),u=Math.max(u,p.y);return{min:new We(e,s),max:new We(l,u)}},d.getColumn=function(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]},d.getImage=Ec,d.getJSON=function(i,e){return Nt(Fn(i,{type:"json"}),e)},d.getMapSessionAPI=ms,d.getPerformanceMeasurement=Z_,d.getProjection=function(i){const e=Id[i.name];if(!e)throw new Error(`Invalid projection name: ${i.name}`);return e.conic?function(s,l){if(l.parallels&&Math.abs(l.parallels[0]+l.parallels[1])<.01){let u=function(p){const _=Math.max(.01,Math.cos(Lt(p))),v=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(w,T){const M=Lt(w)*_,S=Math.sin(Lt(T))/_;return{x:M*v+.5,y:-S*v+.5,z:0}},unproject(w,T){const M=-(T-.5)/v,S=cn(bi((w-.5)/v)/_,-180,180),A=Math.asin(cn(M*_,-1,1)),z=cn(bi(A),-85.051129,mi);return new rt(S,z)}}}(l.parallels[0]);if("lambertConformalConic"===l.name){const{project:p,unproject:_}=Id.mercator;u={wrap:!0,supportsWorldCopies:!0,project:p,unproject:_}}return Fn({},s,l,u)}return Fn({},s,l)}(e,i):e},d.getRTLTextPluginStatus=Qi,d.getReferrer=Sl,d.getTilePoint=function(i,{x:e,y:s},l=0){return new We(((e-l)*i.scale-i.x)*Dt,(s*i.scale-i.y)*Dt)},d.getTileVec3=function(i,e,s=0){return vi(((e.x-s)*i.scale-i.x)*Dt,(e.y*i.scale-i.y)*Dt,qu(e.z,e.y))},d.getVideo=function(i,e){const s=Pe.document.createElement("video");s.muted=!0,s.onloadstart=function(){e(null,s)};for(let l=0;l<i.length;l++){const u=Pe.document.createElement("source");It(i[l])||(s.crossOrigin="Anonymous"),u.src=i[l],s.appendChild(u)}return{cancel:()=>{}}},d.globeBuffersForTileMesh=function(i,e,s,l){const u=i.context,p=i.transform;let _=e.globeGridBuffer,v=e.globePoleBuffer;if(!_){const w=bf.createGridVertices(s.canonical);_=e.globeGridBuffer=u.createVertexBuffer(w,J_,!1)}if(!v){const w=bf.createPoleTriangleVertices(l,p.tileSize*l,0===s.canonical.y);v=e.globePoleBuffer=u.createVertexBuffer(w,J_,!1)}return[_,v]},d.globeDenormalizeECEF=xf,d.globeMatrixForTile=function(i,e){const s=xf(Ed(i)),l=((u=new Float64Array(16))[0]=(p=e)[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=p[6],u[7]=p[7],u[8]=p[8],u[9]=p[9],u[10]=p[10],u[11]=p[11],u[12]=p[12],u[13]=p[13],u[14]=p[14],u[15]=p[15],u);var u,p;return ko(l,l,s),l},d.globePoleMatrixForTile=function(i,e,s){const l=Qr(new Float64Array(16)),u=Math.pow(2,i.z),p=(i.x-u/2)/u*Math.PI*2,_=s.point,v=s.worldSize/(s.tileSize*u);return Bi(l,l,[_.x,_.y,-s.worldSize/Math.PI/2]),ur(l,l,[v,v,v]),Po(l,l,Lt(-s._center.lat)),ao(l,l,Lt(-s._center.lng)),ao(l,l,p),e&&ur(l,l,[1,-1,1]),l},d.globeTileBounds=Ed,d.globeToMercatorTransition=function(i){return zo(5,6,i)},d.identity=Qr,d.identity$1=Ro,d.invert=function(i,e){var s=e[0],l=e[1],u=e[2],p=e[3],_=e[4],v=e[5],w=e[6],T=e[7],M=e[8],S=e[9],A=e[10],z=e[11],N=e[12],U=e[13],q=e[14],Y=e[15],ie=s*v-l*_,ce=s*w-u*_,he=s*T-p*_,fe=l*w-u*v,me=l*T-p*v,Ce=u*T-p*w,Ee=M*U-S*N,$e=M*q-A*N,Oe=M*Y-z*N,Te=S*q-A*U,Ve=S*Y-z*U,Ze=A*Y-z*q,Ie=ie*Ze-ce*Ve+he*Te+fe*Oe-me*$e+Ce*Ee;return Ie?(i[0]=(v*Ze-w*Ve+T*Te)*(Ie=1/Ie),i[1]=(u*Ve-l*Ze-p*Te)*Ie,i[2]=(U*Ce-q*me+Y*fe)*Ie,i[3]=(A*me-S*Ce-z*fe)*Ie,i[4]=(w*Oe-_*Ze-T*$e)*Ie,i[5]=(s*Ze-u*Oe+p*$e)*Ie,i[6]=(q*he-N*Ce-Y*ce)*Ie,i[7]=(M*Ce-A*he+z*ce)*Ie,i[8]=(_*Ve-v*Oe+T*Ee)*Ie,i[9]=(l*Oe-s*Ve-p*Ee)*Ie,i[10]=(N*me-U*he+Y*ie)*Ie,i[11]=(S*he-M*me-z*ie)*Ie,i[12]=(v*$e-_*Te-w*Ee)*Ie,i[13]=(s*Te-l*$e+u*Ee)*Ie,i[14]=(U*ce-N*fe-q*ie)*Ie,i[15]=(M*fe-S*ce+A*ie)*Ie,i):null},d.isMapAuthenticated=function(i){return No.has(i)},d.isMapboxURL=Me,d.latFromMercatorY=vo,d.len=Vs,d.length=fc,d.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},d.loadVectorTile=tg,d.makeRequest=Nt,d.mercatorXfromLng=nl,d.mercatorYfromLat=Is,d.mercatorZfromAltitude=ns,d.mul=ko,d.mul$1=wl,d.multiply=function(i,e,s){var l=e[0],u=e[1],p=e[2],_=e[3],v=e[4],w=e[5],T=e[6],M=e[7],S=e[8],A=s[0],z=s[1],N=s[2],U=s[3],q=s[4],Y=s[5],ie=s[6],ce=s[7],he=s[8];return i[0]=A*l+z*_+N*T,i[1]=A*u+z*v+N*M,i[2]=A*p+z*w+N*S,i[3]=U*l+q*_+Y*T,i[4]=U*u+q*v+Y*M,i[5]=U*p+q*w+Y*S,i[6]=ie*l+ce*_+he*T,i[7]=ie*u+ce*v+he*M,i[8]=ie*p+ce*w+he*S,i},d.multiply$1=vl,d.multiply$2=us,d.nextPowerOfTwo=wi,d.normalize=bl,d.normalize$1=function(i,e){var s=e[0],l=e[1],u=e[2],p=e[3],_=s*s+l*l+u*u+p*p;return _>0&&(_=1/Math.sqrt(_)),i[0]=s*_,i[1]=l*_,i[2]=u*_,i[3]=p*_,i},d.number=Xt,d.ortho=function(i,e,s,l,u,p,_){var v=1/(e-s),w=1/(l-u),T=1/(p-_);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*T,i[11]=0,i[12]=(e+s)*v,i[13]=(u+l)*w,i[14]=(_+p)*T,i[15]=1,i},d.pbf=ha,d.perspective=function(i,e,s,l,u){var p,_=1/Math.tan(e/2);return i[0]=_/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,null!=u&&u!==1/0?(i[10]=(u+l)*(p=1/(l-u)),i[14]=2*u*l*p):(i[10]=-1,i[14]=-2*l),i},d.pick=function(i,e){const s={};for(let l=0;l<e.length;l++){const u=e[l];u in i&&(s[u]=i[u])}return s},d.plugin=Gt,d.pointGeometry=We,d.polygonIntersectsBox=Zh,d.polygonIntersectsPolygon=qc,d.polygonizeBounds=function(i,e,s=0,l=!0){const u=new We(s,s),p=i.sub(u),_=e.add(u),v=[p,new We(_.x,p.y),_,new We(p.x,_.y)];return l&&v.push(p),v},d.posAttributes=K_,d.postMapLoadEvent=un,d.postTurnstileEvent=gn,d.potpack=Up,d.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},d.radToDeg=bi,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(i){return i({pluginStatus:ut,pluginURL:Ct}),di.on("pluginStateChange",i),i},d.removeAuthState=function(i){No.delete(i)},d.renderColorRamp=am,d.rotateX=Po,d.rotateX$1=gc,d.rotateY=ao,d.rotateZ=function(i,e,s){var l=Math.sin(s),u=Math.cos(s),p=e[0],_=e[1],v=e[2],w=e[3],T=e[4],M=e[5],S=e[6],A=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=p*u+T*l,i[1]=_*u+M*l,i[2]=v*u+S*l,i[3]=w*u+A*l,i[4]=T*u-p*l,i[5]=M*u-_*l,i[6]=S*u-v*l,i[7]=A*u-w*l,i},d.rotateZ$1=function(i,e,s){s*=.5;var l=e[0],u=e[1],p=e[2],_=e[3],v=Math.sin(s),w=Math.cos(s);return i[0]=l*w+u*v,i[1]=u*w-l*v,i[2]=p*w+_*v,i[3]=_*w-p*v,i},d.scale=ur,d.scale$1=function(i,e,s){return i[0]=e[0]*s,i[1]=e[1]*s,i[2]=e[2]*s,i[3]=e[3]*s,i},d.scale$2=xi,d.scaleAndAdd=ci,d.setCacheLimits=function(i,e){yh=i,Ml=e},d.setColumn=function(i,e,s){i[4*e+0]=s[0],i[4*e+1]=s[1],i[4*e+2]=s[2],i[4*e+3]=s[3]},d.setRTLTextPlugin=function(i,e,s=!1){if(ut===nt||ut===mt||ut===on)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ct=hr.resolveURL(i),ut=nt,pn=e,Jn(),s||ii()},d.smoothstep=zo,d.spec=be,d.storeAuthState=function(i,e){e?No.add(i):No.delete(i)},d.sub=Ns,d.subtract=ba,d.symbolSize=Cm,d.tileAABB=function(i,e,s,l,u,p,_,v,w){if("globe"===w.name){const z=Ed(new Hm(p,new uf(s,l,u)).canonical).getCorners(),N=Number.MAX_VALUE,U=[-N,-N,-N],q=[N,N,N],Y=eg(i,e);for(let ie=0;ie<z.length;ie++)$t(z[ie],z[ie],Y),M=q,S=z[ie],(T=q)[0]=Math.min(M[0],S[0]),T[1]=Math.min(M[1],S[1]),T[2]=Math.min(M[2],S[2]),bu(U,U,z[ie]);return new xo(q,U)}var T,M,S;const A=rc({z:s,x:l,y:u},w);return new xo([(p+A.x/A.scale)*e,e*(A.y/A.scale),_],[(p+A.x2/A.scale)*e,e*(A.y2/A.scale),v])},d.tileTransform=rc,d.transformMat3=function(i,e,s){var l=e[0],u=e[1],p=e[2];return i[0]=l*s[0]+u*s[3]+p*s[6],i[1]=l*s[1]+u*s[4]+p*s[7],i[2]=l*s[2]+u*s[5]+p*s[8],i},d.transformMat4=$t,d.transformMat4$1=lo,d.transformQuat=mc,d.translate=Bi,d.transpose=function(i,e){if(i===e){var s=e[1],l=e[2],u=e[5];i[1]=e[3],i[2]=e[6],i[3]=s,i[5]=e[7],i[6]=l,i[7]=u}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},d.triggerPluginCompletionEvent=wn,d.uniqueId=xc,d.validateCustomStyleLayer=function(i){const e=[],s=i.id;return void 0===s&&e.push({message:`layers.${s}: missing required property "id"`}),void 0===i.render&&e.push({message:`layers.${s}: missing required method "render"`}),i.renderingMode&&"2d"!==i.renderingMode&&"3d"!==i.renderingMode&&e.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),e},d.validateFog=Jt,d.validateLight=Ne,d.validateStyle=Ha,d.values=Ta,d.vectorTile=Wl,d.version="2.7.0",d.warnOnce=Pn,d.window=Pe,d.wrap=hs}),_h(0,function(d){function Kn(K){const F=typeof K;if("number"===F||"boolean"===F||"string"===F||null==K)return JSON.stringify(K);if(Array.isArray(K)){let J="[";for(const le of K)J+=`${Kn(le)},`;return`${J}]`}const V=Object.keys(K).sort();let X="{";for(let J=0;J<V.length;J++)X+=`${JSON.stringify(V[J])}:${Kn(K[V[J]])},`;return`${X}}`}function Ao(K){let F="";for(const V of d.refProperties)F+=`/${Kn(K[V])}`;return F}class Jr{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,V){for(const J of F)this._layerConfigs[J.id]=J,(this._layers[J.id]=d.createStyleLayer(J)).compileFilter(),this.keyCache[J.id]&&delete this.keyCache[J.id];for(const J of V)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const X=function(J,le){const ge={};for(let ue=0;ue<J.length;ue++){const _e=le&&le[J[ue].id]||Ao(J[ue]);le&&(le[J[ue].id]=_e);let Me=ge[_e];Me||(Me=ge[_e]=[]),Me.push(J[ue])}const pe=[];for(const ue in ge)pe.push(ge[ue]);return pe}(d.values(this._layerConfigs),this.keyCache);for(const J of X){const le=J.map(Ae=>this._layers[Ae.id]),ge=le[0];if("none"===ge.visibility)continue;const pe=ge.source||"";let ue=this.familiesBySource[pe];ue||(ue=this.familiesBySource[pe]={});const _e=ge.sourceLayer||"_geojsonTileLayer";let Me=ue[_e];Me||(Me=ue[_e]=[]),Me.push(le)}}}const{ImageBitmap:We}=d.window;class _t{loadTile(F,V){const{uid:X,encoding:J,rawImageData:le,padding:ge,buildQuadTree:pe}=F,ue=We&&le instanceof We?this.getImageData(le,ge):le;V(null,new d.DEMData(X,ue,J,ge<1,pe))}getImageData(F,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(F.width,F.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=F.width,this.offscreenCanvas.height=F.height,this.offscreenCanvasContext.drawImage(F,0,0,F.width,F.height);const X=this.offscreenCanvasContext.getImageData(-V,-V,F.width+2*V,F.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:X.width,height:X.height},X.data)}}var Pe=function K(F,V){var X,J=F&&F.type;if("FeatureCollection"===J)for(X=0;X<F.features.length;X++)K(F.features[X],V);else if("GeometryCollection"===J)for(X=0;X<F.geometries.length;X++)K(F.geometries[X],V);else if("Feature"===J)K(F.geometry,V);else if("Polygon"===J)li(F.coordinates,V);else if("MultiPolygon"===J)for(X=0;X<F.coordinates.length;X++)li(F.coordinates[X],V);return F};function li(K,F){if(0!==K.length){Tn(K[0],F);for(var V=1;V<K.length;V++)Tn(K[V],!F)}}function Tn(K,F){for(var V=0,X=0,J=0,le=K.length,ge=le-1;J<le;ge=J++){var pe=(K[J][0]-K[ge][0])*(K[ge][1]+K[J][1]),ue=V+pe;X+=Math.abs(V)>=Math.abs(pe)?V-ue+pe:pe-ue+V,V=ue}V+X>=0!=!!F&&K.reverse()}const yl=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Qr{constructor(F){this._feature=F,this.extent=d.EXTENT,this.type=F.type,this.properties=F.tags,"id"in F&&!isNaN(F.id)&&(this.id=parseInt(F.id,10))}loadGeometry(){if(1===this._feature.type){const F=[];for(const V of this._feature.geometry)F.push([new d.pointGeometry(V[0],V[1])]);return F}{const F=[];for(const V of this._feature.geometry){const X=[];for(const J of V)X.push(new d.pointGeometry(J[0],J[1]));F.push(X)}return F}}toGeoJSON(F,V,X){return yl.call(this,F,V,X)}}class vl{constructor(F){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=F.length,this._features=F}feature(F){return new Qr(this._features[F])}}var Bi=d.vectorTile.VectorTileFeature,ur=Po;function Po(K,F){this.options=F||{},this.features=K,this.length=K.length}function ao(K,F){this.id="number"==typeof K.id?K.id:void 0,this.type=K.type,this.rawGeometry=1===K.type?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=F||4096}Po.prototype.feature=function(K){return new ao(this.features[K],this.options.extent)},ao.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var F=0;F<K.length;F++){for(var V=K[F],X=[],J=0;J<V.length;J++)X.push(new d.pointGeometry(V[J][0],V[J][1]));this.geometry.push(X)}return this.geometry},ao.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,F=1/0,V=-1/0,X=1/0,J=-1/0,le=0;le<K.length;le++)for(var ge=K[le],pe=0;pe<ge.length;pe++){var ue=ge[pe];F=Math.min(F,ue.x),V=Math.max(V,ue.x),X=Math.min(X,ue.y),J=Math.max(J,ue.y)}return[F,X,V,J]},ao.prototype.toGeoJSON=Bi.prototype.toGeoJSON;var ko=Lo,xl=ur;function Lo(K){var F=new d.pbf;return function(V,X){for(var J in V.layers)X.writeMessage(3,fc,V.layers[J])}(K,F),F.finish()}function fc(K,F){var V;F.writeVarintField(15,K.version||1),F.writeStringField(1,K.name||""),F.writeVarintField(5,K.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<K.length;V++)X.feature=K.feature(V),F.writeMessage(2,vi,X);var J=X.keys;for(V=0;V<J.length;V++)F.writeStringField(3,J[V]);var le=X.values;for(V=0;V<le.length;V++)F.writeMessage(4,xi,le[V])}function vi(K,F){var V=K.feature;void 0!==V.id&&F.writeVarintField(1,V.id),F.writeMessage(2,cs,K),F.writeVarintField(3,V.type),F.writeMessage(4,bu,V)}function cs(K,F){var V=K.feature,X=K.keys,J=K.values,le=K.keycache,ge=K.valuecache;for(var pe in V.properties){var ue=V.properties[pe],_e=le[pe];if(null!==ue){void 0===_e&&(X.push(pe),le[pe]=_e=X.length-1),F.writeVarint(_e);var Me=typeof ue;"string"!==Me&&"boolean"!==Me&&"number"!==Me&&(ue=JSON.stringify(ue));var Ae=Me+":"+ue,ze=ge[Ae];void 0===ze&&(J.push(ue),ge[Ae]=ze=J.length-1),F.writeVarint(ze)}}}function ba(K,F){return(F<<3)+(7&K)}function us(K){return K<<1^K>>31}function bu(K,F){for(var V=K.loadGeometry(),X=K.type,J=0,le=0,ge=V.length,pe=0;pe<ge;pe++){var ue=V[pe],_e=1;1===X&&(_e=ue.length),F.writeVarint(ba(1,_e));for(var Me=3===X?ue.length-1:ue.length,Ae=0;Ae<Me;Ae++){1===Ae&&1!==X&&F.writeVarint(ba(2,Me-1));var ze=ue[Ae].x-J,it=ue[Ae].y-le;F.writeVarint(us(ze)),F.writeVarint(us(it)),J+=ze,le+=it}3===X&&F.writeVarint(ba(7,1))}}function xi(K,F){var V=typeof K;"string"===V?F.writeStringField(1,K):"boolean"===V?F.writeBooleanField(7,K):"number"===V&&(K%1!=0?F.writeDoubleField(3,K):K<0?F.writeSVarintField(6,K):F.writeVarintField(5,K))}function ci(K,F,V,X,J,le){if(J-X<=V)return;const ge=X+J>>1;bl(K,F,ge,X,J,le%2),ci(K,F,V,X,ge-1,le+1),ci(K,F,V,ge+1,J,le+1)}function bl(K,F,V,X,J,le){for(;J>X;){if(J-X>600){const _e=J-X+1,Me=V-X+1,Ae=Math.log(_e),ze=.5*Math.exp(2*Ae/3),it=.5*Math.sqrt(Ae*ze*(_e-ze)/_e)*(Me-_e/2<0?-1:1);bl(K,F,V,Math.max(X,Math.floor(V-Me*ze/_e+it)),Math.min(J,Math.floor(V+(_e-Me)*ze/_e+it)),le)}const ge=F[2*V+le];let pe=X,ue=J;for(Ni(K,F,X,V),F[2*J+le]>ge&&Ni(K,F,X,J);pe<ue;){for(Ni(K,F,pe,ue),pe++,ue--;F[2*pe+le]<ge;)pe++;for(;F[2*ue+le]>ge;)ue--}F[2*X+le]===ge?Ni(K,F,X,ue):(ue++,Ni(K,F,ue,J)),ue<=V&&(X=ue+1),V<=ue&&(J=ue-1)}}function Ni(K,F,V,X){Yn(K,V,X),Yn(F,2*V,2*X),Yn(F,2*V+1,2*X+1)}function Yn(K,F,V){const X=K[F];K[F]=K[V],K[V]=X}function $t(K,F,V,X){const J=K-V,le=F-X;return J*J+le*le}ko.fromVectorTileJs=Lo,ko.fromGeojsonVt=function(K,F){F=F||{};var V={};for(var X in K)V[X]=new ur(K[X].features,F),V[X].name=X,V[X].version=F.version,V[X].extent=F.extent;return Lo({layers:V})},ko.GeoJSONWrapper=xl;const mc=K=>K[0],Bs=K=>K[1];class Ns{constructor(F,V=mc,X=Bs,J=64,le=Float64Array){this.nodeSize=J,this.points=F;const ge=F.length<65536?Uint16Array:Uint32Array,pe=this.ids=new ge(F.length),ue=this.coords=new le(2*F.length);for(let _e=0;_e<F.length;_e++)pe[_e]=_e,ue[2*_e]=V(F[_e]),ue[2*_e+1]=X(F[_e]);ci(pe,ue,J,0,pe.length-1,0)}range(F,V,X,J){return function(le,ge,pe,ue,_e,Me,Ae){const ze=[0,le.length-1,0],it=[];let ct,st;for(;ze.length;){const dt=ze.pop(),Mt=ze.pop(),gn=ze.pop();if(Mt-gn<=Ae){for(let bn=gn;bn<=Mt;bn++)ct=ge[2*bn],st=ge[2*bn+1],ct>=pe&&ct<=_e&&st>=ue&&st<=Me&&it.push(le[bn]);continue}const yn=Math.floor((gn+Mt)/2);ct=ge[2*yn],st=ge[2*yn+1],ct>=pe&&ct<=_e&&st>=ue&&st<=Me&&it.push(le[yn]);const un=(dt+1)%2;(0===dt?pe<=ct:ue<=st)&&(ze.push(gn),ze.push(yn-1),ze.push(un)),(0===dt?_e>=ct:Me>=st)&&(ze.push(yn+1),ze.push(Mt),ze.push(un))}return it}(this.ids,this.coords,F,V,X,J,this.nodeSize)}within(F,V,X){return function(J,le,ge,pe,ue,_e){const Me=[0,J.length-1,0],Ae=[],ze=ue*ue;for(;Me.length;){const it=Me.pop(),ct=Me.pop(),st=Me.pop();if(ct-st<=_e){for(let un=st;un<=ct;un++)$t(le[2*un],le[2*un+1],ge,pe)<=ze&&Ae.push(J[un]);continue}const dt=Math.floor((st+ct)/2),Mt=le[2*dt],gn=le[2*dt+1];$t(Mt,gn,ge,pe)<=ze&&Ae.push(J[dt]);const yn=(it+1)%2;(0===it?ge-ue<=Mt:pe-ue<=gn)&&(Me.push(st),Me.push(dt-1),Me.push(yn)),(0===it?ge+ue>=Mt:pe+ue>=gn)&&(Me.push(dt+1),Me.push(ct),Me.push(yn))}return Ae}(this.ids,this.coords,F,V,X,this.nodeSize)}}const wl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Vs=Math.fround||(lo=new Float32Array(1),K=>(lo[0]=+K,lo[0]));var lo;class Vi{constructor(F){this.options=Ea(Object.create(wl),F),this.trees=new Array(this.options.maxZoom+1)}load(F){const{log:V,minZoom:X,maxZoom:J,nodeSize:le}=this.options;V&&console.time("total time");const ge=`prepare ${F.length} points`;V&&console.time(ge),this.points=F;let pe=[];for(let ue=0;ue<F.length;ue++)F[ue].geometry&&pe.push(gc(F[ue],ue));this.trees[J+1]=new Ns(pe,_c,yc,le,Float32Array),V&&console.timeEnd(ge);for(let ue=J;ue>=X;ue--){const _e=+Date.now();pe=this._cluster(pe,ue),this.trees[ue]=new Ns(pe,_c,yc,le,Float32Array),V&&console.log("z%d: %d clusters in %dms",ue,pe.length,+Date.now()-_e)}return V&&console.timeEnd("total time"),this}getClusters(F,V){let X=((F[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,F[1]));let le=180===F[2]?180:((F[2]+180)%360+360)%360-180;const ge=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)X=-180,le=180;else if(X>le){const Me=this.getClusters([X,J,180,ge],V),Ae=this.getClusters([-180,J,le,ge],V);return Me.concat(Ae)}const pe=this.trees[this._limitZoom(V)],ue=pe.range(El(X),Lt(ge),El(le),Lt(J)),_e=[];for(const Me of ue){const Ae=pe.points[Me];_e.push(Ae.numPoints?Fo(Ae):this.points[Ae.index])}return _e}getChildren(F){const V=this._getOriginId(F),X=this._getOriginZoom(F),J="No cluster with the specified id.",le=this.trees[X];if(!le)throw new Error(J);const ge=le.points[V];if(!ge)throw new Error(J);const pe=this.options.radius/(this.options.extent*Math.pow(2,X-1)),ue=le.within(ge.x,ge.y,pe),_e=[];for(const Me of ue){const Ae=le.points[Me];Ae.parentId===F&&_e.push(Ae.numPoints?Fo(Ae):this.points[Ae.index])}if(0===_e.length)throw new Error(J);return _e}getLeaves(F,V,X){const J=[];return this._appendLeaves(J,F,V=V||10,X=X||0,0),J}getTile(F,V,X){const J=this.trees[this._limitZoom(F)],le=Math.pow(2,F),{extent:ge,radius:pe}=this.options,ue=pe/ge,_e=(X-ue)/le,Me=(X+1+ue)/le,Ae={features:[]};return this._addTileFeatures(J.range((V-ue)/le,_e,(V+1+ue)/le,Me),J.points,V,X,le,Ae),0===V&&this._addTileFeatures(J.range(1-ue/le,_e,1,Me),J.points,le,X,le,Ae),V===le-1&&this._addTileFeatures(J.range(0,_e,ue/le,Me),J.points,-1,X,le,Ae),Ae.features.length?Ae:null}getClusterExpansionZoom(F){let V=this._getOriginZoom(F)-1;for(;V<=this.options.maxZoom;){const X=this.getChildren(F);if(V++,1!==X.length)break;F=X[0].properties.cluster_id}return V}_appendLeaves(F,V,X,J,le){const ge=this.getChildren(V);for(const pe of ge){const ue=pe.properties;if(ue&&ue.cluster?le+ue.point_count<=J?le+=ue.point_count:le=this._appendLeaves(F,ue.cluster_id,X,J,le):le<J?le++:F.push(pe),F.length===X)break}return le}_addTileFeatures(F,V,X,J,le,ge){for(const pe of F){const ue=V[pe],_e=ue.numPoints;let Me,Ae,ze;if(_e)Me=wa(ue),Ae=ue.x,ze=ue.y;else{const st=this.points[ue.index];Me=st.properties,Ae=El(st.geometry.coordinates[0]),ze=Lt(st.geometry.coordinates[1])}const it={type:1,geometry:[[Math.round(this.options.extent*(Ae*le-X)),Math.round(this.options.extent*(ze*le-J))]],tags:Me};let ct;_e?ct=ue.id:this.options.generateId?ct=ue.index:this.points[ue.index].id&&(ct=this.points[ue.index].id),void 0!==ct&&(it.id=ct),ge.features.push(it)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(+F,this.options.maxZoom+1))}_cluster(F,V){const X=[],{radius:J,extent:le,reduce:ge,minPoints:pe}=this.options,ue=J/(le*Math.pow(2,V));for(let _e=0;_e<F.length;_e++){const Me=F[_e];if(Me.zoom<=V)continue;Me.zoom=V;const Ae=this.trees[V+1],ze=Ae.within(Me.x,Me.y,ue),it=Me.numPoints||1;let ct=it;for(const st of ze){const dt=Ae.points[st];dt.zoom>V&&(ct+=dt.numPoints||1)}if(ct>it&&ct>=pe){let st=Me.x*it,dt=Me.y*it,Mt=ge&&it>1?this._map(Me,!0):null;const gn=(_e<<5)+(V+1)+this.points.length;for(const yn of ze){const un=Ae.points[yn];if(un.zoom<=V)continue;un.zoom=V;const bn=un.numPoints||1;st+=un.x*bn,dt+=un.y*bn,un.parentId=gn,ge&&(Mt||(Mt=this._map(Me,!0)),ge(Mt,this._map(un)))}Me.parentId=gn,X.push(Ro(st/ct,dt/ct,gn,ct,Mt))}else if(X.push(Me),ct>1)for(const st of ze){const dt=Ae.points[st];dt.zoom<=V||(dt.zoom=V,X.push(dt))}}return X}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,V){if(F.numPoints)return V?Ea({},F.properties):F.properties;const X=this.points[F.index].properties,J=this.options.map(X);return V&&J===X?Ea({},J):J}}function Ro(K,F,V,X,J){return{x:Vs(K),y:Vs(F),zoom:1/0,id:V,parentId:-1,numPoints:X,properties:J}}function gc(K,F){const[V,X]=K.geometry.coordinates;return{x:Vs(El(V)),y:Vs(Lt(X)),zoom:1/0,index:F,parentId:-1}}function Fo(K){return{type:"Feature",id:K.id,properties:wa(K),geometry:{type:"Point",coordinates:[(F=K.x,360*(F-.5)),bi(K.y)]}};var F}function wa(K){const F=K.numPoints,V=F>=1e4?`${Math.round(F/1e3)}k`:F>=1e3?Math.round(F/100)/10+"k":F;return Ea(Ea({},K.properties),{cluster:!0,cluster_id:K.id,point_count:F,point_count_abbreviated:V})}function El(K){return K/360+.5}function Lt(K){const F=Math.sin(K*Math.PI/180),V=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return V<0?0:V>1?1:V}function bi(K){const F=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function Ea(K,F){for(const V in F)K[V]=F[V];return K}function _c(K){return K.x}function yc(K){return K.y}function Tl(K,F,V,X){for(var J,le=X,ge=V-F>>1,pe=V-F,ue=K[F],_e=K[F+1],Me=K[V],Ae=K[V+1],ze=F+3;ze<V;ze+=3){var it=cn(K[ze],K[ze+1],ue,_e,Me,Ae);if(it>le)J=ze,le=it;else if(it===le){var ct=Math.abs(ze-ge);ct<pe&&(J=ze,pe=ct)}}le>X&&(J-F>3&&Tl(K,F,J,X),K[J+2]=le,V-J>3&&Tl(K,J,V,X))}function cn(K,F,V,X,J,le){var ge=J-V,pe=le-X;if(0!==ge||0!==pe){var ue=((K-V)*ge+(F-X)*pe)/(ge*ge+pe*pe);ue>1?(V=J,X=le):ue>0&&(V+=ge*ue,X+=pe*ue)}return(ge=K-V)*ge+(pe=F-X)*pe}function zo(K,F,V,X){var J={id:void 0===K?null:K,type:F,geometry:V,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var ge=le.geometry,pe=le.type;if("Point"===pe||"MultiPoint"===pe||"LineString"===pe)hs(le,ge);else if("Polygon"===pe||"MultiLineString"===pe)for(var ue=0;ue<ge.length;ue++)hs(le,ge[ue]);else if("MultiPolygon"===pe)for(ue=0;ue<ge.length;ue++)for(var _e=0;_e<ge[ue].length;_e++)hs(le,ge[ue][_e])}(J),J}function hs(K,F){for(var V=0;V<F.length;V+=3)K.minX=Math.min(K.minX,F[V]),K.minY=Math.min(K.minY,F[V+1]),K.maxX=Math.max(K.maxX,F[V]),K.maxY=Math.max(K.maxY,F[V+1])}function ds(K,F,V,X){if(F.geometry){var J=F.geometry.coordinates,le=F.geometry.type,ge=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),pe=[],ue=F.id;if(V.promoteId?ue=F.properties[V.promoteId]:V.generateId&&(ue=X||0),"Point"===le)Ta(J,pe);else if("MultiPoint"===le)for(var _e=0;_e<J.length;_e++)Ta(J[_e],pe);else if("LineString"===le)Fn(J,pe,ge,!1);else if("MultiLineString"===le){if(V.lineMetrics){for(_e=0;_e<J.length;_e++)Fn(J[_e],pe=[],ge,!1),K.push(zo(ue,"LineString",pe,F.properties));return}vc(J,pe,ge,!1)}else if("Polygon"===le)vc(J,pe,ge,!0);else{if("MultiPolygon"!==le){if("GeometryCollection"===le){for(_e=0;_e<F.geometry.geometries.length;_e++)ds(K,{id:ue,geometry:F.geometry.geometries[_e],properties:F.properties},V,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_e=0;_e<J.length;_e++){var Me=[];vc(J[_e],Me,ge,!0),pe.push(Me)}}K.push(zo(ue,le,pe,F.properties))}}function Ta(K,F){F.push(xc(K[0])),F.push(ji(K[1])),F.push(0)}function Fn(K,F,V,X){for(var J,le,ge=0,pe=0;pe<K.length;pe++){var ue=xc(K[pe][0]),_e=ji(K[pe][1]);F.push(ue),F.push(_e),F.push(0),pe>0&&(ge+=X?(J*_e-ue*le)/2:Math.sqrt(Math.pow(ue-J,2)+Math.pow(_e-le,2))),J=ue,le=_e}var Me=F.length-3;F[2]=1,Tl(F,0,Me,V),F[Me+2]=1,F.size=Math.abs(ge),F.start=0,F.end=F.size}function vc(K,F,V,X){for(var J=0;J<K.length;J++){var le=[];Fn(K[J],le,V,X),F.push(le)}}function xc(K){return K/360+.5}function ji(K){var F=Math.sin(K*Math.PI/180),V=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return V<0?0:V>1?1:V}function wi(K,F,V,X,J,le,ge,pe){if(X/=F,le>=(V/=F)&&ge<X)return K;if(ge<V||le>=X)return null;for(var ue=[],_e=0;_e<K.length;_e++){var Me=K[_e],Ae=Me.geometry,ze=Me.type,it=0===J?Me.minX:Me.minY,ct=0===J?Me.maxX:Me.maxY;if(it>=V&&ct<X)ue.push(Me);else if(!(ct<V||it>=X)){var st=[];if("Point"===ze||"MultiPoint"===ze)wu(Ae,st,V,X,J);else if("LineString"===ze)Da(Ae,st,V,X,J,!1,pe.lineMetrics);else if("MultiLineString"===ze)ps(Ae,st,V,X,J,!1);else if("Polygon"===ze)ps(Ae,st,V,X,J,!0);else if("MultiPolygon"===ze)for(var dt=0;dt<Ae.length;dt++){var Mt=[];ps(Ae[dt],Mt,V,X,J,!0),Mt.length&&st.push(Mt)}if(st.length){if(pe.lineMetrics&&"LineString"===ze){for(dt=0;dt<st.length;dt++)ue.push(zo(Me.id,ze,st[dt],Me.tags));continue}"LineString"!==ze&&"MultiLineString"!==ze||(1===st.length?(ze="LineString",st=st[0]):ze="MultiLineString"),"Point"!==ze&&"MultiPoint"!==ze||(ze=3===st.length?"Point":"MultiPoint"),ue.push(zo(Me.id,ze,st,Me.tags))}}}return ue.length?ue:null}function wu(K,F,V,X,J){for(var le=0;le<K.length;le+=3){var ge=K[le+J];ge>=V&&ge<=X&&(F.push(K[le]),F.push(K[le+1]),F.push(K[le+2]))}}function Da(K,F,V,X,J,le,ge){for(var pe,ue,_e=Dl(K),Me=0===J?Ui:Eu,Ae=K.start,ze=0;ze<K.length-3;ze+=3){var it=K[ze],ct=K[ze+1],st=K[ze+2],dt=K[ze+3],Mt=K[ze+4],gn=0===J?it:ct,yn=0===J?dt:Mt,un=!1;ge&&(pe=Math.sqrt(Math.pow(it-dt,2)+Math.pow(ct-Mt,2))),gn<V?yn>V&&(ue=Me(_e,it,ct,dt,Mt,V),ge&&(_e.start=Ae+pe*ue)):gn>X?yn<X&&(ue=Me(_e,it,ct,dt,Mt,X),ge&&(_e.start=Ae+pe*ue)):Cl(_e,it,ct,st),yn<V&&gn>=V&&(ue=Me(_e,it,ct,dt,Mt,V),un=!0),yn>X&&gn<=X&&(ue=Me(_e,it,ct,dt,Mt,X),un=!0),!le&&un&&(ge&&(_e.end=Ae+pe*ue),F.push(_e),_e=Dl(K)),ge&&(Ae+=pe)}var bn=K.length-3;it=K[bn],ct=K[bn+1],st=K[bn+2],(gn=0===J?it:ct)>=V&&gn<=X&&Cl(_e,it,ct,st),bn=_e.length-3,le&&bn>=3&&(_e[bn]!==_e[0]||_e[bn+1]!==_e[1])&&Cl(_e,_e[0],_e[1],_e[2]),_e.length&&F.push(_e)}function Dl(K){var F=[];return F.size=K.size,F.start=K.start,F.end=K.end,F}function ps(K,F,V,X,J,le){for(var ge=0;ge<K.length;ge++)Da(K[ge],F,V,X,J,le,!1)}function Cl(K,F,V,X){K.push(F),K.push(V),K.push(X)}function Ui(K,F,V,X,J,le){var ge=(le-F)/(X-F);return K.push(le),K.push(V+(J-V)*ge),K.push(1),ge}function Eu(K,F,V,X,J,le){var ge=(le-V)/(J-V);return K.push(F+(X-F)*ge),K.push(le),K.push(1),ge}function Pn(K,F){for(var V=[],X=0;X<K.length;X++){var J,le=K[X],ge=le.type;if("Point"===ge||"MultiPoint"===ge||"LineString"===ge)J=ui(le.geometry,F);else if("MultiLineString"===ge||"Polygon"===ge){J=[];for(var pe=0;pe<le.geometry.length;pe++)J.push(ui(le.geometry[pe],F))}else if("MultiPolygon"===ge)for(J=[],pe=0;pe<le.geometry.length;pe++){for(var ue=[],_e=0;_e<le.geometry[pe].length;_e++)ue.push(ui(le.geometry[pe][_e],F));J.push(ue)}V.push(zo(le.id,ge,J,le.tags))}return V}function ui(K,F){var V=[];V.size=K.size,void 0!==K.start&&(V.start=K.start,V.end=K.end);for(var X=0;X<K.length;X+=3)V.push(K[X]+F,K[X+1],K[X+2]);return V}function js(K,F){if(K.transformed)return K;var V,X,J,le=1<<K.z,ge=K.x,pe=K.y;for(V=0;V<K.features.length;V++){var ue=K.features[V],_e=ue.geometry,Me=ue.type;if(ue.geometry=[],1===Me)for(X=0;X<_e.length;X+=2)ue.geometry.push($i(_e[X],_e[X+1],F,le,ge,pe));else for(X=0;X<_e.length;X++){var Ae=[];for(J=0;J<_e[X].length;J+=2)Ae.push($i(_e[X][J],_e[X][J+1],F,le,ge,pe));ue.geometry.push(Ae)}}return K.transformed=!0,K}function $i(K,F,V,X,J,le){return[Math.round(V*(K*X-J)),Math.round(V*(F*X-le))]}function Us(K,F,V,X,J){for(var le=F===J.maxZoom?0:J.tolerance/((1<<F)*J.extent),ge={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:X,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<K.length;pe++){ge.numFeatures++,fs(ge,K[pe],le,J);var ue=K[pe].minX,_e=K[pe].minY,Me=K[pe].maxX,Ae=K[pe].maxY;ue<ge.minX&&(ge.minX=ue),_e<ge.minY&&(ge.minY=_e),Me>ge.maxX&&(ge.maxX=Me),Ae>ge.maxY&&(ge.maxY=Ae)}return ge}function fs(K,F,V,X){var J=F.geometry,le=F.type,ge=[];if("Point"===le||"MultiPoint"===le)for(var pe=0;pe<J.length;pe+=3)ge.push(J[pe]),ge.push(J[pe+1]),K.numPoints++,K.numSimplified++;else if("LineString"===le)Oo(ge,J,K,V,!1,!1);else if("MultiLineString"===le||"Polygon"===le)for(pe=0;pe<J.length;pe++)Oo(ge,J[pe],K,V,"Polygon"===le,0===pe);else if("MultiPolygon"===le)for(var ue=0;ue<J.length;ue++){var _e=J[ue];for(pe=0;pe<_e.length;pe++)Oo(ge,_e[pe],K,V,!0,0===pe)}if(ge.length){var Me=F.tags||null;if("LineString"===le&&X.lineMetrics){for(var Ae in Me={},F.tags)Me[Ae]=F.tags[Ae];Me.mapbox_clip_start=J.start/J.size,Me.mapbox_clip_end=J.end/J.size}var ze={geometry:ge,type:"Polygon"===le||"MultiPolygon"===le?3:"LineString"===le||"MultiLineString"===le?2:1,tags:Me};null!==F.id&&(ze.id=F.id),K.features.push(ze)}}function Oo(K,F,V,X,J,le){var ge=X*X;if(X>0&&F.size<(J?ge:X))V.numPoints+=F.length/3;else{for(var pe=[],ue=0;ue<F.length;ue+=3)(0===X||F[ue+2]>ge)&&(V.numSimplified++,pe.push(F[ue]),pe.push(F[ue+1])),V.numPoints++;J&&function(_e,Me){for(var Ae=0,ze=0,it=_e.length,ct=it-2;ze<it;ct=ze,ze+=2)Ae+=(_e[ze]-_e[ct])*(_e[ze+1]+_e[ct+1]);if(Ae>0===Me)for(ze=0,it=_e.length;ze<it/2;ze+=2){var st=_e[ze],dt=_e[ze+1];_e[ze]=_e[it-2-ze],_e[ze+1]=_e[it-1-ze],_e[it-2-ze]=st,_e[it-1-ze]=dt}}(pe,le),K.push(pe)}}function Ei(K,F){var V=(F=this.options=function(J,le){for(var ge in le)J[ge]=le[ge];return J}(Object.create(this.options),F)).debug;if(V&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var J,le,ge,pe,ue,_e,X=function(J,le){var ge=[];if("FeatureCollection"===J.type)for(var pe=0;pe<J.features.length;pe++)ds(ge,J.features[pe],le,pe);else ds(ge,"Feature"===J.type?J:{geometry:J},le);return ge}(K,F);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(J=X,le=F,ge=le.buffer/le.extent,pe=J,ue=wi(J,1,-1-ge,ge,0,-1,2,le),_e=wi(J,1,1-ge,2+ge,0,-1,2,le),(ue||_e)&&(pe=wi(J,1,-ge,1+ge,0,-1,2,le)||[],ue&&(pe=Pn(ue,1).concat(pe)),_e&&(pe=pe.concat(Pn(_e,-1)))),X=pe).length&&this.splitTile(X,0,0,0),V&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Bo(K,F,V){return 32*((1<<K)*V+F)+K}function Gi(K,F){const V=K.tileID.canonical;if(!this._geoJSONIndex)return F(null,null);const X=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!X)return F(null,null);const J=new vl(X.features);let le=ko(J);0===le.byteOffset&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),F(null,{vectorTile:J,rawData:le.buffer})}Ei.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ei.prototype.splitTile=function(K,F,V,X,J,le,ge){for(var pe=[K,F,V,X],ue=this.options,_e=ue.debug;pe.length;){X=pe.pop(),V=pe.pop(),F=pe.pop(),K=pe.pop();var Me=1<<F,Ae=Bo(F,V,X),ze=this.tiles[Ae];if(!ze&&(_e>1&&console.time("creation"),ze=this.tiles[Ae]=Us(K,F,V,X,ue),this.tileCoords.push({z:F,x:V,y:X}),_e)){_e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,V,X,ze.numFeatures,ze.numPoints,ze.numSimplified),console.timeEnd("creation"));var it="z"+F;this.stats[it]=(this.stats[it]||0)+1,this.total++}if(ze.source=K,J){if(F===ue.maxZoom||F===J)continue;var ct=1<<J-F;if(V!==Math.floor(le/ct)||X!==Math.floor(ge/ct))continue}else if(F===ue.indexMaxZoom||ze.numPoints<=ue.indexMaxPoints)continue;if(ze.source=null,0!==K.length){_e>1&&console.time("clipping");var st,dt,Mt,gn,yn,un,bn=.5*ue.buffer/ue.extent,ms=.5-bn,No=.5+bn,xr=1+bn;st=dt=Mt=gn=null,yn=wi(K,Me,V-bn,V+No,0,ze.minX,ze.maxX,ue),un=wi(K,Me,V+ms,V+xr,0,ze.minX,ze.maxX,ue),K=null,yn&&(st=wi(yn,Me,X-bn,X+No,1,ze.minY,ze.maxY,ue),dt=wi(yn,Me,X+ms,X+xr,1,ze.minY,ze.maxY,ue),yn=null),un&&(Mt=wi(un,Me,X-bn,X+No,1,ze.minY,ze.maxY,ue),gn=wi(un,Me,X+ms,X+xr,1,ze.minY,ze.maxY,ue),un=null),_e>1&&console.timeEnd("clipping"),pe.push(st||[],F+1,2*V,2*X),pe.push(dt||[],F+1,2*V,2*X+1),pe.push(Mt||[],F+1,2*V+1,2*X),pe.push(gn||[],F+1,2*V+1,2*X+1)}}},Ei.prototype.getTile=function(K,F,V){var X=this.options,J=X.extent,le=X.debug;if(K<0||K>24)return null;var ge=1<<K,pe=Bo(K,F=(F%ge+ge)%ge,V);if(this.tiles[pe])return js(this.tiles[pe],J);le>1&&console.log("drilling down to z%d-%d-%d",K,F,V);for(var ue,_e=K,Me=F,Ae=V;!ue&&_e>0;)_e--,Me=Math.floor(Me/2),Ae=Math.floor(Ae/2),ue=this.tiles[Bo(_e,Me,Ae)];return ue&&ue.source?(le>1&&console.log("found parent tile z%d-%d-%d",_e,Me,Ae),le>1&&console.time("drilling down"),this.splitTile(ue.source,_e,Me,Ae,K,F,V),le>1&&console.timeEnd("drilling down"),this.tiles[pe]?js(this.tiles[pe],J):null):null};class $s extends d.VectorTileWorkerSource{constructor(F,V,X,J,le){super(F,V,X,J,Gi),le&&(this.loadGeoJSON=le)}loadData(F,V){const X=F&&F.request,J=X&&X.collectResourceTiming;this.loadGeoJSON(F,(le,ge)=>{if(le||!ge)return V(le);if("object"!=typeof ge)return V(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));{Pe(ge,!0);try{if(F.filter){const ue=d.createExpression(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ue.result)throw new Error(ue.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));const _e=ge.features.filter(Me=>ue.value.evaluate({zoom:0},Me));ge={type:"FeatureCollection",features:_e}}this._geoJSONIndex=F.cluster?new Vi(function({superclusterOptions:ue,clusterProperties:_e}){if(!_e||!ue)return ue;const Me={},Ae={},ze={accumulated:null,zoom:0},it={properties:null},ct=Object.keys(_e);for(const st of ct){const[dt,Mt]=_e[st],gn=d.createExpression(Mt),yn=d.createExpression("string"==typeof dt?[dt,["accumulated"],["get",st]]:dt);Me[st]=gn.value,Ae[st]=yn.value}return ue.map=st=>{it.properties=st;const dt={};for(const Mt of ct)dt[Mt]=Me[Mt].evaluate(ze,it);return dt},ue.reduce=(st,dt)=>{it.properties=dt;for(const Mt of ct)ze.accumulated=st[Mt],st[Mt]=Ae[Mt].evaluate(ze,it)},ue}(F)).load(ge.features):new Ei(ue=ge,F.geojsonVtOptions)}catch(ue){return V(ue)}this.loaded={};const pe={};if(J){const ue=d.getPerformanceMeasurement(X);ue&&(pe.resourceTiming={},pe.resourceTiming[F.source]=JSON.parse(JSON.stringify(ue)))}V(null,pe)}var ue})}reloadTile(F,V){const X=this.loaded;return X&&X[F.uid]?super.reloadTile(F,V):this.loadTile(F,V)}loadGeoJSON(F,V){if(F.request)d.getJSON(F.request,V);else{if("string"!=typeof F.data)return V(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(F.data))}catch(X){return V(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(F,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(F.clusterId))}catch(X){V(X)}}getClusterChildren(F,V){try{V(null,this._geoJSONIndex.getChildren(F.clusterId))}catch(X){V(X)}}getClusterLeaves(F,V){try{V(null,this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset))}catch(X){V(X)}}}class hr{constructor(F){this.self=F,this.actor=new d.Actor(F,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.getProjection({name:"mercator"}),this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:$s},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,X)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=X},this.self.registerRTLTextPlugin=V=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=V.applyArabicShaping,d.plugin.processBidirectionalText=V.processBidirectionalText,d.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(F,V,X){delete this.layerIndexes[F],delete this.availableImages[F],delete this.workerSources[F],delete this.demWorkerSources[F],X()}checkIfReady(F,V,X){X()}setReferrer(F,V){this.referrer=V}spriteLoaded(F,V){this.isSpriteLoaded[F]=V;for(const X in this.workerSources[F]){const J=this.workerSources[F][X];for(const le in J)J[le]instanceof d.VectorTileWorkerSource&&(J[le].isSpriteLoaded=V,J[le].fire(new d.Event("isSpriteLoaded")))}}setImages(F,V,X){this.availableImages[F]=V;for(const J in this.workerSources[F]){const le=this.workerSources[F][J];for(const ge in le)le[ge].availableImages=V}X()}enableTerrain(F,V,X){this.terrain=V,X()}setProjection(F,V){this.projections[F]=d.getProjection(V)}setLayers(F,V,X){this.getLayerIndex(F).replace(V),X()}updateLayers(F,V,X){this.getLayerIndex(F).update(V.layers,V.removedIds),X()}loadTile(F,V,X){const J=this.enableTerrain?d.extend({enableTerrain:this.terrain},V):V;J.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,V.type,V.source).loadTile(J,X)}loadDEMTile(F,V,X){const J=this.enableTerrain?d.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(F,V.source).loadTile(J,X)}reloadTile(F,V,X){const J=this.enableTerrain?d.extend({enableTerrain:this.terrain},V):V;J.projection=this.projections[F]||this.defaultProjection,this.getWorkerSource(F,V.type,V.source).reloadTile(J,X)}abortTile(F,V,X){this.getWorkerSource(F,V.type,V.source).abortTile(V,X)}removeTile(F,V,X){this.getWorkerSource(F,V.type,V.source).removeTile(V,X)}removeSource(F,V,X){if(!this.workerSources[F]||!this.workerSources[F][V.type]||!this.workerSources[F][V.type][V.source])return;const J=this.workerSources[F][V.type][V.source];delete this.workerSources[F][V.type][V.source],void 0!==J.removeSource?J.removeSource(V,X):X()}loadWorkerSource(F,V,X){try{this.self.importScripts(V.url),X()}catch(J){X(J.toString())}}syncRTLPluginState(F,V,X){try{d.plugin.setState(V);const J=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=J){this.self.importScripts(J);const le=d.plugin.isParsed();X(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${J}`),le)}}catch(J){X(J.toString())}}getAvailableImages(F){let V=this.availableImages[F];return V||(V=[]),V}getLayerIndex(F){let V=this.layerIndexes[F];return V||(V=this.layerIndexes[F]=new Jr),V}getWorkerSource(F,V,X){return this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][V]||(this.workerSources[F][V]={}),this.workerSources[F][V][X]||(this.workerSources[F][V][X]=new this.workerSourceTypes[V]({send:(J,le,ge,pe,ue,_e)=>{this.actor.send(J,le,ge,F,ue,_e)},scheduler:this.actor.scheduler},this.getLayerIndex(F),this.getAvailableImages(F),this.isSpriteLoaded[F])),this.workerSources[F][V][X]}getDEMWorkerSource(F,V){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][V]||(this.demWorkerSources[F][V]=new _t),this.demWorkerSources[F][V]}enforceCacheSizeLimit(F,V){d.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(F,V,X){X(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new hr(self)),hr}),_h(0,function(d){var Kn=Ao;function Ao(f){return o=f,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{y=new Worker(E),m=!0}catch(C){m=!1}return y&&y.terminate(),URL.revokeObjectURL(E),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var x=y.getImageData(0,0,1,1);return x&&x.width===m.width}()||(void 0===Jr[c=o&&o.failIfMajorPerformanceCaveat]&&(Jr[c]=function(m){var y,E,C,P,x=(E=m,C=document.createElement("canvas"),(P=Object.create(Ao.webGLContextAttributes)).failIfMajorPerformanceCaveat=E,C.getContext("webgl",P)||C.getContext("experimental-webgl",P));if(!x)return!1;try{y=x.createShader(x.VERTEX_SHADER)}catch(E){return!1}return!(!y||x.isContextLost())&&(x.shaderSource(y,"void main() {}"),x.compileShader(y),!0===x.getShaderParameter(y,x.COMPILE_STATUS))}(c)),!Jr[c]||document.documentMode));var o,c}var Jr={};function We(f,o){var c=o[0],m=o[1],y=o[2],x=o[3],E=c*x-y*m;return E?(f[0]=x*(E=1/E),f[1]=-m*E,f[2]=-y*E,f[3]=c*E,f):null}function _t(f,o){if(Array.isArray(f)){if(!Array.isArray(o)||f.length!==o.length)return!1;for(let c=0;c<f.length;c++)if(!_t(f[c],o[c]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==o){if("object"!=typeof o||Object.keys(f).length!==Object.keys(o).length)return!1;for(const c in f)if(!_t(f[c],o[c]))return!1;return!0}return f===o}Ao.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Pe={create:function(f,o,c){const m=d.window.document.createElement(f);return void 0!==o&&(m.className=o),c&&c.appendChild(m),m},createSVG:function(f,o,c){const m=d.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(o))m.setAttributeNS(null,y,o[y]);return c&&c.appendChild(m),m}},li=d.window.document&&d.window.document.documentElement.style,Tn=li&&void 0!==li.userSelect?"userSelect":"WebkitUserSelect";let yl;Pe.disableDrag=function(){li&&Tn&&(yl=li[Tn],li[Tn]="none")},Pe.enableDrag=function(){li&&Tn&&(li[Tn]=yl)};const Qr=function(f){f.preventDefault(),f.stopPropagation(),d.window.removeEventListener("click",Qr,!0)};function vl(f,o,c){const m=f.offsetWidth===o.width?1:f.offsetWidth/o.width;return new d.pointGeometry((c.clientX-o.left)*m,(c.clientY-o.top)*m)}function Bi(f){const{userImage:o}=f;return!!(o&&o.render&&o.render())&&(f.data.replace(new Uint8Array(o.data.buffer)),!0)}Pe.suppressClick=function(){d.window.addEventListener("click",Qr,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",Qr,!0)},0)},Pe.mousePos=function(f,o){const c=f.getBoundingClientRect();return vl(f,c,o)},Pe.touchPos=function(f,o){const c=f.getBoundingClientRect(),m=[];for(let y=0;y<o.length;y++)m.push(vl(f,c,o[y]));return m},Pe.mouseButton=function(f){return void 0!==d.window.InstallTrigger&&2===f.button&&f.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button};class ur extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,m);this.requestors=[]}}getImage(o){return this.images[o]}addImage(o,c){this._validate(o,c)&&(this.images[o]=c)}_validate(o,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new d.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),m=!1),m}_validateStretch(o,c){if(!o)return!0;let m=0;for(const y of o){if(y[0]<m||y[1]<y[0]||c<y[1])return!1;m=y[1]}return!0}_validateContent(o,c){return!(o&&(4!==o.length||o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,c){c.version=this.images[o].version+1,this.images[o]=c,this.updatedImages[o]=!0}removeImage(o){const c=this.images[o];delete this.images[o],delete this.patterns[o],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,c){let m=!0;if(!this.isLoaded())for(const y of o)this.images[y]||(m=!1);this.isLoaded()||m?this._notify(o,c):this.requestors.push({ids:o,callback:c})}_notify(o,c){const m={};for(const y of o){this.images[y]||this.fire(new d.Event("styleimagemissing",{id:y}));const x=this.images[y];x?m[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:d.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,m)}getPixelSize(){const{width:o,height:c}=this.atlasImage;return{width:o,height:c}}getPattern(o){const c=this.patterns[o],m=this.getImage(o);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},x=new d.ImagePosition(y,m);this.patterns[o]={bin:y,position:x}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const c=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(o,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const x in this.patterns)o.push(this.patterns[x].bin);const{w:c,h:m}=d.potpack(o),y=this.atlasImage;y.resize({width:c||1,height:m||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],C=E.x+1,P=E.y+1,k=this.images[x].data,R=k.width,O=k.height;d.RGBAImage.copy(k,y,{x:0,y:0},{x:C,y:P},{width:R,height:O}),d.RGBAImage.copy(k,y,{x:0,y:O-1},{x:C,y:P-1},{width:R,height:1}),d.RGBAImage.copy(k,y,{x:0,y:0},{x:C,y:P+O},{width:R,height:1}),d.RGBAImage.copy(k,y,{x:R-1,y:0},{x:C-1,y:P},{width:1,height:O}),d.RGBAImage.copy(k,y,{x:0,y:0},{x:C+R,y:P},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const c of o){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const m=this.images[c];Bi(m)&&this.updateImage(c,m)}}}const Po=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(f,o){return function([c,m,y]){const x=d.degToRad(m+90),E=d.degToRad(y);return{x:c*Math.cos(x)*Math.sin(E),y:c*Math.sin(x)*Math.sin(E),z:c*Math.cos(E),azimuthal:m,polar:y}}(f.expression.evaluate(o))}interpolate(f,o,c){return{x:d.number(f.x,o.x,c),y:d.number(f.y,o.y,c),z:d.number(f.z,o.z,c),azimuthal:d.number(f.azimuthal,o.azimuthal,c),polar:d.number(f.polar,o.polar,c)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),ao="-transition";class ko extends d.Evented{constructor(o){super(),this._transitionable=new d.Transitionable(Po),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c={}){if(!this._validate(d.validateLight,o,c))for(const m in o){const y=o[m];d.endsWith(m,ao)?this._transitionable.setTransition(m.slice(0,-ao.length),y):this._transitionable.setValue(m,y)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const xl=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),Lo="-transition";class fc extends d.Evented{constructor(o,c){super(),this._transitionable=new d.Transitionable(xl),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(o){for(const c in o){const m=o[c];d.endsWith(c,Lo)?this._transitionable.setTransition(c.slice(0,-Lo.length),m):this._transitionable.setValue(c,m)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function vi(f,o,c,m){const y=d.smoothstep(45,65,c),[x,E]=cs(f,m),C=d.length(o);let P=1-Math.min(1,Math.exp((C-x)/(E-x)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*y*f.alpha}function cs(f,o){const c=.5/Math.tan(.5*o);return[f.range[0]+c,f.range[1]+c]}const ba=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"])}),us="-transition";class bu extends d.Evented{constructor(o,c){super(),this._transitionable=new d.Transitionable(ba),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,c={}){if(!this._validate(d.validateFog,o,c))for(const m in o){const y=o[m];d.endsWith(m,us)?this._transitionable.setTransition(m.slice(0,-us.length),y):this._transitionable.setValue(m,y)}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return d.smoothstep(45,65,o)*c.a}getOpacityAtLatLng(o,c){return this._transform.projection.supportsFog?function(m,y,x){const E=d.MercatorCoordinate.fromLngLat(y),C=x.elevation?x.elevation.getAtPointOrZero(E):0,P=[E.x,E.y,C];return d.transformMat4(P,P,x.mercatorFogMatrix),vi(m,P,x.pitch,x._fov)}(this.state,o,c):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?cs(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class xi{constructor(o,c){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const m=this.workerPool.acquire(this.id);for(let y=0;y<m.length;y++){const x=new xi.Actor(m[y],c,this.id);x.name=`Worker ${y}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,c,m){d.asyncAll(this.actors,(y,x)=>{y.send(o,c,x)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ci(f,o,c){return o*(d.EXTENT/(f.tileSize*Math.pow(2,c-f.tileID.overscaledZ)))}xi.Actor=d.Actor;class bl{constructor(o,c,m){this.context=o;const y=o.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ni={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Yn{constructor(o,c,m,y){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=o;const x=o.gl;this.buffer=x.createBuffer(),o.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let m=0;m<this.attributes.length;m++){const y=c.attributes[this.attributes[m].name];void 0!==y&&o.enableVertexAttribArray(y)}}setVertexAttribPointers(o,c,m){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],E=c.attributes[x.name];void 0!==E&&o.vertexAttribPointer(E,x.components,o[Ni[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $t{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class mc extends $t{getDefault(){return d.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Bs extends $t{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Ns extends $t{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class wl extends $t{getDefault(){return[!0,!0,!0,!0]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Vs extends $t{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class lo extends $t{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Vi extends $t{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Ro extends $t{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class gc extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class Fo extends $t{getDefault(){return[0,1]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class wa extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class El extends $t{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Lt extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class bi extends $t{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ea extends $t{getDefault(){return d.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class _c extends $t{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class yc extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class Tl extends $t{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class cn extends $t{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class zo extends $t{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class hs extends $t{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class ds extends $t{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ta extends $t{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Fn extends $t{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class vc extends $t{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class xc extends $t{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ji extends $t{getDefault(){return null}set(o){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class wi extends $t{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class wu extends $t{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Da extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Dl extends $t{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class ps extends $t{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class Cl extends ps{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Ui extends ps{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Eu extends Ui{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Pn{constructor(o,c,m,y){this.context=o,this.width=c,this.height=m;const x=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new Cl(o,x),y&&(this.depthAttachment=new Ui(o,x))}destroy(){const o=this.context.gl,c=this.colorAttachment.get();if(c&&o.deleteTexture(c),this.depthAttachment){const m=this.depthAttachment.get();m&&o.deleteRenderbuffer(m)}o.deleteFramebuffer(this.framebuffer)}}class ui{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new mc(this),this.clearDepth=new Bs(this),this.clearStencil=new Ns(this),this.colorMask=new wl(this),this.depthMask=new Vs(this),this.stencilMask=new lo(this),this.stencilFunc=new Vi(this),this.stencilOp=new Ro(this),this.stencilTest=new gc(this),this.depthRange=new Fo(this),this.depthTest=new wa(this),this.depthFunc=new El(this),this.blend=new Lt(this),this.blendFunc=new bi(this),this.blendColor=new Ea(this),this.blendEquation=new _c(this),this.cullFace=new yc(this),this.cullFaceSide=new Tl(this),this.frontFace=new cn(this),this.program=new zo(this),this.activeTexture=new hs(this),this.viewport=new ds(this),this.bindFramebuffer=new Ta(this),this.bindRenderbuffer=new Fn(this),this.bindTexture=new vc(this),this.bindVertexBuffer=new xc(this),this.bindElementBuffer=new ji(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new wi(this),this.pixelStoreUnpack=new wu(this),this.pixelStoreUnpackPremultiplyAlpha=new Da(this),this.pixelStoreUnpackFlipY=new Dl(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c){return new bl(this,o,c)}createVertexBuffer(o,c,m){return new Yn(this,o,c,m)}createRenderbuffer(o,c,m){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,o,c,m),this.bindRenderbuffer.set(null),x}createFramebuffer(o,c,m){return new Pn(this,o,c,m)}clear({color:o,depth:c,stencil:m}){const y=this.gl;let x=0;o&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==m&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(x)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){_t(o.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class js{constructor(o,c,m,y){this.screenBounds=o,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(x=>y.pointCoordinate3D(x)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(o,c){let m,y;if(o instanceof d.pointGeometry||"number"==typeof o[0]){const x=d.pointGeometry.convert(o);m=[d.pointGeometry.convert(o)],y=c.isPointAboveHorizon(x)}else{const x=d.pointGeometry.convert(o[0]),E=d.pointGeometry.convert(o[1]);m=[x,E],y=d.polygonizeBounds(x,E).every(C=>c.isPointAboveHorizon(C))}return new js(m,c.getCameraPoint(),y,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(o){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],y=d.polygonizeBounds(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),d.bufferConvexPolygon(y,o)}containsTile(o,c,m){const y=o.queryPadding+1,x=o.tileID.wrap,E=m?this._bufferedCameraMercator(y,c).map(G=>d.getTilePoint(o.tileTransform,G,x)):this._bufferedScreenMercator(y,c).map(G=>d.getTilePoint(o.tileTransform,G,x)),C=this.screenGeometryMercator.map(G=>d.getTileVec3(o.tileTransform,G,x)),P=C.map(G=>new d.pointGeometry(G[0],G[1])),k=c.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),R=d.getTileVec3(o.tileTransform,k,x),O=C.map(G=>{const W=d.sub(G,G,R);return d.normalize(W,W),new d.Ray(R,W)}),j=ci(o,1,c.zoom);if(d.polygonIntersectsBox(E,0,0,d.EXTENT,d.EXTENT))return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:O,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(Z=d.getBounds(E),Z.min.x=d.clamp(Z.min.x,0,d.EXTENT),Z.min.y=d.clamp(Z.min.y,0,d.EXTENT),Z.max.x=d.clamp(Z.max.x,0,d.EXTENT),Z.max.y=d.clamp(Z.max.y,0,d.EXTENT),Z),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:j};var Z}_bufferedScreenMercator(o,c){const m=$i(o);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{const y=this.bufferedScreenGeometry(o).map(x=>c.pointCoordinate3D(x));return this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(o,c){const m=$i(o);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{const y=this.bufferedCameraGeometry(o).map(x=>c.pointCoordinate3D(x));return this._cameraRaycastCache[m]=y,y}}}function $i(f){return 100*f|0}function Us(f,o,c){const m=function(y,x){if(y)return c(y);if(x){const E=d.pick(d.extend(x,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(C=>C.id)),E.tiles=o.canonicalizeTileset(E,f.url),c(null,E)}};return f.url?d.getJSON(o.transformRequest(o.normalizeSourceURL(f.url),d.ResourceType.Source),m):d.exported.frame(()=>m(null,f))}class fs{constructor(o,c,m){this.bounds=d.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const c=Math.pow(2,o.z),m=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*c),x=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*c),E=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*c);return o.x>=m&&o.x<x&&o.y>=y&&o.y<E}}class Oo extends d.Evented{constructor(o,c,m,y){super(),this.id=o,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},c),d.extend(this,d.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Us(this._options,this.map._requestManager,(o,c)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new d.ErrorEvent(o)):c&&(d.extend(this,c),c.bounds&&(this.tileBounds=new fs(c.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(c.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){const m=d.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);o.request=d.getImage(this.map._requestManager.transformRequest(y,d.ResourceType.Tile),(x,E,C,P)=>{if(delete o.request,o.aborted)o.state="unloaded",c(null);else if(x)o.state="errored",c(x);else if(E){this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:C,expires:P});const k=this.map.painter.context,R=k.gl;o.texture=this.map.painter.getTileTexture(E.width),o.texture?o.texture.update(E,{useMipmap:!0}):(o.texture=new d.Texture(k,E,R.RGBA,{useMipmap:!0}),o.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE),k.extTextureFilterAnisotropic&&R.texParameterf(R.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax)),o.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c()}unloadTile(o,c){o.texture&&this.map.painter.saveTileTexture(o.texture),c()}hasTransition(){return!1}}let Ei;function Bo(f,o,c,m,y,x,E,C){const P=[f,c,y,o,m,x,1,1,1],k=[E,C,1],R=d.adjoint([],P),[O,j,Z]=d.transformMat3(k,k,d.transpose(R,R));return d.multiply(P,[O,0,0,0,j,0,0,0,Z],P)}class Gi extends d.Evented{constructor(o,c,m,y){super(),this.id=o,this.dispatcher=m,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c}load(o,c){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(m,y)=>{this._loaded=!0,m?this.fire(new d.ErrorEvent(m)):y&&(this.image=d.exported.getImageData(y),this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}setCoordinates(o){this.coordinates=o,delete this._boundsArray;const c=o.map(d.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let y=1/0,x=1/0,E=-1/0,C=-1/0;for(const O of m)y=Math.min(y,O.x),x=Math.min(x,O.y),E=Math.max(E,O.x),C=Math.max(C,O.y);const P=Math.max(E-y,C-x),k=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),R=Math.pow(2,k);return new d.CanonicalTileID(k,Math.floor((y+E)/2*R),Math.floor((x+C)/2*R))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const o=d.tileTransform(this.tileID,this.map.transform.projection),[c,m,y,x]=this.coordinates.map(E=>{const C=o.projection.project(E[0],E[1]);return d.getTilePoint(o,C)._round()});return this.perspectiveTransform=function(E,C,P,k,R,O,j,Z,G,W){const se=Bo(0,0,E,0,0,C,E,C),H=Bo(P,k,R,O,j,Z,G,W);return d.multiply(H,d.adjoint(se,se),H),[H[6]/H[8]*E/d.EXTENT,H[7]/H[8]*C/d.EXTENT]}(this.width,this.height,c.x,c.y,m.x,m.y,x.x,x.y,y.x,y.y),this._boundsArray=new d.StructArrayLayout4i8,this._boundsArray.emplaceBack(c.x,c.y,0,0),this._boundsArray.emplaceBack(m.x,m.y,d.EXTENT,0),this._boundsArray.emplaceBack(x.x,x.y,0,d.EXTENT),this._boundsArray.emplaceBack(y.x,y.y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,c=o.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d.Texture(o,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const m in this.tiles){const y=this.tiles[m];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}loadTile(o,c){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},c(null)):(o.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const $s={vector:class extends d.Evented{constructor(f,o,c,m){if(super(),this.id=f,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(o,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Us(this._options,this.map._requestManager,(f,o)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new d.ErrorEvent(f)):o&&(d.extend(this,o),o.bounds&&(this.tileBounds=new fs(o.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f();const o=this.map.style._getSourceCaches(this.id);for(const c of o)c.clearTiles();this.load()}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(f,o){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,d.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=o:f.request=f.actor.send("reloadTile",m,y.bind(this));else if(f.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",m,y.bind(this),void 0,!0);else{const x=d.loadVectorTile.call({deduped:this._deduped},m,(E,C)=>{E||!C?y.call(this,E):(m.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},f.actor&&f.actor.send("loadTile",m,y.bind(this),void 0,!0))},!0);f.request={cancel:x}}function y(x,E){return delete f.request,f.aborted?o(null):x&&404!==x.status?o(x):(E&&E.resourceTiming&&(f.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&f.setExpiryData(E),f.loadVectorData(E,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Oo,"raster-dem":class extends Oo{constructor(f,o,c,m){super(f,o,c,m),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(f,o){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,x){y&&(f.state="errored",o(y)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",o(null))}f.request=d.getImage(this.map._requestManager.transformRequest(c,d.ResourceType.Tile),function(y,x,E,C){if(delete f.request,f.aborted)f.state="unloaded",o(null);else if(y)f.state="errored",o(y);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:E,expires:C});const P=d.window.ImageBitmap&&x instanceof d.window.ImageBitmap&&(null==Ei&&(Ei=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),Ei),k=1-(x.width-d.prevPowerOfTwo(x.width))/2;k<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const R=P?x:d.exported.getImageData(x,k),O={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:k};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",O,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const o=f.canonical,c=Math.pow(2,o.z),m=(o.x-1+c)%c,y=0===o.x?f.wrap-1:f.wrap,x=(o.x+1+c)%c,E=o.x+1===c?f.wrap+1:f.wrap,C={};return C[new d.OverscaledTileID(f.overscaledZ,y,o.z,m,o.y).key]={backfilled:!1},C[new d.OverscaledTileID(f.overscaledZ,E,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(C[new d.OverscaledTileID(f.overscaledZ,y,o.z,m,o.y-1).key]={backfilled:!1},C[new d.OverscaledTileID(f.overscaledZ,f.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},C[new d.OverscaledTileID(f.overscaledZ,E,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<c&&(C[new d.OverscaledTileID(f.overscaledZ,y,o.z,m,o.y+1).key]={backfilled:!1},C[new d.OverscaledTileID(f.overscaledZ,f.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},C[new d.OverscaledTileID(f.overscaledZ,E,o.z,x,o.y+1).key]={backfilled:!1}),C}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends d.Evented{constructor(f,o,c,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=o.data,this._options=d.extend({},o),this._collectResourceTiming=o.collectResourceTiming,void 0!==o.maxzoom&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const y=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(void 0!==o.buffer?o.buffer:128)*y,tolerance:(void 0!==o.tolerance?o.tolerance:.375)*y,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:void 0!==o.clusterMaxZoom?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==o.clusterRadius?o.clusterRadius:50)*y,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},o),this}getClusterChildren(f,o){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},o),this}getClusterLeaves(f,o,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:o,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=d.extend({},this.workerOptions),o=this._data;"string"==typeof o?(f.request=this.map._requestManager.transformRequest(d.exported.resolveURL(o),d.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new d.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),this.fire(new d.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,o){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(c,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,y)=>(delete f.request,f.unloadVectorData(),f.aborted?o(null):m?o(m):(f.loadVectorData(y,this.map.painter,"reloadTile"===c),o(null))),void 0,"loadTile"===c)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Gi{constructor(f,o,c,m){super(f,o,c,m),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const o of f.urls)this.urls.push(this.map._requestManager.transformRequest(o,d.ResourceType.Source).url);d.getVideo(this.urls,(o,c)=>{this._loaded=!0,o?this.fire(new d.ErrorEvent(o)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const o=this.video.seekable;f<o.start(0)||f>o.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,o=f.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(f,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2));for(const c in this.tiles){const m=this.tiles[c];"loaded"!==m.state&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Gi,canvas:class extends Gi{constructor(f,o,c,m){super(f,o,c,m),o.coordinates?Array.isArray(o.coordinates)&&4===o.coordinates.length&&!o.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(x=>"number"!=typeof x))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),o.animate&&"boolean"!=typeof o.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),o.canvas?"string"==typeof o.canvas||o.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=o,this.animate=void 0===o.animate||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const o=this.map.painter.context,c=o.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(o,this.canvas,c.RGBA,{premultiply:!0});for(const m in this.tiles){const y=this.tiles[m];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}}},hr=function(f,o,c,m){const y=new $s[o.type](f,o,c,m);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],y),y};function K(f,o){const c=d.identity([]);return d.scale(c,c,[.5*f.width,.5*-f.height,1]),d.translate(c,c,[1,-1,0]),d.multiply$1(c,c,f.calculateProjMatrix(o.toUnwrapped()))}function F(f,o,c,m,y,x,E,C=!1){const P=f.tilesIn(m,E,C);P.sort(X);const k=[];for(const O of P)k.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(o,c,f._state,O,y,x,K(f.transform,O.tile.tileID),C)});const R=function(O){const j={},Z={};for(const G of O){const W=G.queryResults,se=G.wrappedTileID,H=Z[se]=Z[se]||{};for(const ne in W){const re=W[ne],te=H[ne]=H[ne]||{},Q=j[ne]=j[ne]||[];for(const oe of re)te[oe.featureIndex]||(te[oe.featureIndex]=!0,Q.push(oe))}}return j}(k);for(const O in R)R[O].forEach(j=>{const Z=j.feature,G=f.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=G});return R}function V(f,o){const c=f.getRenderableIds().map(x=>f.getTileByID(x)),m=[],y={};for(let x=0;x<c.length;x++){const E=c[x],C=E.tileID.canonical.key;y[C]||(y[C]=!0,E.querySourceFeatures(m,o))}return m}function X(f,o){const c=f.tileID,m=o.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function J(){return null!=Lr.workerClass?new Lr.workerClass:new d.window.Worker(Lr.workerUrl)}const le="mapboxgl_preloaded_worker_pool";class ge{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<ge.workerCount;)this.workers.push(new J);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[le]}numActive(){return Object.keys(this.active).length}}let pe;function ue(){return pe||(pe=new ge),pe}function _e(f,o){const c={};for(const m in f)"ref"!==m&&(c[m]=f[m]);return d.refProperties.forEach(m=>{m in o&&(c[m]=o[m])}),c}function Me(f){f=f.slice();const o=Object.create(null);for(let c=0;c<f.length;c++)o[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=_e(f[c],o[f[c].ref]));return f}ge.workerCount=2;const Ae={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ze(f,o,c){c.push({command:Ae.addSource,args:[f,o[f]]})}function it(f,o,c){o.push({command:Ae.removeSource,args:[f]}),c[f]=!0}function ct(f,o,c,m){it(f,c,m),ze(f,o,c)}function st(f,o,c){let m;for(m in f[c])if(f[c].hasOwnProperty(m)&&"data"!==m&&!_t(f[c][m],o[c][m]))return!1;for(m in o[c])if(o[c].hasOwnProperty(m)&&"data"!==m&&!_t(f[c][m],o[c][m]))return!1;return!0}function dt(f,o,c,m,y,x){let E;for(E in o=o||{},f=f||{})f.hasOwnProperty(E)&&(_t(f[E],o[E])||c.push({command:x,args:[m,E,o[E],y]}));for(E in o)o.hasOwnProperty(E)&&!f.hasOwnProperty(E)&&(_t(f[E],o[E])||c.push({command:x,args:[m,E,o[E],y]}))}function Mt(f){return f.id}function gn(f,o){return f[o.id]=o,f}class yn{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=d.clamp(o,0,1);let c=1,m=this._distances[c];const y=o*this.paddedLength+this.padding;for(;m<y&&c<this._distances.length;)m=this._distances[++c];const x=c-1,E=this._distances[x],C=m-E,P=C>0?(y-E)/C:0;return this.points[x].mult(1-P).add(this.points[c].mult(P))}}class un{constructor(o,c,m){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(o/m),this.yCellCount=Math.ceil(c/m);for(let E=0;E<this.xCellCount*this.yCellCount;E++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,m,y,x){this._forEachCell(c,m,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(o,c,m,y){this._forEachCell(c-y,m-y,c+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(m),this.circles.push(y)}_insertBoxCell(o,c,m,y,x,E){this.boxCells[x].push(E)}_insertCircleCell(o,c,m,y,x,E){this.circleCells[x].push(E)}_query(o,c,m,y,x,E){if(m<0||o>this.width||y<0||c>this.height)return!x&&[];const C=[];if(o<=0&&c<=0&&this.width<=m&&this.height<=y){if(x)return!0;for(let P=0;P<this.boxKeys.length;P++)C.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const k=this.circles[3*P],R=this.circles[3*P+1],O=this.circles[3*P+2];C.push({key:this.circleKeys[P],x1:k-O,y1:R-O,x2:k+O,y2:R+O})}return E?C.filter(E):C}return this._forEachCell(o,c,m,y,this._queryCell,C,{hitTest:x,seenUids:{box:{},circle:{}}},E),x?C.length>0:C}_queryCircle(o,c,m,y,x){const E=o-m,C=o+m,P=c-m,k=c+m;if(C<0||E>this.width||k<0||P>this.height)return!y&&[];const R=[];return this._forEachCell(E,P,C,k,this._queryCellCircle,R,{hitTest:y,circle:{x:o,y:c,radius:m},seenUids:{box:{},circle:{}}},x),y?R.length>0:R}query(o,c,m,y,x){return this._query(o,c,m,y,!1,x)}hitTest(o,c,m,y,x){return this._query(o,c,m,y,!0,x)}hitTestCircle(o,c,m,y){return this._queryCircle(o,c,m,!0,y)}_queryCell(o,c,m,y,x,E,C,P){const k=C.seenUids,R=this.boxCells[x];if(null!==R){const j=this.bboxes;for(const Z of R)if(!k.box[Z]){k.box[Z]=!0;const G=4*Z;if(o<=j[G+2]&&c<=j[G+3]&&m>=j[G+0]&&y>=j[G+1]&&(!P||P(this.boxKeys[Z]))){if(C.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Z],x1:j[G],y1:j[G+1],x2:j[G+2],y2:j[G+3]})}}}const O=this.circleCells[x];if(null!==O){const j=this.circles;for(const Z of O)if(!k.circle[Z]){k.circle[Z]=!0;const G=3*Z;if(this._circleAndRectCollide(j[G],j[G+1],j[G+2],o,c,m,y)&&(!P||P(this.circleKeys[Z]))){if(C.hitTest)return E.push(!0),!0;{const W=j[G],se=j[G+1],H=j[G+2];E.push({key:this.circleKeys[Z],x1:W-H,y1:se-H,x2:W+H,y2:se+H})}}}}}_queryCellCircle(o,c,m,y,x,E,C,P){const k=C.circle,R=C.seenUids,O=this.boxCells[x];if(null!==O){const Z=this.bboxes;for(const G of O)if(!R.box[G]){R.box[G]=!0;const W=4*G;if(this._circleAndRectCollide(k.x,k.y,k.radius,Z[W+0],Z[W+1],Z[W+2],Z[W+3])&&(!P||P(this.boxKeys[G])))return E.push(!0),!0}}const j=this.circleCells[x];if(null!==j){const Z=this.circles;for(const G of j)if(!R.circle[G]){R.circle[G]=!0;const W=3*G;if(this._circlesCollide(Z[W],Z[W+1],Z[W+2],k.x,k.y,k.radius)&&(!P||P(this.circleKeys[G])))return E.push(!0),!0}}}_forEachCell(o,c,m,y,x,E,C,P){const k=this._convertToXCellCoord(o),R=this._convertToYCellCoord(c),O=this._convertToXCellCoord(m),j=this._convertToYCellCoord(y);for(let Z=k;Z<=O;Z++)for(let G=R;G<=j;G++)if(x.call(this,o,c,m,y,this.xCellCount*G+Z,E,C,P))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,m,y,x,E){const C=y-o,P=x-c,k=m+E;return k*k>C*C+P*P}_circleAndRectCollide(o,c,m,y,x,E,C){const P=(E-y)/2,k=Math.abs(o-(y+P));if(k>P+m)return!1;const R=(C-x)/2,O=Math.abs(c-(x+R));if(O>R+m)return!1;if(k<=P||O<=R)return!0;const j=k-P,Z=O-R;return j*j+Z*Z<=m*m}}const bn=Math.tan(85*Math.PI/180);function ms(f,o,c,m,y,x){let E=d.create();if(c){if("globe"===y.projection.name)E=d.calculateGlobeMatrix(y,y.worldSize/y._projectionScaler,[0,0]),d.multiply$1(E,E,d.globeDenormalizeECEF(d.globeTileBounds(o)));else{const C=We([],x);E[0]=C[0],E[1]=C[1],E[4]=C[2],E[5]=C[3]}m||d.rotateZ(E,E,y.angle)}else d.multiply$1(E,y.labelPlaneMatrix,f);return E}function No(f,o,c,m,y,x){if(c){if("globe"===y.projection.name){const E=ms(f,o,c,m,y,x);return d.invert(E,E),d.multiply$1(E,f,E),E}{const E=d.clone(f),C=d.identity([]);return C[0]=x[0],C[1]=x[1],C[4]=x[2],C[5]=x[3],d.multiply$1(E,E,C),m||d.rotateZ(E,E,-y.angle),E}}return y.glCoordMatrix}function xr(f,o,c=0){const m=[f.x,f.y,c,1];c?d.transformMat4$1(m,m,o):Gs(m,m,o);const y=m[3];return{point:new d.pointGeometry(m[0]/y,m[1]/y),signedDistanceFromCamera:y}}function Hi(f,o){return Math.min(.5+f/o*.5,1.5)}function bc(f,o){const c=f[0]/f[3],m=f[1]/f[3];return c>=-o[0]&&c<=o[0]&&m>=-o[1]&&m<=o[1]}function yh(f,o,c,m,y,x,E,C,P,k){const R=c.transform,O=m?f.textSizeData:f.iconSizeData,j=d.evaluateSizeForZoom(O,c.transform.zoom),Z=[256/c.width*2+1,256/c.height*2+1],G=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;G.clear();const W=f.lineVertexArray,se=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,H=c.transform.width/c.transform.height;let ne=!1;for(let re=0;re<se.length;re++){const te=se.get(re);if(te.writingMode!==d.WritingMode.vertical||ne||0!==re&&se.get(re-1).writingMode===d.WritingMode.horizontal||(ne=!0),te.hidden||te.writingMode===d.WritingMode.vertical&&!ne){Nt(te.numGlyphs,G);continue}ne=!1;const Q=new d.pointGeometry(te.tileAnchorX,te.tileAnchorY),oe=P?P(Q):[0,0,0],de=R.projection.projectTilePoint(Q.x,Q.y,k.canonical),xe=[de.x+oe[0],de.y+oe[1],de.z+oe[2]],Ue=[...xe,1];if(d.transformMat4$1(Ue,Ue,o),!bc(Ue,Z)){Nt(te.numGlyphs,G);continue}const Re=Hi(c.transform.cameraToCenterDistance,Ue[3]),Le=d.evaluateSizeForFeature(O,j,te),we=E?Le/Re:Le*Re,ve=xr(new d.pointGeometry(xe[0],xe[1]),y,xe[2]);if(ve.signedDistanceFromCamera<=0){Nt(te.numGlyphs,G);continue}let ke={};const De=E?null:P,tt=Tu(te,we,!1,C,o,y,x,f.glyphOffsetArray,W,G,ve.point,Q,ke,H,De,R.projection,k);ne=tt.useVertical,De&&tt.needsFlipping&&(ke={}),(tt.notEnoughRoom||ne||tt.needsFlipping&&Tu(te,we,!0,C,o,y,x,f.glyphOffsetArray,W,G,ve.point,Q,ke,H,De,R.projection,k).notEnoughRoom)&&Nt(te.numGlyphs,G)}m?f.text.dynamicLayoutVertexBuffer.updateData(G):f.icon.dynamicLayoutVertexBuffer.updateData(G)}function Ml(f,o,c,m,y,x,E,C,P,k,R,O,j,Z,G){const W=C.glyphStartIndex+C.numGlyphs,se=C.lineStartIndex,H=C.lineStartIndex+C.lineLength,ne=o.getoffsetX(C.glyphStartIndex),re=o.getoffsetX(W-1),te=ln(f*ne,c,m,y,x,E,C.segment,se,H,P,k,R,O,j,!0,Z,G);if(!te)return null;const Q=ln(f*re,c,m,y,x,E,C.segment,se,H,P,k,R,O,j,!0,Z,G);return Q?{first:te,last:Q}:null}function Il(f,o,c,m){return f.writingMode===d.WritingMode.horizontal&&Math.abs(c.y-o.y)>Math.abs(c.x-o.x)*m?{useVertical:!0}:f.writingMode===d.WritingMode.vertical?o.y<c.y?{needsFlipping:!0}:null:0!==f.flipState&&function(y,x,E){const C=(x.x-y.x)*E;return 0===C||Math.abs((x.y-y.y)/C)>bn}(o,c,m)?1===f.flipState?{needsFlipping:!0}:null:o.x>c.x?{needsFlipping:!0}:null}function Tu(f,o,c,m,y,x,E,C,P,k,R,O,j,Z,G,W,se){const H=o/24,ne=f.lineOffsetX*H,re=f.lineOffsetY*H;let te;if(f.numGlyphs>1){const Q=f.glyphStartIndex+f.numGlyphs,oe=f.lineStartIndex,de=f.lineStartIndex+f.lineLength,xe=Ml(H,C,ne,re,c,R,O,f,P,x,j,G,!1,W,se);if(!xe)return{notEnoughRoom:!0};const Ue=xr(xe.first.point,E).point,Re=xr(xe.last.point,E).point;if(m&&!c){const Le=Il(f,Ue,Re,Z);if(f.flipState=Le&&Le.needsFlipping?1:2,Le)return Le}te=[xe.first];for(let Le=f.glyphStartIndex+1;Le<Q-1;Le++)te.push(ln(H*C.getoffsetX(Le),ne,re,c,R,O,f.segment,oe,de,P,x,j,G,!1,!1,W,se));te.push(xe.last)}else{if(m&&!c){const oe=xr(O,y).point,de=f.lineStartIndex+f.segment+1,xe=new d.pointGeometry(P.getx(de),P.gety(de)),Ue=xr(xe,y),Re=Il(f,oe,Ue.signedDistanceFromCamera>0?Ue.point:Ca(O,xe,oe,1,y,void 0,W,se.canonical),Z);if(f.flipState=Re&&Re.needsFlipping?1:2,Re)return Re}const Q=ln(H*C.getoffsetX(f.glyphStartIndex),ne,re,c,R,O,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,P,x,j,G,!1,!1,W,se);if(!Q)return{notEnoughRoom:!0};te=[Q]}for(const Q of te)d.addDynamicAttributes(k,Q.point,Q.angle);return{}}function wc(f,o,c,m,y){const x=m.projectTilePoint(f.x,f.y,o);if(!y)return xr(x,c,x.z);const E=y(f);return xr(new d.pointGeometry(x.x+E[0],x.y+E[1]),c,x.z+E[2])}function Ca(f,o,c,m,y,x,E,C){const P=wc(f.add(f.sub(o)._unit()),C,y,E,x).point,k=c.sub(P);return c.add(k._mult(m/k.mag()))}function ln(f,o,c,m,y,x,E,C,P,k,R,O,j,Z,G,W,se){const H=m?f-o:f+o;let ne=H>0?1:-1,re=0;m&&(ne*=-1,re=Math.PI),ne<0&&(re+=Math.PI);let te=ne>0?C+E:C+E+1,Q=y,oe=y,de=0,xe=0;const Ue=Math.abs(H),Re=[],Le=[];let we=x;const ve=()=>{const je=te-ne;return 0===de?x:new d.pointGeometry(k.getx(je),k.gety(je))},ke=()=>Ca(ve(),we,oe,Ue-de+1,R,j,W,se.canonical);for(;de+xe<=Ue;){if(te+=ne,te<C||te>=P)return null;if(oe=Q,Re.push(Q),Z&&Le.push(we||ve()),Q=O[te],void 0===Q){we=new d.pointGeometry(k.getx(te),k.gety(te));const je=wc(we,se.canonical,R,W,j);Q=je.signedDistanceFromCamera>0?O[te]=je.point:ke()}else we=null;de+=xe,xe=oe.dist(Q)}G&&j&&(we=we||new d.pointGeometry(k.getx(te),k.gety(te)),O[te]=Q=void 0===O[te]?Q:ke(),xe=oe.dist(Q));const De=(Ue-de)/xe,tt=Q.sub(oe),lt=tt.mult(De)._add(oe);c&&lt._add(tt._unit()._perp()._mult(c*ne));const Tt=re+Math.atan2(Q.y-oe.y,Q.x-oe.x);return Re.push(lt),Z&&(we=we||new d.pointGeometry(k.getx(te),k.gety(te)),Le.push(function(je,nt,mt){const on=1-mt;return new d.pointGeometry(je.x*on+nt.x*mt,je.y*on+nt.y*mt)}(Le.length>0?Le[Le.length-1]:we,we,De))),{point:lt,angle:Tt,path:Re,tilePath:Le}}const Sl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Nt(f,o){for(let c=0;c<f;c++){const m=o.length;o.resize(m+4),o.float32.set(Sl,3*m)}}function Gs(f,o,c){const m=o[0],y=o[1];return f[0]=c[0]*m+c[4]*y+c[12],f[1]=c[1]*m+c[5]*y+c[13],f[3]=c[3]*m+c[7]*y+c[15],f}const co=100;class Du{constructor(o,c,m=new un(o.width+200,o.height+200,25),y=new un(o.width+200,o.height+200,25)){this.transform=o,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+co,this.screenBottomBoundary=o.height+co,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=c}placeCollisionBox(o,c,m,y,x,E,C){let P=c.projectedAnchorX,k=c.projectedAnchorY,R=c.projectedAnchorZ;const O=c.elevation,j=c.tileID;if(O&&j){const te=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),Q=te.upVector(j.canonical,c.tileAnchorX,c.tileAnchorY),oe=te.upVectorScale(j.canonical);P+=Q[0]*O*oe,k+=Q[1]*O*oe,R+=Q[2]*O*oe}const Z=this.projectAndGetPerspectiveRatio(E,P,k,R,c.tileID),G=x*Z.perspectiveRatio,W=(c.x1*o+m.x-c.padding)*G+Z.point.x,se=(c.y1*o+m.y-c.padding)*G+Z.point.y,H=(c.x2*o+m.x+c.padding)*G+Z.point.x,ne=(c.y2*o+m.y+c.padding)*G+Z.point.y,re=Z.perspectiveRatio<=.55||Z.aboveHorizon;return!this.isInsideGrid(W,se,H,ne)||!y&&this.grid.hitTest(W,se,H,ne,C)||re?{box:[],offscreen:!1}:{box:[W,se,H,ne],offscreen:this.isOffscreen(W,se,H,ne)}}placeCollisionCircles(o,c,m,y,x,E,C,P,k,R,O,j,Z,G){const W=[],se=this.transform.elevation,H=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ne=se?se.getAtTileOffsetFunc(G,H):De=>[0,0,0],re=new d.pointGeometry(c.tileAnchorX,c.tileAnchorY),te=this.transform.projection.projectTilePoint(c.tileAnchorX,c.tileAnchorY,G.canonical),Q=ne(re),oe=[te.x+Q[0],te.y+Q[1],te.z+Q[2]],de=this.projectAndGetPerspectiveRatio(E,oe[0],oe[1],oe[2],G),{perspectiveRatio:xe}=de,Ue=(R?x/xe:x*xe)/d.ONE_EM,Re=xr(new d.pointGeometry(oe[0],oe[1]),C,oe[2]).point,Le=de.signedDistanceFromCamera>0?Ml(Ue,y,c.lineOffsetX*Ue,c.lineOffsetY*Ue,!1,Re,re,c,m,C,{},se&&!R?ne:null,R&&!!se,this.transform.projection,G):null;let we=!1,ve=!1,ke=!0;if(Le&&!de.aboveHorizon){const De=.5*j*xe+Z,tt=new d.pointGeometry(-100,-100),lt=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Tt=new yn,je=Le.first,nt=Le.last;let mt=[];for(let ut=je.path.length-1;ut>=1;ut--)mt.push(je.path[ut]);for(let ut=1;ut<nt.path.length;ut++)mt.push(nt.path[ut]);const on=2.5*De;if(P){const ut=mt.map(se?(Ct,wn)=>{const Jn=ne(wn<je.path.length-1?je.tilePath[je.path.length-1-wn]:nt.tilePath[wn-je.path.length+2]);return xr(Ct,P,Jn[2])}:Ct=>xr(Ct,P));mt=ut.some(Ct=>Ct.signedDistanceFromCamera<=0)?[]:ut.map(Ct=>Ct.point)}let pn=[];if(mt.length>0){const ut=mt[0].clone(),Ct=mt[0].clone();for(let wn=1;wn<mt.length;wn++)ut.x=Math.min(ut.x,mt[wn].x),ut.y=Math.min(ut.y,mt[wn].y),Ct.x=Math.max(Ct.x,mt[wn].x),Ct.y=Math.max(Ct.y,mt[wn].y);pn=ut.x>=tt.x&&Ct.x<=lt.x&&ut.y>=tt.y&&Ct.y<=lt.y?[mt]:Ct.x<tt.x||ut.x>lt.x||Ct.y<tt.y||ut.y>lt.y?[]:d.clipLine([mt],tt.x,tt.y,lt.x,lt.y)}for(const ut of pn){Tt.reset(ut,.25*De);let Ct=0;Ct=Tt.length<=.5*De?1:Math.ceil(Tt.paddedLength/on)+1;for(let wn=0;wn<Ct;wn++){const Jn=wn/Math.max(Ct-1,1),di=Tt.lerp(Jn),Qi=di.x+co,ii=di.y+co;W.push(Qi,ii,De,0);const Gt=Qi-De,gt=ii-De,Pt=Qi+De,Cn=ii+De;if(ke=ke&&this.isOffscreen(Gt,gt,Pt,Cn),ve=ve||this.isInsideGrid(Gt,gt,Pt,Cn),!o&&this.grid.hitTestCircle(Qi,ii,De,O)&&(we=!0,!k))return{circles:[],offscreen:!1,collisionDetected:we}}}}return{circles:!k&&we||!ve?[]:W,offscreen:ke,collisionDetected:we}}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let m=1/0,y=1/0,x=-1/0,E=-1/0;for(const R of o){const O=new d.pointGeometry(R.x+co,R.y+co);m=Math.min(m,O.x),y=Math.min(y,O.y),x=Math.max(x,O.x),E=Math.max(E,O.y),c.push(O)}const C=this.grid.query(m,y,x,E).concat(this.ignoredGrid.query(m,y,x,E)),P={},k={};for(const R of C){const O=R.key;if(void 0===P[O.bucketInstanceId]&&(P[O.bucketInstanceId]={}),P[O.bucketInstanceId][O.featureIndex])continue;const j=[new d.pointGeometry(R.x1,R.y1),new d.pointGeometry(R.x2,R.y1),new d.pointGeometry(R.x2,R.y2),new d.pointGeometry(R.x1,R.y2)];d.polygonIntersectsPolygon(c,j)&&(P[O.bucketInstanceId][O.featureIndex]=!0,void 0===k[O.bucketInstanceId]&&(k[O.bucketInstanceId]=[]),k[O.bucketInstanceId].push(O.featureIndex))}return k}insertCollisionBox(o,c,m,y,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:x},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,m,y,x){const E=c?this.ignoredGrid:this.grid,C={bucketInstanceId:m,featureIndex:y,collisionGroupID:x};for(let P=0;P<o.length;P+=4)E.insertCircle(C,o[P],o[P+1],o[P+2])}projectAndGetPerspectiveRatio(o,c,m,y,x){const E=[c,m,y||0,1];let C=!1;if(y||this.transform.pitch>0){d.transformMat4$1(E,E,o);let P=!1;this.fogState&&x&&(P=function(k,R,O,j,Z,G){const W=G.calculateFogTileMatrix(Z),se=[R,O,j];return d.transformMat4(se,se,W),vi(k,se,G.pitch,G._fov)}(this.fogState,c,m,y||0,x.toUnwrapped(),this.transform)>.9),C=E[2]>E[3]||P}else Gs(E,E,o);return{point:new d.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+co,(-E[1]/E[3]+1)/2*this.transform.height+co),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/E[3]*.5,1.5),signedDistanceFromCamera:E[3],aboveHorizon:C}}isOffscreen(o,c,m,y){return m<co||o>=this.screenRightBoundary||y<co||c>this.screenBottomBoundary}isInsideGrid(o,c,m,y){return m>=0&&o<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const o=d.identity([]);return d.translate(o,o,[-100,-100,0]),o}}class It{constructor(o,c,m,y){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):y&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class Hs{constructor(o,c,m,y,x,E=!1){this.text=new It(o?o.text:null,c,m,x),this.icon=new It(o?o.icon:null,c,y,x),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Al{constructor(o,c,m,y=!1){this.text=o,this.icon=c,this.skipFade=m,this.clipped=y}}class Kt{constructor(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]}}class Ec{constructor(o,c,m,y,x){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=x}}class wt{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[o]}}function dr(f,o,c,m,y){const{horizontalAlign:x,verticalAlign:E}=d.getAnchorAlignment(f),C=-(x-.5)*o,P=-(E-.5)*c,k=d.evaluateVariableOffset(f,m);return new d.pointGeometry(C+k[0]*y,P+k[1]*y)}function gs(f,o,c,m,y){const x=new d.pointGeometry(f,o);return c&&x._rotate(m?y:-y),x}class Cu{constructor(o,c,m,y,x){this.transform=o.clone(),this.collisionIndex=new Du(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new wt(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,c,m,y){const x=m.getBucket(c),E=m.latestFeatureIndex;if(!x||!E||c.id!==x.layerIds[0])return;const C=x.layers[0].layout,P=m.collisionBoxArray,k=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),R=m.tileSize/d.EXTENT,O=m.tileID.toUnwrapped(),j=this.transform.calculateProjMatrix(O),Z="map"===C.get("text-pitch-alignment"),G="map"===C.get("text-rotation-alignment");c.compileFilter();const W=c.dynamicFilter(),se=c.dynamicFilterNeedsFeature(),H=this.transform.calculatePixelsToTileUnitsMatrix(m),ne=ms(j,m.tileID.canonical,Z,G,this.transform,H);let re=null;if(Z){const oe=No(j,m.tileID.canonical,Z,G,this.transform,H);re=d.multiply$1([],this.transform.labelPlaneMatrix,oe)}let te=null;W&&m.latestFeatureIndex&&(te={unwrappedTileID:O,dynamicFilter:W,dynamicFilterNeedsFeature:se,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Ec(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,m.tileID);const Q={bucket:x,layout:C,posMatrix:j,textLabelPlaneMatrix:ne,labelToScreenMatrix:re,clippingData:te,scale:k,textPixelRatio:R,holdingForFade:m.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(y)for(const oe of x.sortKeyRanges){const{sortKey:de,symbolInstanceStart:xe,symbolInstanceEnd:Ue}=oe;o.push({sortKey:de,symbolInstanceStart:xe,symbolInstanceEnd:Ue,parameters:Q})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(o,c,m,y,x,E,C,P,k,R,O,j,Z,G,W,se,H,ne){const re=[j.textOffset0,j.textOffset1],te=dr(o,m,y,re,x),Q=this.collisionIndex.placeCollisionBox(x,c,gs(te.x,te.y,E,C,this.transform.angle),O,P,k,R.predicate);if((!se||0!==this.collisionIndex.placeCollisionBox(G.getSymbolInstanceIconSize(ne,this.transform.zoom,Z),se,gs(te.x,te.y,E,C,this.transform.angle),O,P,k,R.predicate).box.length)&&Q.box.length>0){let oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(oe=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:re,width:m,height:y,anchor:o,textScale:x,prevAnchor:oe},this.markUsedJustification(G,o,j,W),G.allowVerticalPlacement&&(this.markUsedOrientation(G,W,j),this.placedOrientations[j.crossTileID]=W),{shift:te,placedGlyphBoxes:Q}}}placeLayerBucketPart(o,c,m,y){const{bucket:x,layout:E,posMatrix:C,textLabelPlaneMatrix:P,labelToScreenMatrix:k,clippingData:R,textPixelRatio:O,holdingForFade:j,collisionBoxArray:Z,partiallyEvaluatedTextSize:G,partiallyEvaluatedIconSize:W,collisionGroup:se}=o.parameters,H=E.get("text-optional"),ne=E.get("icon-optional"),re=E.get("text-allow-overlap"),te=E.get("icon-allow-overlap"),Q="map"===E.get("text-rotation-alignment"),oe="map"===E.get("text-pitch-alignment"),de="none"!==E.get("icon-text-fit"),xe="viewport-y"===E.get("symbol-z-order"),Ue=re&&(te||!x.hasIconData()||ne),Re=te&&(re||!x.hasTextData()||H);!x.collisionArrays&&Z&&x.deserializeCollisionBoxes(Z),m&&y&&x.updateCollisionDebugBuffers(this.transform.zoom,Z);const Le=(we,ve,ke)=>{if(R){const Gt={zoom:this.transform.zoom,pitch:this.transform.pitch};let gt=null;if(R.dynamicFilterNeedsFeature){const Pt=this.retainedQueryData[x.bucketInstanceId];gt=R.featureIndex.loadFeature({featureIndex:we.featureIndex,bucketIndex:Pt.bucketIndex,sourceLayerIndex:Pt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(Gt,gt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new d.pointGeometry(we.tileAnchorX,we.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[we.crossTileID]=new Al(!1,!1,!1,!0),void(c[we.crossTileID]=!0)}if(c[we.crossTileID])return;if(j)return void(this.placements[we.crossTileID]=new Al(!1,!1,!1));let De=!1,tt=!1,lt=!0,Tt=null,je={box:null,offscreen:null},nt={box:null,offscreen:null},mt=null,on=null,pn=null,ut=0,Ct=0,wn=0;ke.textFeatureIndex?ut=ke.textFeatureIndex:we.useRuntimeCollisionCircles&&(ut=we.featureIndex),ke.verticalTextFeatureIndex&&(Ct=ke.verticalTextFeatureIndex);const Jn=Gt=>{Gt.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||Gt.elevation)&&(Gt.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,Gt.tileAnchorX,Gt.tileAnchorY):0)},di=ke.textBox;if(di){Jn(di);const Gt=Pt=>{let Cn=d.WritingMode.horizontal;if(x.allowVerticalPlacement&&!Pt&&this.prevPlacement){const oi=this.prevPlacement.placedOrientations[we.crossTileID];oi&&(this.placedOrientations[we.crossTileID]=oi,Cn=oi,this.markUsedOrientation(x,Cn,we))}return Cn},gt=(Pt,Cn)=>{if(x.allowVerticalPlacement&&we.numVerticalGlyphVertices>0&&ke.verticalTextBox){for(const oi of x.writingModes)if(oi===d.WritingMode.vertical?(je=Cn(),nt=je):je=Pt(),je&&je.box&&je.box.length)break}else je=Pt()};if(E.get("text-variable-anchor")){let Pt=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]){const sn=this.prevPlacement.variableOffsets[we.crossTileID];Pt.indexOf(sn.anchor)>0&&(Pt=Pt.filter(pi=>pi!==sn.anchor),Pt.unshift(sn.anchor))}const Cn=(sn,pi,_o)=>{const Rr=x.getSymbolInstanceTextSize(G,we,this.transform.zoom,ve),yo=(sn.x2-sn.x1)*Rr+2*sn.padding,et=(sn.y2-sn.y1)*Rr+2*sn.padding,at=de&&!te?pi:null;at&&Jn(at);let sr={box:[],offscreen:!1};const oa=re?2*Pt.length:Pt.length;for(let Ds=0;Ds<oa;++Ds){const Wn=this.attemptAnchorPlacement(Pt[Ds%Pt.length],sn,yo,et,Rr,Q,oe,O,C,se,Ds>=Pt.length,we,ve,x,_o,at,G,W);if(Wn&&(sr=Wn.placedGlyphBoxes,sr&&sr.box&&sr.box.length)){De=!0,Tt=Wn.shift;break}}return sr};gt(()=>Cn(di,ke.iconBox,d.WritingMode.horizontal),()=>{const sn=ke.verticalTextBox;return sn&&Jn(sn),x.allowVerticalPlacement&&!(je&&je.box&&je.box.length)&&we.numVerticalGlyphVertices>0&&sn?Cn(sn,ke.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),je&&(De=je.box,lt=je.offscreen);const oi=Gt(je&&je.box);if(!De&&this.prevPlacement){const sn=this.prevPlacement.variableOffsets[we.crossTileID];sn&&(this.variableOffsets[we.crossTileID]=sn,this.markUsedJustification(x,sn.anchor,we,oi))}}else{const Pt=(Cn,oi)=>{const sn=x.getSymbolInstanceTextSize(G,we,this.transform.zoom,ve),pi=this.collisionIndex.placeCollisionBox(sn,Cn,new d.pointGeometry(0,0),re,O,C,se.predicate);return pi&&pi.box&&pi.box.length&&(this.markUsedOrientation(x,oi,we),this.placedOrientations[we.crossTileID]=oi),pi};gt(()=>Pt(di,d.WritingMode.horizontal),()=>{const Cn=ke.verticalTextBox;return x.allowVerticalPlacement&&we.numVerticalGlyphVertices>0&&Cn?(Jn(Cn),Pt(Cn,d.WritingMode.vertical)):{box:null,offscreen:null}}),Gt(je&&je.box&&je.box.length)}}if(mt=je,De=mt&&mt.box&&mt.box.length>0,lt=mt&&mt.offscreen,we.useRuntimeCollisionCircles){const Gt=x.text.placedSymbolArray.get(we.centerJustifiedTextSymbolIndex>=0?we.centerJustifiedTextSymbolIndex:we.verticalPlacedTextSymbolIndex),gt=d.evaluateSizeForFeature(x.textSizeData,G,Gt),Pt=E.get("text-padding");on=this.collisionIndex.placeCollisionCircles(re,Gt,x.lineVertexArray,x.glyphOffsetArray,gt,C,P,k,m,oe,se.predicate,we.collisionCircleDiameter*gt/d.ONE_EM,Pt,this.retainedQueryData[x.bucketInstanceId].tileID),De=re||on.circles.length>0&&!on.collisionDetected,lt=lt&&on.offscreen}if(ke.iconFeatureIndex&&(wn=ke.iconFeatureIndex),ke.iconBox){const Gt=gt=>{Jn(gt);const Pt=de&&Tt?gs(Tt.x,Tt.y,Q,oe,this.transform.angle):new d.pointGeometry(0,0),Cn=x.getSymbolInstanceIconSize(W,this.transform.zoom,ve);return this.collisionIndex.placeCollisionBox(Cn,gt,Pt,te,O,C,se.predicate)};nt&&nt.box&&nt.box.length&&ke.verticalIconBox?(pn=Gt(ke.verticalIconBox),tt=pn.box.length>0):(pn=Gt(ke.iconBox),tt=pn.box.length>0),lt=lt&&pn.offscreen}const Qi=H||0===we.numHorizontalGlyphVertices&&0===we.numVerticalGlyphVertices,ii=ne||0===we.numIconVertices;if(Qi||ii?ii?Qi||(tt=tt&&De):De=tt&&De:tt=De=tt&&De,De&&mt&&mt.box&&this.collisionIndex.insertCollisionBox(mt.box,E.get("text-ignore-placement"),x.bucketInstanceId,nt&&nt.box&&Ct?Ct:ut,se.ID),tt&&pn&&this.collisionIndex.insertCollisionBox(pn.box,E.get("icon-ignore-placement"),x.bucketInstanceId,wn,se.ID),on&&(De&&this.collisionIndex.insertCollisionCircles(on.circles,E.get("text-ignore-placement"),x.bucketInstanceId,ut,se.ID),m)){const Gt=x.bucketInstanceId;let gt=this.collisionCircleArrays[Gt];void 0===gt&&(gt=this.collisionCircleArrays[Gt]=new Kt);for(let Pt=0;Pt<on.circles.length;Pt+=4)gt.circles.push(on.circles[Pt+0]),gt.circles.push(on.circles[Pt+1]),gt.circles.push(on.circles[Pt+2]),gt.circles.push(on.collisionDetected?1:0)}this.placements[we.crossTileID]=new Al(De||Ue,tt||Re,lt||x.justReloaded),c[we.crossTileID]=!0};if(xe){const we=x.getSortedSymbolIndexes(this.transform.angle);for(let ve=we.length-1;ve>=0;--ve){const ke=we[ve];Le(x.symbolInstances.get(ke),ke,x.collisionArrays[ke])}}else for(let we=o.symbolInstanceStart;we<o.symbolInstanceEnd;we++)Le(x.symbolInstances.get(we),we,x.collisionArrays[we]);if(m&&x.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[x.bucketInstanceId];d.invert(we.invProjMatrix,C),we.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(o,c,m,y){let x;x=y===d.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(c)];const E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const C of E)C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=x>=0&&C!==x?0:m.crossTileID)}markUsedOrientation(o,c,m){const y=c===d.WritingMode.horizontal||c===d.WritingMode.horizontalOnly?c:0,x=c===d.WritingMode.vertical?c:0,E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const C of E)o.text.placedSymbolArray.get(C).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(o):1,x=c?c.opacities:{},E=c?c.variableOffsets:{},C=c?c.placedOrientations:{};for(const P in this.placements){const k=this.placements[P],R=x[P];R?(this.opacities[P]=new Hs(R,y,k.text,k.icon,null,k.clipped),m=m||k.text!==R.text.placed||k.icon!==R.icon.placed):(this.opacities[P]=new Hs(null,y,k.text,k.icon,k.skipFade,k.clipped),m=m||k.text||k.icon)}for(const P in x){const k=x[P];if(!this.opacities[P]){const R=new Hs(k,y,!1,!1);R.isHidden()||(this.opacities[P]=R,m=m||k.text.placed||k.icon.placed)}}for(const P in E)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=E[P]);for(const P in C)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=C[P]);m?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c){const m={};for(const y of c){const x=y.getBucket(o);x&&y.latestFeatureIndex&&o.id===x.layerIds[0]&&this.updateBucketOpacities(x,m,y.collisionBoxArray)}}updateBucketOpacities(o,c,m){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const y=o.layers[0].layout,x=!!o.layers[0].dynamicFilter(),E=new Hs(null,0,!1,!1,!0),C=y.get("text-allow-overlap"),P=y.get("icon-allow-overlap"),k=y.get("text-variable-anchor"),R="map"===y.get("text-rotation-alignment"),O="map"===y.get("text-pitch-alignment"),j="none"!==y.get("icon-text-fit"),Z=new Hs(null,0,C&&(P||!o.hasIconData()||y.get("icon-optional")),P&&(C||!o.hasTextData()||y.get("text-optional")),!0);!o.collisionArrays&&m&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(m);const G=(se,H,ne)=>{for(let re=0;re<H/4;re++)se.opacityVertexArray.emplaceBack(ne)};let W=0;for(let se=0;se<o.symbolInstances.length;se++){const H=o.symbolInstances.get(se),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:re,crossTileID:te}=H;let Q=this.opacities[te];c[te]?Q=E:Q||(Q=Z,this.opacities[te]=Q),c[te]=!0;const oe=ne>0||re>0,de=H.numIconVertices>0,xe=this.placedOrientations[H.crossTileID],Ue=xe===d.WritingMode.vertical,Re=xe===d.WritingMode.horizontal||xe===d.WritingMode.horizontalOnly;if(!oe&&!de||Q.isHidden()||W++,oe){const Le=Mu(Q.text);G(o.text,ne,Ue?Zs:Le),G(o.text,re,Re?Zs:Le);const we=Q.text.isHidden();[H.rightJustifiedTextSymbolIndex,H.centerJustifiedTextSymbolIndex,H.leftJustifiedTextSymbolIndex].forEach(De=>{De>=0&&(o.text.placedSymbolArray.get(De).hidden=we||Ue?1:0)}),H.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(H.verticalPlacedTextSymbolIndex).hidden=we||Re?1:0);const ve=this.variableOffsets[H.crossTileID];ve&&this.markUsedJustification(o,ve.anchor,H,xe);const ke=this.placedOrientations[H.crossTileID];ke&&(this.markUsedJustification(o,"left",H,ke),this.markUsedOrientation(o,ke,H))}if(de){const Le=Mu(Q.icon);H.placedIconSymbolIndex>=0&&(G(o.icon,H.numIconVertices,Ue?Zs:Le),o.icon.placedSymbolArray.get(H.placedIconSymbolIndex).hidden=Q.icon.isHidden()),H.verticalPlacedIconSymbolIndex>=0&&(G(o.icon,H.numVerticalIconVertices,Re?Zs:Le),o.icon.placedSymbolArray.get(H.verticalPlacedIconSymbolIndex).hidden=Q.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Le=o.collisionArrays[se];if(Le){let we=new d.pointGeometry(0,0),ve=!0;if(Le.textBox||Le.verticalTextBox){if(k){const De=this.variableOffsets[te];De?(we=dr(De.anchor,De.width,De.height,De.textOffset,De.textScale),R&&we._rotate(O?this.transform.angle:-this.transform.angle)):ve=!1}x&&(ve=!Q.clipped),Le.textBox&&qs(o.textCollisionBox.collisionVertexArray,Q.text.placed,!ve||Ue,we.x,we.y),Le.verticalTextBox&&qs(o.textCollisionBox.collisionVertexArray,Q.text.placed,!ve||Re,we.x,we.y)}const ke=ve&&Boolean(!Re&&Le.verticalIconBox);Le.iconBox&&qs(o.iconCollisionBox.collisionVertexArray,Q.icon.placed,ke,j?we.x:0,j?we.y:0),Le.verticalIconBox&&qs(o.iconCollisionBox.collisionVertexArray,Q.icon.placed,!ke,j?we.x:0,j?we.y:0)}}}if(o.fullyClipped=0===W,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=se.invProjMatrix,o.placementViewportMatrix=se.viewportMatrix,o.collisionCircleArray=se.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>o}setStale(){this.stale=!0}}function qs(f,o,c,m,y){f.emplaceBack(o?1:0,c?1:0,m||0,y||0),f.emplaceBack(o?1:0,c?1:0,m||0,y||0),f.emplaceBack(o?1:0,c?1:0,m||0,y||0),f.emplaceBack(o?1:0,c?1:0,m||0,y||0)}const be=Math.pow(2,25),Ge=Math.pow(2,24),Jd=Math.pow(2,17),_s=Math.pow(2,16),Hn=Math.pow(2,9),br=Math.pow(2,8),Vo=Math.pow(2,1);function Mu(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const o=f.placed?1:0,c=Math.floor(127*f.opacity);return c*be+o*Ge+c*Jd+o*_s+c*Hn+o*br+c*Vo+o}const Zs=0;class Xe{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&void 0!==o.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,c,m,y,x){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(E,y,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((C,P)=>C.sortKey-P.sortKey));this._currentPartIndex<E.length;){const C=E[this._currentPartIndex];if(c.placeLayerBucketPart(C,this._seenCrossTileIDs,m,0===C.symbolInstanceStart),this._currentPartIndex++,x())return!0}return!1}}class Vt{constructor(o,c,m,y,x,E,C,P){this.placement=new Cu(o,x,E,C,P),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(o,c,m){const y=d.exported.now(),x=()=>{const E=d.exported.now()-y;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=c[o[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if("symbol"===E.type&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new Xe(E)),this._inProgressLayer.continuePlacement(m[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Rt=512/d.EXTENT/2;class uo{constructor(o,c,m){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let y=0;y<c.length;y++){const x=c.get(y),E=x.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,o)})}}getScaledCoordinates(o,c){const m=Rt/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*d.EXTENT+o.tileAnchorX)*m),y:Math.floor((c.canonical.y*d.EXTENT+o.tileAnchorY)*m)}}findMatches(o,c,m){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let x=0;x<o.length;x++){const E=o.get(x);if(E.crossTileID)continue;const C=this.indexedSymbolInstances[E.key];if(!C)continue;const P=this.getScaledCoordinates(E,c);for(const k of C)if(Math.abs(k.coord.x-P.x)<=y&&Math.abs(k.coord.y-P.y)<=y&&!m[k.crossTileID]){m[k.crossTileID]=!0,E.crossTileID=k.crossTileID;break}}}}class Pl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ft{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const c=Math.round((o-this.lng)/360);if(0!==c)for(const m in this.indexes){const y=this.indexes[m],x={};for(const E in y){const C=y[E];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+c),x[C.tileID.key]=C}this.indexes[m]=x}this.lng=o}addBucket(o,c,m){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const y=this.usedCrossTileIDs[o.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>o.overscaledZ)for(const C in E){const P=E[C];P.tileID.isChildOf(o)&&P.findMatches(c.symbolInstances,o,y)}else{const C=E[o.scaledTo(Number(x)).key];C&&C.findMatches(c.symbolInstances,o,y)}}for(let x=0;x<c.symbolInstances.length;x++){const E=c.symbolInstances.get(x);E.crossTileID||(E.crossTileID=m.generate(),y[E.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new uo(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(const m in c.indexedSymbolInstances)for(const y of c.indexedSymbolInstances[m])delete this.usedCrossTileIDs[o][y.crossTileID]}removeStaleBuckets(o){let c=!1;for(const m in this.indexes){const y=this.indexes[m];for(const x in y)o[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[x]),delete y[x],c=!0)}return c}}class dn{constructor(){this.layerIndexes={},this.crossTileIDs=new Pl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,m,y){let x=this.layerIndexes[o.id];void 0===x&&(x=this.layerIndexes[o.id]=new ft);let E=!1;const C={};"globe"!==y.name&&x.handleWrapJump(m);for(const P of c){const k=P.getBucket(o);k&&o.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(P.tileID,k,this.crossTileIDs)&&(E=!0),C[k.bucketInstanceId]=!0)}return x.removeStaleBuckets(C)&&(E=!0),E}pruneUnusedLayers(o){const c={};o.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const Ws=(f,o)=>d.emitValidationErrors(f,o&&o.filter(c=>"source.canvas"!==c.identifier)),Tc=d.pick(Ae,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),qi=d.pick(Ae,["setCenter","setZoom","setBearing","setPitch"]),pt=function(){const f={},o=d.spec.$version;for(const c in d.spec.$root){const m=d.spec.$root[c];if(m.required){let y=null;y="version"===c?o:"array"===m.type?[]:{},null!=y&&(f[c]=y)}}return f}(),Wf={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class zn extends d.Evented{constructor(o,c={}){super(),this.map=o,this.dispatcher=new xi(ue(),this),this.imageManager=new ur,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(o._requestManager,c.localFontFamily?d.LocalGlyphMode.all:c.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new d.LineAtlas(256,512),this.crossTileSymbolIndex=new dn,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const m=this;this._rtlTextPluginCallback=zn.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(x,E)=>{if(d.triggerPluginCompletionEvent(x),E&&E.every(C=>C))for(const C in m._sourceCaches){const P=m._sourceCaches[C],k=P.getSource().type;"vector"!==k&&"geojson"!==k||P.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const x=this.getSource(y.sourceId);if(x&&x.vectorLayerIds)for(const E in this._layers){const C=this._layers[E];C.source===x.id&&this._validateLayer(C)}})}loadURL(o,c={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof c.validate?c.validate:!d.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,c.accessToken);const y=this.map._requestManager.transformRequest(o,d.ResourceType.Style);this._request=d.getJSON(y,(x,E)=>{this._request=null,x?this.fire(new d.ErrorEvent(x)):E&&this._load(E,m)})}loadJSON(o,c={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(o,!1!==c.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(pt,!1)}_updateLayerCount(o,c){const m=c?1:-1;o.is3D()&&(this._num3DLayers+=m),"circle"===o.type&&(this._numCircleLayers+=m),"symbol"===o.type&&(this._numSymbolLayers+=m)}_load(o,c){if(c&&Ws(this,d.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o,this.updateProjection();for(const y in o.sources)this.addSource(y,o.sources[y],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const m=Me(this.stylesheet.layers);this._order=m.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of m)y=d.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ko(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const o=this.map.transform.projection,c=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),m=this.map.transform.projection;if(this._loaded&&(m.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),c){if(m.isReprojectedInTileSpace||o.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(o){this._spriteRequest=function(c,m,y){let x,E,C;const P=d.exported.devicePixelRatio>1?"@2x":"";let k=d.getJSON(m.transformRequest(m.normalizeSpriteURL(c,P,".json"),d.ResourceType.SpriteJSON),(j,Z)=>{k=null,C||(C=j,x=Z,O())}),R=d.getImage(m.transformRequest(m.normalizeSpriteURL(c,P,".png"),d.ResourceType.SpriteImage),(j,Z)=>{R=null,C||(C=j,E=Z,O())});function O(){if(C)y(C);else if(x&&E){const j=d.exported.getImageData(E),Z={};for(const G in x){const{width:W,height:se,x:H,y:ne,sdf:re,pixelRatio:te,stretchX:Q,stretchY:oe,content:de}=x[G],xe=new d.RGBAImage({width:W,height:se});d.RGBAImage.copy(j,xe,{x:H,y:ne},{x:0,y:0},{width:W,height:se}),Z[G]={data:xe,pixelRatio:te,sdf:re,stretchX:Q,stretchY:oe,content:de}}y(null,Z)}}return{cancel(){k&&(k.cancel(),k=null),R&&(R.cancel(),R=null)}}}(o,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new d.ErrorEvent(c));else if(m)for(const y in m)this.imageManager.addImage(y,m[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(o){const c=this.getSource(o.source);if(!c)return;const m=o.sourceLayer;m&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(m))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const c=[];for(const m of o){const y=this._layers[m];"custom"!==y.type&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&Wf[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(y.length||x.length)&&this._updateWorkerLayers(y,x);for(const E in this._updatedSources){const C=this._updatedSources[E];"reload"===C?this._reloadSource(E):"clear"===C&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const m={};for(const y in this._sourceCaches){const x=this._sourceCaches[y];m[y]=x.used,x.used=!1}for(const y of this._order){const x=this._layers[y];if(x.recalculate(o,this._availableImages),!x.isHidden(o.zoom)){const C=this._getLayerSourceCache(x);C&&(C.used=!0)}const E=this.map.painter;if(E){const C=x.getProgramIds();if(!C)continue;const P=x.getProgramConfiguration(o.zoom);for(const k of C)E.useProgram(k,P)}}for(const y in m){const x=this._sourceCaches[y];m[y]!==x.used&&x.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),Ws(this,d.validateStyle(o)))return!1;(o=d.clone$1(o)).layers=Me(o.layers);const c=function(y,x){if(!y)return[{command:Ae.setStyle,args:[x]}];let E=[];try{if(!_t(y.version,x.version))return[{command:Ae.setStyle,args:[x]}];_t(y.center,x.center)||E.push({command:Ae.setCenter,args:[x.center]}),_t(y.zoom,x.zoom)||E.push({command:Ae.setZoom,args:[x.zoom]}),_t(y.bearing,x.bearing)||E.push({command:Ae.setBearing,args:[x.bearing]}),_t(y.pitch,x.pitch)||E.push({command:Ae.setPitch,args:[x.pitch]}),_t(y.sprite,x.sprite)||E.push({command:Ae.setSprite,args:[x.sprite]}),_t(y.glyphs,x.glyphs)||E.push({command:Ae.setGlyphs,args:[x.glyphs]}),_t(y.transition,x.transition)||E.push({command:Ae.setTransition,args:[x.transition]}),_t(y.light,x.light)||E.push({command:Ae.setLight,args:[x.light]}),_t(y.fog,x.fog)||E.push({command:Ae.setFog,args:[x.fog]}),_t(y.projection,x.projection)||E.push({command:Ae.setProjection,args:[x.projection]});const C={},P=[];!function(O,j,Z,G){let W;for(W in j=j||{},O=O||{})O.hasOwnProperty(W)&&(j.hasOwnProperty(W)||it(W,Z,G));for(W in j)j.hasOwnProperty(W)&&(O.hasOwnProperty(W)?_t(O[W],j[W])||("geojson"===O[W].type&&"geojson"===j[W].type&&st(O,j,W)?Z.push({command:Ae.setGeoJSONSourceData,args:[W,j[W].data]}):ct(W,j,Z,G)):ze(W,j,Z))}(y.sources,x.sources,P,C);const k=[];y.layers&&y.layers.forEach(O=>{C[O.source]?E.push({command:Ae.removeLayer,args:[O.id]}):k.push(O)});let R=y.terrain;R&&C[R.source]&&(E.push({command:Ae.setTerrain,args:[void 0]}),R=void 0),E=E.concat(P),_t(R,x.terrain)||E.push({command:Ae.setTerrain,args:[x.terrain]}),function(O,j,Z){j=j||[];const G=(O=O||[]).map(Mt),W=j.map(Mt),se=O.reduce(gn,{}),H=j.reduce(gn,{}),ne=G.slice(),re=Object.create(null);let te,Q,oe,de,xe,Ue,Re;for(te=0,Q=0;te<G.length;te++)oe=G[te],H.hasOwnProperty(oe)?Q++:(Z.push({command:Ae.removeLayer,args:[oe]}),ne.splice(ne.indexOf(oe,Q),1));for(te=0,Q=0;te<W.length;te++)oe=W[W.length-1-te],ne[ne.length-1-te]!==oe&&(se.hasOwnProperty(oe)?(Z.push({command:Ae.removeLayer,args:[oe]}),ne.splice(ne.lastIndexOf(oe,ne.length-Q),1)):Q++,Ue=ne[ne.length-te],Z.push({command:Ae.addLayer,args:[H[oe],Ue]}),ne.splice(ne.length-te,0,oe),re[oe]=!0);for(te=0;te<W.length;te++)if(oe=W[te],de=se[oe],xe=H[oe],!re[oe]&&!_t(de,xe))if(_t(de.source,xe.source)&&_t(de["source-layer"],xe["source-layer"])&&_t(de.type,xe.type)){for(Re in dt(de.layout,xe.layout,Z,oe,null,Ae.setLayoutProperty),dt(de.paint,xe.paint,Z,oe,null,Ae.setPaintProperty),_t(de.filter,xe.filter)||Z.push({command:Ae.setFilter,args:[oe,xe.filter]}),_t(de.minzoom,xe.minzoom)&&_t(de.maxzoom,xe.maxzoom)||Z.push({command:Ae.setLayerZoomRange,args:[oe,xe.minzoom,xe.maxzoom]}),de)de.hasOwnProperty(Re)&&"layout"!==Re&&"paint"!==Re&&"filter"!==Re&&"metadata"!==Re&&"minzoom"!==Re&&"maxzoom"!==Re&&(0===Re.indexOf("paint.")?dt(de[Re],xe[Re],Z,oe,Re.slice(6),Ae.setPaintProperty):_t(de[Re],xe[Re])||Z.push({command:Ae.setLayerProperty,args:[oe,Re,xe[Re]]}));for(Re in xe)xe.hasOwnProperty(Re)&&!de.hasOwnProperty(Re)&&"layout"!==Re&&"paint"!==Re&&"filter"!==Re&&"metadata"!==Re&&"minzoom"!==Re&&"maxzoom"!==Re&&(0===Re.indexOf("paint.")?dt(de[Re],xe[Re],Z,oe,Re.slice(6),Ae.setPaintProperty):_t(de[Re],xe[Re])||Z.push({command:Ae.setLayerProperty,args:[oe,Re,xe[Re]]}))}else Z.push({command:Ae.removeLayer,args:[oe]}),Ue=ne[ne.lastIndexOf(oe)+1],Z.push({command:Ae.addLayer,args:[xe,Ue]})}(k,x.layers,E)}catch(C){console.warn("Unable to compute style diff:",C),E=[{command:Ae.setStyle,args:[x]}]}return E}(this.serialize(),o).filter(y=>!(y.command in qi));if(0===c.length)return!1;const m=c.filter(y=>!(y.command in Tc));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{"setTransition"!==y.command&&this[y.command].apply(this,y.args)}),this.stylesheet=o,this.updateProjection(),!0}addImage(o,c){if(this.getImage(o))return this.fire(new d.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,c),this._afterImageUpdated(o)}updateImage(o,c){this.imageManager.updateImage(o,c)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new d.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,c,m={}){if(this._checkLoaded(),void 0!==this.getSource(o))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(d.validateStyle.source,`sources.${o}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=hr(o,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:o}));const x=E=>{const C=(E?"symbol:":"other:")+o,P=this._sourceCaches[C]=new d.SourceCache(C,y,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[o]=P,P.style=this,P.onAdd(this.map)};x(!1),"vector"!==c.type&&"geojson"!==c.type||x(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const c=this.getSource(o);if(void 0===c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===o)return this.fire(new d.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new d.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(o);for(const y of m)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,c){this._checkLoaded(),this.getSource(o).setData(c),this._changed=!0}getSource(o){const c=this._getSourceCache(o);return c&&c.getSource()}addLayer(o,c,m={}){this._checkLoaded();const y=o.id;if(this.getLayer(y))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let x;if("custom"===o.type){if(Ws(this,d.validateCustomStyleLayer(o)))return;x=d.createStyleLayer(o)}else{if("object"==typeof o.source&&(this.addSource(y,o.source),o=d.clone$1(o),o=d.extend(o,{source:y})),this._validate(d.validateStyle.layer,`layers.${y}`,o,{arrayIndex:-1},m))return;x=d.createStyleLayer(o),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const E=c?this._order.indexOf(c):this._order.length;if(c&&-1===E)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(E,0,y),this._layerOrderChanged=!0,this._layers[y]=x;const C=this._getLayerSourceCache(x);if(this._removedLayers[y]&&x.source&&C&&"custom"!==x.type){const P=this._removedLayers[y];delete this._removedLayers[y],P.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",C.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,c){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===c)return;const m=this._order.indexOf(o);this._order.splice(m,1);const y=c?this._order.indexOf(c):this._order.length;c&&-1===y?this.fire(new d.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const c=this._layers[o];if(!c)return void this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const m=this._order.indexOf(o);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=c,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const c in this._layers)if(this._layers[c].type===o)return!0;return!1}setLayerZoomRange(o,c,m){this._checkLoaded();const y=this.getLayer(o);y?y.minzoom===c&&y.maxzoom===m||(null!=c&&(y.minzoom=c),null!=m&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,c,m={}){this._checkLoaded();const y=this.getLayer(o);if(y){if(!_t(y.filter,c))return null==c?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(d.validateStyle.filter,`layers.${y.id}.filter`,c,{layerType:y.type},m)||(y.filter=d.clone$1(c),this._updateLayer(y)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){return d.clone$1(this.getLayer(o).filter)}setLayoutProperty(o,c,m,y={}){this._checkLoaded();const x=this.getLayer(o);x?_t(x.getLayoutProperty(c),m)||(x.setLayoutProperty(c,m,y),this._updateLayer(x)):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,c){const m=this.getLayer(o);if(m)return m.getLayoutProperty(c);this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,c,m,y={}){this._checkLoaded();const x=this.getLayer(o);x?_t(x.getPaintProperty(c),m)||(x.setPaintProperty(c,m,y)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,c){return this.getLayer(o).getPaintProperty(c)}setFeatureState(o,c){this._checkLoaded();const m=o.source,y=o.sourceLayer,x=this.getSource(m);if(void 0===x)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const E=x.type;if("geojson"===E&&y)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===E&&!y)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===o.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(m);for(const P of C)P.setFeatureState(y,o.id,c)}removeFeatureState(o,c){this._checkLoaded();const m=o.source,y=this.getSource(m);if(void 0===y)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const x=y.type,E="vector"===x?o.sourceLayer:void 0;if("vector"===x&&!E)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof o.id&&"number"!=typeof o.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(m);for(const P of C)P.removeFeatureState(E,o.id,c)}getFeatureState(o){this._checkLoaded();const c=o.source,m=o.sourceLayer,y=this.getSource(c);if(void 0!==y){if("vector"!==y.type||m)return void 0===o.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(m,o.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();o[m.id]||(o[m.id]=m.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(o){this._updatedLayers[o.id]=!0;const c=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[o.source]="reload",c.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const c=E=>"fill-extrusion"===this._layers[E].type,m={},y=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(c(C)){m[C]=E;for(const P of o){const k=P[C];if(k)for(const R of k)y.push(R)}}}y.sort((E,C)=>C.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const C=this._order[E];if(c(C))for(let P=y.length-1;P>=0;P--){const k=y[P].feature;if(m[k.layer.id]<E)break;x.push(k),y.pop()}else for(const P of o){const k=P[C];if(k)for(const R of k)x.push(R.feature)}}return x}queryRenderedFeatures(o,c,m){c&&c.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of c.layers){const k=this._layers[P];if(!k)return this.fire(new d.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];y[k.source]=!0}}const x=[];c.availableImages=this._availableImages;const E=c&&c.layers?c.layers.some(P=>{const k=this.getLayer(P);return k&&k.is3D()}):this.has3DLayers(),C=js.createFromScreenPoints(o,m);for(const P in this._sourceCaches){const k=this._sourceCaches[P].getSource().id;c.layers&&!y[k]||x.push(F(this._sourceCaches[P],this._layers,this._serializedLayers,C,c,m,E,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(P,k,R,O,j,Z,G){const W={},se=Z.queryRenderedSymbols(O),H=[];for(const ne of Object.keys(se).map(Number))H.push(G[ne]);H.sort(X);for(const ne of H){const re=ne.featureIndex.lookupSymbolFeatures(se[ne.bucketInstanceId],k,ne.bucketIndex,ne.sourceLayerIndex,j.filter,j.layers,j.availableImages,P);for(const te in re){const Q=W[te]=W[te]||[],oe=re[te];oe.sort((de,xe)=>{const Ue=ne.featureSortOrder;if(Ue){const Re=Ue.indexOf(de.featureIndex);return Ue.indexOf(xe.featureIndex)-Re}return xe.featureIndex-de.featureIndex});for(const de of oe)Q.push(de)}}for(const ne in W)W[ne].forEach(re=>{const te=re.feature,Q=R(P[ne]).getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=Q});return W}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(o,c){c&&c.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const m=this._getSourceCaches(o);let y=[];for(const x of m)y=y.concat(V(x,c));return y}addSourceType(o,c,m){return zn.getSourceType(o)?m(new Error(`A source type called "${o}" already exists.`)):(zn.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(o,c={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const E in o)if(!_t(o[E],m[E])){y=!0;break}if(!y)return;const x={now:d.exported.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,c),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,c=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===c){if("object"==typeof o.source){const m="terrain-dem-src";this.addSource(m,o.source),o=d.clone$1(o),o=d.extend(o,{source:m})}if(this._validate(d.validateStyle.terrain,"terrain",o))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(o,c);else{const m=this.terrain,y=m.get();for(const x in o)if(!_t(o[x],y[x])){m.set(o),this.stylesheet.terrain=o;const E={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(E);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const c=this.fog=new bu(o,this.map.transform);this.stylesheet.fog=o;const m={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,m=c.get();for(const y in o)if(!_t(o[y],m[y])){c.set(o),this.stylesheet.fog=o;const x={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(x);break}}else this._createFog(o);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(m=>this.isLayerDraped(this._layers[m])),c=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...c)}_createTerrain(o,c){const m=this.terrain=new fc(o,c);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const y={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};m.updateTransitions(y)}_force3DLayerUpdate(){for(const o in this._layers){const c=this._layers[o];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const c=this._layers[o];"symbol"===c.type&&this._updateLayer(c)}}_validate(o,c,m,y,x={}){return(!x||!1!==x.validate)&&Ws(this,o.call(d.validateStyle,d.extend({key:c,style:this.serialize(),value:m,styleSpec:d.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const c=this._getSourceCaches(o);for(const m of c)m.clearTiles()}_reloadSource(o){const c=this._getSourceCaches(o);for(const m of c)m.resume(),m.reload()}_updateSources(o){for(const c in this._sourceCaches)this._sourceCaches[c].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const c=this._sourceCaches[o];c.resume(),c.reload()}}_updatePlacement(o,c,m,y,x=!1){let E=!1,C=!1;const P={};for(const k of this._order){const R=this._layers[k];if("symbol"!==R.type)continue;if(!P[R.source]){const j=this._getLayerSourceCache(R);if(!j)continue;P[R.source]=j.getRenderableIds(!0).map(Z=>j.getTileByID(Z)).sort((Z,G)=>G.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(G.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(R,P[R.source],o.center.lng,o.projection);E=E||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),o.zoom))&&(this.pauseablePlacement=new Vt(o,this._order,x,c,m,y,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),C=!0),E&&this.pauseablePlacement.placement.setStale()),C||E)for(const k of this._order){const R=this._layers[k];"symbol"===R.type&&this.placement.updateLayerOpacities(R,P[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,c,m){this.imageManager.getImages(c.icons,m),this._updateTilesForChangedImages();const y=x=>{x&&x.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(o,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(o,c,m){return d.makeRequest(c,m)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return"symbol"===o.type?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const c=[];return this._otherSourceCaches[o]&&c.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&c.push(this._symbolSourceCaches[o]),c}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}zn.getSourceType=function(f){return $s[f]},zn.setSourceType=function(f,o){$s[f]=o},zn.registerForPluginStateChange=d.registerForPluginStateChange;var Ma="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Xs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ia={},Sa={};Ia=xt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Sa=xt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const qt=xt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ks=Ma;var kl={background:xt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:xt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:xt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:xt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:xt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:xt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:xt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:xt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:xt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:xt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:xt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:xt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:xt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:xt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:xt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:xt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:xt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:xt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:xt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:xt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:xt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:xt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:xt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:xt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:xt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:xt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Xs),skyboxGradient:xt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Xs),skyboxCapture:xt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:xt("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:xt("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function xt(f,o,c){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,x=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E=f.match(y),C=o.match(y),P=Ma.match(y);let k=C?C.concat(E):E;c||(Ia.staticUniforms&&(k=Ia.staticUniforms.concat(k)),Sa.staticUniforms&&(k=Sa.staticUniforms.concat(k))),k&&(k=k.concat(P));const R={};return{fragmentSource:f=f.replace(m,(O,j,Z,G,W)=>(R[W]=!0,"define"===j?`\n#ifndef HAS_UNIFORM_u_${W}\nvarying ${Z} ${G} ${W};\n#else\nuniform ${Z} ${G} u_${W};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${W}\n    ${Z} ${G} ${W} = u_${W};\n#endif\n`)),vertexSource:o=o.replace(m,(O,j,Z,G,W)=>{const se="float"===G?"vec2":"vec4",H=W.match(/color/)?"color":se;return R[W]?"define"===j?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nattribute ${Z} ${se} a_${W};\nvarying ${Z} ${G} ${W};\n#else\nuniform ${Z} ${G} u_${W};\n#endif\n`:"vec4"===H?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = a_${W};\n#else\n    ${Z} ${G} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${W} = unpack_mix_${H}(a_${W}, u_${W}_t);\n#else\n    ${Z} ${G} ${W} = u_${W};\n#endif\n`:"define"===j?`\n#ifndef HAS_UNIFORM_u_${W}\nuniform lowp float u_${W}_t;\nattribute ${Z} ${se} a_${W};\n#else\nuniform ${Z} ${G} u_${W};\n#endif\n`:"vec4"===H?`\n#ifndef HAS_UNIFORM_u_${W}\n    ${Z} ${G} ${W} = a_${W};\n#else\n    ${Z} ${G} ${W} = u_${W};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${W}\n    ${Z} ${G} ${W} = unpack_mix_${H}(a_${W}, u_${W}_t);\n#else\n    ${Z} ${G} ${W} = u_${W};\n#endif\n`}),staticAttributes:x,staticUniforms:k}}class Ti{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,c,m,y,x,E,C,P){this.context=o;let k=this.boundPaintVertexBuffers.length!==y.length;for(let R=0;!k&&R<y.length;R++)this.boundPaintVertexBuffers[R]!==y[R]&&(k=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===m&&!k&&this.boundIndexBuffer===x&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===C&&this.boundDynamicVertexBuffer2===P?(o.bindVertexArrayOES.set(this.vao),C&&C.bind(),x&&x.dynamicDraw&&x.bind(),P&&P.bind()):this.freshBind(c,m,y,x,E,C,P)}freshBind(o,c,m,y,x,E,C){let P;const k=o.numAttributes,R=this.context,O=R.gl;if(R.extVertexArrayObject)this.vao&&this.destroy(),this.vao=R.extVertexArrayObject.createVertexArrayOES(),R.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=C;else{P=R.currentNumAttributes||0;for(let j=k;j<P;j++)O.disableVertexAttribArray(j)}c.enableAttributes(O,o);for(const j of m)j.enableAttributes(O,o);E&&E.enableAttributes(O,o),C&&C.enableAttributes(O,o),c.bind(),c.setVertexAttribPointers(O,o,x);for(const j of m)j.bind(),j.setVertexAttribPointers(O,o,x);E&&(E.bind(),E.setVertexAttribPointers(O,o,x)),y&&y.bind(),C&&(C.bind(),C.setVertexAttribPointers(O,o,x)),R.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function St(f,o){const c=Math.pow(2,o.canonical.z),m=o.canonical.y;return[new d.MercatorCoordinate(0,m/c).toLngLat().lat,new d.MercatorCoordinate(0,(m+1)/c).toLngLat().lat]}function Aa(f,o,c,m,y,x,E){const C=f.context,P=C.gl,k=c.fbo;if(!k)return;f.prepareDrawTile(o);const R=f.useProgram("hillshade");C.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,k.colorAttachment.get());const O=((W,se,H,ne)=>{const re=H.paint.get("hillshade-shadow-color"),te=H.paint.get("hillshade-highlight-color"),Q=H.paint.get("hillshade-accent-color");let oe=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===H.paint.get("hillshade-illumination-anchor")&&(oe-=W.transform.angle);const de=!W.options.moving;return{u_matrix:ne||W.transform.calculateProjMatrix(se.tileID.toUnwrapped(),de),u_image:0,u_latrange:St(0,se.tileID),u_light:[H.paint.get("hillshade-exaggeration"),oe],u_shadow:re,u_highlight:te,u_accent:Q}})(f,c,m,f.terrain?o.projMatrix:null);f.prepareDrawProgram(C,R,o.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Z,tileBoundsSegments:G}=f.getTileBoundsBuffers(c);R.draw(C,P.TRIANGLES,y,x,E,d.CullFaceMode.disabled,O,m.id,j,Z,G)}function qn(f,o,c){if(!o.needsDEMTextureUpload)return;const m=f.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||f.getTileTexture(c.stride);const x=c.getPixels();o.demTexture?o.demTexture.update(x,{premultiply:!1}):o.demTexture=new d.Texture(m,x,y.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Di(f,o,c,m,y,x){const E=f.context,C=E.gl;if(!o.dem)return;const P=o.dem;if(E.activeTexture.set(C.TEXTURE1),qn(f,o,P),!o.demTexture)return;o.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const k=P.dim;E.activeTexture.set(C.TEXTURE0);let R=o.fbo;if(!R){const G=new d.Texture(E,{width:k,height:k,data:null},C.RGBA);G.bind(C.LINEAR,C.CLAMP_TO_EDGE),R=o.fbo=E.createFramebuffer(k,k,!0),R.colorAttachment.set(G.texture)}E.bindFramebuffer.set(R.framebuffer),E.viewport.set([0,0,k,k]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:j,tileBoundsSegments:Z}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(E,C.TRIANGLES,m,y,x,d.CullFaceMode.disabled,((G,W)=>{const se=W.stride,H=d.create();return d.ortho(H,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(H,H,[0,-d.EXTENT,0]),{u_matrix:H,u_image:1,u_dimension:[se,se],u_zoom:G.overscaledZ,u_unpack:W.unpackVector}})(o.tileID,P),c.id,O,j,Z),o.needsHillshadePrepare=!1}const jo=(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image0:new d.Uniform1i(f,o.u_image0),u_skirt_height:new d.Uniform1f(f,o.u_skirt_height)}),wr=(f,o)=>({u_matrix:f,u_image0:0,u_skirt_height:o}),Zi=(f,o,c,m,y)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:o,u_merc_matrix:c,u_zoom_transition:m,u_merc_center:y,u_image0:0});function On(f,o){return null!=f&&null!=o&&!(!f.hasData()||!o.hasData())&&null!=f.demTexture&&null!=o.demTexture&&f.tileID.key!==o.tileID.key}const Uo=new class{constructor(){this.operations={}}newMorphing(f,o,c,m,y){if(f in this.operations){const x=this.operations[f];x.to.tileID.key!==c.tileID.key&&(x.queued=c)}else this.operations[f]={startTime:m,phase:0,duration:y,from:o,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const o=this.operations[f];return{from:o.from,to:o.to,phase:o.phase}}update(f){for(const o in this.operations){const c=this.operations[o];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[o];break}}}_nextOp(f,o){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=o,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Pa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ho(f,o){const c=1<<f.z;return!o&&(0===f.x||f.x===c-1)||0===f.y||f.y===c-1}const po=f=>({u_matrix:f});function vh(f,o,c,m,y){if(y>0){const x=d.exported.now(),E=(x-f.timeAdded)/y,C=o?(x-o.timeAdded)/y:-1,P=c.getSource(),k=m.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),R=!o||Math.abs(o.tileID.overscaledZ-k)>Math.abs(f.tileID.overscaledZ-k),O=R&&f.refreshedUponExpiration?1:d.clamp(R?E:1-C,0,1);return f.refreshedUponExpiration&&E>=1&&(f.refreshedUponExpiration=!1),o?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class xh extends d.SourceCache{constructor(o){const c={type:"raster-dem",maxzoom:o.transform.maxZoom},m=new xi(ue(),null),y=hr("mock-dem",c,m,o.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,c){o.state="loaded",c(null)}}class Ci extends d.SourceCache{constructor(o){const c=hr("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new xi(ue(),null),o.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,c,m){if(o.freezeTileCoverage)return;this.transform=o;const y=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,E)=>{if(x[E.key]="",!this._tiles[E.key]){const C=new d.Tile(E,this._source.tileSize*E.overscaleFactor(),o.tileZoom);C.state="loaded",this._tiles[E.key]=C}return x},{});for(const x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(o){const c=this.proxyCachedFBO[o];if(void 0!==c){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class rn extends d.OverscaledTileID{constructor(o,c,m){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class Ys extends d.Elevation{constructor(o,c){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,y,x]=function(P){const k=new d.StructArrayLayout4i8,R=new d.StructArrayLayout3ui6,O=131;k.reserve(17161),R.reserve(33800);const j=d.EXTENT/128,Z=d.EXTENT+j/2,G=Z+j;for(let se=-j;se<G;se+=j)for(let H=-j;H<G;H+=j){const ne=H<0||H>Z||se<0||se>Z?24575:0,re=d.clamp(Math.round(H),0,d.EXTENT),te=d.clamp(Math.round(se),0,d.EXTENT);k.emplaceBack(re+ne,te,re,te)}const W=(se,H)=>{const ne=H*O+se;R.emplaceBack(ne+1,ne,ne+O),R.emplaceBack(ne+O,ne+O+1,ne+1)};for(let se=1;se<129;se++)for(let H=1;H<129;H++)W(H,se);return[0,129].forEach(se=>{for(let H=0;H<130;H++)W(H,se),W(se,H)}),[k,R,32768]}(),E=o.context;this.gridBuffer=E.createVertexBuffer(m,d.boundsAttributes.members),this.gridIndexBuffer=E.createIndexBuffer(y),this.gridSegments=d.SegmentVector.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,m.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ci(c.map),this.orthoMatrix=d.create(),d.ortho(this.orthoMatrix,0,d.EXTENT,0,d.EXTENT,0,1);const C=E.gl;this._overlapStencilMode=new d.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new xh(c.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,c,m){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const y=o.terrain.properties;this.sourceCache=0===o.terrain.drapeRenderMode?this._mockSourceCache:o._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const x=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const E=this.getScaledDemTileSize();this.sourceCache.update(c,E,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),c.updateElevation(!m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==o.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&"source"===o.dataType?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):"style"===o.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(P=>{const k=c.getTileByID(P).tileID;return k.projMatrix=m.calculateProjMatrix(k.toUnwrapped()),k});(function(P,k){const R=k.transform.pointCoordinate(k.transform.getCameraPoint()),O=new d.pointGeometry(R.x,R.y);P.sort((j,Z)=>{if(Z.overscaledZ-j.overscaledZ)return Z.overscaledZ-j.overscaledZ;const G=new d.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),W=new d.pointGeometry(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),se=O.mult(1<<j.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(G)-se.distSqr(W)})})(y,this.painter),this._previousZoom=m.zoom;const x=this.proxyToSource||{};this.proxyToSource={},y.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const E=this._style._sourceCaches;for(const P in E){const k=E[P];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,o[P],x),k.usedForTerrain))continue;const R=o[P];k.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[c.id]=y.map(P=>new rn(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const C={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const k=this.terrainTileForTile[P.key];if(!k)continue;const R=k.tileID.key;R in C||(this._visibleDemTiles.push(k),C[R]=R)}}_assignTerrainTiles(o){this._initializing||o.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const o=this.painter.context,c=o.gl;for(const m in this.terrainTileForTile){const y=this.terrainTileForTile[m],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(o.activeTexture.set(c.TEXTURE1),qn(this.painter,y,x))}}_prepareDemTileUniforms(o,c,m,y){if(!c||null==c.demTexture)return!1;const x=o.tileID.canonical,E=Math.pow(2,c.tileID.canonical.z-x.z),C=y||"";return m[`u_dem_tl${C}`]=[x.x*E%1,x.y*E%1],m[`u_dem_scale${C}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,c=o.gl;if(!this._emptyDepthBufferTexture){const m={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new d.Texture(o,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const c=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;const x=y.dem.tree.minimums[0];return x>0&&o++,m+x},0);return o?c/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,c=o.gl;o.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),y={width:1,height:1,data:new Uint8Array(d.DEMData.pack(m,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(y,{premultiply:!1}):x=this._emptyDEMTexture=new d.Texture(o,y,c.RGBA,{premultiply:!1}),x}setupElevationDraw(o,c,m){const y=this.painter.context,x=y.gl,E=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var C;E.u_dem_size=this.sourceCache.getSource().tileSize,E.u_exaggeration=this.exaggeration();const P=this.painter.transform,k=P.projection.createTileTransform(P,P.worldSize),R=o.tileID.canonical;E.u_tile_tl_up=k.upVector(R,0,0),E.u_tile_tr_up=k.upVector(R,d.EXTENT,0),E.u_tile_br_up=k.upVector(R,d.EXTENT,d.EXTENT),E.u_tile_bl_up=k.upVector(R,0,d.EXTENT),E.u_tile_up_scale=k.upVectorScale(R);let O=null,j=null,Z=1;if(m&&m.morphing&&this._useVertexMorphing){const G=m.morphing.srcDemTile,W=m.morphing.dstDemTile;Z=m.morphing.phase,G&&W&&(this._prepareDemTileUniforms(o,G,E,"_prev")&&(j=G),this._prepareDemTileUniforms(o,W,E)&&(O=W))}if(j&&O?(y.activeTexture.set(x.TEXTURE2),O.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),y.activeTexture.set(x.TEXTURE4),j.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),E.u_dem_lerp=Z):(O=this.terrainTileForTile[o.tileID.key],y.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(o,O,E)?O.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),y.activeTexture.set(x.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&O){const G=(1<<O.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=G}m&&m.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(y,E)}renderToBackBuffer(o){const c=this.painter,m=this.painter.context;0!==o.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(y,x,E,C,P){if("globe"===y.transform.projection.name)!function(k,R,O,j,Z){const G=k.context,W=G.gl;let se,H;const ne=k.options.showTerrainWireframe?2:0,re=(Le,we)=>{if(H===Le)return;const ve=[];we&&ve.push(Pa[ne]),ve.push(Pa[Le]),ve.push("PROJECTION_GLOBE_VIEW"),se=k.useProgram("globeRaster",null,ve),H=Le},te=k.colorModeForRenderPass(),Q=new d.DepthMode(W.LEQUAL,d.DepthMode.ReadWrite,k.depthRangeFor3D);Uo.update(Z);const oe=k.transform,de=d.calculateGlobeMatrix(oe,oe.worldSize),xe=d.calculateGlobeMercatorMatrix(oe),Ue=[d.mercatorXfromLng(oe.center.lng),d.mercatorYfromLat(oe.center.lat)],Re=k.globeSharedBuffers;(ne?[!1,!0]:[!1]).forEach(Le=>{H=-1;const we=Le?W.LINES:W.TRIANGLES;for(const ve of j){const ke=O.getTile(ve),De=Math.pow(2,ve.canonical.z),[tt,lt]=d.globeBuffersForTileMesh(k,ke,ve,De),Tt=d.StencilMode.disabled,je=R.prevTerrainTileForTile[ve.key],nt=R.terrainTileForTile[ve.key];On(je,nt)&&Uo.newMorphing(ve.key,je,nt,Z,250),G.activeTexture.set(W.TEXTURE0),ke.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const mt=Uo.getMorphValuesForProxy(ve.key),on=mt?1:0,pn={};mt&&d.extend$1(pn,{morphing:{srcDemTile:mt.from,dstDemTile:mt.to,phase:d.easeCubicInOut(mt.phase)}});const ut=d.globeMatrixForTile(ve.canonical,de),Ct=Zi(oe.projMatrix,ut,xe,d.globeToMercatorTransition(oe.zoom),Ue);if(re(on,Le),R.setupElevationDraw(ke,se,pn),k.prepareDrawProgram(G,se,ve.toUnwrapped()),Re){const[wn,Jn]=Le?Re.getWirefameBuffer(k.context):[Re.gridIndexBuffer,Re.gridSegments];se.draw(G,we,Q,Tt,te,d.CullFaceMode.backCCW,Ct,"globe_raster",tt,wn,Jn)}if(!Le){const wn=[0===ve.canonical.y?d.globePoleMatrixForTile(ve.canonical,!1,oe):null,ve.canonical.y===De-1?d.globePoleMatrixForTile(ve.canonical,!0,oe):null];for(const Jn of wn){if(!Jn)continue;const di=Zi(oe.projMatrix,Jn,Jn,0,Ue);Re&&se.draw(G,we,Q,Tt,te,d.CullFaceMode.disabled,di,"globe_pole_raster",lt,Re.poleIndexBuffer,Re.poleSegments)}}}})}(y,x,E,C,P);else{const k=y.context,R=k.gl;let O,j;const Z=y.options.showTerrainWireframe?2:0,G=(re,te)=>{if(j===re)return;const Q=[Pa[re]];te&&Q.push(Pa[Z]),O=y.useProgram("terrainRaster",null,Q),j=re},W=y.colorModeForRenderPass(),se=new d.DepthMode(R.LEQUAL,d.DepthMode.ReadWrite,y.depthRangeFor3D);Uo.update(P);const H=y.transform,ne=6*Math.pow(1.5,22-H.zoom)*x.exaggeration();(Z?[!1,!0]:[!1]).forEach(re=>{j=-1;const te=re?R.LINES:R.TRIANGLES,[Q,oe]=re?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const de of C){const xe=E.getTile(de),Ue=d.StencilMode.disabled,Re=x.prevTerrainTileForTile[de.key],Le=x.terrainTileForTile[de.key];On(Re,Le)&&Uo.newMorphing(de.key,Re,Le,P,250),k.activeTexture.set(R.TEXTURE0),xe.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const we=Uo.getMorphValuesForProxy(de.key),ve=we?1:0;let ke;we&&(ke={morphing:{srcDemTile:we.from,dstDemTile:we.to,phase:d.easeCubicInOut(we.phase)}});const De=wr(de.projMatrix,ho(de.canonical,H.renderWorldCopies)?ne/10:ne);G(ve,re),x.setupElevationDraw(xe,O,ke),y.prepareDrawProgram(k,O,de.toUnwrapped()),O.draw(k,te,se,Ue,W,d.CullFaceMode.backCCW,De,"terrain_raster",x.gridBuffer,Q,oe)}})}}(c,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,o.splice(0,o.length))}renderBatch(o){if(0===this._drapedRenderBatches.length)return o+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],E=this._drapedRenderBatches.shift(),C=[],P=c.style.order;let k=0;for(const R of x){const O=y.getTileByID(R.proxyTileKey),j=y.proxyCachedFBO[R.key]?y.proxyCachedFBO[R.key][o]:void 0,Z=void 0!==j?y.renderCache[j]:this.pool[k++],G=void 0!==j;if(O.texture=Z.tex,G&&!Z.dirty){C.push(O.tileID);continue}let W;m.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(m.clear({color:d.Color.transparent,stencil:0}),Z.dirty=!1);for(let se=E.start;se<=E.end;++se){const H=c.style._layers[P[se]];if(H.isHidden(c.transform.zoom))continue;const ne=c.style._getLayerSourceCache(H),re=ne?this.proxyToSource[R.key][ne.id]:[R];if(!re)continue;const te=re;m.viewport.set([0,0,Z.fb.width,Z.fb.height]),W!==(ne?ne.id:null)&&(this._setupStencil(Z,re,H,ne),W=ne?ne.id:null),c.renderLayer(c,ne,H,te)}this.renderedToTile?(Z.dirty=!0,C.push(O.tileID)):G||--k,5===k&&(k=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),E.end+1}postRender(){}renderCacheEfficiency(o){const c=o.order.length;if(0===c)return{efficiency:100};let m,y=0,x=0,E=!1;for(let C=0;C<c;++C){const P=o._layers[o.order[C]];this._style.isLayerDraped(P)?(E&&++y,++x):E||(E=!0,m=P.id)}return 0===x?{efficiency:100}:{efficiency:100*(1-y/x),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{o=Math.min(o,c.dem.tree.minimums[0])}),0===o?o:(o-30)*this._exaggeration}raycast(o,c,m){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const E=x.tileID,C=Math.pow(2,E.overscaledZ),{x:P,y:k}=E.canonical,R=P/C,O=(P+1)/C,j=k/C,Z=(k+1)/C;return{minx:R,miny:j,maxx:O,maxy:Z,t:x.dem.tree.raycastRoot(R,j,O,Z,o,c,m),tile:x}});y.sort((x,E)=>(null!==x.t?x.t:Number.MAX_VALUE)-(null!==E.t?E.t:Number.MAX_VALUE));for(const x of y){if(null==x.t)return null;const E=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,o,c,m);if(null!=E)return E}return null}_createFBO(){const o=this.painter.context,c=o.gl,m=this.drapeBufferSize;o.activeTexture.set(c.TEXTURE0);const y=new d.Texture(o,{width:m[0],height:m[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const x=o.createFramebuffer(m[0],m[1],!1);return x.colorAttachment.set(y.texture),x.depthAttachment=new Eu(o,x.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const c=this._style._layers[o],m=c.isHidden(this.painter.transform.zoom),y=c.getCrossfadeParameters(),x=!!y&&1!==y.t,E=c.hasTransition();return"custom"!==c.type&&!m&&(x||E)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof Oo){o=!0;break}if(o)for(let c=0;c<this._style.order.length;++c){const m=this._style._layers[this._style.order[c]],y=m.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(m);if("raster"!==m.type||y||!x)continue;const E=m.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const P=this.proxyToSource[C.key][x.id];if(P)for(const k of P){const R=vh(x.getTile(k),x.findLoadedParent(k,0),x,this.painter.transform,E);(1!==R.opacity||0!==R.mix)&&this._clearRenderCacheForTile(x.id,k)}}}}_setupDrapedRenderBatches(){const o=this._style.order,c=o.length;if(0===c)return;const m=[];let y,x=0,E=this._style._layers[o[x]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++x<c;)E=this._style._layers[o[x]];for(;x<c;++x){const C=this._style._layers[o[x]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?void 0===y&&(y=x):void 0!==y&&(m.push({start:y,end:x-1}),y=void 0))}void 0!==y&&m.push({start:y,end:x-1}),this._drapedRenderBatches=m}_setupRenderCache(o){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const E=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let C=0;C<E.length;++C){const P=Object.values(E[C]);c.renderCachePool.push(...P)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,y=this._tilesDirty;for(let E=m.length-1;E>=0;E--){const C=m[E];if(c.getTileByID(C.key),void 0!==c.proxyCachedFBO[C.key]){const P=o[C.key],k=this.proxyToSource[C.key];let R=0;for(const O in k){const j=k[O],Z=P[O];if(!Z||Z.length!==j.length||j.some((G,W)=>G!==Z[W]||y[O]&&y[O].hasOwnProperty(G.key))){R=-1;break}++R}for(const O in c.proxyCachedFBO[C.key])c.renderCache[c.proxyCachedFBO[C.key][O]].dirty=R<0||R!==Object.values(P).length}}const x=[...this._drapedRenderBatches];x.sort((E,C)=>C.end-C.start-(E.end-E.start));for(const E of x)for(const C of m){if(c.proxyCachedFBO[C.key])continue;let P=c.renderCachePool.pop();void 0===P&&c.renderCache.length<50&&(P=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==P&&(c.proxyCachedFBO[C.key]={},c.proxyCachedFBO[C.key][E.start]=P,c.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(o,c,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,E=x.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let C;if(m.isTileClipped())C=c.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(o,c){const m=this.painter,y=this.painter.context,x=y.gl;m._tileClippingMaskIDs={},y.setColorMode(d.ColorMode.disabled),y.setDepthMode(d.DepthMode.disabled);const E=m.useProgram("clippingMask");for(const C of o){const P=m._tileClippingMaskIDs[C.key]=--c;E.draw(y,x.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:x.ALWAYS,mask:0},P,255,x.KEEP,x.KEEP,x.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,po(C.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(o){const c=this.painter.transform;if(o.x<0||o.x>c.width||o.y<0||o.y>c.height)return null;const m=[o.x,o.y,1,1];d.transformMat4$1(m,m,c.pixelMatrixInverse),d.scale$1(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const y=c._camera.position,x=d.mercatorZfromAltitude(1,c.center.lat),E=[y[0],y[1],y[2]/x,0],C=d.subtract([],m.slice(0,3),E);d.normalize(C,C);const P=this.raycast(E,C,this._exaggeration);return null!==P&&P?(d.scaleAndAdd(E,E,C,P),E[3]=E[2],E[2]*=x,E):null}drawDepth(){const o=this.painter,c=o.context,m=this.proxySourceCache,y=Math.ceil(o.width),x=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===x||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const E=c.gl,C=c.createFramebuffer(y,x,!0);c.activeTexture.set(E.TEXTURE0);const P=new d.Texture(c,{width:y,height:x,data:null},E.RGBA);P.bind(E.NEAREST,E.CLAMP_TO_EDGE),C.colorAttachment.set(P.texture);const k=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,x);C.depthAttachment.set(k),this._depthFBO=C,this._depthTexture=P}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,x]),function(E,C,P,k){if("globe"===E.transform.projection.name)return;const R=E.context,O=R.gl;R.clear({depth:1});const j=E.useProgram("terrainDepth"),Z=new d.DepthMode(O.LESS,d.DepthMode.ReadWrite,E.depthRangeFor3D);for(const G of k){const W=P.getTile(G),se=wr(G.projMatrix,0);C.setupElevationDraw(W,j),j.draw(R,O.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,se,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(o,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,c,m){if(o.getSource()instanceof Gi)return this._setupProxiedCoordsForImageSource(o,c,m);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const y=this.proxiedCoords[o.id]=[],x=this.proxyCoords;for(let C=0;C<x.length;C++){const P=x[C],k=this._findTileCoveringTileID(P,o);if(k){const R=this._createProxiedId(P,k,m[P.key]&&m[P.key][o.id]);y.push(R),this.proxyToSource[P.key][o.id]=[R]}}let E=!1;for(let C=0;C<c.length;C++){const P=o.getTile(c[C]);if(!P||!P.hasData())continue;const k=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==P.tileID.canonical.z){const R=this.proxyToSource[k.tileID.key][o.id],O=this._createProxiedId(k.tileID,P,m[k.tileID.key]&&m[k.tileID.key][o.id]);R?R.splice(R.length-1,0,O):this.proxyToSource[k.tileID.key][o.id]=[O],y.push(O),E=!0}}this._sourceTilesOverlap[o.id]=E}_setupProxiedCoordsForImageSource(o,c,m){if(!o.getSource().loaded())return;const y=this.proxiedCoords[o.id]=[],x=this.proxyCoords,E=o.getSource(),C=new d.pointGeometry(E.tileID.x,E.tileID.y)._div(1<<E.tileID.z),P=E.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((R,O)=>(R.min.x=Math.min(R.min.x,O.x-C.x),R.min.y=Math.min(R.min.y,O.y-C.y),R.max.x=Math.max(R.max.x,O.x-C.x),R.max.y=Math.max(R.max.y,O.y-C.y),R),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(R,O)=>{const j=R.wrap+R.canonical.x/(1<<R.canonical.z),Z=R.canonical.y/(1<<R.canonical.z),G=d.EXTENT/(1<<R.canonical.z),W=O.wrap+O.canonical.x/(1<<O.canonical.z),se=O.canonical.y/(1<<O.canonical.z);return j+G<W+P.min.x||j>W+P.max.x||Z+G<se+P.min.y||Z>se+P.max.y};for(let R=0;R<x.length;R++){const O=x[R];for(let j=0;j<c.length;j++){const Z=o.getTile(c[j]);if(!Z||!Z.hasData()||k(O,Z.tileID))continue;const G=this._createProxiedId(O,Z,m[O.key]&&m[O.key][o.id]),W=this.proxyToSource[O.key][o.id];W?W.push(G):this.proxyToSource[O.key][o.id]=[G],y.push(G)}}}_createProxiedId(o,c,m){let y=this.orthoMatrix;if(m){const x=m.find(E=>E.key===c.tileID.key);if(x)return x}if(c.tileID.key!==o.key){const x=o.canonical.z-c.tileID.canonical.z;let E,C,P;y=d.create();const k=c.tileID.wrap-o.wrap<<o.overscaledZ;x>0?(E=d.EXTENT>>x,C=E*((c.tileID.canonical.x<<x)-o.canonical.x+k),P=E*((c.tileID.canonical.y<<x)-o.canonical.y)):(E=d.EXTENT<<-x,C=d.EXTENT*(c.tileID.canonical.x-(o.canonical.x+k<<-x)),P=d.EXTENT*(c.tileID.canonical.y-(o.canonical.y<<-x))),d.ortho(y,0,E,0,E,0,1),d.translate(y,y,[C,P,0])}return new rn(c.tileID,o.key,y)}_findTileCoveringTileID(o,c){let m=c.getTile(o);if(m&&m.hasData())return m;const y=this._findCoveringTileCache[c.id],x=y[o.key];if(m=x?c.getTileByID(x):null,m&&m.hasData()||null===x)return m;let E=m?m.tileID:o,C=E.overscaledZ;const P=c.getSource().minzoom,k=[];if(!x){const O=c.getSource().maxzoom;if(o.canonical.z>=O){const j=o.canonical.z-O;c.getSource().reparseOverscaled?(C=Math.max(o.canonical.z+2,c.transform.tileZoom),E=new d.OverscaledTileID(C,o.wrap,O,o.canonical.x>>j,o.canonical.y>>j)):0!==j&&(C=O,E=new d.OverscaledTileID(C,o.wrap,O,o.canonical.x>>j,o.canonical.y>>j))}E.key!==o.key&&(k.push(E.key),m=c.getTile(E))}const R=O=>{k.forEach(j=>{y[j]=O}),k.length=0};for(C-=1;C>=P&&(!m||!m.hasData());C--){m&&R(m.tileID.key);const O=E.calculateScaledKey(C);if(m=c.getTileByID(O),m&&m.hasData())break;const j=y[O];if(null===j)break;void 0===j?k.push(O):m=c.getTileByID(j)}return R(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(o){this.renderedToTile=!0}_clearRenderCacheForTile(o,c){let m=this._tilesDirty[o];m||(m=this._tilesDirty[o]={}),m[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(c){let m,y,x;const E=new d.StructArrayLayout2ui4,C=131;for(y=1;y<129;y++){for(m=1;m<129;m++)x=y*C+m,E.emplaceBack(x,x+1),E.emplaceBack(x,x+C),E.emplaceBack(x+1,x+C),128===y&&E.emplaceBack(x+C,x+C+1);E.emplaceBack(x+1,x+1+C)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Iu(f){const o=[];for(let c=0;c<f.length;c++){if(null===f[c])continue;const m=f[c].split(" ");o.push(m.pop())}return o}class fo{static cacheKey(o,c,m){let y=`${o}${m?m.cacheKey:""}`;for(const x of c)y+=`/${x}`;return y}constructor(o,c,m,y,x,E){const C=o.gl;this.program=C.createProgram();const P=Iu(m.staticAttributes),k=y?y.getBinderAttributes():[],R=P.concat(k),O=m.staticUniforms?Iu(m.staticUniforms):[],j=y?y.getBinderUniforms():[],Z=O.concat(j),G=[];for(const Q of Z)G.indexOf(Q)<0&&G.push(Q);let W=y?y.defines():[];W=W.concat(E.map(Q=>`#define ${Q}`));const se=W.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ks,qt.fragmentSource,Sa.fragmentSource,m.fragmentSource).join("\n"),H=W.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ks,qt.vertexSource,Sa.vertexSource,Ia.vertexSource,m.vertexSource).join("\n"),ne=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(ne,se),C.compileShader(ne),C.attachShader(this.program,ne);const re=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(re,H),C.compileShader(re),C.attachShader(this.program,re),this.attributes={};const te={};this.numAttributes=R.length;for(let Q=0;Q<this.numAttributes;Q++)R[Q]&&(C.bindAttribLocation(this.program,Q,R[Q]),this.attributes[R[Q]]=Q);C.linkProgram(this.program),C.deleteShader(re),C.deleteShader(ne);for(let Q=0;Q<G.length;Q++){const oe=G[Q];if(oe&&!te[oe]){const de=C.getUniformLocation(this.program,oe);de&&(te[oe]=de)}}var Q,oe;this.fixedUniforms=x(o,te),this.binderUniforms=y?y.getUniforms(o,te):[],-1!==E.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(Q=o,(oe=te).u_dem),u_dem_prev:new d.Uniform1i(Q,oe.u_dem_prev),u_dem_unpack:new d.Uniform4f(Q,oe.u_dem_unpack),u_dem_tl:new d.Uniform2f(Q,oe.u_dem_tl),u_dem_scale:new d.Uniform1f(Q,oe.u_dem_scale),u_dem_tl_prev:new d.Uniform2f(Q,oe.u_dem_tl_prev),u_dem_scale_prev:new d.Uniform1f(Q,oe.u_dem_scale_prev),u_dem_size:new d.Uniform1f(Q,oe.u_dem_size),u_dem_lerp:new d.Uniform1f(Q,oe.u_dem_lerp),u_exaggeration:new d.Uniform1f(Q,oe.u_exaggeration),u_depth:new d.Uniform1i(Q,oe.u_depth),u_depth_size_inv:new d.Uniform2f(Q,oe.u_depth_size_inv),u_meter_to_dem:new d.Uniform1f(Q,oe.u_meter_to_dem),u_label_plane_matrix_inv:new d.UniformMatrix4f(Q,oe.u_label_plane_matrix_inv),u_tile_tl_up:new d.Uniform3f(Q,oe.u_tile_tl_up),u_tile_tr_up:new d.Uniform3f(Q,oe.u_tile_tr_up),u_tile_br_up:new d.Uniform3f(Q,oe.u_tile_br_up),u_tile_bl_up:new d.Uniform3f(Q,oe.u_tile_bl_up),u_tile_up_scale:new d.Uniform1f(Q,oe.u_tile_up_scale)}),-1!==E.indexOf("FOG")&&(this.fogUniforms=((Q,oe)=>({u_fog_matrix:new d.UniformMatrix4f(Q,oe.u_fog_matrix),u_fog_range:new d.Uniform2f(Q,oe.u_fog_range),u_fog_color:new d.Uniform4f(Q,oe.u_fog_color),u_fog_horizon_blend:new d.Uniform1f(Q,oe.u_fog_horizon_blend),u_fog_temporal_offset:new d.Uniform1f(Q,oe.u_fog_temporal_offset)}))(o,te))}setTerrainUniformValues(o,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const y in c)m[y].set(c[y])}}setFogUniformValues(o,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const y in c)m[y].location&&m[y].set(c[y])}}draw(o,c,m,y,x,E,C,P,k,R,O,j,Z,G,W,se){const H=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(m),o.setStencilMode(y),o.setColorMode(x),o.setCullFace(E);for(const re of Object.keys(this.fixedUniforms))this.fixedUniforms[re].set(C[re]);G&&G.setUniforms(o,this.binderUniforms,j,{zoom:Z});const ne={[H.LINES]:2,[H.TRIANGLES]:3,[H.LINE_STRIP]:1}[c];for(const re of O.get()){const te=re.vaos||(re.vaos={});(te[P]||(te[P]=new Ti)).bind(o,this,k,G?G.getPaintVertexBuffers():[],R,re.vertexOffset,W,se),H.drawElements(c,re.primitiveLength*ne,H.UNSIGNED_SHORT,re.primitiveOffset*ne*2)}}}function _n(f,o,c){const m=1/ci(c,1,o.transform.tileZoom),y=Math.pow(2,c.tileID.overscaledZ),x=c.tileSize*Math.pow(2,o.transform.tileZoom)/y,E=x*(c.tileID.canonical.x+c.tileID.wrap*y),C=x*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[m,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[E>>16,C>>16],u_pixel_coord_lower:[65535&E,65535&C]}}const Ll=(f,o,c,m)=>{const y=o.style.light,x=y.properties.get("position"),E=[x.x,x.y,x.z],C=d.create$1();"viewport"===y.properties.get("anchor")&&(d.fromRotation(C,-o.transform.angle),d.transformMat3(E,E,C));const P=y.properties.get("color");return{u_matrix:f,u_lightpos:E,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+c,u_opacity:m}},Rl=(f,o,c,m,y,x,E)=>d.extend(Ll(f,o,c,m),_n(x,o,E),{u_height_factor:-Math.pow(2,y.overscaledZ)/E.tileSize/8}),Dc=f=>({u_matrix:f}),Cc=(f,o,c,m)=>d.extend(Dc(f),_n(c,o,m)),$o=(f,o)=>({u_matrix:f,u_world:o}),ka=(f,o,c,m,y)=>d.extend(Cc(f,o,c,m),{u_world:y}),Qd=(f,o,c,m)=>{const y=f.transform;let x;return x="map"===m.paint.get("circle-pitch-alignment")?y.calculatePixelsToTileUnitsMatrix(c):new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]),{u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:f.translatePosMatrix(o.projMatrix,c,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:x}},Mi=f=>{const o=[];return"map"===f.paint.get("circle-pitch-alignment")&&o.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&o.push("SCALE_WITH_MAP"),o},bh=(f,o,c)=>{const m=d.EXTENT/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:o.cameraToCenterDistance,u_extrude_scale:[o.pixelsToGLUnits[0]/m,o.pixelsToGLUnits[1]/m]}},Mc=(f,o,c=1)=>({u_matrix:f,u_color:o,u_overlay:0,u_overlay_scale:c}),Su=(f,o,c,m)=>({u_matrix:f,u_extrude_scale:ci(o,1,c),u_intensity:m}),Au=(f,o,c,m,y,x)=>{const E=f.transform,C=E.calculatePixelsToTileUnitsMatrix(o),P={u_matrix:Ra(f,o,c,y),u_pixels_to_tile_units:C,u_device_pixel_ratio:d.exported.devicePixelRatio,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Ir(c)){const k=La(o,f.transform);P.u_texsize=o.lineAtlasTexture.size,P.u_scale=[k,m.fromScale,m.toScale],P.u_mix=m.t}return P},ei=(f,o,c,m,y)=>{const x=f.transform,E=La(o,x);return{u_matrix:Ra(f,o,c,y),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:d.exported.devicePixelRatio,u_image:0,u_scale:[E,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function La(f,o){return 1/ci(f,1,o.tileZoom)}function Ra(f,o,c,m){return f.translatePosMatrix(m||o.tileID.projMatrix,o,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Ir(f){const o=f.paint.get("line-dasharray").value;return o.value||"constant"!==o.kind}const Er=(f,o,c,m,y,x)=>{return{u_matrix:f,u_tl_parent:o,u_scale_parent:c,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(C=y.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(E=y.paint.get("raster-contrast"),E>0?1/(1-E):1+E),u_spin_weights:tr(y.paint.get("raster-hue-rotate")),u_perspective_transform:x};var E,C};function tr(f){f*=Math.PI/180;const o=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}const Wi=(f,o,c,m,y,x,E,C,P,k,R,O,j,Z)=>{const G=y.transform;return{u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:G.cameraToCenterDistance,u_pitch:G.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:G.width/G.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:C,u_is_text:+P,u_pitch_with_map:+m,u_texsize:k,u_tile_id:R,u_zoom_transition:O,u_inv_rot_matrix:j,u_merc_center:Z,u_texture:0}},Xi=(f,o,c,m,y,x,E,C,P,k,R,O,j,Z,G)=>{const{cameraToCenterDistance:W,_pitch:se}=y.transform;return d.extend(Wi(f,o,c,m,y,x,E,C,P,k,O,j,Z,G),{u_gamma_scale:m?W*Math.cos(y.terrain?0:se):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+R})},Sr=(f,o,c,m,y,x,E,C,P,k,R,O,j,Z)=>d.extend(Xi(f,o,c,m,y,x,E,C,!0,P,!0,R,O,j,Z),{u_texsize_icon:k,u_texture_icon:1}),Xt=(f,o,c)=>({u_matrix:f,u_opacity:o,u_color:c}),Fa=(f,o,c,m,y,x)=>d.extend(function(E,C,P,k){const R=P.imageManager.getPattern(E.from.toString()),O=P.imageManager.getPattern(E.to.toString()),{width:j,height:Z}=P.imageManager.getPixelSize(),G=Math.pow(2,k.tileID.overscaledZ),W=k.tileSize*Math.pow(2,P.transform.tileZoom)/G,se=W*(k.tileID.canonical.x+k.tileID.wrap*G),H=W*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:R.tl,u_pattern_br_a:R.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[j,Z],u_mix:C.t,u_pattern_size_a:R.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/ci(k,1,P.transform.tileZoom),u_pixel_coord_upper:[se>>16,H>>16],u_pixel_coord_lower:[65535&se,65535&H]}}(m,x,c,y),{u_matrix:f,u_opacity:o}),za={fillExtrusion:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_lightpos:new d.Uniform3f(f,o.u_lightpos),u_lightintensity:new d.Uniform1f(f,o.u_lightintensity),u_lightcolor:new d.Uniform3f(f,o.u_lightcolor),u_vertical_gradient:new d.Uniform1f(f,o.u_vertical_gradient),u_opacity:new d.Uniform1f(f,o.u_opacity)}),fillExtrusionPattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_lightpos:new d.Uniform3f(f,o.u_lightpos),u_lightintensity:new d.Uniform1f(f,o.u_lightintensity),u_lightcolor:new d.Uniform3f(f,o.u_lightcolor),u_vertical_gradient:new d.Uniform1f(f,o.u_vertical_gradient),u_height_factor:new d.Uniform1f(f,o.u_height_factor),u_image:new d.Uniform1i(f,o.u_image),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade),u_opacity:new d.Uniform1f(f,o.u_opacity)}),fill:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),fillPattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image:new d.Uniform1i(f,o.u_image),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade)}),fillOutline:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_world:new d.Uniform2f(f,o.u_world)}),fillOutlinePattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_world:new d.Uniform2f(f,o.u_world),u_image:new d.Uniform1i(f,o.u_image),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade)}),circle:(f,o)=>({u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_extrude_scale:new d.UniformMatrix2f(f,o.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),collisionBox:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(f,o.u_extrude_scale)}),collisionCircle:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_inv_matrix:new d.UniformMatrix4f(f,o.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(f,o.u_viewport_size)}),debug:(f,o)=>({u_color:new d.UniformColor(f,o.u_color),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_overlay:new d.Uniform1i(f,o.u_overlay),u_overlay_scale:new d.Uniform1f(f,o.u_overlay_scale)}),clippingMask:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),heatmap:(f,o)=>({u_extrude_scale:new d.Uniform1f(f,o.u_extrude_scale),u_intensity:new d.Uniform1f(f,o.u_intensity),u_matrix:new d.UniformMatrix4f(f,o.u_matrix)}),heatmapTexture:(f,o)=>({u_image:new d.Uniform1i(f,o.u_image),u_color_ramp:new d.Uniform1i(f,o.u_color_ramp),u_opacity:new d.Uniform1f(f,o.u_opacity)}),hillshade:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image:new d.Uniform1i(f,o.u_image),u_latrange:new d.Uniform2f(f,o.u_latrange),u_light:new d.Uniform2f(f,o.u_light),u_shadow:new d.UniformColor(f,o.u_shadow),u_highlight:new d.UniformColor(f,o.u_highlight),u_accent:new d.UniformColor(f,o.u_accent)}),hillshadePrepare:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_image:new d.Uniform1i(f,o.u_image),u_dimension:new d.Uniform2f(f,o.u_dimension),u_zoom:new d.Uniform1f(f,o.u_zoom),u_unpack:new d.Uniform4f(f,o.u_unpack)}),line:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_pixels_to_tile_units:new d.UniformMatrix2f(f,o.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(f,o.u_units_to_pixels),u_dash_image:new d.Uniform1i(f,o.u_dash_image),u_gradient_image:new d.Uniform1i(f,o.u_gradient_image),u_image_height:new d.Uniform1f(f,o.u_image_height),u_texsize:new d.Uniform2f(f,o.u_texsize),u_scale:new d.Uniform3f(f,o.u_scale),u_mix:new d.Uniform1f(f,o.u_mix),u_alpha_discard_threshold:new d.Uniform1f(f,o.u_alpha_discard_threshold)}),linePattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_texsize:new d.Uniform2f(f,o.u_texsize),u_pixels_to_tile_units:new d.UniformMatrix2f(f,o.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_image:new d.Uniform1i(f,o.u_image),u_units_to_pixels:new d.Uniform2f(f,o.u_units_to_pixels),u_scale:new d.Uniform3f(f,o.u_scale),u_fade:new d.Uniform1f(f,o.u_fade),u_alpha_discard_threshold:new d.Uniform1f(f,o.u_alpha_discard_threshold)}),raster:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_tl_parent:new d.Uniform2f(f,o.u_tl_parent),u_scale_parent:new d.Uniform1f(f,o.u_scale_parent),u_fade_t:new d.Uniform1f(f,o.u_fade_t),u_opacity:new d.Uniform1f(f,o.u_opacity),u_image0:new d.Uniform1i(f,o.u_image0),u_image1:new d.Uniform1i(f,o.u_image1),u_brightness_low:new d.Uniform1f(f,o.u_brightness_low),u_brightness_high:new d.Uniform1f(f,o.u_brightness_high),u_saturation_factor:new d.Uniform1f(f,o.u_saturation_factor),u_contrast_factor:new d.Uniform1f(f,o.u_contrast_factor),u_spin_weights:new d.Uniform3f(f,o.u_spin_weights),u_perspective_transform:new d.Uniform2f(f,o.u_perspective_transform)}),symbolIcon:(f,o)=>({u_is_size_zoom_constant:new d.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,o.u_size_t),u_size:new d.Uniform1f(f,o.u_size),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,o.u_pitch),u_rotate_symbol:new d.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,o.u_fade_change),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new d.Uniform1i(f,o.u_is_text),u_pitch_with_map:new d.Uniform1i(f,o.u_pitch_with_map),u_texsize:new d.Uniform2f(f,o.u_texsize),u_tile_id:new d.Uniform3f(f,o.u_tile_id),u_zoom_transition:new d.Uniform1f(f,o.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(f,o.u_merc_center),u_texture:new d.Uniform1i(f,o.u_texture)}),symbolSDF:(f,o)=>({u_is_size_zoom_constant:new d.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,o.u_size_t),u_size:new d.Uniform1f(f,o.u_size),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,o.u_pitch),u_rotate_symbol:new d.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,o.u_fade_change),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new d.Uniform1i(f,o.u_is_text),u_pitch_with_map:new d.Uniform1i(f,o.u_pitch_with_map),u_texsize:new d.Uniform2f(f,o.u_texsize),u_texture:new d.Uniform1i(f,o.u_texture),u_gamma_scale:new d.Uniform1f(f,o.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_tile_id:new d.Uniform3f(f,o.u_tile_id),u_zoom_transition:new d.Uniform1f(f,o.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(f,o.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(f,o.u_merc_center),u_is_halo:new d.Uniform1i(f,o.u_is_halo)}),symbolTextAndIcon:(f,o)=>({u_is_size_zoom_constant:new d.Uniform1i(f,o.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(f,o.u_is_size_feature_constant),u_size_t:new d.Uniform1f(f,o.u_size_t),u_size:new d.Uniform1f(f,o.u_size),u_camera_to_center_distance:new d.Uniform1f(f,o.u_camera_to_center_distance),u_pitch:new d.Uniform1f(f,o.u_pitch),u_rotate_symbol:new d.Uniform1i(f,o.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(f,o.u_aspect_ratio),u_fade_change:new d.Uniform1f(f,o.u_fade_change),u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(f,o.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(f,o.u_coord_matrix),u_is_text:new d.Uniform1i(f,o.u_is_text),u_pitch_with_map:new d.Uniform1i(f,o.u_pitch_with_map),u_texsize:new d.Uniform2f(f,o.u_texsize),u_texsize_icon:new d.Uniform2f(f,o.u_texsize_icon),u_texture:new d.Uniform1i(f,o.u_texture),u_texture_icon:new d.Uniform1i(f,o.u_texture_icon),u_gamma_scale:new d.Uniform1f(f,o.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(f,o.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(f,o.u_is_halo)}),background:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_opacity:new d.Uniform1f(f,o.u_opacity),u_color:new d.UniformColor(f,o.u_color)}),backgroundPattern:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_opacity:new d.Uniform1f(f,o.u_opacity),u_image:new d.Uniform1i(f,o.u_image),u_pattern_tl_a:new d.Uniform2f(f,o.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(f,o.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(f,o.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(f,o.u_pattern_br_b),u_texsize:new d.Uniform2f(f,o.u_texsize),u_mix:new d.Uniform1f(f,o.u_mix),u_pattern_size_a:new d.Uniform2f(f,o.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(f,o.u_pattern_size_b),u_scale_a:new d.Uniform1f(f,o.u_scale_a),u_scale_b:new d.Uniform1f(f,o.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(f,o.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(f,o.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(f,o.u_tile_units_to_pixels)}),terrainRaster:jo,terrainDepth:jo,skybox:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_sun_direction:new d.Uniform3f(f,o.u_sun_direction),u_cubemap:new d.Uniform1i(f,o.u_cubemap),u_opacity:new d.Uniform1f(f,o.u_opacity),u_temporal_offset:new d.Uniform1f(f,o.u_temporal_offset)}),skyboxGradient:(f,o)=>({u_matrix:new d.UniformMatrix4f(f,o.u_matrix),u_color_ramp:new d.Uniform1i(f,o.u_color_ramp),u_center_direction:new d.Uniform3f(f,o.u_center_direction),u_radius:new d.Uniform1f(f,o.u_radius),u_opacity:new d.Uniform1f(f,o.u_opacity),u_temporal_offset:new d.Uniform1f(f,o.u_temporal_offset)}),skyboxCapture:(f,o)=>({u_matrix_3f:new d.UniformMatrix3f(f,o.u_matrix_3f),u_sun_direction:new d.Uniform3f(f,o.u_sun_direction),u_sun_intensity:new d.Uniform1f(f,o.u_sun_intensity),u_color_tint_r:new d.Uniform4f(f,o.u_color_tint_r),u_color_tint_m:new d.Uniform4f(f,o.u_color_tint_m),u_luminance:new d.Uniform1f(f,o.u_luminance)}),globeRaster:(f,o)=>({u_proj_matrix:new d.UniformMatrix4f(f,o.u_proj_matrix),u_globe_matrix:new d.UniformMatrix4f(f,o.u_globe_matrix),u_merc_matrix:new d.UniformMatrix4f(f,o.u_merc_matrix),u_zoom_transition:new d.Uniform1f(f,o.u_zoom_transition),u_merc_center:new d.Uniform2f(f,o.u_merc_center),u_image0:new d.Uniform1i(f,o.u_image0)}),globeAtmosphere:(f,o)=>({u_center:new d.Uniform2f(f,o.u_center),u_radius:new d.Uniform1f(f,o.u_radius),u_screen_size:new d.Uniform2f(f,o.u_screen_size),u_pixel_ratio:new d.Uniform1f(f,o.u_pixel_ratio),u_opacity:new d.Uniform1f(f,o.u_opacity),u_fadeout_range:new d.Uniform1f(f,o.u_fadeout_range),u_start_color:new d.Uniform3f(f,o.u_start_color),u_end_color:new d.Uniform3f(f,o.u_end_color)})};let ys;function Go(f,o,c,m,y,x,E){const C=f.context,P=C.gl,k=f.useProgram("collisionBox"),R=[];let O=0,j=0;for(let re=0;re<m.length;re++){const te=m[re],Q=o.getTile(te),oe=Q.getBucket(c);if(!oe)continue;let de=te.projMatrix;0===y[0]&&0===y[1]||(de=f.translatePosMatrix(te.projMatrix,Q,y,x));const xe=E?oe.textCollisionBox:oe.iconCollisionBox,Ue=oe.collisionCircleArray;if(Ue.length>0){const Re=d.create(),Le=de;d.mul(Re,oe.placementInvProjMatrix,f.transform.glCoordMatrix),d.mul(Re,Re,oe.placementViewportMatrix),R.push({circleArray:Ue,circleOffset:j,transform:Le,invTransform:Re}),O+=Ue.length/4,j=O}xe&&(f.terrain&&f.terrain.setupElevationDraw(Q,k),k.draw(C,P.LINES,d.DepthMode.disabled,d.StencilMode.disabled,f.colorModeForRenderPass(),d.CullFaceMode.disabled,bh(de,f.transform,Q),c.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,f.transform.zoom,null,xe.collisionVertexBuffer,xe.collisionVertexBufferExt))}if(!E||!R.length)return;const Z=f.useProgram("collisionCircle"),G=new d.StructArrayLayout2f1f2i16;G.resize(4*O),G._trim();let W=0;for(const re of R)for(let te=0;te<re.circleArray.length/4;te++){const Q=4*te,oe=re.circleArray[Q+0],de=re.circleArray[Q+1],xe=re.circleArray[Q+2],Ue=re.circleArray[Q+3];G.emplace(W++,oe,de,xe,Ue,0),G.emplace(W++,oe,de,xe,Ue,1),G.emplace(W++,oe,de,xe,Ue,2),G.emplace(W++,oe,de,xe,Ue,3)}(!ys||ys.length<2*O)&&(ys=function(re){const te=2*re,Q=new d.StructArrayLayout3ui6;Q.resize(te),Q._trim();for(let oe=0;oe<te;oe++){const de=6*oe;Q.uint16[de+0]=4*oe+0,Q.uint16[de+1]=4*oe+1,Q.uint16[de+2]=4*oe+2,Q.uint16[de+3]=4*oe+2,Q.uint16[de+4]=4*oe+3,Q.uint16[de+5]=4*oe+0}return Q}(O));const se=C.createIndexBuffer(ys,!0),H=C.createVertexBuffer(G,d.collisionCircleLayout.members,!0);for(const re of R){const te={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(ne=f.transform).cameraToCenterDistance,u_viewport_size:[ne.width,ne.height]};Z.draw(C,P.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,f.colorModeForRenderPass(),d.CullFaceMode.disabled,te,c.id,H,se,d.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,f.transform.zoom,null,null,null)}var ne;H.destroy(),se.destroy()}const nr=d.identity(new Float32Array(16));function wh(f,o,c,m,y,x){const{horizontalAlign:E,verticalAlign:C}=d.getAnchorAlignment(f),P=-(E-.5)*o,k=-(C-.5)*c,R=d.evaluateVariableOffset(f,m);return new d.pointGeometry((P/y+R[0])*x,(k/y+R[1])*x)}function Ii(f,o,c,m,y,x,E,C,P,k,R,O){const j=f.text.placedSymbolArray,Z=f.text.dynamicLayoutVertexArray,G=f.icon.dynamicLayoutVertexArray,W={},se=C.projMatrix,H=x.elevation,ne=H?H.getAtTileOffsetFunc(C,O):re=>[0,0,0];Z.clear();for(let re=0;re<j.length;re++){const te=j.get(re),Q=f.allowVerticalPlacement&&!te.placedOrientation,oe=te.hidden||!te.crossTileID||Q?null:m[te.crossTileID];if(oe){const de=new d.pointGeometry(te.tileAnchorX,te.tileAnchorY),xe=ne(de),Ue=xr(de,c?se:E,xe[2]),Re=Hi(x.cameraToCenterDistance,Ue.signedDistanceFromCamera);let Le=y.evaluateSizeForFeature(f.textSizeData,k,te)*Re/d.ONE_EM;c&&(Le*=f.tilePixelRatio/P);const{width:we,height:ve,anchor:ke,textOffset:De,textScale:tt}=oe,lt=wh(ke,we,ve,De,tt,Le),Tt=c?xr(de.add(lt),E,xe[2]).point:Ue.point.add(o?lt.rotate(-x.angle):lt),je=f.allowVerticalPlacement&&te.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let nt=0;nt<te.numGlyphs;nt++)d.addDynamicAttributes(Z,Tt,je);R&&te.associatedIconIndex>=0&&(W[te.associatedIconIndex]={shiftedAnchor:Tt,angle:je})}else Nt(te.numGlyphs,Z)}if(R){G.clear();const re=f.icon.placedSymbolArray;for(let te=0;te<re.length;te++){const Q=re.get(te);if(Q.hidden)Nt(Q.numGlyphs,G);else{const oe=W[te];if(oe)for(let de=0;de<Q.numGlyphs;de++)d.addDynamicAttributes(G,oe.shiftedAnchor,oe.angle);else Nt(Q.numGlyphs,G)}}f.icon.dynamicLayoutVertexBuffer.updateData(G)}f.text.dynamicLayoutVertexBuffer.updateData(Z)}function Qe(f,o,c){return c.iconsInText&&o?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Ft(f,o,c,m,y,x,E,C,P,k,R,O){const j=f.context,Z=j.gl,G=f.transform,W=G.projection.createTileTransform(G,G.worldSize),se="map"===C,H="map"===P,ne=se&&"point"!==c.layout.get("symbol-placement"),re=se&&!H&&!ne,te=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let Q=!1;const oe=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),de=[d.mercatorXfromLng(G.center.lng),d.mercatorYfromLat(G.center.lat)],xe=c.layout.get("text-variable-anchor"),Ue="globe"===G.projection.name,Re=Ue?d.globeToMercatorTransition(G.zoom):0,Le=[],we=[];f.terrain&&H&&we.push("PITCH_WITH_MAP_TERRAIN"),Ue&&we.push("PROJECTION_GLOBE_VIEW"),ne&&we.push("PROJECTED_POS_ON_VIEWPORT");for(const ve of m){const ke=o.getTile(ve),De=ke.getBucket(c);if(!De||De.projection!==G.projection.name)continue;const tt=y?De.text:De.icon;if(!tt||De.fullyClipped||!tt.segments.get().length)continue;const lt=tt.programConfigurations.get(c.id),Tt=y||De.sdfIcons,je=y?De.textSizeData:De.iconSizeData,nt=H||0!==G.pitch,mt=f.useProgram(Qe(Tt,y,De),lt,we),on=d.evaluateSizeForZoom(je,G.zoom),pn=[ve.canonical.x,ve.canonical.y,1<<ve.canonical.z];let ut,Ct,wn,Jn,di=[0,0],Qi=null;if(y){if(Ct=ke.glyphAtlasTexture,wn=Z.LINEAR,ut=ke.glyphAtlasTexture.size,De.iconsInText){di=ke.imageAtlasTexture.size,Qi=ke.imageAtlasTexture;const sr="composite"===je.kind||"camera"===je.kind;Jn=nt||f.options.rotating||f.options.zooming||sr?Z.LINEAR:Z.NEAREST}}else{const sr=1!==c.layout.get("icon-size").constantOr(0)||De.iconsNeedLinear;Ct=ke.imageAtlasTexture,wn=Tt||f.options.rotating||f.options.zooming||sr||nt?Z.LINEAR:Z.NEAREST,ut=ke.imageAtlasTexture.size}const ii=f.transform.calculatePixelsToTileUnitsMatrix(ke),Gt=ms(ve.projMatrix,ke.tileID.canonical,H,se,f.transform,ii),gt=f.terrain&&H&&ne?d.invert(new Float32Array(16),Gt):nr,Pt=No(ve.projMatrix,ke.tileID.canonical,H,se,f.transform,ii),Cn=xe&&De.hasTextData(),oi="none"!==c.layout.get("icon-text-fit")&&Cn&&De.hasIconData();if(ne){const sr=G.elevation,oa=sr?sr.getAtTileOffsetFunc(ve,W):Ds=>[0,0,0];yh(De,ve.projMatrix,f,y,Gt,Pt,H,k,oa,ve)}const sn=f.translatePosMatrix(ve.projMatrix,ke,x,E),pi=ne||y&&xe||oi?nr:Gt,_o=f.translatePosMatrix(Pt,ke,x,E,!0),Rr=Tt&&0!==c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let yo;const et=W.createInversionMatrix(ve.toUnwrapped());yo=Tt?De.iconsInText?Sr(je.kind,on,re,H,f,sn,pi,_o,ut,di,pn,Re,et,de):Xi(je.kind,on,re,H,f,sn,pi,_o,y,ut,!0,pn,Re,et,de):Wi(je.kind,on,re,H,f,sn,pi,_o,y,ut,pn,Re,et,de);const at={program:mt,buffers:tt,uniformValues:yo,atlasTexture:Ct,atlasTextureIcon:Qi,atlasInterpolation:wn,atlasInterpolationIcon:Jn,isSDF:Tt,hasHalo:Rr,tile:ke,labelPlaneMatrixInv:gt};if(te&&De.canOverlap){Q=!0;const sr=tt.segments.get();for(const oa of sr)Le.push({segments:new d.SegmentVector([oa]),sortKey:oa.sortKey,state:at})}else Le.push({segments:tt.segments,sortKey:0,state:at})}Q&&Le.sort((ve,ke)=>ve.sortKey-ke.sortKey);for(const ve of Le){const ke=ve.state;if(f.terrain&&f.terrain.setupElevationDraw(ke.tile,ke.program,{useDepthForOcclusion:!Ue,labelPlaneMatrixInv:ke.labelPlaneMatrixInv}),j.activeTexture.set(Z.TEXTURE0),ke.atlasTexture.bind(ke.atlasInterpolation,Z.CLAMP_TO_EDGE),ke.atlasTextureIcon&&(j.activeTexture.set(Z.TEXTURE1),ke.atlasTextureIcon&&ke.atlasTextureIcon.bind(ke.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),ke.isSDF){const De=ke.uniformValues;ke.hasHalo&&(De.u_is_halo=1,vn(ke.buffers,ve.segments,c,f,ke.program,oe,R,O,De)),De.u_is_halo=0}vn(ke.buffers,ve.segments,c,f,ke.program,oe,R,O,ke.uniformValues)}}function vn(f,o,c,m,y,x,E,C,P){const k=m.context;y.draw(k,k.gl.TRIANGLES,x,E,C,d.CullFaceMode.disabled,P,c.id,f.layoutVertexBuffer,f.indexBuffer,o,c.paint,m.transform.zoom,f.programConfigurations.get(c.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Ar(f,o,c,m,y,x,E){const C=f.context.gl,P=c.paint.get("fill-pattern"),k=P&&P.constantOr(1),R=c.getCrossfadeParameters();let O,j,Z,G,W;E?(j=k&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=C.LINES):(j=k?"fillPattern":"fill",O=C.TRIANGLES);for(const se of m){const H=o.getTile(se);if(k&&!H.patternsLoaded())continue;const ne=H.getBucket(c);if(!ne)continue;f.prepareDrawTile(se);const re=ne.programConfigurations.get(c.id),te=f.useProgram(j,re);k&&(f.context.activeTexture.set(C.TEXTURE0),H.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),re.updatePaintBuffers(R));const Q=P.constantOr(null);if(Q&&H.imageAtlas){const de=H.imageAtlas,xe=de.patternPositions[Q.to.toString()],Ue=de.patternPositions[Q.from.toString()];xe&&Ue&&re.setConstantPatternPositions(xe,Ue)}const oe=f.translatePosMatrix(se.projMatrix,H,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(E){G=ne.indexBuffer2,W=ne.segments2;const de=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];Z="fillOutlinePattern"===j&&k?ka(oe,f,R,H,de):$o(oe,de)}else G=ne.indexBuffer,W=ne.segments,Z=k?Cc(oe,f,R,H):Dc(oe);f.prepareDrawProgram(f.context,te,se.toUnwrapped()),te.draw(f.context,O,y,f.stencilModeForClipping(se),x,d.CullFaceMode.disabled,Z,c.id,ne.layoutVertexBuffer,G,W,c.paint,f.transform.zoom,re)}}function Ki(f,o,c,m,y,x,E){const C=f.context,P=C.gl,k=c.paint.get("fill-extrusion-pattern"),R=k.constantOr(1),O=c.getCrossfadeParameters(),j=c.paint.get("fill-extrusion-opacity");for(const Z of m){const G=o.getTile(Z),W=G.getBucket(c);if(!W)continue;const se=W.programConfigurations.get(c.id),H=f.useProgram(R?"fillExtrusionPattern":"fillExtrusion",se);if(f.terrain){const oe=f.terrain;if(!W.enableTerrain)continue;if(oe.setupElevationDraw(G,H,{useMeterToDem:!0}),rr(C,o,Z,W,c,oe),!W.centroidVertexBuffer){const de=H.attributes.a_centroid_pos;void 0!==de&&P.vertexAttrib2f(de,0,0)}}R&&(f.context.activeTexture.set(P.TEXTURE0),G.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),se.updatePaintBuffers(O));const ne=k.constantOr(null);if(ne&&G.imageAtlas){const oe=G.imageAtlas,de=oe.patternPositions[ne.to.toString()],xe=oe.patternPositions[ne.from.toString()];de&&xe&&se.setConstantPatternPositions(de,xe)}const re=f.translatePosMatrix(Z.projMatrix,G,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),te=c.paint.get("fill-extrusion-vertical-gradient"),Q=R?Rl(re,f,te,j,Z,O,G):Ll(re,f,te,j);f.prepareDrawProgram(C,H,Z.toUnwrapped()),H.draw(C,C.gl.TRIANGLES,y,x,E,d.CullFaceMode.backCCW,Q,c.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,c.paint,f.transform.zoom,se,f.terrain?W.centroidVertexBuffer:null)}}function rr(f,o,c,m,y,x){const E=[H=>{let ne=H.canonical.x-1,re=H.wrap;return ne<0&&(ne=(1<<H.canonical.z)-1,re--),new d.OverscaledTileID(H.overscaledZ,re,H.canonical.z,ne,H.canonical.y)},H=>{let ne=H.canonical.x+1,re=H.wrap;return ne===1<<H.canonical.z&&(ne=0,re++),new d.OverscaledTileID(H.overscaledZ,re,H.canonical.z,ne,H.canonical.y)},H=>new d.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,(0===H.canonical.y?1<<H.canonical.z:H.canonical.y)-1),H=>new d.OverscaledTileID(H.overscaledZ,H.wrap,H.canonical.z,H.canonical.x,H.canonical.y===(1<<H.canonical.z)-1?0:H.canonical.y+1)],C=H=>{const ne=o.getSource().maxzoom,re=de=>{const xe=o.getTileByID(de);if(xe&&xe.hasData())return xe.getBucket(y)};let te,Q,oe;return(H.overscaledZ===H.canonical.z||H.overscaledZ>=ne)&&(te=re(H.key)),H.overscaledZ>=ne&&(Q=re(H.calculateScaledKey(H.overscaledZ+1))),H.overscaledZ>ne&&(oe=re(H.calculateScaledKey(H.overscaledZ-1))),te||Q||oe},P=[0,0,0],k=(H,ne)=>(P[0]=Math.min(H.min.y,ne.min.y),P[1]=Math.max(H.max.y,ne.max.y),P[2]=d.EXTENT-ne.min.x>H.max.x?ne.min.x-d.EXTENT:H.max.x,P),R=(H,ne)=>(P[0]=Math.min(H.min.x,ne.min.x),P[1]=Math.max(H.max.x,ne.max.x),P[2]=d.EXTENT-ne.min.y>H.max.y?ne.min.y-d.EXTENT:H.max.y,P),O=[(H,ne)=>k(H,ne),(H,ne)=>k(ne,H),(H,ne)=>R(H,ne),(H,ne)=>R(ne,H)],j=new d.pointGeometry(0,0);let Z,G,W;const se=(H,ne,re,te,Q)=>{const oe=[[te?re:H,te?H:re,0],[te?re:ne,te?ne:re,0]],de=Q<0?d.EXTENT+Q:Q,xe=[te?de:(H+ne)/2,te?(H+ne)/2:de,0];return 0===re&&Q<0||0!==re&&Q>0?x.getForTilePoints(W,[xe],!0,G):oe.push(xe),x.getForTilePoints(c,oe,!0,Z),Math.max(oe[0][2],oe[1][2],xe[2])/x.exaggeration()};for(let H=0;H<4;H++){const ne=m.borders[H];if(0===ne.length&&(m.borderDone[H]=!0),m.borderDone[H])continue;const re=W=E[H](c),te=C(re);if(!(te&&te.enableTerrain&&(G=x.findDEMTileFor(re),G&&G.dem)))continue;if(!Z){const xe=x.findDEMTileFor(c);if(!xe||!xe.dem)return;Z=xe}const Q=(H<2?1:5)-H,oe=te.borders[Q];let de=0;for(let xe=0;xe<ne.length;xe++){const Ue=m.featuresOnBorder[ne[xe]],Re=Ue.borders[H];let Le;for(;de<oe.length&&(Le=te.featuresOnBorder[oe[de]],!(Le.borders[Q][1]>Re[0]+3));)te.borderDone[Q]||te.encodeCentroid(void 0,Le,!1),de++;if(Le&&de<oe.length){const we=de;let ve=0;for(;!(Le.borders[Q][0]>Re[1]-3)&&(ve++,++de!==oe.length);)Le=te.featuresOnBorder[oe[de]];if(Le=te.featuresOnBorder[oe[we]],Ue.intersectsCount()>1||Le.intersectsCount()>1||1!==ve){1!==ve&&(de=we),m.encodeCentroid(void 0,Ue,!1),te.borderDone[Q]||te.encodeCentroid(void 0,Le,!1);continue}const ke=O[H](Ue,Le),De=H%2?d.EXTENT-1:0;j.x=se(ke[0],Math.min(d.EXTENT-1,ke[1]),De,H<2,ke[2]),j.y=0,m.encodeCentroid(j,Ue,!1),te.borderDone[Q]||te.encodeCentroid(j,Le,!1)}else m.encodeCentroid(void 0,Ue,!1)}m.borderDone[H]=m.needsCentroidUpdate=!0,te.borderDone[Q]||(te.borderDone[Q]=te.needsCentroidUpdate=!0)}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(f)}const vs=new d.Color(1,0,0,1),Zn=new d.Color(0,1,0,1),Ho=new d.Color(0,0,1,1),mo=new d.Color(1,0,1,1),At=new d.Color(0,1,1,1);function Tr(f,o,c,m){Zo(f,0,o+c/2,f.transform.width,c,m)}function qo(f,o,c,m){Zo(f,o-c/2,0,c,f.transform.height,m)}function Zo(f,o,c,m,y,x){const E=f.context,C=E.gl;C.enable(C.SCISSOR_TEST),C.scissor(o*d.exported.devicePixelRatio,c*d.exported.devicePixelRatio,m*d.exported.devicePixelRatio,y*d.exported.devicePixelRatio),E.clear({color:x}),C.disable(C.SCISSOR_TEST)}function Wo(f,o,c){const m=f.context,y=m.gl,x=c.projMatrix,E=f.useProgram("debug"),C=o.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(C,E);const P=d.DepthMode.disabled,k=d.StencilMode.disabled,R=f.colorModeForRenderPass(),O="$debug";m.activeTexture.set(y.TEXTURE0),f.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),C._makeDebugTileBoundsBuffers(f.context,f.transform.projection);const j=C._tileDebugBuffer||f.debugBuffer,Z=C._tileDebugIndexBuffer||f.debugIndexBuffer,G=C._tileDebugSegments||f.debugSegments;E.draw(m,y.LINE_STRIP,P,k,R,d.CullFaceMode.disabled,Mc(x,d.Color.red),O,j,Z,G);const W=C.latestRawTileData,se=Math.floor((W&&W.byteLength||0)/1024),H=o.getTile(c).tileSize,ne=512/Math.min(H,512)*(c.overscaledZ/f.transform.zoom)*.5;let re=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(re+=` => ${c.overscaledZ}`),function(te,Q){te.initDebugOverlayCanvas();const oe=te.debugOverlayCanvas,de=te.context.gl,xe=te.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,oe.width,oe.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(Q,5,5),xe.strokeText(Q,5,5),te.debugOverlayTexture.update(oe),te.debugOverlayTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE)}(f,`${re} ${se}kb`),E.draw(m,y.TRIANGLES,P,k,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,Mc(x,d.Color.transparent,ne),O,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}const Pr=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Js}=Pr;function kr(f,o,c,m){f.emplaceBack(o,c,m)}class ti{constructor(o){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,kr(this.vertexArray,-1,-1,1),kr(this.vertexArray,1,-1,1),kr(this.vertexArray,-1,1,1),kr(this.vertexArray,1,1,1),kr(this.vertexArray,-1,-1,-1),kr(this.vertexArray,1,-1,-1),kr(this.vertexArray,-1,1,-1),kr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Js),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function en(f,o,c,m,y,x){const E=f.gl,C=o.paint.get("sky-atmosphere-color"),P=o.paint.get("sky-atmosphere-halo-color"),k=o.paint.get("sky-atmosphere-sun-intensity"),R={u_matrix_3f:d.fromMat4([],m),u_sun_direction:y,u_sun_intensity:k,u_color_tint_r:[(G=C).r,G.g,G.b,G.a],u_color_tint_m:[(W=P).r,W.g,W.b,W.a],u_luminance:5e-5};var G,W;E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+x,o.skyboxTexture,0),c.draw(f,E.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,R,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const Fl={symbol:function(f,o,c,m,y){if("translucent"!==f.renderPass)return;const x=d.StencilMode.disabled,E=f.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(C,P,k,R,O,j,Z){const G=P.transform,W="map"===O,se="map"===j,H=G.projection.createTileTransform(G,G.worldSize);for(const ne of C){const re=R.getTile(ne),te=re.getBucket(k);if(!te||te.projection!==G.projection.name||!te.text||!te.text.segments.get().length)continue;const Q=d.evaluateSizeForZoom(te.textSizeData,G.zoom),oe=P.transform.calculatePixelsToTileUnitsMatrix(re),de=ms(ne.projMatrix,re.tileID.canonical,se,W,P.transform,oe),xe="none"!==k.layout.get("icon-text-fit")&&te.hasIconData();if(Q){const Ue=Math.pow(2,G.zoom-re.tileID.overscaledZ);Ii(te,W,se,Z,d.symbolSize,G,de,ne,Ue,Q,xe,H)}}}(m,f,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),0!==c.paint.get("icon-opacity").constantOr(1)&&Ft(f,o,c,m,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),x,E),0!==c.paint.get("text-opacity").constantOr(1)&&Ft(f,o,c,m,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),x,E),o.map.showCollisionBoxes&&(Go(f,o,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Go(f,o,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,o,c,m){if("translucent"!==f.renderPass)return;const y=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),C=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===y.constantOr(1)&&(0===x.constantOr(1)||0===E.constantOr(1)))return;const P=f.context,k=P.gl,R=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),O=d.StencilMode.disabled,j=f.colorModeForRenderPass(),Z=[];for(let W=0;W<m.length;W++){const se=m[W],H=o.getTile(se),ne=H.getBucket(c);if(!ne)continue;const re=ne.programConfigurations.get(c.id),te=Mi(c),Q={programConfiguration:re,program:f.useProgram("circle",re,te),layoutVertexBuffer:ne.layoutVertexBuffer,indexBuffer:ne.indexBuffer,uniformValues:Qd(f,se,H,c),tile:H};if(C){const oe=ne.segments.get();for(const de of oe)Z.push({segments:new d.SegmentVector([de]),sortKey:de.sortKey,state:Q})}else Z.push({segments:ne.segments,sortKey:0,state:Q})}C&&Z.sort((W,se)=>W.sortKey-se.sortKey);const G={useDepthForOcclusion:"globe"!==f.transform.projection.name};for(const W of Z){const{programConfiguration:se,program:H,layoutVertexBuffer:ne,indexBuffer:re,uniformValues:te,tile:Q}=W.state,oe=W.segments;f.terrain&&f.terrain.setupElevationDraw(Q,H,G),f.prepareDrawProgram(P,H,Q.tileID.toUnwrapped()),H.draw(P,k.TRIANGLES,R,O,j,d.CullFaceMode.disabled,te,c.id,ne,re,oe,c.paint,f.transform.zoom,se)}},heatmap:function(f,o,c,m){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const y=f.context,x=y.gl,E=d.StencilMode.disabled,C=new d.ColorMode([x.ONE,x.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(P,k,R){const O=P.gl;P.activeTexture.set(O.TEXTURE1),P.viewport.set([0,0,k.width/4,k.height/4]);let j=R.heatmapFbo;if(j)O.bindTexture(O.TEXTURE_2D,j.colorAttachment.get()),P.bindFramebuffer.set(j.framebuffer);else{const Z=O.createTexture();O.bindTexture(O.TEXTURE_2D,Z),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_2D,O.TEXTURE_MAG_FILTER,O.LINEAR),j=R.heatmapFbo=P.createFramebuffer(k.width/4,k.height/4,!1),function(G,W,se,H){const ne=G.gl;ne.texImage2D(ne.TEXTURE_2D,0,ne.RGBA,W.width/4,W.height/4,0,ne.RGBA,G.extRenderToTextureHalfFloat?G.extTextureHalfFloat.HALF_FLOAT_OES:ne.UNSIGNED_BYTE,null),H.colorAttachment.set(se)}(P,k,Z,j)}})(y,f,c),y.clear({color:d.Color.transparent});for(let P=0;P<m.length;P++){const k=m[P];if(o.hasRenderableParent(k))continue;const R=o.getTile(k),O=R.getBucket(c);if(!O)continue;const j=O.programConfigurations.get(c.id),Z=f.useProgram("heatmap",j),{zoom:G}=f.transform;f.terrain&&f.terrain.setupElevationDraw(R,Z),f.prepareDrawProgram(y,Z,k.toUnwrapped()),Z.draw(y,x.TRIANGLES,d.DepthMode.disabled,E,C,d.CullFaceMode.disabled,Su(k.projMatrix,R,G,c.paint.get("heatmap-intensity")),c.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,c.paint,f.transform.zoom,j)}y.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,x){const E=y.context,C=E.gl,P=x.heatmapFbo;if(!P)return;E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,P.colorAttachment.get()),E.activeTexture.set(C.TEXTURE1);let k=x.colorRampTexture;k||(k=x.colorRampTexture=new d.Texture(E,x.colorRamp,C.RGBA)),k.bind(C.LINEAR,C.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(E,C.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,y.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:x.paint.get("heatmap-opacity")},x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)}(f,c))},line:function(f,o,c,m){if("translucent"!==f.renderPass)return;const y=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(0===y.constantOr(1)||0===x.constantOr(1))return;const E=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),C=f.colorModeForRenderPass(),P=c.paint.get("line-dasharray"),k=P.constantOr(1),R=c.layout.get("line-cap"),O=c.paint.get("line-pattern"),j=O.constantOr(1),Z=c.paint.get("line-gradient"),G=c.getCrossfadeParameters(),W=j?"linePattern":"line",se=f.context,H=se.gl,ne=(te=>{const Q=[];Ir(te)&&Q.push("RENDER_LINE_DASH"),te.paint.get("line-gradient")&&Q.push("RENDER_LINE_GRADIENT");const oe=te.paint.get("line-pattern").constantOr(1),de=1!==te.paint.get("line-opacity").constantOr(1);return!oe&&de&&Q.push("RENDER_LINE_ALPHA_DISCARD"),Q})(c);let re=ne.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(re=!1);for(const te of m){const Q=o.getTile(te);if(j&&!Q.patternsLoaded())continue;const oe=Q.getBucket(c);if(!oe)continue;f.prepareDrawTile(te);const de=oe.programConfigurations.get(c.id),xe=f.useProgram(W,de,ne),Ue=O.constantOr(null);if(Ue&&Q.imageAtlas){const De=Q.imageAtlas,tt=De.patternPositions[Ue.to.toString()],lt=De.patternPositions[Ue.from.toString()];tt&&lt&&de.setConstantPatternPositions(tt,lt)}const Re=P.constantOr(null),Le=R.constantOr(null);if(!j&&Re&&Le&&Q.lineAtlas){const De=Q.lineAtlas,tt=De.getDash(Re.to,Le),lt=De.getDash(Re.from,Le);tt&&lt&&de.setConstantPatternPositions(tt,lt)}const we=f.terrain?te.projMatrix:null,ve=j?ei(f,Q,c,G,we):Au(f,Q,c,G,we,oe.lineClipsArray.length);if(Z){const De=oe.gradients[c.id];let tt=De.texture;if(c.gradientVersion!==De.version){let lt=256;if(c.stepInterpolant){const Tt=o.getSource().maxzoom,je=te.canonical.z===Tt?Math.ceil(1<<f.transform.maxZoom-te.canonical.z):1;lt=d.clamp(d.nextPowerOfTwo(oe.maxLineLength/d.EXTENT*1024*je),256,se.maxTextureSize)}De.gradient=d.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:lt,image:De.gradient||void 0,clips:oe.lineClipsArray}),De.texture?De.texture.update(De.gradient):De.texture=new d.Texture(se,De.gradient,H.RGBA),De.version=c.gradientVersion,tt=De.texture}se.activeTexture.set(H.TEXTURE1),tt.bind(c.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}k&&(se.activeTexture.set(H.TEXTURE0),Q.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),de.updatePaintBuffers(G)),j&&(se.activeTexture.set(H.TEXTURE0),Q.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),de.updatePaintBuffers(G)),f.prepareDrawProgram(se,xe,te.toUnwrapped());const ke=De=>{xe.draw(se,H.TRIANGLES,E,De,C,d.CullFaceMode.disabled,ve,c.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,c.paint,f.transform.zoom,de,oe.layoutVertexBuffer2)};if(re){const De=f.stencilModeForClipping(te).ref;0===De&&f.terrain&&se.clear({stencil:0});const tt={func:H.EQUAL,mask:255};ve.u_alpha_discard_threshold=.8,ke(new d.StencilMode(tt,De,255,H.KEEP,H.KEEP,H.INVERT)),ve.u_alpha_discard_threshold=0,ke(new d.StencilMode(tt,De,255,H.KEEP,H.KEEP,H.KEEP))}else ke(f.stencilModeForClipping(te))}re&&(f.resetStencilClippingMasks(),f.terrain&&se.clear({stencil:0}))},fill:function(f,o,c,m){const y=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(0===x.constantOr(1))return;const E=f.colorModeForRenderPass(),C=c.paint.get("fill-pattern"),P=f.opaquePassEnabledForLayer()&&!C.constantOr(1)&&1===y.constantOr(d.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(f.renderPass===P){const k=f.depthModeForSublayer(1,"opaque"===f.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);Ar(f,o,c,m,k,E,!1)}if("translucent"===f.renderPass&&c.paint.get("fill-antialias")){const k=f.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);Ar(f,o,c,m,k,E,!0)}},"fill-extrusion":function(f,o,c,m){const y=c.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===f.renderPass){const x=new d.DepthMode(f.context.gl.LEQUAL,d.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==y||c.paint.get("fill-extrusion-pattern").constantOr(1))Ki(f,o,c,m,x,d.StencilMode.disabled,d.ColorMode.disabled),Ki(f,o,c,m,x,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const E=f.colorModeForRenderPass();Ki(f,o,c,m,x,d.StencilMode.disabled,E)}}},hillshade:function(f,o,c,m){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const y=f.context,x=f.depthModeForSublayer(0,d.DepthMode.ReadOnly),E=f.colorModeForRenderPass(),C=f.terrain&&f.terrain.renderingToTexture,[P,k]="translucent"!==f.renderPass||C?[{},m]:f.stencilConfigForOverlap(m);for(const R of k){const O=o.getTile(R);if(O.needsHillshadePrepare&&"offscreen"===f.renderPass)Di(f,O,c,x,d.StencilMode.disabled,E);else if("translucent"===f.renderPass){const j=C&&f.terrain?f.terrain.stencilModeForRTTOverlap(R):P[R.overscaledZ];Aa(f,R,O,c,x,j,E)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,o,c,m,y,x){if("translucent"!==f.renderPass||0===c.paint.get("raster-opacity")||!m.length)return;const E=f.context,C=E.gl,P=o.getSource(),k=f.useProgram("raster"),R=f.colorModeForRenderPass(),O=f.terrain&&f.terrain.renderingToTexture,[j,Z]=P instanceof Gi||O?[{},m]:f.stencilConfigForOverlap(m),G=Z[Z.length-1].overscaledZ,W=!f.options.moving;for(const se of Z){const H=O?d.DepthMode.disabled:f.depthModeForSublayer(se.overscaledZ-G,1===c.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,C.LESS),ne=se.toUnwrapped(),re=o.getTile(se);if(O&&(!re||!re.hasData()))continue;const te=O?se.projMatrix:f.transform.calculateProjMatrix(ne,W),Q=f.terrain&&O?f.terrain.stencilModeForRTTOverlap(se):j[se.overscaledZ],oe=x?0:c.paint.get("raster-fade-duration");re.registerFadeDuration(oe);const de=o.findLoadedParent(se,0),xe=vh(re,de,o,f.transform,oe);let Ue,Re;f.terrain&&f.terrain.prepareDrawTile(se);const Le="nearest"===c.paint.get("raster-resampling")?C.NEAREST:C.LINEAR;E.activeTexture.set(C.TEXTURE0),re.texture.bind(Le,C.CLAMP_TO_EDGE),E.activeTexture.set(C.TEXTURE1),de?(de.texture.bind(Le,C.CLAMP_TO_EDGE),Ue=Math.pow(2,de.tileID.overscaledZ-re.tileID.overscaledZ),Re=[re.tileID.canonical.x*Ue%1,re.tileID.canonical.y*Ue%1]):re.texture.bind(Le,C.CLAMP_TO_EDGE);const we=Er(te,Re||[0,0],Ue||1,xe,c,P instanceof Gi?P.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(E,k,ne),P instanceof Gi)k.draw(E,C.TRIANGLES,H,d.StencilMode.disabled,R,d.CullFaceMode.disabled,we,c.id,P.boundsBuffer,f.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:ke,tileBoundsSegments:De}=f.getTileBoundsBuffers(re);k.draw(E,C.TRIANGLES,H,Q,R,d.CullFaceMode.disabled,we,c.id,ve,ke,De)}}f.resetStencilClippingMasks()},background:function(f,o,c,m){const y=c.paint.get("background-color"),x=c.paint.get("background-opacity");if(0===x)return;const E=f.context,C=E.gl,P=f.transform,k=P.tileSize,R=c.paint.get("background-pattern");if(f.isPatternMissing(R))return;const O=!R&&1===y.a&&1===x&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==O)return;const j=d.StencilMode.disabled,Z=f.depthModeForSublayer(0,"opaque"===O?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),G=f.colorModeForRenderPass(),W=f.useProgram(R?"backgroundPattern":"background");let se,H=m;H||(se=f.getBackgroundTiles(),H=Object.values(se).map(re=>re.tileID)),R&&(E.activeTexture.set(C.TEXTURE0),f.imageManager.bind(f.context));const ne=c.getCrossfadeParameters();for(const re of H){const te=re.toUnwrapped(),Q=m?re.projMatrix:f.transform.calculateProjMatrix(te);f.prepareDrawTile(re);const oe=o?o.getTile(re):se?se[re.key]:new d.Tile(re,k,P.zoom,f),de=R?Fa(Q,x,f,R,{tileID:re,tileSize:k},ne):Xt(Q,x,y);f.prepareDrawProgram(E,W,te);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Ue,tileBoundsSegments:Re}=f.getTileBoundsBuffers(oe);W.draw(E,C.TRIANGLES,Z,j,G,d.CullFaceMode.disabled,de,c.id,xe,Ue,Re)}},sky:function(f,o,c){const m=f.transform,y="mercator"===m.projection.name||"globe"===m.projection.name?1:d.smoothstep(7,8,m.zoom),x=c.paint.get("sky-opacity")*y;if(0===x)return;const E=f.context,C=c.paint.get("sky-type"),P=new d.DepthMode(E.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),k=f.frameCounter/1e3%1;"atmosphere"===C?"offscreen"===f.renderPass?c.needsSkyboxCapture(f)&&(function(R,O,j,Z){const G=R.context,W=G.gl;let se=O.skyboxFbo;if(!se){se=O.skyboxFbo=G.createFramebuffer(32,32,!1),O.skyboxGeometry=new ti(G),O.skyboxTexture=G.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,O.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let te=0;te<6;++te)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(se.framebuffer),G.viewport.set([0,0,32,32]);const H=O.getCenter(R,!0),ne=R.useProgram("skyboxCapture"),re=new Float64Array(16);d.identity(re),d.rotateY(re,re,.5*-Math.PI),en(G,O,ne,re,H,0),d.identity(re),d.rotateY(re,re,.5*Math.PI),en(G,O,ne,re,H,1),d.identity(re),d.rotateX(re,re,.5*-Math.PI),en(G,O,ne,re,H,2),d.identity(re),d.rotateX(re,re,.5*Math.PI),en(G,O,ne,re,H,3),d.identity(re),en(G,O,ne,re,H,4),d.identity(re),d.rotateY(re,re,Math.PI),en(G,O,ne,re,H,5),G.viewport.set([0,0,R.width,R.height])}(f,c),c.markSkyboxValid(f)):"sky"===f.renderPass&&function(R,O,j,Z,G){const W=R.context,se=W.gl,H=R.transform,ne=R.useProgram("skybox");W.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,O.skyboxTexture);const re={u_matrix:H.skyboxMatrix,u_sun_direction:O.getCenter(R,!1),u_cubemap:0,u_opacity:Z,u_temporal_offset:G};R.prepareDrawProgram(W,ne),ne.draw(W,se.TRIANGLES,j,d.StencilMode.disabled,R.colorModeForRenderPass(),d.CullFaceMode.backCW,re,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(f,c,P,x,k):"gradient"===C&&"sky"===f.renderPass&&function(R,O,j,Z,G){const W=R.context,se=W.gl,H=R.transform,ne=R.useProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new ti(W)),W.activeTexture.set(se.TEXTURE0);let re=O.colorRampTexture;re||(re=O.colorRampTexture=new d.Texture(W,O.colorRamp,se.RGBA)),re.bind(se.LINEAR,se.CLAMP_TO_EDGE);const te=(Q=H.skyboxMatrix,oe=O.getCenter(R,!1),de=O.paint.get("sky-gradient-radius"),xe=Z,Ue=G,{u_matrix:Q,u_color_ramp:0,u_center_direction:oe,u_radius:d.degToRad(de),u_opacity:xe,u_temporal_offset:Ue});var Q,oe,de,xe,Ue;R.prepareDrawProgram(W,ne),ne.draw(W,se.TRIANGLES,j,d.StencilMode.disabled,R.colorModeForRenderPass(),d.CullFaceMode.backCW,te,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(f,c,P,x,k)},debug:function(f,o,c){for(let m=0;m<c.length;m++)Wo(f,o,c[m])},custom:function(f,o,c){const m=f.context,y=c.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))d.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===f.renderPass){const x=y.prerender;x&&(f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),x.call(y,m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),m.setColorMode(f.colorModeForRenderPass()),m.setStencilMode(d.StencilMode.disabled);const x="3d"===y.renderingMode?new d.DepthMode(f.context.gl.LEQUAL,d.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,d.DepthMode.ReadOnly);m.setDepthMode(x),y.render(m.gl,f.transform.customLayerMatrix()),m.setDirty(),f.setBaseState(),m.bindFramebuffer.set(null)}}};class Eh{constructor(o,c){this.context=new ui(o),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new dn,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,c){const m=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ys(this,o));const y=this._terrain;this.transform.elevation=m?y:null,y.update(o,this.transform,c)}_updateFog(o){const c=o.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,y]=c.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);const x=m+.78*(y-m);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,c){if(this.width=o*d.exported.devicePixelRatio,this.height=c*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const o=this.context,c=new d.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(d.EXTENT,0),c.emplaceBack(0,d.EXTENT),c.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(c,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const m=new d.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(d.EXTENT,0),m.emplaceBack(0,d.EXTENT),m.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=o.createVertexBuffer(m,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const y=new d.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(y,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const x=new d.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(d.EXTENT,0,d.EXTENT,0),x.emplaceBack(0,d.EXTENT,0,d.EXTENT),x.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(x,d.boundsAttributes.members),this.mercatorBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const E=new d.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E);const C=new d.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])C.emplaceBack(k);this.debugIndexBuffer=o.createIndexBuffer(C),this.emptyTexture=new d.Texture(o,{width:1,height:1,data:new Uint8Array([0,0,0,0])},o.gl.RGBA),this.identityMat=d.create();const P=this.context.gl;this.stencilClearMode=new d.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(d.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,c=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,c.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,po(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,c,m){if(!c||this.currentStencilSource===c.id||!o.isTileClipped()||!m||0===m.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const P of m)if(void 0===this._tileClippingMaskIDs[P.key]){C=!0;break}if(!C)return}this.currentStencilSource=c.id;const y=this.context,x=y.gl;this.nextStencilID+m.length>256&&this.clearStencil(),y.setColorMode(d.ColorMode.disabled),y.setDepthMode(d.DepthMode.disabled);const E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of m){const P=c.getTile(C),k=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:O,tileBoundsSegments:j}=this.getTileBoundsBuffers(P);E.draw(y,x.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:x.ALWAYS,mask:0},k,255,x.KEEP,x.KEEP,x.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,po(C.projMatrix),"$clipping",R,O,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,c=this.context.gl;return new d.StencilMode({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const c=this.context.gl;return new d.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){const c=this.context.gl,m=o.sort((E,C)=>C.overscaledZ-E.overscaledZ),y=m[m.length-1].overscaledZ,x=m[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let C=0;C<x;C++)E[C+y]=new d.StencilMode({func:c.GEQUAL,mask:255},C+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[E,m]}return[{[y]:d.StencilMode.disabled},m]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new d.ColorMode([o.CONSTANT_COLOR,o.ONE],new d.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(o,c,m){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new d.DepthMode(m||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,c){this.style=o,this.options=c,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const m=this.style.order,y=this.style._sourceCaches;for(const k in y){const R=y[k];R.used&&R.prepare(this.context)}const x={},E={},C={};for(const k in y){const R=y[k];x[k]=R.getVisibleCoordinates(),E[k]=x[k].slice().reverse(),C[k]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<m.length;k++)if(this.style._layers[m[k]].is3D()){this.opaquePassCutoff=k;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.GlobeSharedBuffers(this.context)),!d.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const k of m){const R=this.style._layers[k],O=o._getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const j=O?E[O.id]:void 0;("custom"===R.type||R.isSky()||j&&j.length)&&this.renderLayer(this,O,R,j)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let P=d.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(P=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?d.Color.black:P,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[m[this.currentLayer]],R=o._getLayerSourceCache(k);if(k.isSky())continue;const O=R?E[R.id]:void 0;this._renderTileClippingMasks(k,R,O),this.renderLayer(this,R,k,O)}if(this.renderPass="sky",(d.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const k=this.style._layers[m[this.currentLayer]],R=o._getLayerSourceCache(k);k.isSky()&&this.renderLayer(this,R,k,R?E[R.id]:void 0)}for("globe"===this.transform.projection.name&&function(k){const R=k.context,O=R.gl,j=k.transform,Z=new d.DepthMode(O.LEQUAL,d.DepthMode.ReadOnly,[0,1]),G=k.useProgram("globeAtmosphere"),W=j._camera.getWorldToCamera(j.worldSize,1),se=j._camera.getCameraToClipPerspective(j._fov,j.width/j.height,j._nearZ,j._farZ),H=d.mul([],W,d.calculateGlobeMatrix(j,j.worldSize)),ne=d.mul([],j.labelPlaneMatrix,se),re=d.transformMat4([],[0,0,0],H),te=d.add([],re,[j.worldSize/Math.PI/2,0,0]),Q=d.transformMat4([],re,ne),oe=d.transformMat4([],te,ne),de=d.length(d.sub([],oe,Q)),xe=1-d.globeToMercatorTransition(j.zoom),Ue={u_center:Q,u_radius:de,u_screen_size:[j.width,j.height],u_pixel_ratio:d.exported.devicePixelRatio,u_opacity:xe,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};k.prepareDrawProgram(R,G);const Re=k.globeSharedBuffers;Re&&G.draw(R,O.TRIANGLES,Z,d.StencilMode.disabled,d.ColorMode.alphaBlended,d.CullFaceMode.backCW,Ue,"skybox",Re.atmosphereVertexBuffer,Re.atmosphereIndexBuffer,Re.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const k=this.style._layers[m[this.currentLayer]],R=o._getLayerSourceCache(k);if(k.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(k)){if(k.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const O=R?("symbol"===k.type?C:E)[R.id]:void 0;this._renderTileClippingMasks(k,R,R?x[R.id]:void 0),this.renderLayer(this,R,k,O),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let k=null;d.values(this.style._layers).forEach(R=>{const O=o._getLayerSourceCache(R);O&&!R.isHidden(this.transform.zoom)&&(!k||k.getSource().maxzoom<O.getSource().maxzoom)&&(k=O)}),k&&this.options.showTileBoundaries&&Fl.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const R=k.transform.padding;Tr(k,k.transform.height-(R.top||0),3,vs),Tr(k,R.bottom||0,3,Zn),qo(k,R.left||0,3,Ho),qo(k,k.transform.width-(R.right||0),3,mo);const O=k.transform.centerPoint;var j,Z,G,W;Zo(j=k,(Z=O.x)-1,(G=k.transform.height-O.y)-10,2,20,W=At),Zo(j,Z-10,G-1,20,2,W)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,c,m,y){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(m.type)||Fl[m.type](o,c,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let m=this.gpuTimers[o.id];m||(m=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),m.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const c={};for(const m in o){const y=o[m],x=this.context.extTimerQuery,E=x.getQueryObjectEXT(y.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(y.query),c[m]=E}return c}translatePosMatrix(o,c,m,y,x){if(!m[0]&&!m[1])return o;const E=x?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(E){const k=Math.sin(E),R=Math.cos(E);m=[m[0]*R-m[1]*k,m[0]*k+m[1]*R]}const C=[x?m[0]:ci(c,m[0],this.transform.zoom),x?m[1]:ci(c,m[1],this.transform.zoom),0],P=new Float32Array(16);return d.translate(P,o,C),P}saveTileTexture(o){const c=this._tileTextures[o.size[0]];c?c.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const c=this._tileTextures[o];return c&&c.length>0?c.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const c=this.imageManager.getPattern(o.from.toString()),m=this.imageManager.getPattern(o.to.toString());return!c||!m}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),c&&!o&&0!==c.getOpacity(this.transform.pitch)&&m.push("FOG"),o&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(o,c,m){this.cache=this.cache||{};const y=m||[],x=this.currentGlobalDefines().concat(y),E=fo.cacheKey(o,x,c);return this.cache[E]||(this.cache[E]=new fo(this.context,o,kl[o],c,za[o],x)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(o){this.terrain&&this.terrain.prepareDrawTile(o)}prepareDrawProgram(o,c,m){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const x=y.getOpacity(this.transform.pitch);0!==x&&c.setFogUniformValues(o,((E,C,P,k)=>{const R=C.properties.get("color"),O=E.frameCounter/1e3%1,j=[R.r/R.a,R.g/R.a,R.b/R.a,k];return{u_fog_matrix:P?E.transform.calculateFogTileMatrix(P):E.identityMat,u_fog_range:C.getFovAdjustedRange(E.transform._fov),u_fog_color:j,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:O}})(this,y,m,x))}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,c=o.createTexture();return o.bindTexture(o.TEXTURE_2D,c),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&0!==o.getOpacity(this.transform.pitch)}getBackgroundTiles(){const o=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const y of m)c[y.key]=o[y.key]||new d.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class hi{constructor(o=0,c=0,m=0,y=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=m,this.right=y}interpolate(o,c,m){return null!=c.top&&null!=o.top&&(this.top=d.number(o.top,c.top,m)),null!=c.bottom&&null!=o.bottom&&(this.bottom=d.number(o.bottom,c.bottom,m)),null!=c.left&&null!=o.left&&(this.left=d.number(o.left,c.left,m)),null!=c.right&&null!=o.right&&(this.right=d.number(o.right,c.right,m)),this}getCenter(o,c){const m=d.clamp((this.left+o-this.right)/2,0,o),y=d.clamp((this.top+c-this.bottom)/2,0,c);return new d.pointGeometry(m,y)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new hi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function pr(f,o){const c=d.getColumn(f,3);d.fromQuat(f,o),d.setColumn(f,3,c)}function Ic(f,o){d.setColumn(f,3,[o[0],o[1],o[2],1])}function Oa(f,o){const c=d.identity$1([]);return d.rotateZ$1(c,c,-o),d.rotateX$1(c,c,-f),c}function Ba(f,o){const c=[f[0],f[1],0],m=[o[0],o[1],0];if(d.length(c)>=1e-15){const E=d.normalize([],c);d.scale$2(m,E,d.dot(m,E)),o[0]=m[0],o[1]=m[1]}const y=d.cross([],o,f);if(d.len(y)<1e-15)return null;const x=Math.atan2(-y[1],y[0]);return Oa(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}class Si{constructor(o,c){this.position=o,this.orientation=c}get position(){return this._position}set position(o){this._position=this._renderWorldCopies?function(c){if(!c)return;const m=Array.isArray(c)?new d.MercatorCoordinate(c[0],c[1],c[2]):c;return m.x=d.wrap(m.x,0,1),m}(o):o}lookAtPoint(o,c){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(o)):0,y=this.position,x=d.MercatorCoordinate.fromLngLat(o,m),E=[x.x-y.x,x.y-y.y,x.z-y.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Ba(E,c)}setPitchBearing(o,c){this.orientation=Oa(d.degToRad(o),d.degToRad(-c))}}class Pu{constructor(o,c){this._transform=d.identity([]),this._orientation=d.identity$1([]),c&&(this._orientation=c,pr(this._transform,this._orientation)),o&&Ic(this._transform,o)}get mercatorPosition(){const o=this.position;return new d.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=d.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){Ic(this._transform,o)}get orientation(){return this._orientation}set orientation(o){this._orientation=o,pr(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,c){this._orientation=Oa(o,c),pr(this._transform,this._orientation)}forward(){const o=d.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=d.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=d.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,c){const m=new Float64Array(16);return d.invert(m,this.getWorldToCamera(o,c)),m}getWorldToCameraPosition(o,c,m){const y=this.position;d.scale$2(y,y,-o);const x=new Float64Array(16);return d.fromScaling(x,[m,m,m]),d.translate(x,x,y),x[10]*=c,x}getWorldToCamera(o,c){const m=new Float64Array(16),y=new Float64Array(4),x=this.position;return d.conjugate(y,this._orientation),d.scale$2(x,x,-o),d.fromQuat(m,y),d.translate(m,m,x),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(o,c,m,y){const x=new Float64Array(16);return d.perspective(x,o,c,m,y),x}getDistanceToElevation(o){const c=0===o?0:d.mercatorZfromAltitude(o,this.position[1]),m=this.forward();return(c-this.position[2])/m[2]}clone(){return new Pu([...this.position],[...this.orientation])}}function ep(f,o){const c=Ac(f),m=function(x,E,C,P,k){const R=new d.LngLat(C.lng-180*go,C.lat),O=new d.LngLat(C.lng+180*go,C.lat),j=x.project(R.lng,R.lat),Z=x.project(O.lng,O.lat),G=-Math.atan2(Z.y-j.y,Z.x-j.x),W=d.MercatorCoordinate.fromLngLat(C);W.y=d.clamp(W.y,-.999975,.999975);const se=W.toLngLat(),H=x.project(se.lng,se.lat),ne=d.MercatorCoordinate.fromLngLat(se);ne.x+=go;const re=ne.toLngLat(),te=x.project(re.lng,re.lat),Q=Dh(te.x-H.x,te.y-H.y,G),oe=d.MercatorCoordinate.fromLngLat(se);oe.y+=go;const de=oe.toLngLat(),xe=x.project(de.lng,de.lat),Ue=Dh(xe.x-H.x,xe.y-H.y,G),Re=Math.abs(Q.x)/Math.abs(Ue.y),Le=d.identity([]);d.rotateZ(Le,Le,-G*(1-(k?0:P)));const we=d.identity([]);return d.scale(we,we,[1,1-(1-Re)*P,1]),we[4]=-Ue.x/Ue.y*P,d.rotateZ(we,we,G),d.multiply$1(we,Le,we),we}(f.projection,0,f.center,c,o),y=Sc(f);return d.scale(m,m,[y,y,1]),m}function Sc(f){const o=f.projection,c=Ac(f),m=Th(o,f.center),y=Th(o,d.LngLat.convert(o.center));return Math.pow(2,m*c+(1-c)*y)}function Ac(f){const o=f.projection.range;if(!o)return 0;const c=Math.max(f.width,f.height),m=Math.log(c/1024)/Math.LN2;return d.smoothstep(o[0]+m,o[1]+m,f.zoom)}const go=1/4e4;function Th(f,o){const c=d.clamp(o.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),m=new d.LngLat(o.lng-180*go,c),y=new d.LngLat(o.lng+180*go,c),x=f.project(m.lng,c),E=f.project(y.lng,c),C=d.MercatorCoordinate.fromLngLat(m),P=d.MercatorCoordinate.fromLngLat(y),k=E.x-x.x,R=E.y-x.y,O=P.x-C.x,j=P.y-C.y,Z=Math.sqrt((O*O+j*j)/(k*k+R*R));return Math.log(Z)/Math.LN2}function Dh(f,o,c){const m=Math.cos(c),y=Math.sin(c);return{x:f*m-o*y,y:f*y+o*m}}class Pc{constructor(o,c,m,y,x){this.tileSize=512,this._renderWorldCopies=void 0===x||x,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=null==m?0:m,this._maxPitch=null==y?60:y,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new hi,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Pu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const o=new Pc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.setProjection(this.getProjection()),o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o.tileSize=this.tileSize,o.setMaxBounds(this.getMaxBounds()),o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._cameraZoom=this._cameraZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,o?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(o){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),o&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return d.pick(this.projection,["name","center","parallels"])}setProjection(o){null==o&&(o={name:"mercator"}),this.projectionOptions=o;const c=this.projection?this.getProjection():void 0;return this.projection=d.getProjection(o),!_t(c,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return d.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const c=-o*Math.PI/180;var m,y,x,E,C,P,k,R,O,j;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(m=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),y=this.rotationMatrix,E=this.angle,C=(x=this.rotationMatrix)[0],P=x[1],k=x[2],R=x[3],O=Math.sin(E),j=Math.cos(E),y[0]=C*j+k*O,y[1]=P*j+R*O,y[2]=C*-O+k*j,y[3]=P*-O+R*j)}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const c=d.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(o){const c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===o?(this._cameraZoom=null,!1):(this._centerAltitude=o,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let y=0,x=0;for(let E=0;E<c.length;E++){const C=new d.pointGeometry(c[E][0]*this.width,m+c[E][1]*(this.height-m)),P=o.pointCoordinate(C);if(!P)continue;const k=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);y+=P[3]*k,x+=k}return 0===x?NaN:y/x}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const o=this._cameraZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(o),x=this._mercatorZfromZoom(this._maxZoom),E=Math.max(y-m,x);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let m;m=o.z<this._camera.position[2]?[c.x,c.y,c.z]:[o.x,o.y,o.z];const y=d.length(d.sub([],this._camera.position,m));return d.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let c=!1;if(o.orientation&&!d.exactEquals(o.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(o.orientation)),o.position){const m=[o.position.x,o.position.y,o.position.z];d.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,c=new Si;return c.position=new d.MercatorCoordinate(o[0],o[1],o[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(o){if(!d.length$1(o))return!1;d.normalize$1(o,o);const c=d.transformQuat([],[0,0,-1],o),m=d.transformQuat([],[0,-1,0],o);if(m[2]<0)return!1;const y=Ba(c,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(o){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;o[2]=d.clamp(o[2],y/m,y/c),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,m){this._unmodified=!1,this._edgeInsets.interpolate(o,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){const c=[new d.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const m=this.pointCoordinate(new d.pointGeometry(0,0)),y=this.pointCoordinate(new d.pointGeometry(this.width,0)),x=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new d.pointGeometry(0,this.height)),C=Math.floor(Math.min(m.x,y.x,x.x,E.x)),P=Math.floor(Math.max(m.x,y.x,x.x,E.x)),k=1;for(let R=C-k;R<=P+k;R++)0!==R&&c.push(new d.UnwrappedTileID(R,o))}return c}coveringTiles(o){let c=this.coveringZoomLevel(o);const m=c,y=this.elevation&&!o.isTerrainDEM,x="mercator"===this.projection.name;if(void 0!==o.minzoom&&c<o.minzoom)return[];void 0!==o.maxzoom&&c>o.maxzoom&&(c=o.maxzoom);const E=this.locationCoordinate(this.center),C=1<<c,P=[C*E.x,C*E.y,0],k=d.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,"globe"!==this.projection.name),R=this.pointCoordinate(this.getCameraPoint()),O=C*d.mercatorZfromAltitude(1,this.center.lat),j=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),Z=[C*R.x,C*R.y,j],G=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),W=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,se=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,H=o.isTerrainDEM?-se:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?Sc(this):1,re=ve=>{const De=new d.MercatorCoordinate(ve.x+25e-6,ve.y,ve.z),tt=new d.MercatorCoordinate(ve.x,ve.y+25e-6,ve.z),lt=ve.toLngLat(),Tt=De.toLngLat(),je=tt.toLngLat(),nt=this.locationCoordinate(lt),mt=this.locationCoordinate(Tt),on=this.locationCoordinate(je),pn=Math.hypot(mt.x-nt.x,mt.y-nt.y),ut=Math.hypot(on.x-nt.x,on.y-nt.y);return Math.sqrt(pn*ut)*ne/25e-6},te=ve=>{const ke=se,De=H;return{aabb:d.tileAABB(this,C,0,0,0,ve,De,ke,this.projection),zoom:0,x:0,y:0,minZ:De,maxZ:ke,wrap:ve,fullyVisible:!1}},Q=[];let oe=[];const de=c,xe=o.reparseOverscaled?m:c,Ue=ve=>ve*ve,Re=Ue((j-this._centerAltitude)*O),Le=ve=>{if(!this._elevation||!ve.tileID||!x)return;const ke=this._elevation.getMinMaxForTile(ve.tileID),De=ve.aabb;ke?(De.min[2]=ke.min,De.max[2]=ke.max,De.center[2]=(De.min[2]+De.max[2])/2):(ve.shouldSplit=we(ve),ve.shouldSplit||(De.min[2]=De.max[2]=De.center[2]=this._centerAltitude))},we=ve=>{if(ve.zoom<W)return!0;if(ve.zoom===de)return!1;if(null!=ve.shouldSplit)return ve.shouldSplit;const ke=ve.aabb.distanceX(Z),De=ve.aabb.distanceY(Z);let tt=Re;y&&(tt=Ue(ve.aabb.distanceZ(Z)*O));let lt=1;if(this.projection.isReprojectedInTileSpace&&m<=5){const je=Math.pow(2,ve.zoom),nt=re(new d.MercatorCoordinate((ve.x+.5)/je,(ve.y+.5)/je));lt=nt>.85?1:nt}const Tt=ke*ke+De*De+tt;return Tt<Ue((1<<de-ve.zoom)*G*lt*((je,nt)=>{if(nt*Ue(.707)<je)return 1;const mt=Math.sqrt(nt/je);return mt/(1.4144271570014144+(Math.pow(1.1,mt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(tt,Re),Tt))};if(this.renderWorldCopies)for(let ve=1;ve<=3;ve++)Q.push(te(-ve)),Q.push(te(ve));for(Q.push(te(0));Q.length>0;){const ve=Q.pop(),ke=ve.x,De=ve.y;let tt=ve.fullyVisible;if(!tt){const lt=ve.aabb.intersects(k);if(0===lt)continue;tt=2===lt}if(ve.zoom!==de&&we(ve))for(let lt=0;lt<4;lt++){const Tt=(ke<<1)+lt%2,je=(De<<1)+(lt>>1),nt={aabb:x?ve.aabb.quadrant(lt):d.tileAABB(this,C,ve.zoom+1,Tt,je,ve.wrap,ve.minZ,ve.maxZ,this.projection),zoom:ve.zoom+1,x:Tt,y:je,wrap:ve.wrap,fullyVisible:tt,tileID:void 0,shouldSplit:void 0,minZ:ve.minZ,maxZ:ve.maxZ};y&&(nt.tileID=new d.OverscaledTileID(ve.zoom+1===de?xe:ve.zoom+1,ve.wrap,ve.zoom+1,Tt,je),Le(nt)),Q.push(nt)}else{const lt=ve.zoom===de?xe:ve.zoom;if(o.minzoom&&o.minzoom>lt)continue;const Tt=P[0]-(.5+ke+(ve.wrap<<ve.zoom))*(1<<c-ve.zoom),je=P[1]-.5-De,nt=ve.tileID?ve.tileID:new d.OverscaledTileID(lt,ve.wrap,ve.zoom,ke,De);oe.push({tileID:nt,distanceSq:Tt*Tt+je*je})}}if(this.fogCullDistSq){const ve=this.fogCullDistSq,ke=this.horizonLineFromTop();oe=oe.filter(De=>{const tt=[0,0,0,1],lt=[d.EXTENT,d.EXTENT,0,1],Tt=this.calculateFogTileMatrix(De.tileID.toUnwrapped());d.transformMat4$1(tt,tt,Tt),d.transformMat4$1(lt,lt,Tt);const je=d.getAABBPointSquareDist(tt,lt);if(0===je)return!0;let nt=!1;const mt=this._elevation;if(mt&&je>ve&&0!==ke){const on=this.calculateProjMatrix(De.tileID.toUnwrapped());let pn;o.isTerrainDEM||(pn=mt.getMinMaxForTile(De.tileID)),pn||(pn={min:H,max:se});const ut=d.furthestTileCorner(this.rotation),Ct=[ut[0]*d.EXTENT,ut[1]*d.EXTENT,pn.max];d.transformMat4(Ct,Ct,on),nt=(1-Ct[1])*this.height*.5<ke}return je<ve||nt})}return oe.sort((ve,ke)=>ve.distanceSq-ke.distanceSq).map(ve=>ve.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const c=d.clamp(o.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),m=this.projection.project(o.lng,c);return new d.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,c){const m=this.pointCoordinate(c),y=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(o);this.setLocation(new d.MercatorCoordinate(x.x-(m.x-y.x),x.y-(m.y-y.y)))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this._coordinatePoint(this.locationCoordinate(o),!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,c){const m=c?d.mercatorZfromAltitude(c,o.lat):void 0,y=this.projection.project(o.lng,o.lat);return new d.MercatorCoordinate(y.x,y.y,m)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,c){const m=null!=c?c:this._centerAltitude,y=[o.x,o.y,0,1],x=[o.x,o.y,1,1];d.transformMat4$1(y,y,this.pixelMatrixInverse),d.transformMat4$1(x,x,this.pixelMatrixInverse);const E=x[3];d.scale$1(y,y,1/y[3]),d.scale$1(x,x,1/E);const C=y[2],P=x[2];return{p0:y,p1:x,t:C===P?0:(m-C)/(P-C)}}screenPointToMercatorRay(o){const c=[o.x,o.y,0,1],m=[o.x,o.y,1,1];return d.transformMat4$1(c,c,this.pixelMatrixInverse),d.transformMat4$1(m,m,this.pixelMatrixInverse),d.scale$1(c,c,1/c[3]),d.scale$1(m,m,1/m[3]),c[2]=d.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,m[2]=d.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,d.scale$1(c,c,1/this.worldSize),d.scale$1(m,m,1/this.worldSize),new d.Ray([c[0],c[1],c[2]],d.normalize([],d.sub([],m,c)))}rayIntersectionCoordinate(o){const{p0:c,p1:m,t:y}=o,x=d.mercatorZfromAltitude(c[2],this._center.lat),E=d.mercatorZfromAltitude(m[2],this._center.lat);return new d.MercatorCoordinate(d.number(c[0],m[0],y)/this.worldSize,d.number(c[1],m[1],y)/this.worldSize,d.number(x,E,y))}pointCoordinate(o,c=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(o.x,o.y,c)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);const c=this.elevation;let m=this.elevation.pointCoordinate(o);if(m)return new d.MercatorCoordinate(m[0],m[1],m[2]);let y=0,x=this.horizonLineFromTop();if(o.y>x)return this.pointCoordinate(o);const E=.02*x,C=o.clone();for(let P=0;P<10&&x-y>E;P++){C.y=d.number(y,x,.66);const k=c.pointCoordinate(C);k?(x=C.y,m=k):y=C.y}return m?new d.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){if(this.elevation)return!this.elevation.pointCoordinate(o);{const c=this.horizonLineFromTop();return o.y<c}}_coordinatePoint(o,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,y=[o.x*this.worldSize,o.y*this.worldSize,m+o.toAltitude(),1];return d.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new d.pointGeometry(y[0]/y[3],y[1]/y[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,c){const m=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),y=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),E=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let C=this.pointCoordinate(m,o),P=this.pointCoordinate(y,o);const k=this.pointCoordinate(x,c),R=this.pointCoordinate(E,c),O=(j,Z)=>(Z.y-j.y)/(Z.x-j.x);return C.y>1&&P.y>=0?C=new d.MercatorCoordinate((1-R.y)/O(R,C)+R.x,1):C.y<0&&P.y<=1&&(C=new d.MercatorCoordinate(-R.y/O(R,C)+R.x,0)),P.y>1&&C.y>=0?P=new d.MercatorCoordinate((1-k.y)/O(k,P)+k.x,1):P.y<0&&C.y<=1&&(P=new d.MercatorCoordinate(-k.y/O(k,P)+k.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(P)).extend(this.coordinateLocation(R)).extend(this.coordinateLocation(k))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const c=o.visibleDemTiles.reduce((m,y)=>{if(y.dem){const x=y.dem.tree;m.min=Math.min(m.min,x.minimums[0]),m.max=Math.max(m.max,x.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*o.exaggeration(),c.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return o?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-d.MAX_MERCATOR_LATITUDE,this.maxLat=d.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=d.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=d.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=d.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,c){return this.projection.createTileTransform(this,c).createTileMatrix(o)}calculateDistanceTileData(o){const c=o.key,m=this._distanceTileDataCache;if(m[c])return m[c];const y=o.canonical,x=1/this.height,E=this.cameraWorldSize/this.zoomScale(y.z),C=(y.x+Math.pow(2,y.z)*o.wrap)*E,P=y.y*E,k=this.point,R=this.angle,O=Math.sin(-R),j=-Math.cos(-R);return m[c]={bearing:[O,j],center:[(k.x-C)*x,(k.y-P)*x],scale:E/d.EXTENT*x},m[c]}calculateFogTileMatrix(o){const c=o.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const y=this.calculatePosMatrix(o,this.cameraWorldSize);return d.multiply$1(y,this.worldToFogMatrix,y),m[c]=new Float32Array(y),m[c]}calculateProjMatrix(o,c=!1){const m=o.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[m])return y[m];const x=this.calculatePosMatrix(o,this.worldSize);return d.multiply$1(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,x),y[m]=new Float32Array(x),y[m]}calculatePixelsToTileUnitsMatrix(o){const c=o.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const y=function(x,E){const{scale:C}=x.tileTransform,P=C*d.EXTENT/(x.tileSize*Math.pow(2,E.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return k=new Float32Array(4),j=(R=E.inverseAdjustmentMatrix)[1],Z=R[2],G=R[3],se=(O=[P,P])[1],k[0]=R[0]*(W=O[0]),k[1]=j*W,k[2]=Z*se,k[3]=G*se,k;var k,R,O,j,Z,G,W,se}(o,this);return m[c]=y,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const c=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),y=this._camera.forward(),x=d.mercatorZfromAltitude(1,this._center.lat);m[2]/=x,y[2]/=x,d.normalize(y,y);const E=o.raycast(m,y,o.exaggeration());if(E){const C=d.scaleAndAdd([],m,y,E),P=new d.MercatorCoordinate(C[0],C[1],d.mercatorZfromAltitude(C[2],d.latFromMercatorY(C[1]))),k=(P.z+d.length([P.x-m[0],P.y-m[1],P.z-m[2]*x]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(k),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const c=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),y=o.getAtPointOrZero(new d.MercatorCoordinate(...m)),x=this._minimumHeightOverTerrain()*Math.cos(d.degToRad(this._maxPitch)),E=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*y;if(E<x){const C=this.locationCoordinate(this._center,this._centerAltitude),P=[C.x-m[0],C.y-m[1],C.z-m[2]],k=d.length(P);P[2]-=(x-E)/this._projectionScaler;const R=d.length(P);if(0===R)return;d.scale$2(P,P,k/R*this._projectionScaler),this._camera.position=[C.x-P[0],C.y-P[1],C.z*this._projectionScaler-P[2]],this._camera.orientation=Ba(P,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const O=this.center;return O.lat=d.clamp(O.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(O.lng=d.clamp(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const o=this._unmodified,{x:c,y:m}=this.point;let y=0,x=c,E=m;const C=this.width/2,P=this.height/2,k=this.worldMinY*this.scale,R=this.worldMaxY*this.scale;if(m-P<k&&(E=k+P),m+P>R&&(E=R-P),R-k<this.height&&(y=Math.max(y,this.height/(R-k)),E=(R+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,Z=this.worldSize/2-(O+j)/2;x=(c+Z+this.worldSize)%this.worldSize-Z,x-C<O&&(x=O+C),x+C>j&&(x=j-C),j-O<this.width&&(y=Math.max(y,this.width/(j-O)),x=(j+O)/2)}x===c&&E===m||(this.center=this.unproject(new d.pointGeometry(x,E))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this._fov/2,c=this.centerOffset,m=this.pixelsPerMeter;this._projectionScaler=m/(d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(o)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?m:1),x=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);x[8]=2*-c.x/this.width,x[9]=2*c.y/this.height;let E=d.mul([],x,y);if(this.projection.isReprojectedInTileSpace){const te=this.locationCoordinate(this.center),Q=d.identity([]);d.translate(Q,Q,[te.x*this.worldSize,te.y*this.worldSize,0]),d.multiply$1(Q,Q,ep(this)),d.translate(Q,Q,[-te.x*this.worldSize,-te.y*this.worldSize,0]),d.multiply$1(E,E,Q),this.inverseAdjustmentMatrix=function(oe){const de=ep(oe,!0);return We([],[de[0],de[1],de[4],de[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=d.scale([],E,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=E,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const C=new Float32Array(16);d.identity(C),d.scale(C,C,[1,-1,1]),d.rotateX(C,C,this._pitch),d.rotateZ(C,C,this.angle);const P=d.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),k=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;P[8]=2*-c.x/this.width,P[9]=2*(c.y+k)/this.height,this.skyboxMatrix=d.multiply$1(C,P,C);const R=this.point,O=R.x,j=R.y,Z=this.width%2/2,G=this.height%2/2,W=Math.cos(this.angle),se=Math.sin(this.angle),H=O-Math.round(O)+W*Z+se*G,ne=j-Math.round(j)+W*G+se*Z,re=new Float64Array(E);if(d.translate(re,re,[H>.5?H-1:H,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=re,E=d.create(),d.scale(E,E,[this.width/2,-this.height/2,1]),d.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=d.create(),d.scale(E,E,[1,-1,1]),d.translate(E,E,[-1,-1,0]),d.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=d.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=d.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");this.pixelMatrixInverse=E,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,c=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height,x=[o,o,c];d.scale$2(x,x,y),d.scale$2(m,m,-1),d.multiply$2(m,m,x);const E=d.create();d.translate(E,E,m),d.scale(E,E,x),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,c,y)}_computeCameraPosition(o){const c=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*c-o/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-m[0]*x,y.y/this.worldSize-m[1]*x,o/this.worldSize*this._centerAltitude-m[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=o[2];let y=1;m>0&&(y=Math.min((c-this._camera.position[2])/m,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,o,y),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),x=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),C=Math.max((o[2]-x)/Math.cos(m),E),P=this._zoomFromMercatorZ(C);d.scaleAndAdd(o,o,c,C),this._pitch=d.clamp(m,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(y,-Math.PI,Math.PI),this._setZoom(d.clamp(P,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new d.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(o,c){const m=Math.min(o.x,c.x),y=Math.max(o.x,c.x),x=Math.min(o.y,c.y),E=Math.max(o.y,c.y);if(x<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const C=[new d.pointGeometry(m,x),new d.pointGeometry(y,E),new d.pointGeometry(m,E),new d.pointGeometry(y,x)],P=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const R of C){const O=this.pointRayIntersection(R);if(O.t<0)return!0;const j=this.rayIntersectionCoordinate(O);if(j.x<P||j.y<0||j.x>k||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,c){const m=d.length(d.sub([],this._camera.position,o)),y=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(y)}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,o))}}function Qs(f,o){let c=!1,m=null;const y=()=>{m=null,c&&(f(),m=setTimeout(y,o),c=!1)};return()=>(c=!0,m||y(),m)}class tp{constructor(o){this._hashName=o&&encodeURIComponent(o),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Qs(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,d.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return d.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const c=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),E=Math.round(c.lng*x)/x,C=Math.round(c.lat*x)/x,P=this._map.getBearing(),k=this._map.getPitch();let R="";if(R+=o?`/${E}/${C}/${m}`:`${m}/${C}/${E}`,(P||k)&&(R+="/"+Math.round(10*P)/10),k&&(R+=`/${Math.round(k)}`),this._hashName){const O=this._hashName;let j=!1;const Z=d.window.location.hash.slice(1).split("&").map(G=>{const W=G.split("=")[0];return W===O?(j=!0,`${W}=${R}`):G}).filter(G=>G);return j||Z.push(`${O}=${R}`),`#${Z.join("&")}`}return`#${R}`}_getCurrentHash(){const o=d.window.location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._getCurrentHash();if(o.length>=3&&!o.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:c,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,o)}}const xs={linearity:.3,easing:d.bezier(0,0,.3,1)},zl=d.extend({deceleration:2500,maxSpeed:1400},xs),np=d.extend({deceleration:20,maxSpeed:1400},xs),Ch=d.extend({deceleration:1e3,maxSpeed:360},xs),tn=d.extend({deceleration:1e3,maxSpeed:90},xs);class ku{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,c=d.exported.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const x=kc(c.pan.mag(),m,d.extend({},zl,o||{}));y.offset=c.pan.mult(x.amount/c.pan.mag()),y.center=this._map.transform.center,Lu(y,x)}if(c.zoom){const x=kc(c.zoom,m,np);y.zoom=this._map.transform.zoom+x.amount,Lu(y,x)}if(c.bearing){const x=kc(c.bearing,m,Ch);y.bearing=this._map.transform.bearing+d.clamp(x.amount,-179,179),Lu(y,x)}if(c.pitch){const x=kc(c.pitch,m,tn);y.pitch=this._map.transform.pitch+x.amount,Lu(y,x)}if(y.zoom||y.bearing){const x=void 0===c.pinchAround?c.around:c.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),d.extend(y,{noMoveStart:!0})}}function Lu(f,o){(!f.duration||f.duration<o.duration)&&(f.duration=o.duration,f.easing=o.easing)}function kc(f,o,c){const{maxSpeed:m,linearity:y,deceleration:x}=c,E=d.clamp(f*y/(o/1e3),-m,m),C=Math.abs(E)/(x*y);return{easing:c.easing,duration:1e3*C,amount:E*(C/2)}}class fr extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,m,y={}){const x=Pe.mousePos(c.getCanvasContainer(),m),E=c.unproject(x);super(o,d.extend({point:x,lngLat:E,originalEvent:m},y)),this._defaultPrevented=!1,this.target=c}}class Na extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,m){const y="touchend"===o?m.changedTouches:m.touches,x=Pe.touchPos(c.getCanvasContainer(),y),E=x.map(P=>c.unproject(P)),C=x.reduce((P,k,R,O)=>P.add(k.div(O.length)),new d.pointGeometry(0,0));super(o,{points:x,point:C,lngLats:E,lngLat:c.unproject(C),originalEvent:m}),this._defaultPrevented=!1}}class Xf extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,m){super(o,{originalEvent:m}),this._defaultPrevented=!1}}class rp{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Xf(o.type,this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new fr(o.type,this._map,o))}mouseup(o){this._map.fire(new fr(o.type,this._map,o))}preclick(o){const c=d.extend({},o);c.type="preclick",this._map.fire(new fr(c.type,this._map,c))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(o),this._map.fire(new fr(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new fr(o.type,this._map,o))}mouseover(o){this._map.fire(new fr(o.type,this._map,o))}mouseout(o){this._map.fire(new fr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Na(o.type,this._map,o))}touchmove(o){this._map.fire(new Na(o.type,this._map,o))}touchend(o){this._map.fire(new Na(o.type,this._map,o))}touchcancel(o){this._map.fire(new Na(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Kf{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(o){this._map.fire(new fr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new fr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xo{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&0===o.button&&(Pe.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;const m=c;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=Pe.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const x=Math.min(y.x,m.x),E=Math.max(y.x,m.x),C=Math.min(y.y,m.y),P=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${C}px)`,this._box.style.width=E-x+"px",this._box.style.height=P-C+"px")})}mouseupWindow(o,c){if(!this._active||0!==o.button)return;const m=this._startPos,y=c;if(this.reset(),Pe.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:x=>x.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Pe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new d.Event(o,{originalEvent:c}))}}function Va(f,o){const c={};for(let m=0;m<f.length;m++)c[f[m].identifier]=o[m];return c}class bs{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const x=new d.pointGeometry(0,0);for(const E of y)x._add(E);return x.div(y.length)}(c),this.touches=Va(m,c)))}touchmove(o,c,m){if(this.aborted||!this.centroid)return;const y=Va(m,c);for(const x in this.touches){const E=this.touches[x],C=y[x];(!C||C.dist(E)>30)&&(this.aborted=!0)}}touchend(o,c,m){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class ja{constructor(o){this.singleTap=new bs(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,c,m){this.singleTap.touchstart(o,c,m)}touchmove(o,c,m){this.singleTap.touchmove(o,c,m)}touchend(o,c,m){const y=this.singleTap.touchend(o,c,m);if(y){const x=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(y)<30;if(x&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Ru{constructor(){this._zoomIn=new ja({numTouches:1,numTaps:2}),this._zoomOut=new ja({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,m){this._zoomIn.touchstart(o,c,m),this._zoomOut.touchstart(o,c,m)}touchmove(o,c,m){this._zoomIn.touchmove(o,c,m),this._zoomOut.touchmove(o,c,m)}touchend(o,c,m){const y=this._zoomIn.touchend(o,c,m),x=this._zoomOut.touchend(o,c,m);return y?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(y)},{originalEvent:o})}):x?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Mh={0:1,2:2};class ea{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;const m=Pe.mouseButton(o);this._correctButton(o,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(o,c){const m=this._lastPoint;if(m)if(o.preventDefault(),function(y,x){const E=Mh[x];return void 0===y.buttons||(y.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}mouseupWindow(o){this._lastPoint&&Pe.mouseButton(o)===this._eventButton&&(this._moved&&Pe.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ol extends ea{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return 0===c&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class Ai extends ea{_correctButton(o,c){return 0===c&&o.ctrlKey||2===c}_move(o,c){const m=.8*(c.x-o.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(o){o.preventDefault()}}class Bl extends ea{_correctButton(o,c){return 0===c&&o.ctrlKey||2===c}_move(o,c){const m=-.5*(c.y-o.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(o){o.preventDefault()}}class Ih{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),d.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(o,c,m){return this._calculateTransform(o,c,m)}touchmove(o,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.preventDefault(),this._calculateTransform(o,c,m)}}touchend(o,c,m){this._calculateTransform(o,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,m){m.length>0&&(this._active=!0);const y=Va(m,c),x=new d.pointGeometry(0,0),E=new d.pointGeometry(0,0);let C=0;for(const k in y){const R=y[k],O=this._touches[k];O&&(x._add(R),E._add(R.sub(O)),C++,y[k]=R)}if(this._touches=y,C<this._minTouches||!E.mag())return;const P=E.div(C);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(C),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pe.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Gr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(o){}_move(o,c,m){return{}}touchstart(o,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,m){if(!this._firstTwoTouches)return;o.preventDefault();const[y,x]=this._firstTwoTouches,E=Yi(m,c,y),C=Yi(m,c,x);if(!E||!C)return;const P=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],P,o)}touchend(o,c,m){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,E=Yi(m,c,y),C=Yi(m,c,x);E&&C||(this._active&&Pe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Yi(f,o,c){for(let m=0;m<f.length;m++)if(f[m].identifier===c)return o[m]}function Fu(f,o){return Math.log(f/o)/Math.LN2}class Ua extends Gr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){const m=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Fu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Fu(this._distance,m),pinchAround:c}}}function Lc(f,o){return 180*f.angleWith(o)/Math.PI}class Rc extends Gr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){const m=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Lc(this._vector,m),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const c=25/(Math.PI*this._minDiameter)*360,m=Lc(o,this._startVector);return Math.abs(m)<c}}function $a(f){return Math.abs(f.y)>Math.abs(f.x)}class Sh extends Gr{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(o){this._lastPoints=o,$a(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,m){const y=o[0].sub(this._lastPoints[0]),x=o[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&m.touches.length<3)&&(this._valid=this.gestureBeginsVertically(y,x,m.timeStamp),this._valid))return this._lastPoints=o,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5}}gestureBeginsVertically(o,c,m){if(void 0!==this._valid)return this._valid;const y=o.mag()>=2,x=c.mag()>=2;if(!y&&!x)return;if(!y||!x)return void 0===this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const E=o.y>0==c.y>0;return $a(o)&&$a(c)&&E}}const ws={panStep:100,bearingStep:15,pitchStep:10};class Yf{constructor(){const o=ws;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,m=0,y=0,x=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?m=-1:(o.preventDefault(),x=-1);break;case 39:o.shiftKey?m=1:(o.preventDefault(),x=1);break;case 38:o.shiftKey?y=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?y=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:C=>{const P=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:Bn,zoom:c?Math.round(P)+c*(o.shiftKey?2:1):P,bearing:C.getBearing()+m*this._bearingStep,pitch:C.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:C.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Bn(f){return f*(2-f)}const Fc=4.000244140625;class zc{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=o.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const m=d.exported.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==c&&c%Fc==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Pe.mousePos(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,c=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(0!==this._delta){const P="wheel"===this._type&&Math.abs(this._delta)>Fc?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&0!==k&&(k=1/k);const R=c(),O=Math.pow(2,R),j="number"==typeof this._targetZoom?o.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(j*k))),"wheel"===this._type&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:c(),y=this._startZoom,x=this._easing;let E,C=!1;if("wheel"===this._type&&y&&x){const P=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),k=x(P);E=d.number(y,m,k),P<1?this._frameId||(this._frameId=!0):C=!0}else E=m,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:E-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=d.ease;if(this._prevEase){const m=this._prevEase,y=(d.exported.now()-m.start)/m.duration,x=m.easing(y+.01)-m.easing(y),E=.27/Math.sqrt(x*x+1e-4)*.01,C=Math.sqrt(.0729-E*E);c=d.bezier(E,C,.25,1)}return this._prevEase={start:d.exported.now(),duration:o,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Pe.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(d.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!d.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Nn{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ah{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,c){return o.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(o.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ip{constructor(){this._tap=new ja({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(o,c,m){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(o,c,m))}touchmove(o,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=c[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,o.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(o,c,m)}touchend(o,c,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(o,c,m)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ta{constructor(o,c,m){this._el=o,this._mousePan=c,this._touchPan=m}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ni{constructor(o,c,m){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ph{constructor(o,c,m,y){this._el=o,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const na=f=>f.zoom||f.drag||f.pitch||f.rotate;class ra extends d.Event{}class ri{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,c){const m=d.sub([],c,o);this.radius=d.length(m[2]<0?d.div([],m,this.constants):[m[0],m[1],0])}projectRay(o){d.div(o,o,this.constants),d.normalize(o,o),d.mul$1(o,o,this.constants);const c=d.scale$2([],o,this.radius);if(c[2]>0){const m=d.scale$2([],[0,0,1],d.dot(c,[0,0,1])),y=d.scale$2([],d.normalize([],[c[0],c[1],0]),this.radius),x=d.add([],c,d.scale$2([],d.sub([],d.add([],y,m),c),2));c[0]=x[0],c[1]=x[1]}return c}}function Ga(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Es{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ku(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ri,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),d.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[y,x,E]of this._listeners)y.addEventListener(x,y===d.window.document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,c,m]of this._listeners)o.removeEventListener(c,o===d.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(o){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new rp(c,o));const y=c.boxZoom=new Xo(c,o);this._add("boxZoom",y);const x=new Ru,E=new Ah;c.doubleClickZoom=new Nn(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const C=new ip;this._add("tapDragZoom",C);const P=c.touchPitch=new Sh(c);this._add("touchPitch",P);const k=new Ai(o),R=new Bl(o);c.dragRotate=new ni(o,k,R),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const O=new Ol(o),j=new Ih(c,o);c.dragPan=new ta(m,O,j),this._add("mousePan",O),this._add("touchPan",j,["touchZoom","touchRotate"]);const Z=new Rc,G=new Ua;c.touchZoomRotate=new Ph(m,G,Z,C),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Kf(c));const W=c.scrollZoom=new zc(c,this);this._add("scrollZoom",W,["mousePan"]);const se=c.keyboard=new Yf;this._add("keyboard",se);for(const H of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[H]&&c[H].enable(o[H])}_add(o,c,m){this._handlers.push({handlerName:o,handler:c,allowed:m}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(na(this._eventsInProgress))||this.isZooming()}_blockedByActive(o,c,m){for(const y in o)if(y!==m&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const c=[];for(const m of o)this._el.contains(m.target)&&c.push(m);return c}handleEvent(o,c){this._updatingCamera=!0;const m="renderFrame"===o.type,y=m?void 0:o,x={needsRenderFrame:!1},E={},C={},P=o.touches?this._getMapTouches(o.touches):void 0,k=P?Pe.touchPos(this._el,P):m?void 0:Pe.mousePos(this._el,o);for(const{handlerName:j,handler:Z,allowed:G}of this._handlers){if(!Z.isEnabled())continue;let W;this._blockedByActive(C,G,j)?Z.reset():Z[c||o.type]&&(W=Z[c||o.type](o,k,P),this.mergeHandlerResult(x,E,W,j,y),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||Z.isActive())&&(C[j]=Z)}const R={};for(const j in this._previousActiveHandlers)C[j]||(R[j]=y);this._previousActiveHandlers=C,(Object.keys(R).length||Ga(x))&&(this._changes.push([x,E,R]),this._triggerRenderFrame()),(Object.keys(C).length||Ga(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=x;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(o,c,m,y,x){if(!m)return;d.extend(o,m);const E={handlerName:y,originalEvent:m.originalEvent||x};void 0!==m.zoomDelta&&(c.zoom=E),void 0!==m.panDelta&&(c.drag=E),void 0!==m.pitchDelta&&(c.pitch=E),void 0!==m.bearingDelta&&(c.rotate=E)}_applyChanges(){const o={},c={},m={};for(const[y,x,E]of this._changes)y.panDelta&&(o.panDelta=(o.panDelta||new d.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(o.around=y.around),void 0!==y.aroundCoord&&(o.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(o.pinchAround=y.pinchAround),y.noInertia&&(o.noInertia=y.noInertia),d.extend(c,x),d.extend(m,E);this._updateMapTransform(o,c,m),this._changes=[]}_updateMapTransform(o,c,m){const y=this._map,x=y.transform,E=ne=>[ne.x,ne.y,ne.z];if((ne=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Ga(o)){const ne=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",ne!==x.zoom&&this._map._update(!0)}if(!Ga(o))return this._fireEvents(c,m,!0);let{panDelta:C,zoomDelta:P,bearingDelta:k,pitchDelta:R,around:O,aroundCoord:j,pinchAround:Z}=o;void 0!==Z&&(O=Z),(ne=>c.drag&&!this._eventsInProgress.drag)()&&O&&(this._dragOrigin=E(x.pointCoordinate3D(O)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),O=O||y.transform.centerPoint,k&&(x.bearing+=k),R&&(x.pitch+=R),x._updateCameraState();const G=[0,0,0];if(C){const ne=x.pointCoordinate(O),re=x.pointCoordinate(O.sub(C));ne&&re&&(G[0]=re.x-ne.x,G[1]=re.y-ne.y)}const W=x.zoom,se=[0,0,0];if(P){const ne=E(j||x.pointCoordinate3D(O)),re={dir:d.normalize([],d.sub([],ne,x._camera.position))};if(re.dir[2]<0){const te=x.zoomDeltaToMovement(ne,P);d.scale$2(se,re.dir,te)}}const H=d.add(G,G,se);x._translateCameraConstrained(H),P&&Math.abs(x.zoom-W)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,m,!0)}_fireEvents(o,c,m){const y=na(this._eventsInProgress),x=na(o),E={};for(const R in o){const{originalEvent:O}=o[R];this._eventsInProgress[R]||(E[`${R}start`]=O),this._eventsInProgress[R]=o[R]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const R in E)this._fireEvent(R,E[R]);x&&this._fireEvent("move",x.originalEvent);for(const R in o){const{originalEvent:O}=o[R];this._fireEvent(R,O)}const C={};let P;for(const R in this._eventsInProgress){const{handlerName:O,originalEvent:j}=this._eventsInProgress[R];this._handlersById[O].isActive()||(delete this._eventsInProgress[R],P=c[O]||j,C[`${R}end`]=P)}for(const R in C)this._fireEvent(R,C[R]);const k=na(this._eventsInProgress);if(m&&(y||x)&&!k){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=j=>0!==j&&-this._bearingSnap<j&&j<this._bearingSnap;R?(O(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:P})):(this._map.fire(new d.Event("moveend",{originalEvent:P})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new d.Event(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new ra("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const zu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ko extends d.Evented{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,m){return o=d.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,d.extend({offset:o},c),m)}panTo(o,c,m){return this.easeTo(d.extend({center:o},c),m)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,m){return this.easeTo(d.extend({zoom:o},c),m)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,m){return this.easeTo(d.extend({bearing:o},c),m)}resetNorth(o,c){return this.rotateTo(0,d.extend({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=d.LngLatBounds.convert(o);const m=c&&c.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),m,c)}_extendCameraOptions(o){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(o=d.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding){const m=o.padding;o.padding={top:m,bottom:m,right:m,left:m}}return o.padding=d.extend(c,o.padding),o}_cameraForBoxAndBearing(o,c,m,y){const x=this._extendCameraOptions(y),E=this.transform,C=E.padding,P=E.project(d.LngLat.convert(o)),k=E.project(d.LngLat.convert(c)),R=P.rotate(-d.degToRad(m)),O=k.rotate(-d.degToRad(m)),j=new d.pointGeometry(Math.max(R.x,O.x),Math.max(R.y,O.y)),Z=new d.pointGeometry(Math.min(R.x,O.x),Math.min(R.y,O.y)),G=j.sub(Z),W=(E.width-(C.left+C.right+x.padding.left+x.padding.right))/G.x,se=(E.height-(C.top+C.bottom+x.padding.top+x.padding.bottom))/G.y;if(se<0||W<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const H=Math.min(E.scaleZoom(E.scale*Math.min(W,se)),x.maxZoom),ne="number"==typeof x.offset.x?new d.pointGeometry(x.offset.x,x.offset.y):d.pointGeometry.convert(x.offset),re=new d.pointGeometry((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(m*Math.PI/180),te=ne.add(re).mult(E.scale/E.zoomScale(H));return{center:E.unproject(P.add(k).div(2).sub(te)),zoom:H,bearing:m}}_cameraForBox(o,c,m,y,x){const E=this._extendCameraOptions(x);m=m||0,y=y||0,o=d.LngLat.convert(o),c=d.LngLat.convert(c);const C=this.transform.clone();C.padding=E.padding;const P=this.getFreeCameraOptions(),k=new d.LngLat(.5*(o.lng+c.lng),.5*(o.lat+c.lat)),R=.5*(m+y);if(C._camera.position[2]<d.mercatorZfromAltitude(R,k.lat))return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");P.lookAtPoint(k),C.setFreeCameraOptions(P);const O=d.MercatorCoordinate.fromLngLat(o),j=d.MercatorCoordinate.fromLngLat(c),Z=C.pointRayIntersection(C.centerPoint,R),G=[(W=C.rayIntersectionCoordinate(Z)).x,W.y,W.z];var W;const se=C.screenPointToMercatorRay(C.centerPoint),H="globe"!==C.projection.name;let ne,re=0;do{const te=Math.floor(C.zoom),Q=1<<te,oe=Math.min(Q*O.x,Q*j.x),de=Math.min(Q*O.y,Q*j.y),xe=Math.max(Q*O.x,Q*j.x),Ue=Math.max(Q*O.y,Q*j.y),Re=new d.Aabb([oe,de,m],[xe,Ue,y]),Le=d.Frustum.fromInvProjectionMatrix(C.invProjMatrix,C.worldSize,te,H);if(2!==Re.intersects(Le)){ne&&(C._camera.position=d.scaleAndAdd([],C._camera.position,se.dir,-ne),C._updateStateFromCamera());break}const we=d.sub([],C._camera.position,G);ne=.5*d.length(we),C._camera.position=d.scaleAndAdd([],C._camera.position,se.dir,ne);try{C._updateStateFromCamera()}catch(ve){return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++re<10);return{center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch}}fitBounds(o,c,m){return this._fitInternal(this.cameraForBounds(o,c),c,m)}_raycastElevationBox(o,c){const m=this.transform.elevation;if(!m)return;const y=new d.pointGeometry(o.x,c.y),x=new d.pointGeometry(c.x,o.y),E=m.pointCoordinate(o);if(!E)return;const C=m.pointCoordinate(c);if(!C)return;const P=m.pointCoordinate(y);if(!P)return;const k=m.pointCoordinate(x);if(!k)return;const R=new d.MercatorCoordinate(E[0],E[1]).toLngLat(),O=new d.MercatorCoordinate(C[0],C[1]).toLngLat(),j=new d.MercatorCoordinate(P[0],P[1]).toLngLat(),Z=new d.MercatorCoordinate(k[0],k[1]).toLngLat(),G=Math.min(R.lng,Math.min(O.lng,Math.min(j.lng,Z.lng))),W=Math.min(R.lat,Math.min(O.lat,Math.min(j.lat,Z.lat))),se=Math.max(R.lng,Math.max(O.lng,Math.max(j.lng,Z.lng))),H=Math.max(R.lat,Math.max(O.lat,Math.max(j.lat,Z.lat))),ne=Math.min(E[3],Math.min(C[3],Math.min(P[3],k[3]))),re=Math.max(E[3],Math.max(C[3],Math.max(P[3],k[3])));return{minLngLat:new d.LngLat(G,W),maxLngLat:new d.LngLat(se,H),minAltitude:ne,maxAltitude:re}}fitScreenCoordinates(o,c,m,y,x){let E,C,P,k;const R=d.pointGeometry.convert(o),O=d.pointGeometry.convert(c),j=this._raycastElevationBox(R,O);if(j)E=j.minLngLat,C=j.maxLngLat,P=j.minAltitude,k=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(R,O))return this;E=this.transform.pointLocation(R),C=this.transform.pointLocation(O)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(d.pointGeometry.convert(o)),this.transform.pointLocation(d.pointGeometry.convert(c)),m,y):this._cameraForBox(E,C,P,k,y),y,x)}_fitInternal(o,c,m){return o?(delete(c=d.extend(o,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(o,c){this.stop();const m=o.preloadOnly?this.transform.clone():this.transform;let y=!1,x=!1,E=!1;return"zoom"in o&&m.zoom!==+o.zoom&&(y=!0,m.zoom=+o.zoom),void 0!==o.center&&(m.center=d.LngLat.convert(o.center)),"bearing"in o&&m.bearing!==+o.bearing&&(x=!0,m.bearing=+o.bearing),"pitch"in o&&m.pitch!==+o.pitch&&(E=!0,m.pitch=+o.pitch),null==o.padding||m.isPaddingEqual(o.padding)||(m.padding=o.padding),o.preloadOnly?(this._preloadTiles(m),this):(this.fire(new d.Event("movestart",c)).fire(new d.Event("move",c)),y&&this.fire(new d.Event("zoomstart",c)).fire(new d.Event("zoom",c)).fire(new d.Event("zoomend",c)),x&&this.fire(new d.Event("rotatestart",c)).fire(new d.Event("rotate",c)).fire(new d.Event("rotateend",c)),E&&this.fire(new d.Event("pitchstart",c)).fire(new d.Event("pitch",c)).fire(new d.Event("pitchend",c)),this.fire(new d.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.warnOnce(zu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return void d.warnOnce(zu);this.stop();const y=m.zoom,x=m.pitch,E=m.bearing;m.setFreeCameraOptions(o);const C=y!==m.zoom,P=x!==m.pitch,k=E!==m.bearing;return this.fire(new d.Event("movestart",c)).fire(new d.Event("move",c)),C&&this.fire(new d.Event("zoomstart",c)).fire(new d.Event("zoom",c)).fire(new d.Event("zoomend",c)),k&&this.fire(new d.Event("rotatestart",c)).fire(new d.Event("rotate",c)).fire(new d.Event("rotateend",c)),P&&this.fire(new d.Event("pitchstart",c)).fire(new d.Event("pitch",c)).fire(new d.Event("pitchend",c)),this.fire(new d.Event("moveend",c)),this}easeTo(o,c){this._stop(!1,o.easeId),(!1===(o=d.extend({offset:[0,0],duration:500,easing:d.ease},o)).animate||!o.essential&&d.exported.prefersReducedMotion)&&(o.duration=0);const m=this.transform,y=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),P="zoom"in o?+o.zoom:y,k="bearing"in o?this._normalizeBearing(o.bearing,x):x,R="pitch"in o?+o.pitch:E,O="padding"in o?o.padding:m.padding,j=d.pointGeometry.convert(o.offset);let Z=m.centerPoint.add(j);const G="globe"===m.projection.name?m.pointCoordinate(Z).toLngLat():m.pointLocation(Z),W=d.LngLat.convert(o.center||G);this._normalizeCenter(W);const se=m.project(G),H=m.project(W).sub(se),ne=m.zoomScale(P-y);let re,te;o.around&&(re=d.LngLat.convert(o.around),te=m.locationPoint(re));const Q=this._zooming||P!==y,oe=this._rotating||x!==k,de=this._pitching||R!==E,xe=!m.isPaddingEqual(O),Ue=Le=>we=>{if(Q&&(Le.zoom=d.number(y,P,we)),oe&&(Le.bearing=d.number(x,k,we)),de&&(Le.pitch=d.number(E,R,we)),xe&&(Le.interpolatePadding(C,O,we),Z=Le.centerPoint.add(j)),re)Le.setLocationAtPoint(re,te);else{const ve=Le.zoomScale(Le.zoom-y),ke=P>y?Math.min(2,ne):Math.max(.5,ne),De=Math.pow(ke,1-we),tt=Le.unproject(se.add(H.mult(we*De)).mult(ve));Le.setLocationAtPoint(Le.renderWorldCopies?tt.wrap():tt,Z)}return o.preloadOnly||this._fireMoveEvents(c),Le};if(o.preloadOnly){const Le=this._emulate(Ue,o.duration,m);return this._preloadTiles(Le),this}const Re={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Q,this._rotating=oe,this._pitching=de,this._padding=xe,this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,Re),this._ease(Ue(m),Le=>{m.recenterOnTerrain(),this._afterEase(c,Le)},o),this}_prepareEase(o,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||m.moving||this.fire(new d.Event("movestart",o)),this._zooming&&!m.zooming&&this.fire(new d.Event("zoomstart",o)),this._rotating&&!m.rotating&&this.fire(new d.Event("rotatestart",o)),this._pitching&&!m.pitching&&this.fire(new d.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new d.Event("move",o)),this._zooming&&this.fire(new d.Event("zoom",o)),this._rotating&&this.fire(new d.Event("rotate",o)),this._pitching&&this.fire(new d.Event("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.transform.cameraElevationReference="ground";const m=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new d.Event("zoomend",o)),y&&this.fire(new d.Event("rotateend",o)),x&&this.fire(new d.Event("pitchend",o)),this.fire(new d.Event("moveend",o))}flyTo(o,c){if(!o.essential&&d.exported.prefersReducedMotion){const je=d.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,c)}this.stop(),o=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},o);const m=this.transform,y=this.getZoom(),x=this.getBearing(),E=this.getPitch(),C=this.getPadding(),P="zoom"in o?d.clamp(+o.zoom,m.minZoom,m.maxZoom):y,k="bearing"in o?this._normalizeBearing(o.bearing,x):x,R="pitch"in o?+o.pitch:E,O="padding"in o?o.padding:m.padding,j=m.zoomScale(P-y),Z=d.pointGeometry.convert(o.offset);let G=m.centerPoint.add(Z);const W=m.pointLocation(G),se=d.LngLat.convert(o.center||W);this._normalizeCenter(se);const H=m.project(W),ne=m.project(se).sub(H);let re=o.curve;const te=Math.max(m.width,m.height),Q=te/j,oe=ne.mag();if("minZoom"in o){const je=d.clamp(Math.min(o.minZoom,y,P),m.minZoom,m.maxZoom),nt=te/m.zoomScale(je-y);re=Math.sqrt(nt/oe*2)}const de=re*re;function xe(je){const nt=(Q*Q-te*te+(je?-1:1)*de*de*oe*oe)/(2*(je?Q:te)*de*oe);return Math.log(Math.sqrt(nt*nt+1)-nt)}function Ue(je){return(Math.exp(je)-Math.exp(-je))/2}function Re(je){return(Math.exp(je)+Math.exp(-je))/2}const Le=xe(0);let we=function(je){return Re(Le)/Re(Le+re*je)},ve=function(je){return te*((Re(Le)*(Ue(nt=Le+re*je)/Re(nt))-Ue(Le))/de)/oe;var nt},ke=(xe(1)-Le)/re;if(Math.abs(oe)<1e-6||!isFinite(ke)){if(Math.abs(te-Q)<1e-6)return this.easeTo(o,c);const je=Q<te?-1:1;ke=Math.abs(Math.log(Q/te))/re,ve=function(){return 0},we=function(nt){return Math.exp(je*re*nt)}}o.duration="duration"in o?+o.duration:1e3*ke/("screenSpeed"in o?+o.screenSpeed/re:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const De=x!==k,tt=R!==E,lt=!m.isPaddingEqual(O),Tt=je=>nt=>{const mt=nt*ke,on=1/we(mt);je.zoom=1===nt?P:y+je.scaleZoom(on),De&&(je.bearing=d.number(x,k,nt)),tt&&(je.pitch=d.number(E,R,nt)),lt&&(je.interpolatePadding(C,O,nt),G=je.centerPoint.add(Z));const pn=1===nt?se:je.unproject(H.add(ne.mult(ve(mt))).mult(on));return je.setLocationAtPoint(je.renderWorldCopies?pn.wrap():pn,G),je._updateCenterElevation(),o.preloadOnly||this._fireMoveEvents(c),je};if(o.preloadOnly){const je=this._emulate(Tt,o.duration,m);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=De,this._pitching=tt,this._padding=lt,this._prepareEase(c,!1),this._ease(Tt(m),()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,c)}if(!o){const m=this.handlers;m&&m.stop(!1)}return this}_ease(o,c,m){!1===m.animate||0===m.duration?(o(1),c()):(this._easeStart=d.exported.now(),this._easeOptions=m,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=d.wrap(o,-180,180);const m=Math.abs(o-c);return Math.abs(o-360-c)<m&&(o-=360),Math.abs(o+360-c)<m&&(o+=360),o}_normalizeCenter(o){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const m=o.lng-c.center.lng;o.lng+=m>180?-360:m<-180?360:0}_emulate(o,c,m){const y=Math.ceil(15*c/1e3),x=[],E=o(m.clone());for(let C=0;C<=y;C++){const P=E(C/y);x.push(P.clone())}return x}}class Oc{constructor(o={}){this.options=o,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const c=this.options&&this.options.compact;return this._map=o,this._container=Pe.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Pe.create("button","mapboxgl-ctrl-attrib-button",this._container),Pe.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Pe.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,c){const m=this._map._getUIString(`AttributionControl.${c}`);o.setAttribute("aria-label",m),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(o){const m=c.reduce((y,x,E)=>(x.value&&(y+=`${x.key}=${x.value}${E<c.length-1?"&":""}`),y),"?");o.href=`${d.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||"metadata"!==o.sourceDataType&&"visibility"!==o.sourceDataType&&"style"!==o.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const x=c[y];if(x.used){const E=x.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o.sort((y,x)=>y.length-x.length),o=o.filter((y,x)=>{for(let E=x+1;E<o.length;E++)if(o[E].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const m=o.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,o.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Nl{constructor(){d.bindAll(["_updateLogo"],this),d.bindAll(["_updateCompact"],this)}onAdd(o){this._map=o,this._container=Pe.create("div","mapboxgl-ctrl");const c=Pe.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(0===Object.entries(o).length)return!0;for(const c in o){const m=o[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const c=o[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class vt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const y of m)if(y.id===o)return void(y.cancelled=!0)}run(o=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function kh(f,o,c){if(f=new d.LngLat(f.lng,f.lat),o){const m=new d.LngLat(f.lng-360,f.lat),y=new d.LngLat(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),E=c.locationPoint(f).distSqr(o),C=o.x<0||o.y<0||o.x>c.width||o.y>c.height;c.locationPoint(m).distSqr(o)<E&&(C||Math.abs(m.lng-c.center.lng)<x)?f=m:c.locationPoint(y).distSqr(o)<E&&(C||Math.abs(y.lng-c.center.lng)<x)&&(f=y)}for(;Math.abs(f.lng-c.center.lng)>180;){const m=c.locationPoint(f);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const mr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ou extends d.Evented{constructor(o,c){if(super(),(o instanceof d.window.HTMLElement||c)&&(o=d.extend({element:o},c)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=d.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Pe.create("div");const y=41,x=27,E=Pe.createSVG("svg",{display:"block",height:y*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${y}`},this._element),C=Pe.createSVG("radialGradient",{id:"shadowGradient"},Pe.createSVG("defs",{},E));Pe.createSVG("stop",{offset:"10%","stop-opacity":.4},C),Pe.createSVG("stop",{offset:"100%","stop-opacity":.05},C),Pe.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),Pe.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),Pe.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),Pe.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=d.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const m=this._element.classList;for(const y in mr)m.remove(`mapboxgl-marker-anchor-${y}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=d.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const c=o.code,m=o.charCode||o.keyCode;"Space"!==c&&"Enter"!==c&&32!==m&&13!==m||this.togglePopup()}_onMapClick(o){const c=o.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const o=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(o))return void this._clearFadeTimer();const c=this._map.unproject(o);let m=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const x=this._map.getFreeCameraOptions();if(x.position){const E=x.position.toLngLat();m=E.distanceTo(c)<.9*E.distanceTo(this._lngLat)}}const y=(1-this._map._queryFogOpacity(c))*(m?.2:1);this._element.style.opacity=`${y}`,this._popup&&this._popup._setOpacity(`${y}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(o){const c=this._map.transform;return!!o&&o.x>=0&&o.x<c.width&&o.y>=0&&o.y<c.height}_updateDOM(){const o=this._pos||new d.pointGeometry(0,0),c=this._calculatePitch(),m=this._calculateRotation();this._element.style.transform=`${mr[this._anchor]} translate(${o.x}px, ${o.y}px) rotateX(${c}deg) rotateZ(${m}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(o){d.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=kh(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),!0===o?this._updateFrameId=d.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const o=this._map.transform,c=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&c._rotate(o.angle),"map"===this._pitchAlignment&&(c.y*=Math.cos(o._pitch)),c}getOffset(){return this._offset}setOffset(o){return this._offset=d.pointGeometry.convert(o),this._update(),this}_onMove(o){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Yo{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const c=d.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,c,m){this._start=this.getValue(c),this._end=o,this._startTime=c,this._endTime=c+m}}const Bu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Ji,HTMLElement:Ha,ImageBitmap:Ne}=d.window,Jt={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function qa(f){f.parentNode&&f.parentNode.removeChild(f)}const ir={showCompass:!0,showZoom:!0,visualizePitch:!1};class Nu{constructor(o,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Ai({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,m&&(this.mousePitch=new Bl({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),Pe.disableDrag()}move(o,c){const m=this.map,y=this.mouseRotate.mousemoveWindow(o,c);if(y&&y.bearingDelta&&m.setBearing(m.getBearing()+y.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(o,c);x&&x.pitchDelta&&m.setPitch(m.getPitch()+x.pitchDelta)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Pe.enableDrag(),d.window.removeEventListener("mousemove",this.mousemove),d.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(d.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Pe.mousePos(this.element,o)),d.window.addEventListener("mousemove",this.mousemove),d.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Pe.mousePos(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){1!==o.targetTouches.length?this.reset():(this._startPos=this._lastPos=Pe.touchPos(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){1!==o.targetTouches.length?this.reset():(this._lastPos=Pe.touchPos(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){0===o.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Jo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Dn,ia=0,Ts=!1;const Bc={maxWidth:100,unit:"metric"};function Ye(f,o,c){const m=c&&c.maxWidth||100,y=f._containerHeight/2,x=f.unproject([0,y]),E=f.unproject([m,y]),C=x.distanceTo(E);if(c&&"imperial"===c.unit){const P=3.2808*C;P>5280?Qo(o,m,P/5280,f._getUIString("ScaleControl.Miles"),f):Qo(o,m,P,f._getUIString("ScaleControl.Feet"),f)}else c&&"nautical"===c.unit?Qo(o,m,C/1852,f._getUIString("ScaleControl.NauticalMiles"),f):C>=1e3?Qo(o,m,C/1e3,f._getUIString("ScaleControl.Kilometers"),f):Qo(o,m,C,f._getUIString("ScaleControl.Meters"),f)}function Qo(f,o,c,m,y){const x=function(C){const P=Math.pow(10,`${Math.floor(C)}`.length-1);let k=C/P;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(R){const O=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*O)/O}(k),P*k}(c),E=x/c;y._requestDomTask(()=>{f.style.width=o*E+"px",f.innerHTML=`${x}&nbsp;${m}`})}const Vl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},or=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Lr={version:d.version,supported:Kn,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends Ko{constructor(f){if(null!=(f=d.extend({},Jt,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Pc(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._renderTaskQueue=new vt,this._domRenderTaskQueue=new vt,this._controls=[],this._markers=[],this._mapId=d.uniqueId(),this._locale=d.extend({},Bu,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Yo(0),this._requestManager=new d.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=d.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof Ha))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&d.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Es(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new tp("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,d.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Oc({customAttribution:f.customAttribution})),this._logoControl=new Nl,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update("style"===o.dataType),this.fire(new d.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new d.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(f,o){if(void 0===o&&(o=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const m=this._controlPositions[o];return-1!==o.indexOf("bottom")?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(f);return o>-1&&this._controls.splice(o,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new d.Event("movestart",f)).fire(new d.Event("move",f)),this.fire(new d.Event("resize",f)),o&&this.fire(new d.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(d.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=null==f?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=null==f?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=null==f?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=null==f?85:f)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getProjection(){return this.transform.getProjection()}setProjection(f){return this._lazyInitEmptyStyle(),"string"==typeof f&&(f={name:f}),this._runtimeProjection=f,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(f){return this.transform.locationPoint3D(d.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(d.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(f,o,c){if("mouseenter"===f||"mouseover"===f){let m=!1;const y=E=>{const C=o.filter(k=>this.getLayer(k)),P=C.length?this.queryRenderedFeatures(E.point,{layers:C}):[];P.length?m||(m=!0,c.call(this,new fr(f,this,E.originalEvent,{features:P}))):m=!1},x=()=>{m=!1};return{layers:new Set(o),listener:c,delegates:{mousemove:y,mouseout:x}}}if("mouseleave"===f||"mouseout"===f){let m=!1;const y=E=>{const C=o.filter(P=>this.getLayer(P));(C.length?this.queryRenderedFeatures(E.point,{layers:C}):[]).length?m=!0:m&&(m=!1,c.call(this,new fr(f,this,E.originalEvent)))},x=E=>{m&&(m=!1,c.call(this,new fr(f,this,E.originalEvent)))};return{layers:new Set(o),listener:c,delegates:{mousemove:y,mouseout:x}}}{const m=y=>{const x=o.filter(C=>this.getLayer(C)),E=x.length?this.queryRenderedFeatures(y.point,{layers:x}):[];E.length&&(y.features=E,c.call(this,y),delete y.features)};return{layers:new Set(o),listener:c,delegates:{[f]:m}}}}on(f,o,c){if(void 0===c)return super.on(f,o);Array.isArray(o)||(o=[o]);const m=this._createDelegatedListener(f,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(f,o,c){if(void 0===c)return super.once(f,o);Array.isArray(o)||(o=[o]);const m=this._createDelegatedListener(f,o,c);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(f,o,c){if(void 0===c)return super.off(f,o);o=new Set(Array.isArray(o)?o:[o]);const m=(x,E)=>{if(x.size!==E.size)return!1;for(const C of x)if(!E.has(C))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[f]:void 0;return y&&(x=>{for(let E=0;E<x.length;E++){const C=x[E];if(C.listener===c&&m(C.layers,o)){for(const P in C.delegates)this.off(P,C.delegates[P]);return x.splice(E,1),this}}})(y),this}queryRenderedFeatures(f,o){return this.style?(void 0!==o||void 0===f||f instanceof d.pointGeometry||Array.isArray(f)||(o=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(f,o){return this.style.querySourceFeatures(f,o)}queryTerrainElevation(f,o){const c=this.transform.elevation;return c?(o=d.extend({},{exaggerated:!0},o),c.getAtPoint(d.MercatorCoordinate.fromLngLat(f),null,o.exaggerated)):null}setStyle(f,o){return!1!==(o=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(f,o))}_getUIString(f){const o=this._locale[f];if(null==o)throw new Error(`Missing UI string '${f}'`);return o}_updateStyle(f,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),f&&(this.style=new zn(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new zn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,o){if("string"==typeof f){const c=this._requestManager.normalizeStyleURL(f),m=this._requestManager.transformRequest(c,d.ResourceType.Style);d.getJSON(m,(y,x)=>{y?this.fire(new d.ErrorEvent(y)):x&&this._updateDiff(x,o)})}else"object"==typeof f&&this._updateDiff(f,o)}_updateDiff(f,o){try{this.style.setState(f)&&this._update(!0)}catch(c){d.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(f,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")}addSource(f,o){return this._lazyInitEmptyStyle(),this.style.addSource(f,o),this._update(!0)}isSourceLoaded(f){const o=this.style&&this.style._getSourceCaches(f);if(0!==o.length)return o.every(c=>c.loaded());this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const o in f){const c=f[o]._tiles;for(const m in c){const y=c[m];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(f,o,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,o,c)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,o,{pixelRatio:c=1,sdf:m=!1,stretchX:y,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),o instanceof Ji||Ne&&o instanceof Ne){const{width:C,height:P,data:k}=d.exported.getImageData(o);this.style.addImage(f,{data:new d.RGBAImage({width:C,height:P},k),pixelRatio:c,stretchX:y,stretchY:x,content:E,sdf:m,version:0})}else{if(void 0===o.width||void 0===o.height)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:P,data:k}=o,R=o;this.style.addImage(f,{data:new d.RGBAImage({width:C,height:P},new Uint8Array(k)),pixelRatio:c,stretchX:y,stretchY:x,content:E,sdf:m,version:0,userImage:R}),R.onAdd&&R.onAdd(this,f)}}}updateImage(f,o){const c=this.style.getImage(f);if(!c)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=o instanceof Ji||Ne&&o instanceof Ne?d.exported.getImageData(o):o,{width:y,height:x,data:E}=m;return void 0===y||void 0===x?this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):y!==c.data.width||x!==c.data.height?this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(c.data.replace(E,!(o instanceof Ji||Ne&&o instanceof Ne)),void this.style.updateImage(f,c))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,o){d.getImage(this._requestManager.transformRequest(f,d.ResourceType.Image),(c,m)=>{o(c,m instanceof Ji?d.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(f,o){return this._lazyInitEmptyStyle(),this.style.addLayer(f,o),this._update(!0)}moveLayer(f,o){return this.style.moveLayer(f,o),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,o,c){return this.style.setLayerZoomRange(f,o,c),this._update(!0)}setFilter(f,o,c={}){return this.style.setFilter(f,o,c),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,o,c,m={}){return this.style.setPaintProperty(f,o,c,m),this._update(!0)}getPaintProperty(f,o){return this.style.getPaintProperty(f,o)}setLayoutProperty(f,o,c,m={}){return this.style.setLayoutProperty(f,o,c,m),this._update(!0)}getLayoutProperty(f,o){return this.style.getLayoutProperty(f,o)}setLight(f,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){"globe"===this.transform.projection.name&&this.transform.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(f),this.transform):0}setFeatureState(f,o){return this.style.setFeatureState(f,o),this._update()}removeFeatureState(f,o){return this.style.removeFeatureState(f,o),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let c,m=this._container;for(;m&&!c;){const y=d.window.getComputedStyle(m).transform;y&&"none"!==y&&(c=y.match(/matrix.*\((.+)\)/)[1].split(", ")),m=m.parentElement}c?(this._containerWidth=c[0]&&"0"!==c[0]?Math.abs(f/c[0]):f,this._containerHeight=c[3]&&"0"!==c[3]?Math.abs(o/c[3]):o):(this._containerWidth=f,this._containerHeight=o)}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Pe.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=Pe.create("div","mapboxgl-canvas-container",f);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=Pe.create("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=Pe.create("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=Pe.create("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,o){const c=d.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(o),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${o}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const o=this._markers.indexOf(f);-1!==o&&this._markers.splice(o,1)}_setupPainter(){const f=d.extend({},Kn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);o?(d.storeAuthState(o,!0),this.painter=new Eh(o,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(o)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let o;const c=this.painter.context.extTimerQuery,m=d.exported.now();this.listens("gpu-timing-frame")&&(o=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,o));let y=this._updateAverageElevation(m);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjection();let x=!1;const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,k=this.transform.pitch,R=d.exported.now();this.style.zoomHistory.update(P,R);const O=new d.EvaluationParameters(P,{now:R,fadeDuration:E,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=O.crossFadingFactor();1===j&&j===this._crossFadingFactor||(x=!0,this._crossFadingFactor=j),this.style.update(O)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const P=d.exported.now()-m;c.endQueryEXT(c.TIME_ELAPSED_EXT,o),setTimeout(()=>{const k=c.getQueryObjectEXT(o,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(o),this.fire(new d.Event("gpu-timing-frame",{cpuTime:P,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(P);this.fire(new d.Event("gpu-timing-layer",{layerTimes:k}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(C||this._repaint)this.triggerRepaint();else{const P=!this.isMoving()&&this.loaded();if(P&&(y=this._updateAverageElevation(m,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,o=!1){const c=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((o||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const m=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();isNaN(y)?y=0:this._averageElevationLastSampledAt=f;const x=Math.abs(m-y);if(x>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,f,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===d.AUTH_ERR_MSG||401===f.status)){const o=this.painter.context.gl;d.storeAuthState(o,!1),this._logoControl instanceof Nl&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function y(x){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,x,0);const E=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,E),E}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(y(f),o.canvasCopies.map(y),o.timeStamps)}_canvasPixelComparison(f,o,c){let m=c[1]-c[0];const y=f.length/4;for(let x=0;x<o.length;x++){const E=o[x];let C=0;for(let P=0;P<E.length;P+=4)E[P]===f[P]&&E[P+1]===f[P+1]&&E[P+2]===f[P+2]&&E[P+3]===f[P+3]&&(C+=1);m+=(c[x+2]-c[x+1])*(1-C/y)}return m}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),qa(this._canvasContainer),qa(this._controlContainer),qa(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=d.exported.frame(o=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(o)}))}_preloadTiles(f){const o=this.style&&Object.values(this.style._sourceCaches)||[];return d.asyncAll(o,(c,m)=>c._preloadTiles(f,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,o){d.setCacheLimits(f,o)}get version(){return d.version}},NavigationControl:class{constructor(f){this.options=d.extend({},ir,f),this._container=Pe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),Pe.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),Pe.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=Pe.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const f=this._map.getZoom(),o=f===this._map.getMaxZoom(),c=f===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=f)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,o){const c=Pe.create("button",f,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(f,o){const c=this._map._getUIString(`NavigationControl.${o}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends d.Evented{constructor(f){super(),this.options=d.extend({},Jo,f),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Qs(this._updateMarkerRotation,20)}onAdd(f){var o;return this._map=f,this._container=Pe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,void 0!==Dn?o(Dn):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(c=>{Dn="denied"!==c.state,o(Dn)}):(Dn=!!d.window.navigator.geolocation,o(Dn)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,ia=0,Ts=!1}_isOutOfMapMaxBounds(f){const o=this._map.getMaxBounds(),c=f.coords;return o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",f)),this._finish()}}_updateCamera(f){const o=new d.LngLat(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,m=this._map.getBearing(),y=d.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),y,{geolocateSource:!0})}_updateMarker(f){if(f){const o=new d.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._containerHeight/2,o=this._map.unproject([0,f]),c=this._map.unproject([100,f]),m=o.distanceTo(c)/100,y=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&Ts)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Pe.create("button","mapboxgl-ctrl-geolocate",this._container),Pe.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===f){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Pe.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Pe.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Pe.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ou({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Pe.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ou({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||"ACTIVE_LOCK"!==this._watchState||o.originalEvent&&"resize"===o.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ia--,Ts=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ia++,ia>1?(f={maximumAge:6e5,timeout:0},Ts=!0):(f=this.options.positionOptions,Ts=!1),this._geolocationWatchID=d.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else d.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(o=>{"granted"===o&&f()}).catch(console.error):f()}_clearWatch(){d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Oc,ScaleControl:class{constructor(f){this.options=d.extend({},Bc,f),d.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ye(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=Pe.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,Ye(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof d.window.HTMLElement?this._container=f.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Pe.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Pe.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Pe.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(f){super(),this.options=d.extend(Object.create(Vl),f),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(d.window.document.createTextNode(f))}setHTML(f){const o=d.window.document.createDocumentFragment(),c=d.window.document.createElement("body");let m;for(c.innerHTML=f;m=c.firstChild,m;)o.appendChild(m);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Pe.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._container&&this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._container&&this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let o;return this._classList.delete(f)?o=!1:(this._classList.add(f),o=!0),this._container&&this._updateClassList(),o}_createCloseButton(){this.options.closeButton&&(this._closeButton=Pe.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const o=this._pos,c=this._container.offsetWidth,m=this._container.offsetHeight;let y;return y=o.y+f.bottom.y<m?["top"]:o.y>this._map.transform.height-m?["bottom"]:[],o.x<c/2?y.push("left"):o.x>this._map.transform.width-c/2&&y.push("right"),0===y.length?"bottom":y.join("-")}_updateClassList(){const f=[...this._classList];f.push("mapboxgl-popup"),this._anchor&&f.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&f.push("mapboxgl-popup-track-pointer"),this._container.className=f.join(" ")}_update(f){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Pe.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Pe.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=kh(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f){const o=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),c=function(x){if(x||(x=new d.pointGeometry(0,0)),"number"==typeof x){const E=Math.round(Math.sqrt(.5*Math.pow(x,2)));return{center:new d.pointGeometry(0,0),top:new d.pointGeometry(0,x),"top-left":new d.pointGeometry(E,E),"top-right":new d.pointGeometry(-E,E),bottom:new d.pointGeometry(0,-x),"bottom-left":new d.pointGeometry(E,-E),"bottom-right":new d.pointGeometry(-E,-E),left:new d.pointGeometry(x,0),right:new d.pointGeometry(-x,0)}}if(x instanceof d.pointGeometry||Array.isArray(x)){const E=d.pointGeometry.convert(x);return{center:E,top:E,"top-left":E,"top-right":E,bottom:E,"bottom-left":E,"bottom-right":E,left:E,right:E}}return{center:d.pointGeometry.convert(x.center||[0,0]),top:d.pointGeometry.convert(x.top||[0,0]),"top-left":d.pointGeometry.convert(x["top-left"]||[0,0]),"top-right":d.pointGeometry.convert(x["top-right"]||[0,0]),bottom:d.pointGeometry.convert(x.bottom||[0,0]),"bottom-left":d.pointGeometry.convert(x["bottom-left"]||[0,0]),"bottom-right":d.pointGeometry.convert(x["bottom-right"]||[0,0]),left:d.pointGeometry.convert(x.left||[0,0]),right:d.pointGeometry.convert(x.right||[0,0])}}(this.options.offset),m=this._anchor=this._getAnchor(c),y=o.add(c[m]).round();this._map._requestDomTask(()=>{this._container&&m&&(this._container.style.transform=`${mr[m]} translate(${y.x}px,${y.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(or);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._content&&(this._content.style.opacity=f),this._tip&&(this._tip.style.opacity=f)}},Marker:Ou,Style:zn,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:Si,Evented:d.Evented,config:d.config,prewarm:function(){ue().acquire(le)},clearPrewarmedResources:function(){const f=pe;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(le),pe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(f){d.config.ACCESS_TOKEN=f},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(f){d.config.API_URL=f},get workerCount(){return ge.workerCount},set workerCount(f){ge.workerCount=f},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){d.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){d.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return Lr}),Rn}()}},Kd=>{Kd(Kd.s=562)}]);